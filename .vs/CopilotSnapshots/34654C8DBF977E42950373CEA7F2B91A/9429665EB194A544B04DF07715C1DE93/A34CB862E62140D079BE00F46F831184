Imports VB = Microsoft.VisualBasic
Imports System.Data
Imports DevExpress.XtraPrinting
Imports DevExpress.XtraReports.UI
Imports System.Drawing.Imaging
Imports System.Drawing
Imports System.Data.SqlClient
Imports EgsReport.clsGlobal
Imports System.Windows.Forms
Imports EgsData
Imports System.IO
Imports System.Threading
Imports System.Globalization
Imports System.Math
Imports System
Imports log4net

Imports Microsoft.Win32.SafeHandles     'RDTC 2017.06.22
Imports System.Runtime.InteropServices  'RDTC 2017.06.22
Imports System.Drawing.Drawing2D


Public Class StandardDetail
    Inherits DevExpress.XtraReports.UI.XtraReport
    Private Shared ReadOnly Log As ILog = LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType)
    Dim intNewY As Integer
    Dim intNewX As Integer

#Region " DECLARATIONS "
    '30.11.2005
    Dim strX As String
    Dim strReportTitle As String
    Dim dblNutrientFactor As Double
    Dim L_NutrientCount As Integer
    Dim L_lngCol(0 To 10) As Long
    Dim L_Nutrient(0 To 34) As clsGlobal.tNutrient '15
    Dim L_lngNameW As Long

    Dim sf As StringFormat = New StringFormat(StringFormatFlags.NoClip)
    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    Private WithEvents SubRptDetail As DevExpress.XtraReports.UI.Subreport
    Private WithEvents xrLblEGS As DevExpress.XtraReports.UI.XRLabel
    Private WithEvents xrLblEGS2 As DevExpress.XtraReports.UI.XRLabel
    Private WithEvents xrPIPageNumber As DevExpress.XtraReports.UI.XRPageInfo
    Private WithEvents xrLinePF As DevExpress.XtraReports.UI.XRLine
    Friend WithEvents Style1 As DevExpress.XtraReports.UI.XRControlStyle
    Friend WithEvents XrFooterPicLogo As DevExpress.XtraReports.UI.XRPictureBox

    'For SV Kolb's Report only 12.29.09
    Private intGlobalX, intGlobalMultiplier As Integer
    Private fntHeading As New Font("Arial", 12.0!, FontStyle.Bold)
    Private fntBodyBold As New Font("Arial", 8.0!, FontStyle.Bold)
    Private fntBody As New Font("Arial", 8.0!, FontStyle.Regular)
    Private fntBodyItalic As New Font("Arial", 8.0!, FontStyle.Italic)

    Dim i As Integer
#End Region

#Region " DESIGNER GENERATED CODE "
    Public Sub New()
        MyBase.New()

        'This call is required by the Designer.
        InitializeComponent()

        'Add any initialization after the InitializeComponent() call
    End Sub

    'XtraReport overrides dispose to clean up the component list.
    <System.Diagnostics.DebuggerNonUserCode()> _
    Protected Overrides Sub Dispose(ByVal disposing As Boolean)
        If disposing AndAlso components IsNot Nothing Then
            components.Dispose()
        End If
        MyBase.Dispose(disposing)
    End Sub

    'Required by the Designer
    Private components As System.ComponentModel.IContainer

    'NOTE: The following procedure is required by the Designer
    'It can be modified using the Designer.  
    'Do not modify it using the code editor.
    <System.Diagnostics.DebuggerStepThrough()> _
    Private Sub InitializeComponent()
        Me.Style1 = New DevExpress.XtraReports.UI.XRControlStyle
        Me.Detail = New DevExpress.XtraReports.UI.DetailBand
        Me.PageHeader = New DevExpress.XtraReports.UI.PageHeaderBand
        Me.PageFooter = New DevExpress.XtraReports.UI.PageFooterBand
        Me.XrFooterPicLogo = New DevExpress.XtraReports.UI.XRPictureBox
        Me.xrLblEGS = New DevExpress.XtraReports.UI.XRLabel
        Me.xrLblEGS2 = New DevExpress.XtraReports.UI.XRLabel
        Me.xrPIPageNumber = New DevExpress.XtraReports.UI.XRPageInfo
        Me.xrLinePF = New DevExpress.XtraReports.UI.XRLine
        CType(Me, System.ComponentModel.ISupportInitialize).BeginInit()
        '
        'Style1
        '
        Me.Style1.Borders = CType((((DevExpress.XtraPrinting.BorderSide.Left Or DevExpress.XtraPrinting.BorderSide.Top) _
                    Or DevExpress.XtraPrinting.BorderSide.Right) _
                    Or DevExpress.XtraPrinting.BorderSide.Bottom), DevExpress.XtraPrinting.BorderSide)
        Me.Style1.Name = "Style1"
        '
        'Detail
        '
        Me.Detail.Height = 0
        Me.Detail.Name = "Detail"
        '
        'PageHeader
        '
        Me.PageHeader.Height = 35
        Me.PageHeader.Name = "PageHeader"
        '
        'PageFooter
        '
        Me.PageFooter.Controls.AddRange(New DevExpress.XtraReports.UI.XRControl() {Me.XrFooterPicLogo, Me.xrLblEGS, Me.xrLblEGS2, Me.xrPIPageNumber, Me.xrLinePF})
        Me.PageFooter.Height = 45
        Me.PageFooter.LockedInUserDesigner = True
        Me.PageFooter.Name = "PageFooter"
        Me.PageFooter.ParentStyleUsing.UseBorders = False
        '
        'XrFooterPicLogo
        '
        Me.XrFooterPicLogo.Location = New System.Drawing.Point(300, 17)
        Me.XrFooterPicLogo.Name = "XrFooterPicLogo"
        Me.XrFooterPicLogo.Size = New System.Drawing.Size(58, 16)
        Me.XrFooterPicLogo.Visible = False
        '
        'xrLblEGS
        '
        Me.xrLblEGS.Font = New System.Drawing.Font("Arial", 9.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
        Me.xrLblEGS.KeepTogether = True
        Me.xrLblEGS.Location = New System.Drawing.Point(0, 9)
        Me.xrLblEGS.Name = "xrLblEGS"
        Me.xrLblEGS.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
        Me.xrLblEGS.ParentStyleUsing.UseBorders = False
        Me.xrLblEGS.ParentStyleUsing.UseFont = False
        Me.xrLblEGS.Size = New System.Drawing.Size(333, 17)
        Me.xrLblEGS.Visible = False
        '
        'xrLblEGS2
        '
        Me.xrLblEGS2.Font = New System.Drawing.Font("Arial", 9.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
        Me.xrLblEGS2.KeepTogether = True
        Me.xrLblEGS2.Location = New System.Drawing.Point(0, 9)
        Me.xrLblEGS2.Name = "xrLblEGS"
        Me.xrLblEGS2.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
        Me.xrLblEGS2.ParentStyleUsing.UseBorders = False
        Me.xrLblEGS2.ParentStyleUsing.UseFont = False
        Me.xrLblEGS2.Size = New System.Drawing.Size(333, 17)
        Me.xrLblEGS2.Visible = False
        '
        'xrPIPageNumber
        '
        Me.xrPIPageNumber.Font = New System.Drawing.Font("Arial", 9.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
        Me.xrPIPageNumber.Format = "Page {0} of {1}"
        Me.xrPIPageNumber.Location = New System.Drawing.Point(358, 9)
        Me.xrPIPageNumber.Name = "xrPIPageNumber"
        Me.xrPIPageNumber.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
        Me.xrPIPageNumber.ParentStyleUsing.UseBorderColor = False
        Me.xrPIPageNumber.ParentStyleUsing.UseBorders = False
        Me.xrPIPageNumber.ParentStyleUsing.UseFont = False
        Me.xrPIPageNumber.ParentStyleUsing.UseForeColor = False
        Me.xrPIPageNumber.Size = New System.Drawing.Size(292, 17)
        Me.xrPIPageNumber.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
        Me.xrPIPageNumber.Visible = False
        '
        'xrLinePF 
        '
        Me.xrLinePF.Location = New System.Drawing.Point(0, 0)
        Me.xrLinePF.Name = "xrLinePF"
        Me.xrLinePF.Size = New System.Drawing.Size(650, 9)
        Me.xrLinePF.Visible = False
        '
        'StandardDetail
        '
        Me.Bands.AddRange(New DevExpress.XtraReports.UI.Band() {Me.Detail, Me.PageHeader, Me.PageFooter})
        Me.Margins = New System.Drawing.Printing.Margins(100, 1, 100, 100)
        Me.StyleSheet.AddRange(New DevExpress.XtraReports.UI.XRControlStyle() {Me.Style1})
        CType(Me, System.ComponentModel.ISupportInitialize).EndInit()

    End Sub
    Friend WithEvents Detail As DevExpress.XtraReports.UI.DetailBand
    Friend WithEvents PageHeader As DevExpress.XtraReports.UI.PageHeaderBand
    Friend WithEvents PageFooter As DevExpress.XtraReports.UI.PageFooterBand

#End Region

#Region " Old Codes"
    'MCM 02 JANUARY 2005
    Function fctPrintRecipeEgsStandard2(ByVal foundDetails() As DataRow, _
                                                     ByVal foundKeywords() As DataRow, _
                                                     ByVal foundAllergens() As DataRow) As XtraReport   'MCM 03.03.06

        Dim strRecipeName As String
        Dim strPortionUnit As String
        Dim strYieldName As String
        Dim intCount As Integer
        Dim dblMaxHeightPicture As Double
        Dim dblMaxWidthPicture As Double
        Dim strPicture(0 To 2) As String
        Dim str3Pictures As String
        Dim blflagQtyFirst As Boolean
        Dim intDictionary As Integer
        Dim intColumnWidth As Integer = 100
        Dim intPicStart As Integer

        fctPrintRecipeEgsStandard2 = Nothing

        Try
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
        Catch ex As Exception

            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try



        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, G_strConnection) 'VRP 08.01.2009
        End If

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)


            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = (intAvailableWidth - G_ReportOptions.dblLeftMargin - G_ReportOptions.dblRightMargin)


            intCount = 0
            For i As Integer = 1 To 34 '15
                L_Nutrient(i).Format = G_Nutrient(i).Format
                L_Nutrient(i).Heading = G_Nutrient(i).Heading
                L_Nutrient(i).Name = G_Nutrient(i).Name
                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                L_Nutrient(i).Value = -1
                L_Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
                If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
            Next

            'If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
            'If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
            'If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
            'If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
            'If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
            'If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
            'If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
            'If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
            'If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
            'If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
            'If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
            'If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
            'If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
            'If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
            'If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

            Dim strFieldname As String = Nothing
            Dim strFieldnameForPercent As String = Nothing
            For i As Integer = 1 To 34 '15
                strFieldname = "N" & i.ToString
                strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
                If Not IsDBNull(row(strFieldname)) And _
                   Not IsDBNull(row(strFieldnameForPercent)) Then
                    If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                        L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                        G_Nutrient(i).Unit = "%"
                        L_Nutrient(i).Unit = G_Nutrient(i).Unit
                    Else
                        L_Nutrient(i).Value = CType(row(strFieldname), Double)
                        L_Nutrient(i).Unit = G_Nutrient(i).Unit
                    End If
                End If
            Next

            intDictionary = G_Language

            If G_ReportOptions.intTranslation > 0 Then
                If IsDBNull(CType(row("CodeDictionary"), Integer)) Then
                    intDictionary = G_Language
                Else
                    intDictionary = CType(row("CodeDictionary"), Integer)
                End If
            End If
            G_Language = intDictionary

            intNewX = 0
            intNewY = 0

            'Recipe Name
            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += intTextHeight

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
            intNewY += intTextHeight

            strYieldName = row("PortionUnit").ToString

            blflagQtyFirst = True
            'Set Picture sizes
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                Select Case G_ReportOptions.strSubStyle
                    Case "01" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4
                    Case "02" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4 : blflagQtyFirst = False
                    Case "11" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5
                    Case "12" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5 : blflagQtyFirst = False
                    Case "21" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                    Case "22" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3 : blflagQtyFirst = False
                    Case Else : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                End Select

                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                Select Case G_ReportOptions.strSubStyle
                    Case "01" : dblMaxHeightPicture = 180
                    Case "02" : dblMaxHeightPicture = 180 : blflagQtyFirst = False
                    Case "11" : dblMaxHeightPicture = 250
                    Case "12" : dblMaxHeightPicture = 250 : blflagQtyFirst = False
                    Case "21" : dblMaxHeightPicture = 350
                    Case "22" : dblMaxHeightPicture = 350 : blflagQtyFirst = False
                End Select
                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If


            str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

            Dim strFileName As String = Nothing
            For j As Integer = 0 To 2
                strPicture(j) = ""
                strPicture(j) = fctGetPictureName(str3Pictures, j)
                If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then strFileName &= strPicture(j)
            Next

            'If strFileName <> "" Then
            '    intNewY += 50
            'End If

            If G_ReportOptions.blnPicturesAll = True Then

                If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To 2
                        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & strPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += CInt(G_dblMaxWidthPicture) + 5
                            strFileName &= strPicture(j)
                        End If
                    Next
                    If strFileName <> "" Then
                        intNewY += CInt(G_dblMaxHeightPicture) + 10
                        intNewX = 0
                        intNewY += intTextHeight
                    End If
                End If
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        For j As Integer = 0 To 2
                            If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                                strFileName = G_strPhotoPath & strPicture(j)
                                .Detail.Controls.AddRange(New XRControl() _
                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                intNewX += G_dblMaxWidthPicture + 20
                                intPicStart = intNewY
                                Exit For
                            End If
                        Next
                    End If
                End If
            End If


            sf = New StringFormat(StringFormatFlags.DirectionVertical)

            G_intMaxRecipeDetailsWidth = 0
            '-----------------<Start> Get Widest 
            If G_ReportOptions.blnIncludeNumber = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)       'Recipe # 
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCategory = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeSource = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeDate = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCostOfGoods = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeRemark = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            'Recipe Number
            If G_ReportOptions.blnIncludeNumber = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                strX = fctSqlReady(row("RecipeNumber").ToString) : strX = Replace(strX, Chr(1), "")
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If


            'AGL 2013.06.17 - 5368 - use fractions
            Dim blnUseFractions As Boolean = G_ReportOptions.blnUseFractions

            ''''-- Remove JBB 06.29.2012
            ' ''Category
            ''If G_ReportOptions.blnIncludeCategory = True Then
            ''    strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            ''    strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            ''    intNewY += intTextHeight
            ''End If

            ' ''Source/Chef
            ''If G_ReportOptions.blnIncludeSource = True Then
            ''    strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            ''    strX = CStr(IIf(IsDBNull(row("Chef").ToString), "", Trim((fctSqlReady(row("Chef").ToString)))))
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            ''    intNewY += intTextHeight
            ''End If

            ' ''Dates
            ''If G_ReportOptions.blnIncludeDate = True Then
            ''    strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            ''    strX = fctSqlReady(fctConvertDate(row("Dates").ToString))
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            ''    intNewY += intTextHeight
            ''End If

            ' ''Cost of goods
            ''If G_ReportOptions.blnIncludeCostOfGoods = True Then
            ''    strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            ''    strX = fctSqlReady(row("Symbole").ToString)
            ''    Dim dblCalcPrice As Double = 0
            ''    If Not IsDBNull(row("calcprice")) Then
            ''        dblCalcPrice = CType(row("calcprice"), Double)
            ''    End If

            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & Trim(strX) & " " & Format(dblCalcPrice, G_strPriceFormat) & " / " & strYieldName, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            ''    intNewY += intTextHeight
            ''End If

            ' ''Remark
            ''If G_ReportOptions.blnIncludeRemark = True Then
            ''    strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            ''    strX = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation)
            ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            ''    intNewY += intTextHeight
            ''End If
            ''''--

            If G_ReportOptions.blnPicturesAll = False Then
                If G_ReportOptions.blnWithPicture = True Then
                    intNewX = 0
                    If intPicStart > 0 Then
                        intNewY = intPicStart + G_dblMaxHeightPicture
                    End If
                End If
            End If

            Dim XRLineSeparator As New XRLine
            With XRLineSeparator
                intNewY += 10
                .Location = New System.Drawing.Point(intNewX, intNewY)
                .Name = "xrLine1"
                .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
            End With
            .Detail.Controls.AddRange(New XRControl() {XRLineSeparator})



            'Servings
            '--------------------------------------------------
            'Ingredients for "Number of Servings" at "DishPercent"
            '--------------------------------------------------
            Dim dblYieldQty As Integer = CType(row("Yield"), Double)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim strPortionUnit2Format As String = G_FormatOneDecimal
            Dim strNumberOfServings As String = Nothing
            Dim strServings As String

            strPortionUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation)

            If G_Options.QtyType = 0 Then
                strNumberOfServings = fctFormatNumericQuantity(dblYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
                If CType(row("Yield2"), Double) > 0 Then
                    strNumberOfServings = strNumberOfServings & "/" &
                    fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " &
                    strPortionUnit
                End If
            Else
                'If G_ReportOptions.blnUseFractions = True Then
                '    strNumberOfServings = fctConvertToFraction2(dblYieldQty) & " " & Trim(strYieldName)
                'Else
                '    strNumberOfServings = dblYieldQty.ToString & " " & Trim(strYieldName)
                'End If
                strNumberOfServings = fctConvertToFraction2(dblYieldQty) & " " & Trim(strYieldName)

                If CType(row("Yield2"), Double) > 0 Then
                    'If G_ReportOptions.blnUseFractions = True Then
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    fctConvertToFraction2(CType(row("Yield2"), Double)) & " " & _
                    '    strPortionUnit
                    'Else
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    CType(row("Yield2"), Double) & " " & _
                    '    strPortionUnit
                    'End If
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction2(CType(row("Yield2"), Double)) & " " &
                        strPortionUnit
                End If
            End If

            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", CType(row("DishPercent"), Double))     '"Ingredients for " & strNumberOfServings & " at " & rsX!DishPercent & "% (Net Quantity)"
            strServings = strServings.Replace("N/A", "").Replace("n/a", "")
            strServings = strServings.Replace("[_]", "")
            sf = New StringFormat(StringFormatFlags.NoClip)
            intTextHeight = ReportingTextUtils.MeasureText(strServings, fntBold, intAvailableWidth, sf, Me.Padding).Height

            intNewY += 10
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strServings, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += intTextHeight + 10

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height

            'Get Ingredients
            Dim strNumber As String = Nothing
            Dim strComplement As String = Nothing
            Dim strIngredient As String = Nothing
            Dim sUnit As String = Nothing
            Dim strQuantityNet As String = "0"
            Dim strUnitFormat As String = G_FormatOneDecimal
            Dim dblPercentage As Double
            Dim bBold As Boolean
            Dim intWidestQty As Integer
            Dim intWidestUnit As Integer
            Dim intWidestItemNumber As Integer
            Dim intWidestIngredient As Integer


            G_Options.ConvertToBestUnit = True
            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
                If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                strQuantityNet = CType(CDbl(strQuantityNet), String)
                dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)

                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                        strQuantityNet = "0"
                        sUnit = ""
                        bBold = True
                    Else
                        If G_Options.QtyType = 0 Then
                            strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                        Else
                            'If G_ReportOptions.blnUseFractions Then
                            '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                            'Else
                            '    strQuantityNet = CDbl(strQuantityNet)
                            'End If
                            strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        End If
                        bBold = False
                    End If
                End If

                sf = New StringFormat(StringFormatFlags.DirectionVertical)
                If intWidestQty < ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestQty = ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestUnit < ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestUnit = ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestItemNumber < ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestItemNumber = ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height
            Next

            intWidestIngredient = intAvailableWidth - intWidestQty - intWidestUnit - intWidestItemNumber - 30
            'intNewY += intTextHeight

            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)

                'For Each rowIng In dtRecipe.Rows
                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                    strIngredient = fctGetTranslatedText(foundDetails(rowIng), "Ingredient", "IngredientTrans", G_ReportOptions.intTranslation)
                    strComplement = fctGetTranslatedText(foundDetails(rowIng), "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                    If strComplement <> "" Then strIngredient = strIngredient & " '" & strComplement & " "

                    If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                    If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                    'strQuantityNet = CType(CDbl(strQuantityNet) * intYieldQty, String)  MCM 15.02.06
                    strQuantityNet = CType(CDbl(strQuantityNet), String)
                    dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                    strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)

                    If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                        If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                            strQuantityNet = "0"
                            sUnit = ""
                        Else
                            If G_Options.QtyType = 0 Then
                                strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                            Else
                                'If blnUseFractions Then
                                '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                                'Else
                                '    strQuantityNet = CDbl(strQuantityNet)
                                'End If
                                strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                            End If
                            bBold = False
                        End If
                    End If

                    intNewX = 0

                    Select Case CType(foundDetails(rowIng)("IngrType"), Integer)
                        Case ID_Recipe : fntFont = fntItalic
                        Case ID_Text : fntFont = fntBold
                        Case Else : fntFont = fntRegular
                    End Select

                    Dim intIngredientHeight As Integer
                    intIngredientHeight = fctGetHighest(strIngredient, intTextHeight, intWidestIngredient, fntFont, sf)


                    If blflagQtyFirst Then

                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + INTCOLUMNSPACE + intWidestUnit + INTCOLUMNSPACE + intWidestItemNumber + INTCOLUMNSPACE
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, False)})
                        Else
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strQuantityNet), fntFont, intNewX, intNewY, intWidestQty, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                            intNewX += intWidestQty + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                            intNewX += intWidestUnit + INTCOLUMNSPACE

                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNumber, fntFont, intNewX, intNewY, intWidestItemNumber, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                                intNewX += intWidestItemNumber + INTCOLUMNSPACE
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                        End If
                        intNewY += intIngredientHeight
                    Else
                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + INTCOLUMNSPACE + intWidestUnit + INTCOLUMNSPACE + intWidestItemNumber + INTCOLUMNSPACE
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, False)})
                        Else

                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strNumber), fntFont, intNewX, intNewY, intWidestItemNumber, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                intNewX += intWidestItemNumber + INTCOLUMNSPACE
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                            intNewX += intWidestIngredient + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strQuantityNet, fntFont, intNewX, intNewY, intWidestQty, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                            intNewX += intWidestQty + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intIngredientHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , False)})
                        End If
                        intNewY += intIngredientHeight

                    End If

                End If
            Next

            intNewX = 0
            'Preparation
            If G_ReportOptions.blnIncludePreparation Then
                If Not IsDBNull(row("Note")) Then
                    strX = row("Note").ToString
                    strX = UCase(Trim(Replace(strX, vbCrLf & "#", vbCrLf)))
                    If Mid(strX, 1, 1) = "#" Then strX = Mid(strX, 2)

                    If Not IsNothing(strX) Then
                        sf = New StringFormat(StringFormatFlags.NoClip)
                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height

                        intNewY += 10
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                        intNewY += intTextHeight
                    End If
                End If
            End If
            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height


            'HACCP
            If G_ReportOptions.blnIncludeHACCP Then
                Dim strCoolingTime As String = Nothing
                Dim strHeatingTime As String = Nothing
                Dim strHeatingTemp As String = Nothing
                Dim strHeatingMode As String = Nothing
                Dim strCCPDesc As String = Nothing
                Dim strHACCP As String = Nothing

                If Not IsDBNull(row("CoolingTime").ToString) Then strCoolingTime = Trim(row("CoolingTime").ToString)
                If Not IsDBNull(row("HeatingTime").ToString) Then strHeatingTime = Trim(row("HeatingTime").ToString)
                If Not IsDBNull(row("HeatingTemperature").ToString) Then strHeatingTemp = Trim(row("HeatingTemperature").ToString)
                If Not IsDBNull(row("HeatingMode").ToString) Then strHeatingMode = Trim(row("HeatingMode").ToString)
                If Not IsDBNull(row("CCPDescription").ToString) Then strCCPDesc = Trim(row("CCPDescription").ToString)
                If Not IsDBNull(row("HACCP")).ToString Then strHACCP = Trim(row("HACCP").ToString)

                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemp, strHeatingMode, strCCPDesc, "001", "", "", strHACCP)
            End If

            'Nutrients()
            If G_ReportOptions.blnIncludeNutrients Then
                subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001")
            End If

            'Keywords()
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then
                subDisplayKeywords(foundKeywords, "001")
            End If


            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                Dim row1 As DataRow = foundDetails(0)

                Dim CodeAllergenTranslation As Integer 'KMQDC 6.17.2015
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)  'KMQDC 6.17.2015
                'subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "001")
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "001", CodeAllergenTranslation)
            End If


        End With

        Return Me
    End Function

    Function fctPrintRecipeEgsModern2(ByVal foundDetails() As DataRow,
                                     ByVal foundKeywords() As DataRow,
                                     ByVal foundAllergens() As DataRow) As XtraReport
        Dim intAvailableWidth As Long

        Dim strRecipeName As String
        Dim strPortionUnit As String
        Dim strYieldName As String

        Dim intCount As Integer

        Dim intNewX As Integer
        Dim intNewY As Integer

        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

        Try
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me


        End Try

        Dim dblMaxHeightPicture As Double
        Dim dblMaxWidthPicture As Double

        Dim strPicture(0 To 2) As String
        Dim str3Pictures As String

        Dim blflagQtyFirst As Boolean
        Dim intDictionary As Integer

        Dim intColumnWidth As Integer = 100
        Dim intTextHeight As Integer

        Dim intPicStart As Integer



        fctPrintRecipeEgsModern2 = Nothing


        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
        End If

        With Me

            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30


            intCount = 0
            For i As Integer = 1 To 34 ' 15
                L_Nutrient(i).Format = G_Nutrient(i).Format
                L_Nutrient(i).Heading = G_Nutrient(i).Heading
                L_Nutrient(i).Name = G_Nutrient(i).Name
                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                L_Nutrient(i).Value = -1
                L_Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
                If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
            Next

            If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
            If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
            If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
            If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
            If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
            If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
            If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
            If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
            If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
            If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
            If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
            If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
            If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
            If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
            If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

            intDictionary = G_Language

            If G_ReportOptions.intTranslation > 0 Then
                If IsDBNull(CType(row("COdeDictionary"), Integer)) Then
                    intDictionary = G_Language
                Else
                    intDictionary = CType(row("COdeDictionary"), Integer)
                End If
            End If
            G_Language = intDictionary

            intNewX = 0
            intNewY = 0

            'Recipe Name

            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
            intNewY += GetLineSpace(intTextHeight)

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
            intNewY += GetLineSpace(intTextHeight)

            strYieldName = row("PortionUnit").ToString

            'Picture
            blflagQtyFirst = True

            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                Select Case G_ReportOptions.strSubStyle
                    Case "01" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4
                    Case "02" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4 : blflagQtyFirst = False
                    Case "11" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5
                    Case "12" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5 : blflagQtyFirst = False
                    Case "21" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                    Case "22" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3 : blflagQtyFirst = False
                    Case Else : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                End Select

                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                Select Case G_ReportOptions.strSubStyle
                    Case "01" : dblMaxHeightPicture = 180
                    Case "02" : dblMaxHeightPicture = 180 : blflagQtyFirst = False
                    Case "11" : dblMaxHeightPicture = 250
                    Case "12" : dblMaxHeightPicture = 250 : blflagQtyFirst = False
                    Case "21" : dblMaxHeightPicture = 350
                    Case "22" : dblMaxHeightPicture = 350 : blflagQtyFirst = False
                End Select
                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                'dblMaxWidthPicture = (intAvailableWidth * 0.4) - 100
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If

            str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

            Dim strFileName As String = Nothing
            For j As Integer = 0 To 2
                strPicture(j) = ""
                strPicture(j) = fctGetPictureName(str3Pictures, j)
                If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then strFileName &= strPicture(j)
            Next

            'If strFileName <> "" Then intNewY += 50

            strFileName = Nothing
            If G_ReportOptions.blnPicturesAll = True Then

                If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To 2
                        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & strPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                            intNewX += CInt(G_dblMaxWidthPicture) + 5
                            strFileName &= strPicture(j)
                        End If
                    Next
                    If strFileName <> "" Then
                        intNewY += CInt(G_dblMaxHeightPicture) + 10
                        intNewX = 0
                        intNewY += intTextHeight

                    End If
                End If
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        For j As Integer = 0 To 2
                            If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then

                                strFileName = G_strPhotoPath & strPicture(j)
                                .Detail.Controls.AddRange(New XRControl() _
                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                                intNewX += G_dblMaxWidthPicture + 20
                                intPicStart = intNewY
                                Exit For
                            End If
                        Next
                    End If
                End If
            End If


            sf = New StringFormat(StringFormatFlags.DirectionVertical)

            G_intMaxRecipeDetailsWidth = 0
            '-----------------<Start> Get Widest 
            If G_ReportOptions.blnIncludeNumber = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)  'Recipe #
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCategory = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeSource = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeDate = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCostOfGoods = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeRemark = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            'Recipe Number
            If G_ReportOptions.blnIncludeNumber = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No) '"Recipe #" 
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


                Dim strRecipeNumber As String = fctSqlReady(row("RecipeNumber").ToString)
                strRecipeNumber = Replace(strRecipeNumber, Chr(1), "")
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strRecipeNumber, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Category
            If G_ReportOptions.blnIncludeCategory = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)        'Category
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strCategoryName As String = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCategoryName, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Source/Chef
            If G_ReportOptions.blnIncludeSource = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)          'Source
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strSource As String = CStr(IIf(IsDBNull(row("Chef").ToString), "", Trim((fctSqlReady(row("Chef").ToString)))))
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strSource, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Dates
            If G_ReportOptions.blnIncludeDate = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)       'Date
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strDates As String = fctSqlReady(fctConvertDate(row("Dates").ToString))
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strDates, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Cost of goods
            If G_ReportOptions.blnIncludeCostOfGoods = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strSymbol As String = fctSqlReady(row("Symbole").ToString) '"USD" 
                Dim dblCalcPrice As Double = 0
                If Not IsDBNull(row("calcprice")) Then
                    dblCalcPrice = CType(row("calcprice"), Double)  '1.46 
                End If

                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & Trim(strSymbol) & " " & Format(dblCalcPrice, G_strPriceFormat) & " / " & strYieldName, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Remark
            If G_ReportOptions.blnIncludeRemark = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strRemarks As String = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strRemarks, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            If G_ReportOptions.blnPicturesAll = False Then
                If G_ReportOptions.blnWithPicture = True Then
                    intNewX = 0
                    If intPicStart > 0 Then
                        intNewY = intPicStart + G_dblMaxHeightPicture
                    End If
                End If
            End If


            'Servings
            Dim intYieldQty As Integer = CType(row("Yield"), Integer)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim strPortionUnit2Format As String = G_FormatOneDecimal
            strPortionUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation)
            Dim strNumberOfServings As String = Nothing
            Dim strServings As String

            Dim blnUseFractions As Boolean = G_ReportOptions.blnUseFractions

            If G_Options.QtyType = 0 Then

                strNumberOfServings = fctFormatNumericQuantity(intYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
                If CType(row("Yield2"), Integer) > 0 Then
                    strNumberOfServings = strNumberOfServings & "/" &
                    fctFormatNumericQuantity(CType(row("Yield2"), Integer), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " &
                    strPortionUnit
                End If
            Else
                'If blnUseFractions Then
                '    strNumberOfServings = fctConvertToFraction2(intYieldQty) & " " & Trim(strYieldName)
                'Else
                '    strNumberOfServings = intYieldQty.ToString & " " & Trim(strYieldName)
                'End If
                strNumberOfServings = fctConvertToFraction2(intYieldQty) & " " & Trim(strYieldName)

                If CType(row("Yield2"), Integer) > 0 Then
                    If blnUseFractions Then
                        strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction2(CType(row("Yield2"), Integer)) & " " &
                        strPortionUnit
                    Else
                        strNumberOfServings = strNumberOfServings & "/" &
                        CType(row("Yield2"), Integer).ToString & " " &
                        strPortionUnit
                    End If
                End If
            End If

            intNewX = 0
            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", CType(row("DishPercent"), Double))     '"Ingredients for " & strNumberOfServings & " at " & rsX!DishPercent & "% (Net Quantity)"
            strServings = strServings.Replace("N/A", "").Replace("n/a", "")
            strServings = strServings.Replace("[_]", "")
            intNewY += 10
            sf = New StringFormat(StringFormatFlags.NoClip)
            intTextHeight = ReportingTextUtils.MeasureText(strServings, fntBold, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strServings, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
            intNewY += intTextHeight


            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height

            'Get Ingredients
            Dim strNumber As String = Nothing
            Dim strComplement As String = Nothing
            Dim strIngredient As String = Nothing
            Dim sUnit As String = Nothing
            Dim strQuantityNet As String = "0"
            Dim strUnitFormat As String = G_FormatOneDecimal
            Dim dblPercentage As Double

            Dim bBold As Boolean

            Dim intWidestQty As Integer
            Dim intWidestUnit As Integer
            Dim intWidestItemNumber As Integer
            Dim intWidestIngredient As Integer
            'Dim rowIng As DataRow

            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)

                'For Each rowIng In dtRecipe.Rows

                If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                'strQuantityNet = CType(CDbl(strQuantityNet) * intYieldQty, String)
                strQuantityNet = CType(CDbl(strQuantityNet), String)
                dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)
                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                        strQuantityNet = "0"
                        sUnit = ""
                        bBold = True
                    Else
                        If G_Options.QtyType = 0 Then
                            strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                        Else
                            'If blnUseFractions Then
                            '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                            'Else
                            '    strQuantityNet = CDbl(strQuantityNet).ToString
                            'End If
                            strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        End If
                        bBold = False
                    End If
                Else
                    If G_Options.QtyType = 0 Then
                        strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                    Else
                        'If blnUseFractions Then
                        '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        'Else
                        '    strQuantityNet = CDbl(strQuantityNet).ToString
                        'End If
                        strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                    End If
                    bBold = False
                End If

                sf = New StringFormat(StringFormatFlags.DirectionVertical)
                If intWidestQty < ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestQty = ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestUnit < ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestUnit = ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestItemNumber < ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestItemNumber = ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height

            Next

            intWidestIngredient = intAvailableWidth - intWidestQty - intWidestUnit - intWidestItemNumber - 15

            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)

                'For Each rowIng In dtRecipe.Rows
                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                    strIngredient = fctGetTranslatedText(foundDetails(rowIng), "Ingredient", "IngredientTrans", G_ReportOptions.intTranslation)
                    strComplement = fctGetTranslatedText(foundDetails(rowIng), "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                    If strComplement <> "" Then strIngredient = strIngredient & " '" & strComplement & "'"

                    If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                    If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                    'strQuantityNet = CType(CDbl(strQuantityNet) * intYieldQty, String)
                    strQuantityNet = CType(CDbl(strQuantityNet), String)
                    dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                    strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)

                    If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                        strQuantityNet = "0"
                        sUnit = ""
                    Else

                        If G_Options.QtyType = 0 Then
                            strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                        Else
                            'If blnUseFractions Then
                            '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                            'Else
                            '    strQuantityNet = CDbl(strQuantityNet).ToString
                            'End If
                            strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        End If


                        bBold = False

                    End If

                    intNewX = 0

                    Select Case CType(foundDetails(rowIng)("IngrType"), Integer)
                        Case ID_Recipe : fntFont = fntItalic
                        Case ID_Text : fntFont = fntBold
                        Case Else : fntFont = fntRegular
                    End Select

                    sf = New StringFormat(StringFormatFlags.NoClip)
                    intTextHeight = ReportingTextUtils.MeasureText(strIngredient, fntFont, intWidestIngredient, sf, Me.Padding).Height


                    If blflagQtyFirst Then

                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + INTCOLUMNSPACE + intWidestUnit + INTCOLUMNSPACE + intWidestItemNumber + INTCOLUMNSPACE
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, False)})
                        Else
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strQuantityNet), fntFont, intNewX, intNewY, intWidestQty, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                            intNewX += intWidestQty + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestUnit + INTCOLUMNSPACE

                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNumber, fntFont, intNewX, intNewY, intWidestItemNumber, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                                intNewX += intWidestItemNumber + INTCOLUMNSPACE
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                        End If
                        intNewY += intTextHeight
                    Else
                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + INTCOLUMNSPACE + intWidestUnit + INTCOLUMNSPACE + intWidestItemNumber + INTCOLUMNSPACE
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, False)})
                        Else
                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strNumber), fntFont, intNewX, intNewY, intWidestItemNumber, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                                intNewX += intWidestItemNumber + INTCOLUMNSPACE
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestIngredient + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strQuantityNet, fntFont, intNewX, intNewY, intWidestQty, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestQty + INTCOLUMNSPACE

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                        End If
                        intNewY += intTextHeight

                    End If

                End If
            Next


            intNewX = 0

            'Preparation
            If G_ReportOptions.blnIncludePreparation Then
                Dim strPreparation As String = row("Note").ToString
                strPreparation = UCase(Trim(Replace(strPreparation, vbCrLf & "#", vbCrLf)))
                If Mid(strPreparation, 1, 1) = "#" Then strPreparation = Mid(strPreparation, 2)
                intNewY += 30
                intTextHeight = ReportingTextUtils.MeasureText(strPreparation, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPreparation, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                intNewY += intTextHeight
            End If

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height


            'HACCP
            If G_ReportOptions.blnIncludeHACCP Then
                intNewY += 30
                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.HACCP))
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                intNewY += intTextHeight
                'GetWidest
                sf = New StringFormat(StringFormatFlags.DirectionVertical)

                G_intMaxRecipeDetailsWidth = 0
                '-----------------<Start> Get Widest 
                strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime) 'Cooling Time
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime) 'Heating Time
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)   'Heating degree/temperature
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode) 'Heating mode
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)  'CCP Description
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)  'HACCP
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                '-----------------<End> Get Widest 

                'Cooling Time
                Dim strCoolingTime As String = Nothing
                If Not IsDBNull(row("CoolingTime").ToString) Then strCoolingTime = Trim(row("CoolingTime").ToString)
                If strCoolingTime.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime) 'Cooling Time 
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCoolingTime, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If

                'Heating Time
                Dim strHeatingTime As String = Nothing
                If Not IsDBNull(row("HeatingTime").ToString) Then strHeatingTime = Trim(row("HeatingTime").ToString)
                If strHeatingTime.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime) 'Heating Time
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingTime, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If

                'Heating Temperature
                Dim strHeatingTemp As String = Nothing
                If Not IsDBNull(row("HeatingTemperature").ToString) Then strHeatingTemp = Trim(row("HeatingTemperature").ToString)
                If strHeatingTemp.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)   'Heating degree/temperature
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingTemp, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If

                'Heating Mode
                Dim strHeatingMode As String = Nothing
                If Not IsDBNull(row("HeatingMode").ToString) Then strHeatingMode = Trim(row("HeatingMode").ToString)
                If strHeatingMode.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode) 'Heating mode
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingMode, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If

                'CCP description
                Dim strCCPDesc As String = Trim(row("CCPDescription").ToString)
                If strCCPDesc.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)  'CCP Description
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCCPDesc, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If

                'HACCP
                Dim strHACCP As String = Trim(row("HACCP").ToString)
                If strHACCP.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)  'HACCP
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHACCP, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += intTextHeight
                End If




            End If

            'Nutrients()
            If G_ReportOptions.blnIncludeNutrients Then
                Dim strNutrient As String
                Dim strPerServings As String
                Dim strNA As String
                Dim intFirstRow As Integer
                Dim intTotalValue As Integer

                intNewY += 30
                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Nutrients))   'Nutrients
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                intNewY += intTextHeight


                'Get Widest
                sf = New StringFormat(StringFormatFlags.DirectionVertical)
                G_intMaxRecipeDetailsWidth = 0
                For i As Integer = 1 To intCount   '12
                    If Trim(L_Nutrient(i).Name) <> "" Then
                        If i = 1 Then
                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                            strNutrient = L_Nutrient(i).Name & " kcal"
                        Else
                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                        End If

                        '-----------------<Start> Get Widest 
                        intColumnWidth = ReportingTextUtils.MeasureText(strNutrient, fntRegular, intTextHeight, sf, Me.Padding).Height
                        If intColumnWidth > G_intMaxRecipeDetailsWidth Then G_intMaxRecipeDetailsWidth = intColumnWidth
                    End If
                    intTotalValue += L_Nutrient(i).Value
                Next

                'mcm 02.01.06 if less than 0 do not display nutrients info.
                If intTotalValue > 0 Then
                    G_intMaxRecipeDetailsWidth *= 1.5
                    Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

                    intNewY += 20
                    intNewX += G_intMaxRecipeDetailsWidth
                    strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName) '"per " & stryieldname & " at 100%"
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += intRemainingColumn

                    strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent) '"per 100g or 100ml at 100%"
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


                    dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
                    For i As Integer = 1 To intCount   '12
                        If Trim(L_Nutrient(i).Name) <> "" Then
                            intNewY += intTextHeight
                            intNewX = 0
                            If i = 1 Then
                                intFirstRow = intNewY
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                intNewY += intTextHeight
                                strNutrient = L_Nutrient(i).Name & " kcal"
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            Else
                                'intNewY += intTextHeight
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            End If

                            If L_Nutrient(i).Value <> -1 Then
                                If i = 1 Then
                                    'per servings at 100%
                                    intNewY = intFirstRow
                                    strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    strPerServings = Format(L_Nutrient(i).Value / ENERGYFACTOR, L_Nutrient(i).Format)
                                    intNewY += intTextHeight
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    'per 100g or 100ml at 100%
                                    intNewY = intFirstRow
                                    If dblNutrientFactor > 0 Then
                                        strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        strNA = Format(L_Nutrient(i).Value / ENERGYFACTOR / dblNutrientFactor, L_Nutrient(i).Format)
                                        intNewY += intTextHeight
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    Else
                                        intNewY = intFirstRow
                                        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        intNewY += intTextHeight
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    End If
                                Else
                                    strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    If dblNutrientFactor > 0 Then
                                        strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                    Else
                                        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"
                                    End If
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                End If  'i=1

                            End If 'L_Nutrient(i).Value <> -1 Then
                        End If

                    Next
                End If
            End If

            'Keywords()
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then 'subPrintKeywords(lngCode, intAvailableWidth, G_Options.CardFont1, G_Options.CardFontSize1, G_Options.CardFont2, G_Options.CardFontSize2, "001", intTranslation)
                Dim strKeyword As String
                Dim intPrevious As Integer

                intNewY += 30
                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Keywords))        'Keywords
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                intNewY += intTextHeight

                intPrevious = -1


                For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)

                    strKeyword = CType(foundKeywords(rowK)("Name"), String)

                    If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
                        If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
                            If CType(foundKeywords(rowK)("derived"), Boolean) Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            Else
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            End If
                        End If
                    Else
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    End If
                    intNewY += intTextHeight
                Next
            End If
            'End of Keywords

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "002")
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "002")
            End If
            'End of Allergens


        End With
        Return Me
    End Function

    Function fctPrintRecipeEgsTwoColumns2(ByVal foundDetails() As DataRow,
                                         ByVal foundKeywords() As DataRow,
                                         ByVal foundAllergens() As DataRow) As XtraReport
        Dim intAvailableWidth As Long

        Dim strRecipeName As String
        Dim strPortionUnit As String
        Dim strYieldName As String

        Dim intCount As Integer

        Dim intNewX As Integer
        Dim intNewY As Integer

        Dim dblMaxHeightPicture As Double
        Dim dblMaxWidthPicture As Double

        Dim strPicture(0 To 2) As String
        Dim str3Pictures As String

        Dim blflagQtyFirst As Boolean
        Dim intDictionary As Integer

        Dim intColumnWidth As Integer = 100
        Dim sf As StringFormat = New StringFormat(StringFormatFlags.NoClip)
        Dim intTextHeight As Integer

        Dim intPicStart As Integer
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

        Dim blnUseFractions As Boolean = G_ReportOptions.blnUseFractions

        fctPrintRecipeEgsTwoColumns2 = Nothing

        Try
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
        End If

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            intCount = 0
            For i As Integer = 1 To 34 '15
                L_Nutrient(i).Format = G_Nutrient(i).Format
                L_Nutrient(i).Heading = G_Nutrient(i).Heading
                L_Nutrient(i).Name = G_Nutrient(i).Name
                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                L_Nutrient(i).Value = -1
                L_Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
                If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
            Next

            If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
            If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
            If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
            If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
            If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
            If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
            If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
            If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
            If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
            If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
            If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
            If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
            If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
            If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
            If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

            intDictionary = G_Language

            If G_ReportOptions.intTranslation > 0 Then
                If IsDBNull(CType(row("COdeDictionary"), Integer)) Then
                    intDictionary = G_Language
                Else
                    intDictionary = CType(row("COdeDictionary"), Integer)
                End If
            End If
            G_Language = intDictionary

            intNewX = 0
            intNewY = 0

            'Recipe Name

            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Bottom)})
            intNewY += intTextHeight

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height

            strYieldName = row("PortionUnit").ToString

            'Picture
            blflagQtyFirst = True

            Select Case G_ReportOptions.strSubStyle
                Case "01" : dblMaxHeightPicture = 350
                Case "02" : dblMaxHeightPicture = 350 : blflagQtyFirst = False
            End Select
            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            Dim strFileName As String = Nothing




            sf = New StringFormat(StringFormatFlags.DirectionVertical)

            G_intMaxRecipeDetailsWidth = 0
            '-----------------<Start> Get Widest 
            If G_ReportOptions.blnIncludeNumber = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCategory = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeSource = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeDate = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeCostOfGoods = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If

            If G_ReportOptions.blnIncludeRemark = True Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
            End If
            '------------------------------

            intNewY += intTextHeight
            'Recipe Number
            If G_ReportOptions.blnIncludeNumber = True Then
                Dim strRecipeNumber As String = fctSqlReady(row("RecipeNumber").ToString)
                strRecipeNumber = Replace(strRecipeNumber, Chr(1), "")
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strRecipeNumber, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Category
            If G_ReportOptions.blnIncludeCategory = True Then
                Dim strCategoryName As String = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCategoryName, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Source/Chef
            If G_ReportOptions.blnIncludeSource = True Then
                Dim strSource As String = CStr(IIf(IsDBNull(row("Chef").ToString), "", Trim((fctSqlReady(row("Chef").ToString)))))
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strSource, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Dates
            If G_ReportOptions.blnIncludeDate = True Then
                Dim strDates As String = fctSqlReady(fctConvertDate(row("Dates").ToString))

                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strDates, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Cost of goods
            If G_ReportOptions.blnIncludeCostOfGoods = True Then
                Dim strSymbol As String = fctSqlReady(row("Symbole").ToString) '"USD" 
                Dim dblCalcPrice As Double  '1.46 

                If Not IsDBNull(row("calcprice")) Then

                    dblCalcPrice = CType(row("calcprice"), Double)
                End If

                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & Trim(strSymbol) & " " & Format(dblCalcPrice, G_strPriceFormat) & " / " & strYieldName, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            'Remark
            If G_ReportOptions.blnIncludeRemark = True Then
                Dim strRemarks As String = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation)
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strRemarks, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
            End If

            Dim blflagPixOK As Boolean
            str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

            For j As Integer = 0 To 2
                strPicture(j) = ""
                strPicture(j) = fctGetPictureName(str3Pictures, j)
            Next


            intNewX = 0
            If G_ReportOptions.blnWithPicture = True Then
                If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    intPicStart = intNewY
                    For j As Integer = 0 To 2
                        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                            intNewY += intTextHeight + 20

                            strFileName = G_strPhotoPath & strPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                            strFileName &= strPicture(j)
                            blflagPixOK = True
                            intNewY -= intTextHeight - 20
                            Exit For
                        End If
                    Next
                End If
            End If

            'Servings
            Dim intYieldQty As Integer = CType(row("Yield"), Integer)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim strPortionUnit2Format As String = G_FormatOneDecimal
            strPortionUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation)
            Dim strNumberOfServings As String = Nothing
            Dim strServings As String

            If G_Options.QtyType = 0 Then

                strNumberOfServings = fctFormatNumericQuantity(intYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
                If CType(row("Yield2"), Integer) > 0 Then
                    strNumberOfServings = strNumberOfServings & "/" &
                    fctFormatNumericQuantity(CType(row("Yield2"), Integer), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " &
                    strPortionUnit
                End If
            Else
                'If blnUseFractions Then
                '    strNumberOfServings = fctConvertToFraction2(intYieldQty) & " " & Trim(strYieldName)
                'Else
                '    strNumberOfServings = intYieldQty.ToString & " " & Trim(strYieldName)
                'End If
                strNumberOfServings = fctConvertToFraction2(intYieldQty) & " " & Trim(strYieldName)
                If CType(row("Yield2"), Integer) > 0 Then
                    'If blnUseFractions Then
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    fctConvertToFraction2(CType(row("Yield2"), Integer)) & " " & _
                    '    strPortionUnit
                    'Else
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    CType(row("Yield2"), Integer).ToString & " " & _
                    '    strPortionUnit
                    'End If
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction2(CType(row("Yield2"), Integer)) & " " &
                        strPortionUnit
                End If
            End If


            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", CType(row("DishPercent"), Double))     '"Ingredients for " & strNumberOfServings & " at " & rsX!DishPercent & "% (Net Quantity)"
            strServings = strServings.Replace("N/A", "").Replace("n/a", "")
            strServings = strServings.Replace("[_]", "")
            sf = New StringFormat(StringFormatFlags.NoClip)
            intTextHeight = ReportingTextUtils.MeasureText(strServings, fntBold, intAvailableWidth, sf, Me.Padding).Height

            If G_ReportOptions.blnPicturesAll = False And G_ReportOptions.blnWithPicture = False Then
                intNewX = 0
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strServings, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            Else
                If Not IsNothing(strFileName) Then
                    intNewY += 10
                    intNewX = intAvailableWidth / 2
                    intTextHeight = ReportingTextUtils.MeasureText(strServings, fntBold, CInt(intAvailableWidth / 2), sf, Me.Padding).Height
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strServings, fntBold, intNewX, intNewY, CInt(intAvailableWidth / 2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                Else
                    intNewX = 0
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strServings, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If
            End If
            intNewY += intTextHeight

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height

            'Get Ingredients
            Dim strNumber As String = Nothing
            Dim strComplement As String = Nothing
            Dim strIngredient As String = Nothing
            Dim sUnit As String = Nothing
            Dim strQuantityNet As String = "0"
            Dim strUnitFormat As String = G_FormatOneDecimal
            Dim dblPercentage As Double

            Dim bBold As Boolean

            Dim intWidestQty As Integer
            Dim intWidestUnit As Integer
            Dim intWidestItemNumber As Integer
            Dim intWidestIngredient As Integer

            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
                If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                'strQuantityNet = CType(CDbl(strQuantityNet) * intYieldQty, String)
                strQuantityNet = CType(CDbl(strQuantityNet), String)
                dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)
                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                        strQuantityNet = "0"
                        sUnit = ""
                        bBold = True
                    Else


                    End If
                    If G_Options.QtyType = 0 Then
                        strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                    Else
                        'If blnUseFractions Then
                        '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        'Else
                        '    strQuantityNet = CDbl(strQuantityNet).ToString
                        'End If
                        strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        bBold = False
                    End If
                Else
                    If G_Options.QtyType = 0 Then
                        strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                    Else
                        'If blnUseFractions Then
                        '    strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))
                        'Else
                        '    strQuantityNet = CDbl(strQuantityNet).ToString
                        'End If
                        strQuantityNet = fctConvertToFraction2(CDbl(strQuantityNet))

                    End If
                    bBold = False
                End If

                sf = New StringFormat(StringFormatFlags.DirectionVertical)
                If intWidestQty < ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestQty = ReportingTextUtils.MeasureText(strQuantityNet, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestUnit < ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestUnit = ReportingTextUtils.MeasureText(sUnit, fntRegular, intTextHeight, sf, Me.Padding).Height
                If intWidestItemNumber < ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height Then intWidestItemNumber = ReportingTextUtils.MeasureText(strNumber, fntRegular, intTextHeight, sf, Me.Padding).Height

            Next

            If blflagPixOK Then
                intWidestIngredient = (intAvailableWidth / 2) - intWidestQty - intWidestUnit - intWidestItemNumber - 15
            Else
                intWidestIngredient = (intAvailableWidth) - intWidestQty - intWidestUnit - intWidestItemNumber - 15
            End If

            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
                If Not IsDBNull(foundDetails(rowIng)("IngrType")) Then
                    If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(foundDetails(rowIng)("ItemNumber").ToString)
                    strIngredient = fctGetTranslatedText(foundDetails(rowIng), "Ingredient", "IngredientTrans", G_ReportOptions.intTranslation)
                    strComplement = fctGetTranslatedText(foundDetails(rowIng), "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    sUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)

                    If strComplement <> "" Then strIngredient = strIngredient & " '" & strComplement & "'"

                    If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then strQuantityNet = CType(foundDetails(rowIng)("Quantity"), String)
                    If Not IsDBNull(foundDetails(rowIng)("Unitformat")) Then strUnitFormat = foundDetails(rowIng)("unitformat").ToString

                    'strQuantityNet = CType(CDbl(strQuantityNet) * intYieldQty, String)
                    strQuantityNet = CType(CDbl(strQuantityNet), String)
                    dblPercentage = CType(foundDetails(rowIng)("DishPercent"), Double)
                    strQuantityNet = CType((CDbl(strQuantityNet) * dblPercentage) / 100, String)

                    If CType(foundDetails(rowIng)("IngrType"), Single) = ID_Text Then
                        strQuantityNet = "0"
                        sUnit = ""
                        bBold = True
                    Else

                        If G_Options.QtyType = 0 Then
                            strQuantityNet = fctFormatNumericQuantity(CDbl(strQuantityNet), strUnitFormat, G_ReportOptions.blnRemoveTrailingZeros)
                        Else
                            strQuantityNet = fctConvertToFraction(CDbl(strQuantityNet))
                        End If

                        Select Case CType(foundDetails(rowIng)("IngrType"), Integer)
                            Case ID_Recipe : fntFont = fntItalic
                            Case ID_Text : fntFont = fntBold
                            Case Else : fntFont = fntRegular
                        End Select

                    End If
                    If G_ReportOptions.blnPicturesAll = False And G_ReportOptions.blnWithPicture = False Then
                        intNewX = 0
                    Else
                        If Not IsNothing(strFileName) Then
                            intNewX = intAvailableWidth / 2
                        Else
                            intNewX = 0
                        End If
                    End If

                    sf = New StringFormat(StringFormatFlags.NoClip)

                    intTextHeight = ReportingTextUtils.MeasureText(strIngredient, fntBold, intWidestIngredient, sf, Me.Padding).Height

                    If blflagQtyFirst Then

                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + 5 + intWidestUnit + 5 + intWidestItemNumber + 5
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, False)})
                        Else
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strQuantityNet), fntFont, intNewX, intNewY, intWidestQty, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                            intNewX += intWidestQty + 5

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestUnit + 5

                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNumber, fntFont, intNewX, intNewY, intWidestItemNumber, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                                intNewX += intWidestItemNumber + 5
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                        End If
                        intNewY += intTextHeight
                    Else
                        If strQuantityNet = "0" Then
                            intNewX += intWidestQty + 5 + intWidestUnit + 5 + intWidestItemNumber + 5
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, False)})
                        Else

                            If G_ReportOptions.blnIncludeIngrNumber Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(CStr(strNumber), fntFont, intNewX, intNewY, intWidestItemNumber, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                                intNewX += intWidestItemNumber + 5
                            End If

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngredient, fntFont, intNewX, intNewY, intWidestIngredient, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestIngredient + 5

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strQuantityNet, fntFont, intNewX, intNewY, intWidestQty, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})
                            intNewX += intWidestQty + 5

                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sUnit, fntFont, intNewX, intNewY, intWidestUnit, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , False)})

                        End If
                        intNewY += intTextHeight

                    End If

                End If
            Next

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height

            intNewX = 0

            If G_ReportOptions.blnPicturesAll = False And G_ReportOptions.blnWithPicture = False Then
                intNewY += 20
            Else
                intNewY += intTextHeight
                If Not IsNothing(strFileName) Then
                    intNewY = intPicStart + G_dblMaxHeightPicture + 10
                End If
            End If

            Dim XRLineSeparator1 As New XRLine
            With XRLineSeparator1
                .Location = New System.Drawing.Point(intNewX, intNewY)
                .Name = "xrLine1"
                .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
            End With
            .Detail.Controls.AddRange(New XRControl() {XRLineSeparator1})


            'Preparation
            Dim intTextPrepHeight As Integer
            sf = New StringFormat(StringFormatFlags.NoClip)
            If G_ReportOptions.blnIncludePreparation Then
                Dim strPreparation As String = row("Note").ToString
                strPreparation = UCase(Trim(Replace(strPreparation, vbCrLf & "#", vbCrLf)))
                If Mid(strPreparation, 1, 1) = "#" Then strPreparation = Mid(strPreparation, 2)
                intTextPrepHeight = ReportingTextUtils.MeasureText(strPreparation, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                intNewY += 10
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPreparation, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextPrepHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
            End If

            intNewY += intTextPrepHeight

            Dim XRLineSeparator2 As New XRLine
            With XRLineSeparator2
                .Location = New System.Drawing.Point(intNewX, intNewY)
                .Name = "xrLine1"
                .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
            End With
            .Detail.Controls.AddRange(New XRControl() {XRLineSeparator2})


            'HACCP
            If G_ReportOptions.blnIncludeHACCP Then
                intNewY += 10
                strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
                'GetWidest
                sf = New StringFormat(StringFormatFlags.DirectionVertical)

                G_intMaxRecipeDetailsWidth = 0
                '-----------------<Start> Get Widest 
                strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)


                strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)
                G_intMaxRecipeDetailsWidth = fctGetWidest(strX, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
                '-----------------<End> Get Widest 

                'Cooling Time
                Dim strCoolingTime As String = Nothing
                If Not IsDBNull(row("CoolingTime").ToString) Then strCoolingTime = Trim(row("CoolingTime").ToString)
                If strCoolingTime.Length > 0 Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCoolingTime, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                'Heating Time
                Dim strHeatingTime As String = Nothing
                If Not IsDBNull(row("HeatingTime").ToString) Then strHeatingTime = Trim(row("HeatingTime").ToString)
                If strHeatingTime.Length > 0 Then
                    intNewY += intTextHeight
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingTime, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                'Heating Temperature
                Dim strHeatingTemp As String = Nothing
                If Not IsDBNull(row("HeatingTemperature").ToString) Then strHeatingTemp = Trim(row("HeatingTemperature").ToString)
                If strHeatingTemp.Length > 0 Then
                    intNewY += intTextHeight
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingTemp, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                'Heating Mode
                Dim strHeatingMode As String = Nothing
                If Not IsDBNull(row("HeatingMode").ToString) Then strHeatingMode = Trim(row("HeatingMode").ToString)
                If strHeatingMode.Length > 0 Then
                    intNewY += intTextHeight
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHeatingMode, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                'CCP description
                Dim strCCPDesc As String = Nothing
                If Not IsDBNull(row("CCPDescription").ToString) Then strCCPDesc = Trim(row("CCPDescription").ToString)
                If strCCPDesc.Length > 0 Then
                    intNewY += intTextHeight
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCCPDesc, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                'HACCP
                Dim strHACCP As String = Nothing
                If Not IsDBNull(row("HACCP").ToString) Then strHACCP = Trim(row("HACCP").ToString)
                If strHACCP.Length > 0 Then
                    intNewY += intTextHeight
                    strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strHACCP, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intAvailableWidth - G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                intNewY += 20

                Dim XRLineSeparator3 As New XRLine
                With XRLineSeparator3
                    .Location = New System.Drawing.Point(intNewX, intNewY)
                    .Name = "xrLine1"
                    .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
                End With
                .Detail.Controls.AddRange(New XRControl() {XRLineSeparator3})
            End If

            'Nutrients()
            If G_ReportOptions.blnIncludeNutrients Then
                Dim strNutrient As String
                Dim strPerServings As String
                Dim strNA As String
                Dim intFirstRow As Integer
                Dim intTotalValue As Integer
                intNewY += 10
                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Nutrients))
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight

                'Get Widest
                sf = New StringFormat(StringFormatFlags.DirectionVertical)
                G_intMaxRecipeDetailsWidth = 0
                For i As Integer = 1 To intCount   '12
                    If Trim(L_Nutrient(i).Name) <> "" Then
                        If i = 1 Then
                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                            strNutrient = L_Nutrient(i).Name & " kcal"
                        Else
                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                        End If

                        '-----------------<Start> Get Widest 
                        intColumnWidth = ReportingTextUtils.MeasureText(strNutrient, fntRegular, intTextHeight, sf, Me.Padding).Height
                        If intColumnWidth > G_intMaxRecipeDetailsWidth Then G_intMaxRecipeDetailsWidth = intColumnWidth
                    End If
                    intTotalValue += L_Nutrient(i).Value
                Next

                If intTotalValue > 0 Then
                    G_intMaxRecipeDetailsWidth *= 1.5
                    Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

                    intNewY += 20
                    intNewX += G_intMaxRecipeDetailsWidth

                    strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName) '"per " & strYieldName & " at 100%"
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += intRemainingColumn

                    strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent) '"per 100g or 100ml at 100%"
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                    dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
                    For i As Integer = 1 To intCount   '12
                        If Trim(L_Nutrient(i).Name) <> "" Then
                            intNewY += intTextHeight
                            intNewX = 0
                            If i = 1 Then
                                intFirstRow = intNewY
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                intNewY += intTextHeight
                                strNutrient = L_Nutrient(i).Name & " kcal"
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            Else
                                'intNewY += intTextHeight
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            End If

                            If L_Nutrient(i).Value <> -1 Then
                                If i = 1 Then
                                    'per servings at 100%
                                    intNewY = intFirstRow
                                    strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    strPerServings = Format(L_Nutrient(i).Value / ENERGYFACTOR, L_Nutrient(i).Format)
                                    intNewY += intTextHeight
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    'per 100g or 100ml at 100%
                                    If dblNutrientFactor > 0 Then
                                        intNewY = intFirstRow
                                        strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        strNA = Format(L_Nutrient(i).Value / ENERGYFACTOR / dblNutrientFactor, L_Nutrient(i).Format)
                                        intNewY += intTextHeight
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    Else
                                        intNewY = intFirstRow
                                        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA) '"N/A"
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        intNewY += intTextHeight
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    End If
                                Else
                                    strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    If dblNutrientFactor > 0 Then
                                        strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                    Else
                                        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"
                                    End If
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                End If  'i=1

                            End If 'L_Nutrient(i).Value <> -1 Then
                        End If
                    Next
                End If
                intNewY += 20
                Dim XRLineSeparator4 As New XRLine
                With XRLineSeparator4
                    .Location = New System.Drawing.Point(intNewX, intNewY)
                    .Name = "xrLine1"
                    .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
                End With
                .Detail.Controls.AddRange(New XRControl() {XRLineSeparator4})

            End If


            'Keywords()
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then
                Dim strKeyword As String
                Dim intPrevious As Integer
                intNewY += 10
                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Keywords))
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += intTextHeight
                intPrevious = -1
                For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)

                    strKeyword = CType(foundKeywords(rowK)("Name"), String)

                    If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
                        If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
                            If CType(foundKeywords(rowK)("derived"), Boolean) Then
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            Else
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            End If
                        End If
                    Else
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    End If
                    intNewY += intTextHeight

                Next
                intNewY += 20
                Dim XRLineSeparator5 As New XRLine
                With XRLineSeparator5
                    .Location = New System.Drawing.Point(intNewX, intNewY)
                    .Name = "xrLine1"
                    .Size = New System.Drawing.Size(CInt(intAvailableWidth), 8)
                End With
                .Detail.Controls.AddRange(New XRControl() {XRLineSeparator5})

            End If

            'Allergens MCM 03.03.06
            '----------------------

            If G_ReportOptions.blnIncludeAllergens Then
                ''subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
            End If
            'End of Allergens


        End With
        Return Me
    End Function


#End Region

#Region " MERCHANDISE REPORTS "
    '01 December 2005
    Public Function fctPrintMerchandiseEgsDetails(ByVal foundDetails() As DataRow,
                                                  ByVal foundKeywords() As DataRow,
                                                  ByVal foundAllergens() As DataRow,
                                                  Optional ByVal dtProductLink As DataTable = Nothing,
                                                  Optional ByVal strCnn As String = "",
                                                   Optional ByVal userLocale As String = "en-US") As XtraReport

        If G_ReportOptions.strSubStyle = "5" Then
            Return fctPrintMerchandiseEgsDetails2(foundDetails, foundKeywords, foundAllergens, strCnn)
        End If
        Dim lngWidestColumn As Long = 0
        'Dim str3Pictures As String
        'Dim strPicture(0 To 2) As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007
        Dim strX As String
        Dim dblMaxWidthPicture As Double
        Dim dblMaxHeightPicture As Double
        Dim intCount As Integer
        Dim fntItalic2 As Font
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim blFlagPixOk As Boolean
        Dim intTextHeight2 As Integer

        fctPrintMerchandiseEgsDetails = Nothing
        Cursor.Current = Cursors.WaitCursor
        sf = New StringFormat(StringFormatFlags.NoClip)

        Dim userCulture As CultureInfo = New CultureInfo(userLocale)

        Try
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)

            fntRegular2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)

        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & "(" & cLang.GetString(clsEGSLanguage.CodeType.Font) & ") - " & G_ReportOptions.strFontName2, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        Try
            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            End If
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & "(" & cLang.GetString(clsEGSLanguage.CodeType.Font) & ") - " & G_ReportOptions.strFontTitleName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If


        Dim row As DataRow = foundDetails(0)

        'If dtMerchandiseDetails.DefaultView.Count > 0 Then
        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'AGL 2013.02.14 - insert page breaks
            '.Detail.PageBreak = DevExpress.XtraReports.UI.PageBreak.AfterBand
            '.Bands(Me.Bands.Count - 1).PageBreak = DevExpress.XtraReports.UI.PageBreak.AfterBand

            sf = New StringFormat(StringFormatFlags.NoClip)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)                          'Number
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold2, intAvailableWidth, sf, Me.Padding).Height

            sf = New StringFormat(StringFormatFlags.DirectionVertical)
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                        'Category
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

            If G_ReportOptions.blnIncludeInfo Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.ProductDescription)              'Product Description
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

                strX = cLang.GetString(clsEGSLanguage.CodeType.Products) ' RBAJ-2012.10.08
                'strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredient)                     'Ingredients
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

                If G_CLIENT = "SV" Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Degustation_Development)                      'Refinement
                Else
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Refinement)                      'Refinement
                End If
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

                If G_CLIENT = "SV" Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.FeedBack)                      'Cooking Tip/Advise
                Else
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CookingTip)                      'Cooking Tip/Advise
                End If
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)



                strX = cLang.GetString(clsEGSLanguage.CodeType.Preparation)                     'Preparation
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)


                If G_CLIENT = "SV" Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                    'Yield/Productivity
                Else
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Productivity)                    'Yield/Productivity
                End If
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

                strX = cLang.GetString(clsEGSLanguage.CodeType.Storage)                         'Storage
                lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)
            End If

            strX = cLang.GetString(clsEGSLanguage.CodeType.Nutrients)                       'Nutrients
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Keyword)                         'Keywords
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntBold)

            'lngWidestColumn += 50
            sf = New StringFormat(StringFormatFlags.NoClip)

            'page header
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            intNewX = 0
            intNewY = CInt(G_ReportOptions.dblTopMargin)

            'strX = row("Name").ToString
            'intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            '.PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})

            Dim xrHeaderTbl As New XRTable
            Dim xrHeaderRow As New XRTableRow
            Dim xrHeaderCell As New XRTableCell
            xrHeaderTbl.Location = New Point(intNewX, intNewY)
            xrHeaderTbl.Width = intAvailableWidth
            xrHeaderRow.Height = G_ReportOptions.sgFontTitleSize + 1
            If G_ReportOptions.blnIncludeHighlightSection Then
                xrHeaderTbl.BackColor = Color.LightGray
                xrHeaderTbl.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xrHeaderCell.BorderWidth = 1
            Else
                xrHeaderTbl.BackColor = Color.White
                xrHeaderTbl.Borders = DevExpress.XtraPrinting.BorderSide.None
                xrHeaderCell.BorderWidth = 0
            End If

            xrHeaderCell.Font = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            xrHeaderCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            xrHeaderCell.Text = row("Name").ToString.Trim
            xrHeaderRow.Cells.Add(xrHeaderCell)
            xrHeaderTbl.Rows.Add(xrHeaderRow)
            intNewY += 10
            .PageHeader.Controls.Add(xrHeaderTbl)

            Dim xrlbl As New XRLabel
            ' RDC 09.07.2013 : Changed xrlbl.Text  = "spacer" to Blank
            xrlbl.Height = CInt(40)
            xrlbl.Text = " "
            xrlbl.Font = New Font("Arial", "20")
            xrlbl.ForeColor = Color.White
            .PageHeader.Controls.Add(xrlbl)
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

            intNewX = 0
            intNewY = 20

            '---------------------------------------------------------------------------
            'Picture
            '---------------------------------------------------------------------------
            Dim flagQtyFirst As Boolean = True
            Dim strFileName As String = Nothing
            Dim intY As Integer = 0

            dblMaxHeightPicture = 150
            dblMaxWidthPicture = 150

            ' RDC 07.18.2013 : Menu Picture
            Dim intDPic As Integer, intPicWidth As Integer = CInt(dblMaxHeightPicture), intPicHeight As Integer = CInt(dblMaxHeightPicture)
            If row.Table.Columns.Contains("DefaultPicture") Then
                intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
            Else
                intDPic = 1
            End If

            Dim xrPicTable As New XRTable
            Dim xrPicRow As New XRTableRow
            Dim xrPicCell1 As New XRTableCell, xrPicCell2 As New XRTableCell

            If Not IsDBNull(row("PictureName").ToString) Then strPictureAll = row("PictureName").ToString
            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
            Dim strPicPath() As String = {"", "", "", "", "", ""}
            Dim intPicLoc As Integer = 1

            xrPicTable.Width = intAvailableWidth
            xrPicRow = New XRTableRow

            'SM 20251201 update For Azure blob
            Dim coreCodeGroup As String = "0"
            If Not IsDBNull(row("CoreCodeGroup").ToString) Then coreCodeGroup = CryptoService.Get25CharString(row("CoreCodeGroup").ToString)
            If Not IsDBNull(row("PictureName").ToString) Then G_strPhotoPath = G_strPhotoPath.Replace("CoreCodeGroup", coreCodeGroup)

            If G_ReportOptions.blnPicturesAll Then              ' All
                xrPicTable.Location = New Point(0, intNewY)
                ' Rearrange images
                For iPicPos As Integer = 0 To arrPicture.GetUpperBound(0) Step 1
                    If Not arrPicture(iPicPos).ToString = "" And UrlFileExists(G_strPhotoPath & arrPicture(iPicPos)) Then
                        strPicPath(intPicLoc) = G_strPhotoPath & arrPicture(iPicPos).ToString
                        intPicLoc += 1
                    End If
                Next

                ' Display images
                For iPicPos As Integer = 1 To 5 Step 1
                    xrPicCell1 = New XRTableCell
                    xrPicCell2 = New XRTableCell
                    Dim xrPicBox As New XRPictureBox

                    With xrPicCell1
                        .Size = New System.Drawing.Size(intPicWidth, intPicHeight)

                        If Not strPicPath(iPicPos) = "" Then
                            .Borders = DevExpress.XtraPrinting.BorderSide.All
                            .BorderWidth = 1

                            xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 55), CInt(intPicHeight - 55))
                            xrPicBox.Location = New Point(5, 4)
                            xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrPicBox.Image = LoadImageFromUrl(strPicPath(iPicPos)) 'Image.FromFile(strPicPath(iPicPos))
                            xrPicBox.Sizing = ImageSizeMode.ZoomImage
                            xrPicBox.Parent = xrPicCell1
                            xrPicCell1.Controls.Add(xrPicBox)
                        Else
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                        End If
                    End With
                    If iPicPos <= 4 Then
                        With xrPicCell2
                            .Size = New System.Drawing.Size(10, intPicHeight)
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                        End With
                    End If

                    xrPicRow.Cells.AddRange({xrPicCell1, xrPicCell2})
                Next
                xrPicTable.Rows.Add(xrPicRow)
                .Detail.Controls.Add(xrPicTable)

            ElseIf G_ReportOptions.blnPictureOneRight Then      ' Right
                xrPicTable = New XRTable
                xrPicRow = New XRTableRow
                Dim recipeImg As String = G_strPhotoPath & arrPicture(intDPic - 1).ToString

                xrPicTable.Location = New Point(CInt(intAvailableWidth - (intPicWidth + 10)), intNewY)
                xrPicTable.Width = CInt(intPicWidth)
                xrPicTable.Height = CInt(intPicHeight)

                xrPicCell1 = New XRTableCell

                Dim xrPicBox As New XRPictureBox
                xrPicRow.Width = CInt(intPicWidth)
                With xrPicCell1
                    '.Size = New System.Drawing.Size(CInt(intPicWidth), CInt(intPicHeight))
                    .Width = CInt(intPicWidth)
                    If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                        .Borders = DevExpress.XtraPrinting.BorderSide.All
                        .BorderWidth = 1
                        xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 10), CInt(intPicHeight - 10))
                        xrPicBox.Location = New Point(5, 4)
                        xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                        xrPicBox.Sizing = ImageSizeMode.ZoomImage
                        xrPicCell1.Controls.Add(xrPicBox)
                    Else
                        .Borders = DevExpress.XtraPrinting.BorderSide.None
                        .BorderWidth = 0
                    End If
                End With
                xrPicRow.Cells.Add(xrPicCell1)
                xrPicTable.Rows.Add(xrPicRow)
                .Detail.Controls.Add(xrPicTable)

            Else                                                ' Default : Left

                If G_ReportOptions.blnWithPicture Then
                    xrPicTable = New XRTable
                    xrPicRow = New XRTableRow
                    Dim recipeImg As String = G_strPhotoPath & arrPicture(intDPic - 1).ToString

                    xrPicTable.Location = New Point(0, intNewY)
                    xrPicTable.Width = CInt(intPicWidth)

                    xrPicCell1 = New XRTableCell

                    Dim xrPicBox As New XRPictureBox
                    xrPicRow.Width = CInt(intPicWidth)
                    With xrPicCell1
                        '.Size = New System.Drawing.Size(CInt(intPicWidth), CInt(intPicHeight))
                        .Width = CInt(intPicWidth)
                        If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                            .Borders = DevExpress.XtraPrinting.BorderSide.All
                            .BorderWidth = 1
                            xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 10), CInt(intPicHeight - 10))
                            xrPicBox.Location = New Point(5, 4)
                            xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                            xrPicBox.Sizing = ImageSizeMode.ZoomImage
                            xrPicCell1.Controls.Add(xrPicBox)
                        Else
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                        End If
                    End With
                    xrPicRow.Cells.Add(xrPicCell1)
                    xrPicTable.Rows.Add(xrPicRow)
                    .Detail.Controls.Add(xrPicTable)
                End If
            End If
            intNewY += (xrPicTable.Height + 30)

            ' RDC 07.23.2013 : Removed and replaced picture loading routine

            ' RDC 07.23.2013 : New display of merchandise information
            Dim xrMerchInfoTbl As New XRTable
            Dim xrMerchInfoRow As New XRTableRow

            xrMerchInfoTbl.Location = New Point(intNewX, intNewY)
            xrMerchInfoTbl.Width = intAvailableWidth

            ' Category
            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
            xrMerchInfoRow = New XRTableRow
            xrMerchInfoRow = fctMakeDataRow({strX, row("Category").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
            xrMerchInfoRow.Height = 25
            xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

            ' Brand
            strX = cLang.GetString(clsEGSLanguage.CodeType.Brand)
            xrMerchInfoRow = New XRTableRow

            'AGL 2014.03.13
            Dim strBrand As String
            strBrand = row("BrandName").ToString
            If strBrand.ToLower.Contains("not defined") Then
                strBrand = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
            End If

            xrMerchInfoRow = fctMakeDataRow({strX, strBrand}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
            xrMerchInfoRow.Height = 25
            xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

            If G_ReportOptions.blnIncludeInfo Then

                ' Product Description
                strX = cLang.GetString(clsEGSLanguage.CodeType.ProductDescription)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Description").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Preparation
                strX = cLang.GetString(clsEGSLanguage.CodeType.Preparation)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Preparation").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Ingredients
                strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredients)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Ingredients").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Cooking Tip / Advise
                If G_CLIENT = "SV" Then strX = cLang.GetString(clsEGSLanguage.CodeType.FeedBack) Else strX = cLang.GetString(clsEGSLanguage.CodeType.CookingTip)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("CookingTip").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Refinement
                If G_CLIENT = "SV" Then strX = cLang.GetString(clsEGSLanguage.CodeType.Degustation_Development) Else strX = cLang.GetString(clsEGSLanguage.CodeType.Refinement)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Refinement").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Storage
                strX = cLang.GetString(clsEGSLanguage.CodeType.Storage)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Storage").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)

                ' Yield / Productivity
                If G_CLIENT = "SV" Then strX = cLang.GetString(clsEGSLanguage.CodeType.Remark) Else strX = cLang.GetString(clsEGSLanguage.CodeType.Productivity)
                xrMerchInfoRow = New XRTableRow
                xrMerchInfoRow = fctMakeDataRow({strX, row("Productivity").ToString}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.Top, FontStyle.Regular, G_ReportOptions.sgFontSize2 + 3)
                xrMerchInfoRow.Height = 25
                xrMerchInfoTbl.Rows.Add(xrMerchInfoRow)
            End If
            .Detail.Controls.Add(xrMerchInfoTbl)
            intNewY += (xrMerchInfoTbl.Height + 20)

            sf = New StringFormat(StringFormatFlags.NoClip)
            If G_ReportOptions.blnIncludeNutrients Then
                Dim intNutrientcount As Integer
                Dim strCaption As String
                Dim strCaptionNValue As String
                Dim intNutrientSpace As Integer = ((intAvailableWidth - lngWidestColumn) / 2)


                'intNewX = 0
                'strX = cLang.GetString(clsEGSLanguage.CodeType.Nutrients)
                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                'intNewY += GetLineSpace(intTextHeight)
                ' RDC 07.23.2013 : New Section Header
                intNewX = 0
                Dim xrNutrientSectionTbl As New XRTable
                xrNutrientSectionTbl = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Nutrients), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrNutrientSectionTbl)
                intNewY += (xrNutrientSectionTbl.Height + 10)

                'fctGetNutrientDetails()
                fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), G_ReportOptions.intSelectedNutrientSet, strCnn) 'VRP 08.01.2009

                intCount = 0

                For intNutrientcount = 1 To 34 ' 15
                    L_Nutrient(intNutrientcount).Format = G_Nutrient(intNutrientcount).Format
                    L_Nutrient(intNutrientcount).Heading = G_Nutrient(intNutrientcount).Heading
                    L_Nutrient(intNutrientcount).Name = G_Nutrient(intNutrientcount).Name
                    L_Nutrient(intNutrientcount).Unit = G_Nutrient(intNutrientcount).Unit
                    L_Nutrient(intNutrientcount).FormatKCAL = G_Nutrient(intNutrientcount).FormatKCAL 'DLS 17.08.2007
                    L_Nutrient(intNutrientcount).DisplayPosition = G_Nutrient(intNutrientcount).DisplayPosition
                    L_Nutrient(intNutrientcount).Position = G_Nutrient(intNutrientcount).Position

                    L_Nutrient(intNutrientcount).Value = -1
                    If Trim(L_Nutrient(intNutrientcount).Name) <> "" Then intCount = intCount + 1
                Next

                If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
                If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
                If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
                If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
                If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
                If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
                If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
                If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
                If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
                If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
                If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
                If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
                If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
                If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
                If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)
                If Not IsDBNull(row("N16")) Then L_Nutrient(16).Value = CType(row("N16"), Double)
                If Not IsDBNull(row("N17")) Then L_Nutrient(17).Value = CType(row("N17"), Double)
                If Not IsDBNull(row("N18")) Then L_Nutrient(18).Value = CType(row("N18"), Double)
                If Not IsDBNull(row("N19")) Then L_Nutrient(19).Value = CType(row("N19"), Double)
                If Not IsDBNull(row("N20")) Then L_Nutrient(20).Value = CType(row("N20"), Double)
                If Not IsDBNull(row("N21")) Then L_Nutrient(21).Value = CType(row("N21"), Double)
                If Not IsDBNull(row("N22")) Then L_Nutrient(22).Value = CType(row("N22"), Double)
                If Not IsDBNull(row("N23")) Then L_Nutrient(23).Value = CType(row("N23"), Double)
                If Not IsDBNull(row("N24")) Then L_Nutrient(24).Value = CType(row("N24"), Double)
                If Not IsDBNull(row("N25")) Then L_Nutrient(25).Value = CType(row("N25"), Double)
                If Not IsDBNull(row("N26")) Then L_Nutrient(26).Value = CType(row("N26"), Double)
                If Not IsDBNull(row("N27")) Then L_Nutrient(27).Value = CType(row("N27"), Double)
                If Not IsDBNull(row("N28")) Then L_Nutrient(28).Value = CType(row("N28"), Double)
                If Not IsDBNull(row("N29")) Then L_Nutrient(29).Value = CType(row("N29"), Double)
                If Not IsDBNull(row("N30")) Then L_Nutrient(30).Value = CType(row("N30"), Double)
                If Not IsDBNull(row("N31")) Then L_Nutrient(31).Value = CType(row("N31"), Double)
                If Not IsDBNull(row("N32")) Then L_Nutrient(32).Value = CType(row("N32"), Double)
                If Not IsDBNull(row("N33")) Then L_Nutrient(33).Value = CType(row("N33"), Double)
                If Not IsDBNull(row("N34")) Then L_Nutrient(34).Value = CType(row("N34"), Double)

                '-- JBB 08.21.2012
                For intNutrientIndex As Integer = 1 To intCount
                    For intNutrientcount = 1 To intCount
                        If L_Nutrient(intNutrientcount).DisplayPosition = intNutrientIndex Then
                            intNewX = lngWidestColumn
                            strCaption = L_Nutrient(intNutrientcount).Name

                            If intNutrientcount = 1 Then

                                'JTOC 02.10.2014 added kcal
                                '------------------------------------------------------------
                                Dim strCaption2 As String = L_Nutrient(intNutrientcount).Name.Replace("kj", "")
                                Dim strCaptionNValue2 As String = ""
                                'strCaption2 &= "kcal"
                                If L_Nutrient(intNutrientcount).Value = -1 Then
                                    strCaptionNValue2 = ""
                                Else
                                    '   strCaptionNValue2 = Format(L_Nutrient(intNutrientcount).Value / ENERGYFACTOR, L_Nutrient(intNutrientcount).FormatKCAL) & " kcal"
                                    strCaptionNValue2 = Format(L_Nutrient(intNutrientcount).Value / ENERGYFACTOR, L_Nutrient(intNutrientcount).Format) & " kcal"
                                    strCaptionNValue2 = String.Format(userCulture, "{0:N} kcal", L_Nutrient(intNutrientcount).Value / ENERGYFACTOR)
                                End If


                                If strCaptionNValue2 <> "" Then
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCaption2, fntBold2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    intNewX += intNutrientSpace
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCaptionNValue2, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    intNewY += GetLineSpace(intTextHeight)

                                End If
                                '------------------------------------------------------------

                                strCaption.Replace("kj", "")
                                If L_Nutrient(intNutrientcount).Value = -1 Then
                                    strCaptionNValue = ""
                                Else
                                    strCaptionNValue = Format(L_Nutrient(intNutrientcount).Value, L_Nutrient(intNutrientcount).Format) & " " & L_Nutrient(intNutrientcount).Unit ' & _
                                    '" / " & Format(L_Nutrient(intNutrientcount).Value / ENERGYFACTOR, L_Nutrient(intNutrientcount).FormatKCAL) & " kcal"
                                    strCaptionNValue = String.Format(userCulture, "{0:N} {1}", L_Nutrient(intNutrientcount).Value, L_Nutrient(intNutrientcount).Unit)
                                End If

                            Else
                                If L_Nutrient(intNutrientcount).Value = -1 Then
                                    strCaptionNValue = ""
                                Else
                                    'strCaptionNValue = L_Nutrient(intNutrientcount).Value & " " & L_Nutrient(intNutrientcount).Unit
                                    strCaptionNValue = Format(L_Nutrient(intNutrientcount).Value, L_Nutrient(intNutrientcount).Format) & " " & L_Nutrient(intNutrientcount).Unit
                                    strCaptionNValue = String.Format(userCulture, "{0:" & L_Nutrient(intNutrientcount).Format & "} {1}", L_Nutrient(intNutrientcount).Value, L_Nutrient(intNutrientcount).Unit)
                                End If

                            End If

                            'JTOC 11.13.2013 added if condition
                            If strCaptionNValue <> "" Then
                                intNewX = lngWidestColumn
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCaption, fntBold2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                intNewX += intNutrientSpace
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCaptionNValue, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                intNewY += GetLineSpace(intTextHeight)
                            End If
                            Exit For

                        End If
                    Next
                Next

            End If
            '-- JBB 08.21.2012
            'End of Nutrients

            ' RDC 07.23.2013 : New Section Header
            'intNewY += 20

            'DLS Aug112007
            If G_ReportOptions.blnIncludeGDA Then
                Dim intNutrientcount As Integer
                Dim strCaption As String
                Dim strCaptionNValue As String
                Dim intNutrientSpace As Integer = ((intAvailableWidth - lngWidestColumn) / 2)
                Dim dblValue As Double

                intNewY += intTextHeight * 1.5

                intNewX = 0
                Dim xrGDASectionTbl As New XRTable
                xrGDASectionTbl = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrGDASectionTbl)
                intNewY += (xrGDASectionTbl.Height + 20)

                'fctGetNutrientDetails()
                fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), G_ReportOptions.intSelectedNutrientSet, strCnn)    'VRP 08.01.2009 'JTOC 11.13.2013 added G_ReportOptions.intSelectedNutrientSet to parameter

                intCount = 0

                Dim flagWithGDA As Boolean = False
                For intNutrientcount = 1 To 34 '15
                    L_Nutrient(intNutrientcount).Format = G_Nutrient(intNutrientcount).Format
                    L_Nutrient(intNutrientcount).Heading = G_Nutrient(intNutrientcount).Heading
                    L_Nutrient(intNutrientcount).Name = G_Nutrient(intNutrientcount).Name
                    L_Nutrient(intNutrientcount).Unit = G_Nutrient(intNutrientcount).Unit
                    L_Nutrient(intNutrientcount).GDA = G_Nutrient(intNutrientcount).GDA
                    L_Nutrient(intNutrientcount).Value = -1
                    If Trim(L_Nutrient(intNutrientcount).Name) <> "" Then intCount = intCount + 1
                    If L_Nutrient(intNutrientcount).GDA > 0 Then flagWithGDA = True
                Next

                If flagWithGDA Then
                    If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
                    If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
                    If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
                    If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
                    If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
                    If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
                    If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
                    If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
                    If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
                    If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
                    If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
                    If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
                    If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
                    If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
                    If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)
                    If Not IsDBNull(row("N16")) Then L_Nutrient(16).Value = CType(row("N16"), Double)
                    If Not IsDBNull(row("N17")) Then L_Nutrient(17).Value = CType(row("N17"), Double)
                    If Not IsDBNull(row("N18")) Then L_Nutrient(18).Value = CType(row("N18"), Double)
                    If Not IsDBNull(row("N19")) Then L_Nutrient(19).Value = CType(row("N19"), Double)
                    If Not IsDBNull(row("N20")) Then L_Nutrient(20).Value = CType(row("N20"), Double)
                    If Not IsDBNull(row("N21")) Then L_Nutrient(21).Value = CType(row("N21"), Double)
                    If Not IsDBNull(row("N22")) Then L_Nutrient(22).Value = CType(row("N22"), Double)
                    If Not IsDBNull(row("N23")) Then L_Nutrient(23).Value = CType(row("N23"), Double)
                    If Not IsDBNull(row("N24")) Then L_Nutrient(24).Value = CType(row("N24"), Double)
                    If Not IsDBNull(row("N25")) Then L_Nutrient(25).Value = CType(row("N25"), Double)
                    If Not IsDBNull(row("N26")) Then L_Nutrient(26).Value = CType(row("N26"), Double)
                    If Not IsDBNull(row("N27")) Then L_Nutrient(27).Value = CType(row("N27"), Double)
                    If Not IsDBNull(row("N28")) Then L_Nutrient(28).Value = CType(row("N28"), Double)
                    If Not IsDBNull(row("N29")) Then L_Nutrient(29).Value = CType(row("N29"), Double)
                    If Not IsDBNull(row("N30")) Then L_Nutrient(30).Value = CType(row("N30"), Double)
                    If Not IsDBNull(row("N31")) Then L_Nutrient(31).Value = CType(row("N31"), Double)
                    If Not IsDBNull(row("N32")) Then L_Nutrient(32).Value = CType(row("N32"), Double)
                    If Not IsDBNull(row("N33")) Then L_Nutrient(33).Value = CType(row("N33"), Double)
                    If Not IsDBNull(row("N34")) Then L_Nutrient(34).Value = CType(row("N34"), Double)

                    For intNutrientcount = 1 To intCount

                        If L_Nutrient(intNutrientcount).GDA > 0 Then 'applicable for GDA
                            'Nutrient Name
                            intNewX = lngWidestColumn
                            strCaption = L_Nutrient(intNutrientcount).Name

                            dblValue = (L_Nutrient(intNutrientcount).Value / L_Nutrient(intNutrientcount).GDA) * 100
                            If L_Nutrient(intNutrientcount).Value = -1 Then
                                strCaptionNValue = "-"
                            Else

                                If dblValue < 1 And dblValue <> 0 Then
                                    strCaptionNValue = "< 1%"
                                Else
                                    strCaptionNValue = FormatNumber(dblValue, 0) & "%"
                                    strCaptionNValue = String.Format(userCulture, "{0:N0}%", dblValue)
                                End If
                            End If

                            'End If
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCaption, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            intNewX += intNutrientSpace
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCaptionNValue, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                            intNewY += GetLineSpace(intTextHeight)
                        End If
                    Next
                End If

            End If
            'End of GDA
            ' RDC 07.23.2013 : Additional space
            'intNewY += 20

            If G_ReportOptions.blnIncludeKeyword AndAlso foundKeywords IsNot Nothing Then

                'Keywords()
                intNewY += intTextHeight * 1.5

                ' RDC 07.23.2013 : New Section Header
                intNewX = 0
                Dim xrKeywordSectionTbl As New XRTable
                xrKeywordSectionTbl = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrKeywordSectionTbl)
                intNewY += (xrKeywordSectionTbl.Height + 10)

                Dim strKeyword As String
                Dim intPrevious As Integer
                intPrevious = -1

                For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)

                    strKeyword = CType(foundKeywords(rowK)("Name"), String)
                    If Not IsNothing(strKeyword) Then
                        intNewY += GetLineSpace(intTextHeight)

                        If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
                            If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
                                If CType(foundKeywords(rowK)("derived"), Boolean) Then
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                Else
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                End If
                            End If
                        Else
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        End If
                    End If

                Next
            Else
                intNewX = 0 'CMC_COOP-2171
            End If

            intNewY += 20

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                'subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "004")
                Dim row1 As DataRow = foundDetails(0)
                Dim CodeAllergenTranslation As Integer
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)

                sf = New StringFormat(StringFormatFlags.NoClip)
                With Me
                    Dim strStyle As String = "004"
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                    'Select Case strStyle
                    '    Case "003Menu"
                    '        intNewY += 10
                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                    '    Case "004" 'Merchandise Details
                    intNewY += 30

                    .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                    '    Case Else
                    'intNewY += 10
                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    'End Select


                    intNewY += intTextHeight + 10
                End With
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "004", False, True, strCnn, CodeAllergenTranslation)
            End If
            'End of Allergens

            'AGL 2013.02.14 - force pagebreak

            .Detail.Controls.Add(New XRPageBreak)
        End With



        Return Me
    End Function

    '==================================================
    'Print Menu Costing
    'MCM
    'Last Modified : 20 January 2006
    '==================================================

    Public Function fctPrintMerchandiseEgsDetails2(ByVal foundDetails() As DataRow,
                                                  ByVal foundKeywords() As DataRow,
                                                  ByVal foundAllergens() As DataRow,
                                                  Optional ByVal strCnn As String = "") As XtraReport

        Dim lngWidestColumn As Long = 0
        'Dim str3Pictures As String
        'Dim strPicture() As String
        Dim strPictureAll As String = "" 'VRP 06.11.2007
        Dim strX As String
        Dim dblMaxWidthPicture As Double
        Dim dblMaxHeightPicture As Double
        Dim intCount As Integer
        Dim fntItalic2 As Font
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim blFlagPixOk As Boolean
        Dim intTextHeight2 As Integer
        Dim intYImageRight As Integer

        fctPrintMerchandiseEgsDetails2 = Nothing
        Cursor.Current = Cursors.WaitCursor
        sf = New StringFormat(StringFormatFlags.NoClip)

        Try
            fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

            fntRegular2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic2 = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            End If
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If


        Dim row As DataRow = foundDetails(0)

        'If dtMerchandiseDetails.DefaultView.Count > 0 Then
        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            sf = New StringFormat(StringFormatFlags.NoClip)
            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular2, intAvailableWidth, sf, Me.Padding).Height

            strX = cLang.GetString(clsEGSLanguage.CodeType.Brand)                           'brand
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                        'Category
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)                          'Number
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Supplier)                        'Supplier
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)

            strX = cLang.GetString(clsEGSLanguage.CodeType.SupplierNumber)                  'Supplier number
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)                           'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            strX = cLang.GetString(clsEGSLanguage.CodeType.ProductDescription)                           'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Preparation)                           'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Products) ' RBAJ-2012.10.08
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredients)                           'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            If G_CLIENT = "SV" Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.FeedBack)                      'Cooking Tip/Advise
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.CookingTip)                      'Cooking Tip/Advise
            End If                    'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            If G_CLIENT = "SV" Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Degustation_Development)                      'Refinement
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.Refinement)                      'Refinement
            End If                      'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Storage)                           'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)


            If G_CLIENT = "SV" Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                    'Yield/Productivity
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.Productivity)                    'Yield/Productivity
            End If                    'Date
            lngWidestColumn = fctGetWidest(strX, intTextHeight, lngWidestColumn, fntRegular2)
            sf = New StringFormat(StringFormatFlags.NoClip)
            'lngWidestColumn += 50

            'page header
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            intNewX = 0
            intNewY = CInt(G_ReportOptions.dblTopMargin)
            strX = row("Name").ToString
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

            intNewX = 0
            intNewY = 0
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
            intNewY += GetLineSpace(intTextHeight)

            If G_ReportOptions.blnPictureOneRight = True Then
                G_ReportOptions.blnWithPicture = True
                G_ReportOptions.blnPicturesAll = False
            End If

            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False
                dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5
                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            ElseIf G_ReportOptions.blnWithPicture Then
                dblMaxHeightPicture = 180
                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                'dblMaxWidthPicture = (L_lngW * 0.4) - 100
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            If G_ReportOptions.blnWithPicture OrElse G_ReportOptions.blnPicturesAll Then
                'str3Pictures = ""
                'If Not IsDBNull(row("PictureName").ToString) Then str3Pictures = row("PictureName").ToString
                'Dim strFileName As String = Nothing
                'For j As Integer = 0 To 2
                '    strPicture(j) = ""
                '    strPicture(j) = fctGetPictureName(str3Pictures, j)
                '    If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then strFileName &= strPicture(j)
                'Next

                'If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                '    dblMaxHeightPicture = 350
                '    dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
                'End If

                'If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
                '    If G_ReportOptions.blnWithPicture Then
                '        For j As Integer = 0 To 4
                '            If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                '                strFileName = G_strPhotoPath & strPicture(j)

                '                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                '                    intNewX = (intAvailableWidth - dblMaxWidthPicture)
                '                End If

                '                .Detail.Controls.AddRange(New XRControl() _
                '                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                '                blFlagPixOk = True

                '                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                '                    intNewX = 0
                '                    intYImageRight = intNewY + G_dblMaxHeightPicture + intTextHeight 'DLS Aug302007
                '                Else
                '                    intNewX += G_dblMaxWidthPicture + 20
                '                    intNewY += G_dblMaxHeightPicture + intTextHeight
                '                End If

                '                'intPicStart = intNewY
                '                Exit For
                '            End If
                '        Next
                '    ElseIf G_ReportOptions.blnPicturesAll Then
                '        Dim intBiggestHeightPic As Integer = 0
                '        For j As Integer = 0 To 4 'VRP 06.11.2007
                '            If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
                '                strFileName = G_strPhotoPath & strPicture(j)

                '                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                '                    intNewX = (intAvailableWidth - dblMaxWidthPicture)
                '                End If

                '                .Detail.Controls.AddRange(New XRControl() _
                '                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                '                intNewX += CInt(G_dblMaxWidthPicture) + 5
                '                intBiggestHeightPic = IIf(intBiggestHeightPic < G_dblMaxHeightPicture, G_dblMaxHeightPicture, intBiggestHeightPic)
                '                strFileName &= strPicture(j)
                '            End If
                '        Next

                '        If strFileName <> "" Then
                '            intNewY += CInt(intBiggestHeightPic) + intTextHeight
                '            intNewX = 0
                '        End If
                '    End If
                'End If


                '--- VRP 06.11.2007
                If Not IsDBNull(row("PictureName").ToString) Then strPictureAll = row("PictureName").ToString
                Dim arrPicture() As String = strPictureAll.Split(CChar(";"))

                Dim strFileName As String = Nothing
                For j As Integer = 0 To UBound(arrPicture)
                    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then strFileName &= arrPicture(j)
                Next

                If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                    dblMaxHeightPicture = 350
                    dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
                End If

                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    If G_ReportOptions.blnWithPicture Then
                        For j As Integer = 0 To UBound(arrPicture)
                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                strFileName = G_strPhotoPath & arrPicture(j)

                                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                    intNewX = (intAvailableWidth - dblMaxWidthPicture)
                                End If

                                .Detail.Controls.AddRange(New XRControl() _
                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                blFlagPixOk = True

                                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                    intNewX = 0
                                    intYImageRight = intNewY + G_dblMaxHeightPicture + intTextHeight 'DLS Aug302007
                                Else
                                    intNewX += G_dblMaxWidthPicture + 20
                                    intNewY += G_dblMaxHeightPicture + intTextHeight
                                End If

                                'intPicStart = intNewY
                                Exit For
                            End If
                        Next
                    ElseIf G_ReportOptions.blnPicturesAll Then
                        Dim intBiggestHeightPic As Integer = 0
                        For j As Integer = 0 To UBound(arrPicture)
                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                strFileName = G_strPhotoPath & arrPicture(j)

                                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                    intNewX = (intAvailableWidth - dblMaxWidthPicture)
                                End If

                                .Detail.Controls.AddRange(New XRControl() _
                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                intNewX += CInt(G_dblMaxWidthPicture) + 5
                                intBiggestHeightPic = IIf(intBiggestHeightPic < G_dblMaxHeightPicture, G_dblMaxHeightPicture, intBiggestHeightPic)
                                strFileName &= arrPicture(j)
                            End If
                        Next

                        If strFileName <> "" Then
                            intNewY += CInt(intBiggestHeightPic) + intTextHeight
                            intNewX = 0
                        End If
                    End If
                End If
                '--------

            End If

            'Brand
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Brand)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("BrandName").ToString), "", row("BrandName").ToString)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            'Category
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Category").ToString), "", row("Category").ToString)
            '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            'number
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("number").ToString), "", row("number").ToString)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            'supplier
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Supplier)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("supplier").ToString), "", row("supplier").ToString)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            'suppliernumber
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.SupplierNumber)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("suppliernumber").ToString), "", row("suppliernumber").ToString)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            'date
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            intNewX += lngWidestColumn
            strX = ": " & fctSqlReady(fctConvertDate(row("Dates").ToString))
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += GetLineSpace(intTextHeight)

            intNewY += GetLineSpace(intTextHeight)

            If G_ReportOptions.blnPictureOneRight Then 'DLS August302007
                If intNewY < (intYImageRight) Then
                    intNewY = intYImageRight
                End If
            End If


            'Product Description
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.ProductDescription)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Description").ToString), "", row("Description").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, DevExpress.XtraPrinting.BorderSide.Top)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            'Preparation
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Preparation)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Preparation").ToString), "", row("Preparation").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            'Ingredients
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Products) ' RBAJ-2012.10.08
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredients)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Ingredients").ToString), "", row("Ingredients").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            If G_ReportOptions.blnIncludeCookingTip Then
                'Cooking Tip/Advise
                intNewX = 0
                If G_CLIENT = "SV" Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.FeedBack)                      'Cooking Tip/Advise
                Else
                    strX = cLang.GetString(clsEGSLanguage.CodeType.CookingTip)                      'Cooking Tip/Advise
                End If
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

                intNewX += lngWidestColumn
                strX = ": " & IIf(IsDBNull(row("CookingTip").ToString), "", row("CookingTip").ToString)
                If strX.Length = 0 Then
                    intTextHeight2 = intTextHeight
                Else
                    intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
                End If
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                intNewY += GetLineSpace(intTextHeight2) * 1.5
            End If

            'Refinement
            intNewX = 0
            If G_CLIENT = "SV" Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Degustation_Development)                      'Refinement
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.Refinement)                      'Refinement
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Refinement").ToString), "", row("Refinement").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            'Storage
            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Storage)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Storage").ToString), "", row("Storage").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            'Yield/Productivity
            intNewX = 0
            If G_CLIENT = "SV" Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                    'Yield/Productivity
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.Productivity)                    'Yield/Productivity
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, lngWidestColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewX += lngWidestColumn
            strX = ": " & IIf(IsDBNull(row("Productivity").ToString), "", row("Productivity").ToString)
            If strX.Length = 0 Then
                intTextHeight2 = intTextHeight
            Else
                intTextHeight2 = ReportingTextUtils.MeasureText(strX, fntRegular2, intAvailableWidth - lngWidestColumn, sf, Me.Padding).Height
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth - lngWidestColumn, intTextHeight2, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
            intNewY += GetLineSpace(intTextHeight2) * 1.5

            If G_ReportOptions.blnIncludeNutrients Then
                Dim intNutrientcount As Integer
                Dim strCaption As String
                Dim strCaptionNValue As String
                Dim intNutrientSpace As Integer = ((intAvailableWidth - lngWidestColumn) / 2)


                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Nutrients)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                intNewY += GetLineSpace(intTextHeight) * 2

                'fctGetNutrientDetails()
                fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, strCnn) 'VRP 08.01.2009

                intCount = 0

                For intNutrientcount = 1 To 34 '15
                    L_Nutrient(intNutrientcount).Format = G_Nutrient(intNutrientcount).Format
                    L_Nutrient(intNutrientcount).Heading = G_Nutrient(intNutrientcount).Heading
                    L_Nutrient(intNutrientcount).Name = G_Nutrient(intNutrientcount).Name
                    L_Nutrient(intNutrientcount).Unit = G_Nutrient(intNutrientcount).Unit
                    L_Nutrient(intNutrientcount).Value = -1
                    If Trim(L_Nutrient(intNutrientcount).Name) <> "" Then intCount = intCount + 1
                Next

                If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
                If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
                If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
                If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
                If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
                If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
                If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
                If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
                If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
                If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
                If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
                If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
                If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
                If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
                If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

                For intNutrientcount = 1 To intCount
                    'Nutrient Name
                    'intNewX = lngWidestColumn
                    intNewX = 0
                    strCaption = L_Nutrient(intNutrientcount).Name

                    If intNutrientcount = 1 Then
                        strCaption &= "/kcal"
                        If L_Nutrient(intNutrientcount).Value = -1 Then
                            strCaptionNValue = ""
                        Else
                            strCaptionNValue = L_Nutrient(intNutrientcount).Value & " " & L_Nutrient(intNutrientcount).Unit &
                            " / " & Format(L_Nutrient(intNutrientcount).Value / ENERGYFACTOR, L_Nutrient(intNutrientcount).FormatKCAL) & " kcal"
                        End If
                    Else
                        If L_Nutrient(intNutrientcount).Value = -1 Then
                            strCaptionNValue = ""
                        Else
                            strCaptionNValue = L_Nutrient(intNutrientcount).Value & " " & L_Nutrient(intNutrientcount).Unit
                        End If

                    End If
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCaption, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += intNutrientSpace
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCaptionNValue, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewY += GetLineSpace(intTextHeight)
                Next

            End If
            'End of Nutrients

            'DLS Aug112007
            If G_ReportOptions.blnIncludeGDA Then
                Dim intNutrientcount As Integer
                Dim strCaption As String
                Dim strCaptionNValue As String
                Dim intNutrientSpace As Integer = ((intAvailableWidth - lngWidestColumn) / 2)
                Dim dblValue As Double

                intNewY += intTextHeight * 1.5
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                intNewY += GetLineSpace(intTextHeight) * 2

                'fctGetNutrientDetails()
                fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, strCnn) 'VRP 08.01.2009

                intCount = 0

                For intNutrientcount = 1 To 34 '15
                    L_Nutrient(intNutrientcount).Format = G_Nutrient(intNutrientcount).Format
                    L_Nutrient(intNutrientcount).Heading = G_Nutrient(intNutrientcount).Heading
                    L_Nutrient(intNutrientcount).Name = G_Nutrient(intNutrientcount).Name
                    L_Nutrient(intNutrientcount).Unit = G_Nutrient(intNutrientcount).Unit
                    L_Nutrient(intNutrientcount).GDA = G_Nutrient(intNutrientcount).GDA
                    L_Nutrient(intNutrientcount).Value = -1
                    If Trim(L_Nutrient(intNutrientcount).Name) <> "" Then intCount = intCount + 1
                Next

                If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
                If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
                If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
                If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
                If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
                If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
                If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
                If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
                If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
                If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
                If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
                If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
                If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
                If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
                If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

                For intNutrientcount = 1 To intCount

                    If L_Nutrient(intNutrientcount).GDA > 0 Then 'applicable for GDA
                        'Nutrient Name
                        intNewX = 0
                        strCaption = L_Nutrient(intNutrientcount).Name

                        'If intNutrientcount = 1 Then
                        '    strCaption &= "/kcal"
                        '    If L_Nutrient(intNutrientcount).Value = -1 Then
                        '        strCaptionNValue = ""
                        '    Else
                        '        strCaptionNValue = L_Nutrient(intNutrientcount).Value & " " & L_Nutrient(intNutrientcount).Unit & _
                        '        " / " & Format(L_Nutrient(intNutrientcount).Value / ENERGYFACTOR, "###.00") & " kcal"
                        '    End If
                        'Else
                        dblValue = (L_Nutrient(intNutrientcount).Value / L_Nutrient(intNutrientcount).GDA) * 100
                        If L_Nutrient(intNutrientcount).Value = -1 Then
                            strCaptionNValue = "-"
                        Else
                            If dblValue < 1 And dblValue <> 0 Then
                                strCaptionNValue = "< 1%"
                            Else
                                strCaptionNValue = FormatNumber(dblValue, 0) & "%"
                            End If
                            'strCaptionNValue = FormatNumber(dblValue, 2) & "%"
                        End If

                        'End If
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCaption, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += intNutrientSpace
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCaptionNValue, fntRegular2, intNewX, intNewY, intNutrientSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewY += GetLineSpace(intTextHeight)
                    End If
                Next

            End If
            'End of GDA




            If G_ReportOptions.blnIncludeKeyword Then

                'Keywords()
                intNewY += intTextHeight * 1.5
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Keywords)        'Keywords
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})


                Dim dtKey As New DataTable
                dtKey.Columns.Add("codeKey", System.Type.GetType("System.Int32"))
                dtKey.Columns.Add("parent", System.Type.GetType("System.Int32"))
                dtKey.Columns.Add("type", System.Type.GetType("System.Int32"))
                dtKey.Columns.Add("name")
                dtKey.Columns.Add("derived")
                dtKey.Columns.Add("indent", System.Type.GetType("System.Int32"))

                Dim rwKey As DataRow
                For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)
                    rwKey = dtKey.NewRow
                    rwKey("codeKey") = foundKeywords(rowK)("codeKey")
                    rwKey("parent") = foundKeywords(rowK)("parent")
                    rwKey("type") = foundKeywords(rowK)("type")
                    rwKey("name") = foundKeywords(rowK)("Name")
                    rwKey("derived") = foundKeywords(rowK)("derived")
                    dtKey.Rows.Add(rwKey)
                Next

                Dim intCurrentParent As Integer
                Dim intIndent As Integer
                For Each rwKey In dtKey.Rows
                    intCurrentParent = rwKey("parent")
                    intIndent = 0
                    While dtKey.Select("codeKey=" & intCurrentParent).Length > 0
                        intCurrentParent = dtKey.Select("codeKey=" & intCurrentParent)(0)("parent")
                        intIndent += 1
                    End While
                    rwKey("indent") = intIndent
                    dtKey.AcceptChanges()
                Next

                Dim dvKey As DataView = dtKey.DefaultView
                dvKey.RowFilter = "indent=0"

                Dim drvKey As DataRowView
                For Each drvKey In dvKey
                    intNewX = drvKey("indent") * 20
                    intNewY += GetLineSpace(intTextHeight)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drvKey("name"), fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                    GetChild(dtKey, drvKey("codeKey"))
                Next

                'Dim strKeyword As String
                'Dim intPrevious As Integer
                'intPrevious = -1

                'For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)
                '    strKeyword = CType(foundKeywords(rowK)("Name"), String)
                '    If Not IsNothing(strKeyword) Then
                '        intNewY += GetLineSpace(intTextHeight)

                '        If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
                '            If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
                '                If CType(foundKeywords(rowK)("derived"), Boolean) Then
                '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                '                Else
                '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                '                End If
                '            End If
                '        Else

                '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                '        End If
                '    End If

                'Next

            End If

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                ''  subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "004")
                Dim row1 As DataRow = foundDetails(0)
                Dim CodeAllergenTranslation As Integer
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)

                sf = New StringFormat(StringFormatFlags.NoClip)
                With Me
                    Dim strStyle As String = "004"
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                    'Select Case strStyle
                    '    Case "003Menu"
                    '        intNewY += 10
                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                    '    Case "004" 'Merchandise Details
                    intNewY += 30
                    intNewX = 0
                    .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                    '    Case Else
                    'intNewY += 10
                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    'End Select


                    intNewY += intTextHeight + 10
                End With
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "004", False, True, strCnn)
            End If
            'End of Allergens



        End With

        Return Me
    End Function
#End Region

#Region " Recipe Reports"

    'MCM  03.08.06
    'MCM  03.08.06
    Function fctPrintRecipeDetailEgs(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow,
        ByVal foundAllergens() As DataRow, ByVal strStyle As String,
        Optional ByVal flagSubRecipeAsterisk As Boolean = False,
        Optional ByVal flagSubRecipeNormalFont As Boolean = False,
        Optional ByVal flagRecipeDetails As Integer = -1,
        Optional ByVal strMigrosParam As String = ";;;;",
        Optional ByVal strCnn As String = "",
        Optional ByVal dtIngredients As DataTable = Nothing,
        Optional ByVal blnShowSteps As Boolean = True, Optional ByVal dtListePreparation() As DataRow = Nothing,
                                      Optional ByVal userLocale As String = "en-US") As XtraReport   'MCM 03.03.06

        'Dim clsTrans As New clsLanguage(enumAppType.WebApp, strCnn, enumEgswFetchType.DataTable)
        'intSelCodeLang = clsTrans.GetCodeLang(G_ReportOptions.intTranslation)  'MKAM 2015.04.16
        'cLangTrans = New clsEGSLanguage(intSelCodeLang)

        ' RDC 05.09.2013 for testing
        'Return fctPrintRecipeDetailEgs2(foundDetails, foundKeywords, foundAllergens, strStyle)
        'Exit Function
        Dim strPriceFormat As String

        Dim userCulture As CultureInfo = New CultureInfo(userLocale)

        G_Options.RemoveTrailingZero = G_ReportOptions.blnRemoveTrailingZeros '// DRR 03.08.2012
        Dim strNutrientServing As String = ""

        Dim arrNutrientName As New ArrayList
        For Each tNut As tNutrient In G_Nutrient
            arrNutrientName.Add(tNut.Name)
        Next

        ' RDC 08.02.2013 : NutrientSet, Acquiring session variable
        Dim intSelectedNutrientSet As Integer = 0
        'If Not Session("SelectedNutrientSetCode") Is Nothing Then intSelectedNutrientSet = CInt(Session("SelectedNutrientSetCode"))

        Dim intRecipeCode As Long
        Dim strRecipeName As String
        Dim strPortionUnit As String = ""
        Dim strYieldName As String
        Dim intCount As Integer
        Dim dblMaxHeightPicture As Double
        Dim dblMaxWidthPicture As Double
        'Dim strPicture(0 To 2) As String
        'Dim str3Pictures As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007
        Dim blflagQtyFirst As Boolean
        Dim intDictionary As Integer
        Dim intColumnWidth As Integer = 100
        Dim intPicStart As Integer
        Dim intNewXIngredient As Integer = 0 'DLS May252007
        Dim intNewYIngredient As Integer = 0 'DLS June182007
        Dim IntRecipeParentCode As Integer      'MKAM 2015.07.02
        Dim IntRecipeID As Integer
        Dim intPosition As Integer = 0

        fctPrintRecipeDetailEgs = Nothing

        Try
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold) 'VRP 05.11.2007
            End If
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        Dim row As DataRow = foundDetails(0)
        intRecipeCode = row("Code") ' RDC 03.14.2013 - Filter
        IntRecipeParentCode = IIf(IsDBNull(row("CodeListeParent")), 0, row("CodeListeParent"))   'MKAM 2015.07.02
        IntRecipeID = row("ID")
        intPosition = IIf(IsDBNull(row("position")), 0, row("position"))
        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then 'DLS Aug112007
            'fctGetNutrientDetails()
            ' RDC 07.31.2013 : Added optional parameter for nutrientset
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), G_ReportOptions.intSelectedNutrientSet, strCnn) 'VRP 08.01.2009
        End If



        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)


            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = (intAvailableWidth - G_ReportOptions.dblLeftMargin - G_ReportOptions.dblRightMargin) - 15
            intCount = 0
            For i As Integer = 1 To 34 '15
                L_Nutrient(i).Format = G_Nutrient(i).Format
                L_Nutrient(i).Heading = G_Nutrient(i).Heading
                L_Nutrient(i).Name = G_Nutrient(i).Name
                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                L_Nutrient(i).Value = -1
                L_Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
                L_Nutrient(i).DisplayPosition = G_Nutrient(i).DisplayPosition  '// DRR 03.09.2012
                If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
            Next
            Dim strFieldname As String = Nothing
            Dim strFieldnameForPercent As String = Nothing
            For i As Integer = 1 To 34 '15
                strFieldname = "N" & i.ToString
                'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
                strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
                If Not IsDBNull(row(strFieldname)) And
                   Not IsDBNull(row(strFieldnameForPercent)) Then
                    If row(strFieldnameForPercent) = -1 Then
                        L_Nutrient(i).Value = CType(row(strFieldname), Double)
                        L_Nutrient(i).Unit = G_Nutrient(i).Unit
                    Else
                        L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                        G_Nutrient(i).Unit = "%"
                        L_Nutrient(i).Unit = G_Nutrient(i).Unit
                    End If
                Else ''--- 03.21.2012 JBB
                    If Not IsDBNull(row(strFieldnameForPercent)) Then
                        If row(strFieldnameForPercent) = -1 Then
                            If IsDBNull(row(strFieldname)) Then
                                L_Nutrient(i).Value = -1.0
                                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                            Else
                                L_Nutrient(i).Value = CType(row(strFieldname), Double)
                                L_Nutrient(i).Unit = G_Nutrient(i).Unit
                            End If

                        Else
                            L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                            G_Nutrient(i).Unit = "%"
                            L_Nutrient(i).Unit = G_Nutrient(i).Unit
                        End If
                    Else
                        If IsDBNull(row(strFieldname)) Then
                            L_Nutrient(i).Value = -1.0
                            L_Nutrient(i).Unit = G_Nutrient(i).Unit
                        Else
                            L_Nutrient(i).Value = CType(row(strFieldname), Double)
                            L_Nutrient(i).Unit = G_Nutrient(i).Unit
                        End If
                    End If
                End If
            Next

            intDictionary = G_Language

            If G_ReportOptions.intTranslation > 0 Then
                If IsDBNull(CType(row("CodeDictionary"), Integer)) Then
                    intDictionary = G_Language
                Else
                    intDictionary = CType(row("CodeDictionary"), Integer)
                End If
            End If
            G_Language = intDictionary

            'for page header
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            intNewX = 0
            intNewY = CInt(G_ReportOptions.dblTopMargin)

            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)

            strX = strRecipeName
            strLocation = strX

            If strX <> strRecipeName Then
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                intNewY += intTextHeight
                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                intNewY += intTextHeight + 5
            End If
            strX = fctSqlReady(row("RecipeNumber").ToString) : strX = Replace(strX, Chr(1), "")
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width

            intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth - intTextWidth, sf, Me.Padding).Height

            Dim xTable As New XRTable
            Dim xTblRow As New XRTableRow
            Dim xTblCell As New XRTableCell

            xTable.Location = New System.Drawing.Point(intNewX, intNewY)
            xTable.Width = intAvailableWidth

            If G_ReportOptions.blnIncludeHighlightSection Then
                'xTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xTable.BorderWidth = 1
                xTable.BackColor = Color.LightGray
            Else
                'xTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                xTable.BorderWidth = 1
                xTable.BackColor = Color.White
            End If

            xTblRow.Padding = New DevExpress.XtraPrinting.PaddingInfo(0, 0, 0, 0)
            xTblRow.Height = CInt(G_ReportOptions.sgFontTitleSize)
            xTblCell.Text = New String(strRecipeName)
            xTblCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            If G_ReportOptions.blnIncludeHighlightSection Then xTblCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xTblCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            xTblCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xTblRow.Cells.Add(xTblCell)
            xTable.Rows.Add(xTblRow)

            'Dim rwSubtitle() As DataRow = G_ReportOptions.dtSubtitle.Select("Name = '" & strRecipeName.Replace("'", "''") & "'")
            Dim blnUseMakes As Boolean = False
            Dim rwSubtitle() As DataRow = Nothing

            If G_ReportOptions.dtSubtitle IsNot Nothing Then
                rwSubtitle = G_ReportOptions.dtSubtitle.Select("Code = " & row("Code"))
                If rwSubtitle IsNot Nothing AndAlso rwSubtitle.Length > 0 Then
                    blnUseMakes = CBoolDB(rwSubtitle(0)("bitUseMakes"))
                End If

                If G_ReportOptions.blnIncludeSubtitle And rwSubtitle.Length > 0 Then
                    Dim strSubtitle As String = rwSubtitle(0)("SubTitle").ToString.Trim
                    xTblRow = New XRTableRow
                    xTblRow.Height = CInt(G_ReportOptions.sgFontSize2)
                    xTblCell = New XRTableCell
                    xTblCell.Text = New String(strSubtitle)
                    xTblCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    If Not G_ReportOptions.blnIncludeHighlightSection Then xTblCell.Borders = DevExpress.XtraPrinting.BorderSide.Bottom Else xTblCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                    xTblCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                    xTblRow.Cells.Add(xTblCell)
                    xTable.Rows.Add(xTblRow)
                End If
            End If

            xTable.KeepTogether = False
            .PageHeader.Controls.Add(xTable)

            'xTable.Dispose()
            'xTblRow.Dispose()
            'xTblCell.Dispose()

            intNewY += 25 ' RDC 02.27.2013 - Line Spacing


            If G_CLIENT = "HACO" Then
                intNewX = CInt(intAvailableWidth - intTextWidth)
                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, CInt(intTextWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , , , G_ReportOptions.strTitleColor)})
            End If

            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRLabel() {fctMakeXRLabel(" ", fntBold, intNewX, intNewY, 8, intTextWidth, DevExpress.XtraPrinting.TextAlignment.BottomCenter)})

            If Not strStyle = "003" Then
                intNewX = 0
                intNewY = 0
                intNewY += 10
            End If

            'strYieldName = row("PortionUnit").ToString
            strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation)

            blflagQtyFirst = True
            'Set Picture sizes
            Select Case strStyle
                Case "001", "002"         'Standard, Modern
                    If G_ReportOptions.blnPicturesAll = True Then
                        G_ReportOptions.blnWithPicture = False

                        Select Case G_ReportOptions.strSubStyle
                            Case "01" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4
                            Case "02" : dblMaxWidthPicture = (intAvailableWidth - 200) / 4 : blflagQtyFirst = False
                            Case "11" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5
                            Case "12" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5 : blflagQtyFirst = False
                            Case "21" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                            Case "22" : dblMaxWidthPicture = (intAvailableWidth - 200) / 3 : blflagQtyFirst = False
                            Case Else : dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                        End Select

                        dblMaxHeightPicture = dblMaxWidthPicture '* 1.5
                    Else
                        Select Case G_ReportOptions.strSubStyle
                            Case "01" : dblMaxHeightPicture = 180
                            Case "02" : dblMaxHeightPicture = 180 : blflagQtyFirst = False
                            Case "11" : dblMaxHeightPicture = 250
                            Case "12" : dblMaxHeightPicture = 250 : blflagQtyFirst = False
                            Case "21" : dblMaxHeightPicture = 350
                            Case "22" : dblMaxHeightPicture = 350 : blflagQtyFirst = False
                        End Select
                        If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                        dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
                    End If
                Case "003"      'Two Columns
                    Select Case G_ReportOptions.strSubStyle
                        Case "01" : dblMaxHeightPicture = 350
                        Case "02" : dblMaxHeightPicture = 350 : blflagQtyFirst = False
                    End Select
                    dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End Select

            Dim intDPic As Integer
            If row.Table.Columns.Contains("DefaultPicture") Then
                intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
            Else
                intDPic = 1
            End If

            'SM 20251201 update For Azure blob
            Dim coreCodeGroup As String = "0"
            If Not IsDBNull(row("CoreCodeGroup").ToString) Then coreCodeGroup = CryptoService.Get25CharString(row("CoreCodeGroup").ToString)
            If Not IsDBNull(row("Pix").ToString) Then G_strPhotoPath = G_strPhotoPath.Replace("CoreCodeGroup", coreCodeGroup)

            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString
            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))

            Dim strFileName As String = Nothing
            If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
                strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
            Else
                For j As Integer = 0 To UBound(arrPicture)
                    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then strFileName &= arrPicture(j)
                Next
            End If
            Log.Info("PRINT PICTURE " + strFileName)
            Log.Info("PRINT PICTURE " + G_strPhotoPath)
            'If strFileName <> "" Then
            '    intNewY += 50
            'End If
            If G_ReportOptions.blnPictureOneRight = True Then
                G_ReportOptions.blnWithPicture = True
                G_ReportOptions.blnPicturesAll = False
            End If

            Dim PicBoxHeight As Integer = 0 'for 1 pic only
            Select Case strStyle
                Case "001", "002"     'For Standard/Modern
                    If G_ReportOptions.blnPicturesAll = True Then
                        If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                            ' RDC 05.09.2013 - Placing images into table
                            Dim xPicTable As New XRTable

                            Dim xPicRow As New XRTableRow
                            Dim xPicCell As New XRTableCell

                            Dim intPicBoxWidth As Integer = CInt(dblMaxWidthPicture)
                            Dim intPicBoxHeight As Integer = CInt(dblMaxHeightPicture) 'AGL 2014.10.03

                            xPicTable.Size = New System.Drawing.Size(intAvailableWidth, intPicBoxHeight + 2)
                            xPicTable.BorderWidth = 0
                            xPicTable.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xPicTable.Location = New Point(intNewX, intNewY)
                            xPicRow.Height = intPicBoxHeight
                            xPicTable.Padding = New DevExpress.XtraPrinting.PaddingInfo(20, 20, 20, 20)
                            'AGL 2013.05.16 
                            Dim intValidPicCount As Integer = 0
                            For j As Integer = 0 To UBound(arrPicture) - 1 Step 1
                                If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                    'AGL 2013.05.16
                                    intValidPicCount += 1
                                    strFileName = G_strPhotoPath & arrPicture(j)

                                    If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                        intNewX = (intAvailableWidth - dblMaxWidthPicture)
                                    End If

                                    xPicCell = New XRTableCell
                                    xPicCell.Size = New Size(intPicBoxWidth, intPicBoxHeight)
                                    xPicCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    'xPicCell.BorderWidth = 1
                                    'xPicCell.BorderColor = Color.Black
                                    xPicCell.Padding = New DevExpress.XtraPrinting.PaddingInfo(1, 1, 1, 1)

                                    Dim xrPicBox As New XRPictureBox
                                    With xrPicBox
                                        .Borders = DevExpress.XtraPrinting.BorderSide.None
                                        .BorderWidth = 0
                                        .BorderColor = Color.White
                                        .Size = New System.Drawing.Size(intPicBoxWidth, intPicBoxHeight)
                                        .Image = LoadImageFromUrl(strFileName) 'Image.FromFile(strFileName)
                                        .Sizing = ImageSizeMode.ZoomImage
                                        '.Location = New Point(2, 2)
                                        .Padding = New DevExpress.XtraPrinting.PaddingInfo(5, 5, 5, 5)
                                    End With

                                    xPicCell.Controls.Add(xrPicBox)

                                    xPicRow.Cells.Add(xPicCell)
                                    xPicRow.Padding = New DevExpress.XtraPrinting.PaddingInfo(5, 5, 5, 5)
                                    xPicCell = New XRTableCell
                                    xPicCell.Size = New Size(intPicBoxWidth / 10, intPicBoxHeight)
                                    xPicCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    'xPicRow.Cells.Add(xPicCell)
                                    strFileName &= arrPicture(j)

                                    'xrPicBox.Dispose()
                                End If
                            Next

                            'AGL 2013.05.16
                            xPicTable.Width = (intAvailableWidth / 5) * intValidPicCount
                            'xPicTable.CanGrow = True
                            If xPicRow.Cells.Count > 0 Then
                                xPicTable.Rows.Add(xPicRow)
                                .Detail.Controls.Add(xPicTable)
                                intNewY += (xPicTable.Height) 'AGL 2014.06.11 - removed +20, was too much
                            End If

                            If strFileName <> "" Then
                                intNewX = 0
                                If G_ReportOptions.blnPictureOneRight = False Then 'DLS Aug292007
                                    intNewY += CInt(G_dblMaxHeightPicture) + 10
                                    intNewY += intTextHeight
                                End If
                            End If
                            'intNewY += (xPicTable.Height + 20) 'AGL 2014.06.11 - removed

                            'xPicTable.Dispose()
                            'xPicRow.Dispose()
                            'xPicCell.Dispose()
                        End If
                        '----------
                        'intNewY = intNewY + 100
                    Else
                        If G_ReportOptions.blnWithPicture = True Then
                            If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                                If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
                                    strFileName = G_strPhotoPath & arrPicture(intDPic - 1)

                                    If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                        ' RDC 05.23.2013 - Replotting of picture box on sub styles not equal to 01 and 02 
                                        'intNewX = (intAvailableWidth - dblMaxWidthPicture)
                                        Select Case G_ReportOptions.strSubStyle
                                            Case "01", "02"
                                                intNewX = CInt(intAvailableWidth - CInt(dblMaxHeightPicture - 60))
                                            Case "11", "12"
                                                intNewX = CInt(intAvailableWidth - CInt(dblMaxHeightPicture - 60))
                                            Case "21", "22"
                                                intNewX = CInt(intAvailableWidth - CInt(dblMaxHeightPicture - 60))
                                        End Select
                                    End If

                                    Dim xrPicTable As New XRTable
                                    Dim xrPicRow As New XRTableRow
                                    Dim xrPicCell As New XRTableCell
                                    Dim intPicBoxWidth As Integer = CInt(dblMaxHeightPicture - 60)
                                    Dim intPicBoxHeight As Integer = CInt(dblMaxHeightPicture - 60)
                                    PicBoxHeight = intPicBoxHeight


                                    xrPicTable.Size = New System.Drawing.Size(intPicBoxWidth, intPicBoxHeight)
                                    xrPicTable.Location = New Point(intNewX, intNewY)
                                    xrPicTable.BorderWidth = 1
                                    xrPicTable.Borders = DevExpress.XtraPrinting.BorderSide.All
                                    xrPicRow.Height = intPicBoxHeight

                                    Dim xrPicBox As New XRPictureBox
                                    With xrPicBox
                                        .Borders = DevExpress.XtraPrinting.BorderSide.None
                                        .BorderWidth = 0
                                        .BorderColor = Color.White
                                        .Size = New System.Drawing.Size(intPicBoxWidth - 8, intPicBoxHeight - 8)
                                        .Image = LoadImageFromUrl(strFileName) 'Image.FromFile(strFileName)
                                        .Sizing = ImageSizeMode.ZoomImage
                                        .Location = New Point(4, 4)
                                    End With

                                    xrPicCell.Size = New Size(intPicBoxWidth, intPicBoxHeight)
                                    xrPicCell.Borders = DevExpress.XtraPrinting.BorderSide.All
                                    xrPicCell.BorderWidth = 1
                                    xrPicCell.BorderColor = Color.Black
                                    xrPicCell.Controls.Add(xrPicBox)

                                    xrPicRow.Cells.Add(xrPicCell)
                                    xrPicTable.Rows.Add(xrPicRow)

                                    .Detail.Controls.Add(xrPicTable)

                                    If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                        intNewX = 0
                                    Else
                                        intNewX += intPicBoxWidth + 20
                                    End If

                                    intPicStart = intNewY

                                    'xrPicTable.Dispose()
                                    'xrPicRow.Dispose()
                                    'xrPicCell.Dispose()
                                    'xrPicBox.Dispose()
                                Else
                                    For j As Integer = 0 To UBound(arrPicture)
                                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                            strFileName = G_strPhotoPath & arrPicture(j)
                                            '-------

                                            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                                intNewX = (intAvailableWidth - dblMaxWidthPicture)
                                            End If

                                            .Detail.Controls.AddRange(New XRControl() _
                                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})


                                            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
                                                intNewX = 0
                                            Else
                                                intNewX += G_dblMaxWidthPicture + 20
                                            End If

                                            intPicStart = intNewY
                                            Exit For
                                        End If
                                    Next
                                End If
                            Else
                                dblMaxHeightPicture = 80 'LLG 05.26.2016 added to delete space when there is no image
                                dblMaxWidthPicture = 80 'DLS 05.26.2016 added to delete space when there is no image
                            End If
                        End If
                    End If
                    'intNewY += 20
                Case Else
                    intNewY += 10
                    intNewX = 0
            End Select

            Dim intGDAPicY As Integer
            Dim xRecipeInfoTable As New XRTable
            If Not strStyle = "003" Then xRecipeInfoTable.Width = CInt(intAvailableWidth - CInt(dblMaxHeightPicture - 60)) Else xRecipeInfoTable.Width = intAvailableWidth
            xRecipeInfoTable.Location = New Point(intNewX, intNewY)

            Dim xRecipeInfoRow As New XRTableRow
            Dim y As Integer
            With G_ReportOptions
                If .blnIncludeNumber Then
                    strX = fctSqlReady(row("RecipeNumber").ToString) : strX = Replace(strX, Chr(1), "")
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No).ToString.Trim, ": " & strX},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                End If

                'bann
                ' RDC 07.25.2013 : Recipe Status
                If .blnIncludeRecipeStatus AndAlso rwSubtitle IsNot Nothing AndAlso rwSubtitle.Length > 0 Then
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.RecipeStatus).ToString.Trim, ": " & rwSubtitle(0)("RecipeStatus").ToString.Trim},
                                {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                    'intGDAPicY = intNewY
                End If

                If .blnIncludeCategory Then
                    strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category).ToString.Trim, ": " & strX},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                End If

                If G_ReportOptions.blnIncludeSource = True Then
                    strX = CStr(IIf(IsDBNull(row("Chef").ToString), "", Trim((fctSqlReady(row("Chef").ToString.Replace("''", "'")))))).Replace("''", "'")
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source).ToString.Trim, ": " & strX},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                End If

                If G_ReportOptions.blnIncludeDate = True Then
                    ' strX = fctSqlReady(fctConvertDate(row("Dates").ToString))
                    strX = DirectCast(row("Dates"), DateTime).ToString("d", userCulture) 'DirectCast(row("Dates"), DateTime).ToShortDateString
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_).ToString.Trim, ": " & strX},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                End If
                'braga
                If G_ReportOptions.blnIncludeCostOfGoods = True Then

                    strPriceFormat = CType(row("curFormat"), String)
                    Dim strYieldFormat As String = CType(row("yieldformat"), String)

                    strX = fctSqlReady(row("Symbole").ToString)
                    Dim dblCalcPrice As Double = 0
                    If Not IsDBNull(row("calcprice")) Then dblCalcPrice = (CType(row("calcprice"), Double) / CType(row("originalyield"), Double)) * CType(row("Yield"), Double)

                    'JTOC 13.02.2013 Added yield quantity before serving
                    Dim dblTempYield As Double = 0
                    If Not IsDBNull(row("Yield")) Then dblTempYield = CType(row("Yield"), Double)

                    Dim strTempYieldName As String = ""
                    If dblTempYield > 1 Then
                        strTempYieldName = fctPluralPortionText(strYieldName)
                    Else
                        strTempYieldName = strYieldName
                    End If

                    ' RDC 09.05.2013 : Remove [_] and N/A on display/printout
                    ' RDC 08.12.2013 : Limit to 2 decimal places only. Replaced dblTempYield to Format(dblTempYield, "###0.0#")
                    ' RDC 09.07.2013 : Removed G_Options.RemoveTrailingZero for price.
                    'strX &= " " & fctFormatNumericQuantity(dblCalcPrice, G_strPriceFormat, G_Options.RemoveTrailingZero) & " / " & Format(dblTempYield, "###0.0#") & " " & strTempYieldName.Replace("[_]", "").Replace("n/a", "").Replace("N/A", "")
                    'strX &= " " & fctFormatNumericQuantity(dblCalcPrice, strPriceFormat, False) & " / " & Format(dblTempYield, strYieldFormat) & " " & strTempYieldName.Replace("[_]", "").Replace("n/a", "").Replace("N/A", "")
                    strX &= " " & dblCalcPrice.ToString(strPriceFormat, userCulture) & " / " & dblTempYield.ToString(strYieldFormat, userCulture) & " " & strTempYieldName.Replace("[_]", "").Replace("n/a", "").Replace("N/A", "")

                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods).ToString.Trim, ": " & strX},
                                                {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})

                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    y = CInt(xRecipeInfoTable.Height)
                End If

                If G_ReportOptions.blnIncludeRemark = True Then
                    strX = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation)
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark).ToString.Trim, ": " & strX},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    'intGDAPicY = intNewY
                    y = CInt(xRecipeInfoTable.Height)
                End If

                ' RDC 07.10.2013 - Description
                If G_ReportOptions.blnIncludeDescription Then

                    Dim strDesc As String = ""
                    'Try
                    '    strDesc = rwSubtitle(0)("RecipeDesc").ToString.Trim
                    'Catch ex As Exception
                    '    strDesc = ""
                    'End Try
                    strDesc = fctGetTranslatedText(row, "Description", "DescriptionTrans", G_ReportOptions.intTranslation)
                    'xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Description).ToString.Trim, ": " & rwSubtitle(0)("RecipeDesc").ToString.Trim}, _
                    '                                {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Description).ToString.Trim, ": " & strDesc},
                                                    {CInt(100), CInt(xRecipeInfoTable.Width - 100)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                    xRecipeInfoTable.Rows.Add(xRecipeInfoRow)
                    intGDAPicY = intNewY
                    y = CInt(xRecipeInfoTable.Height)
                End If

            End With

            Detail.Controls.Add(xRecipeInfoTable)

            Dim spaceToAdd As Integer = 0
            If G_ReportOptions.blnPicturesAll = False And G_ReportOptions.blnWithPicture = True Then
                If xRecipeInfoTable.Height > PicBoxHeight Then
                    intNewY += xRecipeInfoTable.Height 'AGL 2014.10.14 'SM 20150825 commented this to avoid space after the details. Reported by Somerset Larder
                Else
                    Dim toAdd As Integer = 0
                    Select Case G_ReportOptions.strSubStyle
                        Case "01", "02" 'small pic
                            toAdd = CInt(PicBoxHeight - 30)
                        Case "11", "12" 'medium pic
                            toAdd = CInt(PicBoxHeight - 40)
                        Case "21", "22" 'large pic
                            toAdd = CInt(PicBoxHeight / 3)
                    End Select
                    intNewY += toAdd
                End If
            End If

            If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
                Dim bShowGDAImage As Boolean = False
                For Each arr As tNutrient In G_Nutrient
                    If CDblDB(arr.GDA) > 0 Then
                        bShowGDAImage = True
                        Exit For
                    End If
                Next
                If bShowGDAImage Then
                    G_ReportOptions.blnIncludeGDA = False
                    Dim intGDAPanelHeight = 70
                    Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                    Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                    Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                    If G_ReportOptions.blnPictureOneRight Then
                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(0, intGDAPicY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
                        If intNewY < intGDAPicY + intGDAPanelHeight + 10 Then
                            intNewY = intGDAPicY + intGDAPanelHeight + 10
                        End If
                    Else
                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY - 10 - intGDAPanelHeight, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
                    End If
                End If
            End If

            Dim blflagPixOK As Boolean
            Dim intCurrY As Integer

            If strStyle = "003" Then
                intNewY += CInt(xRecipeInfoTable.Height + 20)
                If G_ReportOptions.blnWithPicture = True Then

                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        intPicStart = intNewY
                        For j As Integer = 0 To UBound(arrPicture)
                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                intNewY += intTextHeight + 20

                                strFileName = G_strPhotoPath & arrPicture(j)
                                Dim xrPicTable As New XRTable
                                Dim xrPicRow As New XRTableRow
                                Dim xrPicCell As New XRTableCell
                                Dim intPicBoxWidth As Integer = CInt(dblMaxHeightPicture - 150)
                                Dim intPicBoxHeight As Integer = CInt(dblMaxHeightPicture - 150)


                                xrPicTable.Size = New System.Drawing.Size(intPicBoxWidth, intPicBoxHeight)
                                xrPicTable.Location = New Point(intNewX, intNewY)
                                xrPicTable.BorderWidth = 1
                                xrPicTable.Borders = DevExpress.XtraPrinting.BorderSide.All
                                xrPicRow.Height = intPicBoxHeight

                                Dim xrPicBox As New XRPictureBox
                                With xrPicBox
                                    .Borders = DevExpress.XtraPrinting.BorderSide.None
                                    .BorderWidth = 0
                                    .BorderColor = Color.White
                                    .Size = New System.Drawing.Size(intPicBoxWidth - 8, intPicBoxHeight - 8)
                                    .Image = LoadImageFromUrl(strFileName) 'Image.FromFile(strFileName)
                                    .Sizing = ImageSizeMode.ZoomImage
                                    .Location = New Point(4, 4)
                                End With

                                xrPicCell.Size = New Size(intPicBoxWidth, intPicBoxHeight)
                                xrPicCell.Borders = DevExpress.XtraPrinting.BorderSide.All
                                xrPicCell.BorderWidth = 1
                                xrPicCell.BorderColor = Color.Black
                                xrPicCell.Controls.Add(xrPicBox)

                                xrPicRow.Cells.Add(xrPicCell)
                                xrPicTable.Rows.Add(xrPicRow)

                                .Detail.Controls.Add(xrPicTable)

                                strFileName &= arrPicture(j)
                                blflagPixOK = True
                                intCurrY = intNewY + G_dblMaxHeightPicture
                                intNewY -= intTextHeight - 20
                                Exit For
                            End If
                        Next
                    End If
                    '-------
                End If
            End If

            ' intNewY += (xRecipeInfoTable.Height - 20)

            ' RDC 02.18.2013
            ' RDC 02.22.2013 Moved Place
            ' RDC 03.13.2013 - Changed to table based layout.
            ' Time Types (Cooking, Prep, Ready-in times)

            'AGL 2014.09.08
            Dim intValueToAddToY As Integer
            If dblMaxHeightPicture >= xRecipeInfoTable.Height Then
                intValueToAddToY = dblMaxHeightPicture
            Else
                intValueToAddToY = xRecipeInfoTable.Height
            End If


            Dim pixName As String = fctSqlReady(row("pix").ToString)

            ' RDC 05.23.2013 - 
            If Not strStyle = "003" Then
                If pixName = ";;;;;" Then
                    ' intNewY = intNewY + 26
                    intNewY += CInt(xRecipeInfoTable.Height + 70)
                Else
                    xRecipeInfoTable.Height = 56
                    Select Case G_ReportOptions.strSubStyle
                        Case "01", "02"
                            intNewY += CInt(xRecipeInfoTable.Height + 20)
                        Case "11", "12"
                            intNewY += CInt(xRecipeInfoTable.Height + 40)
                        Case "21", "22"
                            intNewY += CInt(xRecipeInfoTable.Height + 180)
                    End Select
                End If
            End If
            Dim haveRecipe As Boolean = False
            'xRecipeInfoTable.Dispose()

            If G_ReportOptions.dtTimeTypes IsNot Nothing Then
                If G_ReportOptions.blnIncludeTimeTypes And G_ReportOptions.dtTimeTypes.Select("Code = " & row("Code")).Count > 0 Then
                    Dim strTimeHH As String = ""
                    Dim strTimeMM As String = ""
                    Dim strTimeSS As String = ""
                    Dim strRecipeTime As String = ""

                    Dim xrTimeTable As New XRTable
                    Dim xrTimeRow As New XRTableRow
                    Dim xrTimeCell As New XRTableCell

                    ' RDC 03.21.2013 - CWM-4808 fix
                    If strStyle = "003" Then
                        ' RDC 05.11.2013 - Recomputing placement for recipe time in two columns
                        'intNewX = (intAvailableWidth / 2) - 30
                        intNewX = (dblMaxHeightPicture - 150) + 30
                        'intNewY += CInt(xRecipeInfoTable.Height + 20)
                    Else
                        'AGL 2014.09.08 'intNewY += GetLineSpace(intTextHeight) * 1.5
                        intNewX = 0
                    End If

                    Dim strTimeTypeSection As String = cLang.GetString(clsEGSLanguage.CodeType.RecipeTime).Trim
                    ' RDC 03.21.2013 - CWM-4808 fix
                    If strStyle = "003" Then
                        With G_ReportOptions
                            Dim xSectionHeaderTbl As XRTable = fctMakeSectionHeader(strTimeTypeSection, intNewX, intNewY, CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30)), G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                            Detail.Controls.Add(xSectionHeaderTbl)
                            intNewY += (xSectionHeaderTbl.Height + 10)
                        End With
                    Else
                        With G_ReportOptions
                            Dim xSectionHeaderTbl As XRTable = fctMakeSectionHeader(strTimeTypeSection, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                            Detail.Controls.Add(xSectionHeaderTbl)
                            intNewY += (xSectionHeaderTbl.Height + 10)
                        End With
                    End If


                    xrTimeTable = New XRTable
                    If Not strStyle = "003" Then xrTimeTable.Width = intAvailableWidth Else xrTimeTable.Width = CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30))
                    xrTimeTable.Location = New Point(intNewX, intNewY) 'anm


                    For Each rwTimes As DataRow In G_ReportOptions.dtTimeTypes.Select("Code=" & CIntDB(row("Code")))

                        If rwTimes("RecipeTimeHH") > 1 Then
                            strTimeHH = rwTimes("RecipeTimeHH") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeHours).ToLower
                        ElseIf rwTimes("RecipeTimeHH") = 1 Then
                            strTimeHH = rwTimes("RecipeTimeHH") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeHour).ToLower
                        Else
                            strTimeHH = ""
                        End If

                        If rwTimes("RecipeTimeMM") >= 60 Then
                            Dim intHourLapse As Integer = 0
                            For iTime As Integer = 1 To CInt(rwTimes("RecipeTimeMM")) Step 60
                                intHourLapse += 60
                            Next

                            If intHourLapse > 0 Then
                                strTimeHH = CIntDB(strTimeHH) + (intHourLapse / 60)
                                strTimeMM = ""

                                If CIntDB(strTimeHH) = 1 Then strTimeHH &= " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeHour).ToLower Else strTimeHH &= " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeHours).ToLower
                            End If

                            Dim dblMinRemainder As Double = CInt(rwTimes("RecipeTimeMM")) - intHourLapse

                            If dblMinRemainder > 1 Then
                                strTimeMM = dblMinRemainder & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinutes).ToLower
                            ElseIf dblMinRemainder = 1 Then
                                strTimeMM = dblMinRemainder & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinute).ToLower
                            Else
                                strTimeMM = ""
                            End If

                        Else
                            If rwTimes("RecipeTimeMM") > 1 Then
                                strTimeMM = rwTimes("RecipeTimeMM") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinutes).ToLower
                            ElseIf rwTimes("RecipeTimeMM") = 1 Then
                                strTimeMM = rwTimes("RecipeTimeMM") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinute).ToLower
                            Else
                                strTimeMM = ""
                            End If
                        End If

                        If rwTimes("RecipeTimeSS") >= 60 Then
                            Dim intMinLapse As Integer = 0
                            For iTime As Integer = 1 To CInt(rwTimes("RecipeTimeSS")) Step 60
                                intMinLapse += 60
                            Next

                            If intMinLapse > 0 Then
                                strTimeMM = CIntDB(strTimeMM) + (intMinLapse / 60)
                                strTimeSS = ""
                                If CIntDB(strTimeMM) = 1 Then strTimeMM &= " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinute).ToLower Else strTimeMM &= " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeMinutes).ToLower
                            End If

                            Dim dblSecRemainder As Double = CInt(rwTimes("RecipeTimeSS")) - intMinLapse

                            If dblSecRemainder > 1 Then
                                strTimeSS = dblSecRemainder & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeSeconds).ToLower
                            ElseIf dblSecRemainder = 1 Then
                                strTimeSS = dblSecRemainder & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeSecond).ToLower
                            Else
                                strTimeSS = ""
                            End If

                        Else
                            If rwTimes("RecipeTimeSS") > 1 Then
                                strTimeSS = rwTimes("RecipeTimeSS") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeSeconds).ToLower
                            ElseIf rwTimes("RecipeTimeSS") = 1 Then
                                strTimeSS = rwTimes("RecipeTimeSS") & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeSecond).ToLower
                            Else
                                strTimeSS = ""
                            End If
                        End If

                        If strTimeHH.Length > 0 And strTimeMM.Length = 0 And strTimeSS.Length = 0 Then          '01:00:00
                            strRecipeTime = strTimeHH
                        ElseIf strTimeHH.Length = 0 And strTimeMM.Length > 0 And strTimeSS.Length = 0 Then      '00:01:00
                            strRecipeTime = strTimeMM
                        ElseIf strTimeHH.Length = 0 And strTimeMM.Length = 0 And strTimeSS.Length > 0 Then      '00:00:01
                            strRecipeTime = strTimeSS
                        ElseIf strTimeHH.Length > 0 And strTimeMM.Length > 0 And strTimeSS.Length = 0 Then      '01:01:00
                            strRecipeTime = strTimeHH & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeAnd) & " " & strTimeMM
                        ElseIf strTimeHH.Length = 0 And strTimeMM.Length > 0 And strTimeSS.Length > 0 Then      '00:01:01
                            strRecipeTime = strTimeMM & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeAnd) & " " & strTimeSS
                        ElseIf strTimeHH.Length > 0 And strTimeMM.Length = 0 And strTimeSS.Length = 0 Then      '01:00:01
                            strRecipeTime = strTimeHH & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeAnd) & " " & strTimeSS
                        ElseIf strTimeHH.Length > 0 And strTimeMM.Length > 0 And strTimeSS.Length > 0 Then      '01:01:01
                            strRecipeTime = strTimeHH & ", " & strTimeMM & " " & cLang.GetString(clsEGSLanguage.CodeType.RecipeTimeAnd) & " " & strTimeSS
                        Else
                            strRecipeTime = ""
                        End If

                        If strStyle = "003" Then
                            If strRecipeTime.Trim.Length > 1 Then
                                haveRecipe = True
                                xrTimeRow = New XRTableRow
                                xrTimeRow = fctMakeDataRow({rwTimes("TimeType").ToString().Trim.Replace("''", "'"), ": " & strRecipeTime.Trim}, {CInt(150), CInt(CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30)) - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                                xrTimeTable.Rows.Add(xrTimeRow)
                            End If
                        Else
                            If strRecipeTime.Trim.Length > 1 Then
                                haveRecipe = True
                                xrTimeRow = New XRTableRow
                                xrTimeRow = fctMakeDataRow({rwTimes("TimeType").ToString().Trim.Replace("''", "'"), ": " & strRecipeTime.Trim}, {CInt(150), CInt(intAvailableWidth - 150)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                                xrTimeTable.Rows.Add(xrTimeRow)
                            End If
                        End If
                    Next
                    .Detail.Controls.Add(xrTimeTable)
                    intNewY += (xrTimeTable.Height + 10) '-150

                    'xrTimeTable.Dispose()
                    'xrTimeRow.Dispose()
                    'xrTimeCell.Dispose()
                Else
                    intNewY += 30
                    intNewX = 0
                End If
            End If


            If strStyle = "003" Then
                intNewX = (dblMaxHeightPicture - 150) + 30
            End If

            Dim xrIngTable As New XRTable
            Dim xrIngTableNew As New XRTable
            Dim xrIngRow As New XRTableRow
            Dim xrIngCell As New XRTableCell
            Dim xrIngCellNew As New XRTableCell
            Dim xrIngRowHeader As New XRTableRow
            Dim xrIngRow1 As New XRTableRow
            Dim xrIngCell1 As New XRTableCell
            If haveRecipe = True Then
                intNewY = intNewY
            End If

            xrIngTable = New XRTable
            xrIngTable.Location = New Point(intNewX, intNewY - 50) 'LLG 05.16.2016 for lepause issue
            If strStyle = "003" Then
                xrIngTable.Width = intAvailableWidth - (dblMaxHeightPicture - 150)
            Else
                xrIngTable.Width = intAvailableWidth
            End If


            ' Ingredient Header 
            'anm 1-4-2016
            If G_ReportOptions.blnIncludeHighlightSection Then
                xrIngTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xrIngTable.BorderWidth = 1
                xrIngTable.BorderColor = Color.Black
                xrIngTable.BackColor = Color.LightGray
            Else
                xrIngTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                xrIngTable.BorderWidth = 1
                xrIngTable.BorderColor = Color.Black
                xrIngTable.BackColor = Color.White
            End If

            ' RDC 07.30.2013 : Added condition for useMakes support
            Dim formatYieldUnit As String = foundDetails(0).ItemArray(36)
            Dim dblYldQty As Double = CDbl(row("Yield"))
            'Dim strRecipeYield As String = Format(dblYldQty, formatYieldUnit) & " " & strYieldName.Trim
            Dim strRecipeYield As String = dblYldQty.ToString(formatYieldUnit, userCulture) & " " & strYieldName.Trim
            Dim strServingHeader As String = ""
            If blnUseMakes Then
                strServingHeader &= cLang.GetString(clsEGSLanguage.CodeType.Yield) & " " & strRecipeYield.Replace("[_]", "").Replace("n/a", "").Replace("N/A", "")
            Else
                strServingHeader = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsForNServing), "%y", strRecipeYield), "%p", CType(row("PrintPercent"), Double))     '"Ingredients for " & strNumberOfServings & " at " & rsX!DishPercent & "% (Net Quantity)" 'SM 20150706 changed translation
                strServingHeader = strServingHeader.Replace("N/A", "").Replace("n/a", "")
                strServingHeader = strServingHeader.Replace("[_]", "")
            End If

            If strStyle = "003" Then
                With G_ReportOptions
                    Dim xSectionHeaderTbl As XRTable = fctMakeSectionHeader(strServingHeader, intNewX, intNewY, CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30)), G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    Detail.Controls.Add(xSectionHeaderTbl)
                    intNewY += (xSectionHeaderTbl.Height + 10)
                End With
            Else
                If blnUseMakes Then
                    Dim xrServTbl As New XRTable
                    Dim xrServRow As New XRTableRow
                    Dim xrServCell As New XRTableCell

                    xrServTbl.Location = New Point(intNewX, intNewY)
                    xrServTbl.Width = intAvailableWidth
                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrServTbl.BackColor = Color.LightGray
                        xrServTbl.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrServTbl.BorderWidth = 1
                    Else
                        xrServTbl.BackColor = Color.White
                        xrServTbl.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrServTbl.BorderWidth = 0
                    End If

                    xrServRow = New XRTableRow
                    xrServRow.Height = G_ReportOptions.sgFontSize2
                    xrServCell = New XRTableCell
                    xrServCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrServCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    If G_ReportOptions.blnIncludeHighlightSection Then xrServCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xrServCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                    xrServCell.Text = strServingHeader
                    xrServRow.Cells.Add(xrServCell)
                    xrServTbl.Rows.Add(xrServRow)

                    xrServRow = New XRTableRow
                    xrServRow.Height = G_ReportOptions.sgFontSize2
                    xrServCell = New XRTableCell
                    xrServCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrServCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    xrServCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Ingredients) & " :"
                    xrServCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                    xrServRow.Cells.Add(xrServCell)
                    xrServTbl.Rows.Add(xrServRow)
                    .Detail.Controls.Add(xrServTbl)
                    intNewY += (xrServTbl.Height + 10)

                    'xrServTbl.Dispose()
                    'xrServRow.Dispose()
                    'xrServCell.Dispose()
                Else
                    With G_ReportOptions
                        Dim xSectionHeaderTbl As XRTable = fctMakeSectionHeader(strServingHeader, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                        Detail.Controls.Add(xSectionHeaderTbl)
                        intNewY += (xSectionHeaderTbl.Height + 10) 'LLG2016
                    End With
                End If


            End If

            xrIngTable = New XRTable
            xrIngTable.Location = New Point(intNewX, intNewY)
            If Not strStyle = "003" Then xrIngTable.Width = intAvailableWidth Else xrIngTable.Width = CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30))
            xrIngTable.BorderWidth = 1

            'AGL 2013.05.16
            xrIngTable.CanShrink = True
            xrIngTable.CanGrow = True

            If dtIngredients IsNot Nothing Then
                Dim dvIng As New DataView(dtIngredients)
                dvIng.Sort = "step asc"
                'dvIng.RowFilter = "CodeMain=" & intRecipeCode
                dvIng.RowFilter = "CodeMain=" & intRecipeCode & IIf(IntRecipeParentCode = 0, " AND CodeListeParent IS NULL", " AND CodeListeParent=" & IntRecipeParentCode & " AND Position =" & intPosition) 'MKAM 2015.07.02
            End If

            'AGL 2013.05.17
            Dim strUnit As String = ""

            ' RDC 11.28.2013 : Column resizing 
            Dim intExcessSpace As Integer = intAvailableWidth
            Dim intQtyWidth As Integer = 30
            Dim intUnitWidth As Integer = 20
            Dim intItemWidth As Integer = 0
            Dim intItemNumWidth As Integer = 45
            Dim intWastageWidth As Integer = 30

            'Dim xlic1 As New EgswKey.clsLicense

            Dim xrIngAutoGrillCell = New XRTableCell  'KMQDC 8.3.2015 This is for adjusting column on print details


            If G_ReportOptions.blnUseMetricImperial Then
                Dim intFieldsToDisplay As Integer = 0

                With G_ReportOptions
                    If .blnIncludeMetricQtyNet Then intFieldsToDisplay += 1
                    If .blnIncludeMetricQtyGross Then intFieldsToDisplay += 1
                    If .blnIncludeImperialQtyNet Then intFieldsToDisplay += 1
                    If .blnIncludeImperialQtyGross Then intFieldsToDisplay += 1
                End With

                Select Case intFieldsToDisplay
                    Case 1
                        intUnitWidth = 180
                    Case 2
                        intUnitWidth = 150
                    Case 3
                        intUnitWidth = 80
                    Case 4
                        intUnitWidth = 60
                    Case Else
                        intUnitWidth = 40
                End Select

                If G_ReportOptions.blnIncludeIngrNumber Then
                    intExcessSpace -= intItemNumWidth
                End If

                If G_ReportOptions.blnIncludeWastage Then
                    intExcessSpace -= intWastageWidth
                End If

                intExcessSpace -= ((intQtyWidth + intUnitWidth) * intFieldsToDisplay)

            Else
                Dim intFieldsToDisplay As Integer = 0
                With G_ReportOptions
                    If .blnIncludeGrossQty Then intFieldsToDisplay += 1
                    If .blnIncludeNetQty Then intFieldsToDisplay += 1
                End With

                Select Case intFieldsToDisplay
                    Case 1
                        intUnitWidth = 70 '180 'SM 20150706 changed the value of unit width
                    Case 2
                        intUnitWidth = 150
                    Case 0

                End Select

                If G_ReportOptions.blnIncludeIngrNumber Then
                    intExcessSpace -= intItemNumWidth
                End If

                If G_ReportOptions.blnIncludeWastage Then
                    intExcessSpace -= intWastageWidth
                End If

                intExcessSpace -= ((intQtyWidth + intUnitWidth) * intFieldsToDisplay)

            End If

            ' RDC 08.16.2013 : Only ingredient have to be in bold style fonts
            'Dim xlic As New EgswKey.clsLicense
            'If G_ReportOptions.blnIncludeGrossQty Then
            '    'gross

            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
            '    xrIngCell.Width = intQtyWidth
            '    xrIngCell.Text = "Gross"
            '    xrIngRow.Cells.Add(xrIngCell)
            '    ' Metric Unit
            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '    xrIngCell.Width = intUnitWidth
            '    ' RDC 05.23.2013 - Fix for Bug CWM-6115
            '    If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
            '    xrIngRow.Cells.Add(xrIngCell)

            '    'net


            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
            '    xrIngCell.Width = intQtyWidth
            '    xrIngCell.Text = "Net"
            '    xrIngRow.Cells.Add(xrIngCell)
            '    ' Metric Unit
            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '    xrIngCell.Width = intUnitWidth
            '    ' RDC 05.23.2013 - Fix for Bug CWM-6115
            '    If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
            '    xrIngRow.Cells.Add(xrIngCell)

            '    'wastage
            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '    xrIngCell.Width = intWastageWidth
            '    xrIngCell.Text = "Wastage"
            '    xrIngRow.Cells.Add(xrIngCell)

            '    'number
            '    xrIngCell = New XRTableCell
            '    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '    xrIngCell.Width = intItemNumWidth
            '    xrIngCell.Text = "Number"
            '    xrIngRow.Cells.Add(xrIngCell)

            '    ' Ingredient Name & Complement & Preparation & Alternative Ingredient
            '    Dim strAltIngredient As String = ""
            '    Dim strComple As String = ""
            '    Dim strPrep As String = ""
            '    Dim strIngr As String = "" 'RwVw("itemname").ToString

            '    ' RDC 08.14.2013 : Remove comma in complement.
            '    If G_ReportOptions.blnIncludeComplementPreparation And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
            '    If G_ReportOptions.blnIncludeComplementPreparation And strPrep.Trim.Length > 0 Then strPrep = ", " & strPrep.Trim Else strPrep = ""
            '    'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLang.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = ""
            '    If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLangTrans.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = "" 'MKAM 2015.04.16
            '    strIngr = ""

            '    xrIngCell = New XRTableCell
            '    xrIngAutoGrillCell = New XRTableCell
            '    If RwVw("itemType") = 8 Then
            '        xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            '        xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            '    Else
            '        xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '        xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            '    End If
            '    ' RDC 07.29.2013 : Make ingredient font to bold when ingredient is a branded ingredient.
            '    'If CBool(RwVw("isBrandedIngredient")) Then xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            '    If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
            '        xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '        xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '        If G_ReportOptions.blnIncludeIngrNumber Then
            '            xrIngAutoGrillCell.Width = 210
            '        Else
            '            xrIngAutoGrillCell.Width = 300
            '        End If

            '    Else
            '        xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '        xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '        xrIngCell.Width = intExcessSpace - 5
            '    End If
            '    'xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            '    'xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            '    'xrIngCell.Width = intExcessSpace - 5
            '    'xrIngCell.Text = x.Text




            '    Dim x As New RichTextBox
            '    x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            '    x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    x.SelectedText = strComple
            '    If CBool(RwVw("isBrandedIngredient")) And Not xlic.l_App = EgswKey.clsLicense.enumApp.Nestle Then
            '        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            '    Else
            '        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    End If
            '    x.SelectedText = RwVw("itemname").ToString
            '    x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    x.SelectedText = strAltIngredient
            '    x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '    x.SelectedText = strPrep

            '    Dim a As New XRRichText
            '    a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            '    a.Width = intExcessSpace - 5
            '    a.Rtf = x.Rtf
            '    'xrIngCell.Controls.Add(a)
            '    'xrIngRow.Cells.Add(xrIngCell)

            '    If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
            '        xrIngAutoGrillCell.Controls.Add(a)
            '        xrIngRow.Cells.Add(xrIngAutoGrillCell)
            '    Else
            '        xrIngCell.Controls.Add(a)
            '        xrIngRow.Cells.Add(xrIngCell)
            '    End If
            '    xrIngTable.Rows.Add(xrIngRow)
            '    .Detail.Controls.Add(xrIngTable)




            'End If
            Dim first As Integer = 0

            'Dim newRow As DataRow= dtIngredients.

            'newRow("CodeMain") = 12345
            'newRow("itemType") = 8
            'newRow("item") = 8
            ''dtIngredients.Rows.InsertAt(newRow, 0)

            ' SAFE: handle dtIngredients being Nothing or empty before creating a DataView
            Dim NewDtTable As DataTable

            If dtIngredients Is Nothing OrElse dtIngredients.Rows.Count = 0 Then
                ' No data: use an empty table. If you need schema for downstream logic, keep Temp = NewDtTable.Clone() below.
                NewDtTable = New DataTable()
            Else
                Dim newdvIng As New DataView(dtIngredients)
                newdvIng.Sort = "step asc"
                newdvIng.RowFilter = "CodeMain=" & intRecipeCode & IIf(IntRecipeParentCode = 0, " AND CodeListeParent IS NULL", " AND CodeListeParent=" & IntRecipeParentCode) & " AND ID=" & IntRecipeID
                NewDtTable = newdvIng.ToTable()
            End If

            ' Build Temp safely. Clone keeps schema so DataView(Temp) always has a DataTable set.
            Dim Temp As DataTable = NewDtTable.Clone()

            If NewDtTable IsNot Nothing AndAlso NewDtTable.Rows.Count > 0 Then
                ' some code
                Temp = NewDtTable.AsEnumerable().Take(1).CopyToDataTable()
                Temp.Merge(NewDtTable, True, MissingSchemaAction.Add)
            Else
                ' some code (optional header-setup, etc.)
            End If

            Dim newdvIng2 As New DataView(Temp)


            For Each RwVw As DataRowView In newdvIng2

                Dim strAltIngredient As String = RwVw("altIngredient").ToString.Trim
                Dim strComple As String = RwVw("Complement").ToString.Trim
                Dim strPrep As String = RwVw("Preparation").ToString.Trim
                Dim strIngr As String = "" 'RwVw("itemname").ToString
                'PLGL 09/23/2016 - COMPLEMENT POSITION
                Dim cConfig As New clsConfig(enumAppType.WebApp, strCnn)
                Dim intCodeSite = CType(row("CodeSite"), Integer)
                Dim complementAfterIngredient = CBool(cConfig.GetConfig(intCodeSite, clsConfig.enumNumeros.ComplementAfterIngredient, -3, False))
                Select Case G_ReportOptions.strSubStyle
                    Case "01", "11", "21"
                        'For Each RwVw As DataRowView In newdvIng
                        ' RDC 08.30.2013 : Compressing cells for ingredient display
                        'intExcessSpace = intAvailableWidth
                        first += 1
                        xrIngRow = New XRTableRow
                        xrIngRow.Height = G_ReportOptions.sgFontSize2
                        xrIngAutoGrillCell = New XRTableCell  'KMQDC 8.3.2015 This is for adjusting column on print details
                        intQtyWidth = 40 'KMQDC 8.3.2015
                        intUnitWidth = 20 'KMQDC 8.3.2015
                        intItemNumWidth = 45 'KMQDC 8.3.2015

                        'If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                        '    If first = 1 Then
                        '        'xrIngCell = New XRTableCells
                        '    Else
                        '        'xrIngCell = New XRTableCell

                        '        xrIngRow = fctMakeDataRow({RwVw("itemName").ToString.Trim, RwVw("Procedure").ToString.Trim}, {170, CInt(intAvailableWidth) - 60}, {TextAlignment.TopLeft, TextAlignment.TopLeft}, , FontStyle.Bold)
                        '        xrIngRow.Height += 5
                        '    End If
                        '    'xrIngRow = fctMakeDataRow({RwVw("itemName").ToString.Trim, RwVw("Procedure").ToString.Trim}, {60, CInt(intAvailableWidth) - 60}, {TextAlignment.TopLeft, TextAlignment.TopLeft}, , FontStyle.Bold)
                        '    'xrIngRow.Height += 5
                        'End If

                        ' RDC 01.10.2014 : Display unvalidated quantities
                        Dim strImpUnvalidatedQty As String = "", strImpUnvalidatedUnit As String = ""
                        Dim strMetUnvalidatedQty As String = "", strMetUnvalidatedUnit As String = ""
                        Dim dtUnvalidated As New DataTable

                        If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                            dtUnvalidated = getUnavalidatedQuantity(RwVw("tmpqty"), RwVw("tmpunit").ToString, CIntDB(CodeSiteCO(row)), CIntDB(row("Codetrans")))
                            If Not dtUnvalidated Is Nothing Or Not dtUnvalidated.Rows.Count = 0 Then
                                For Each dr As DataRow In dtUnvalidated.Rows
                                    strImpUnvalidatedQty = dr("QtyImperial")
                                    strImpUnvalidatedUnit = dr("UnitImperial")
                                    strMetUnvalidatedQty = dr("QtyMetric")
                                    strMetUnvalidatedUnit = dr("UnitMetric")
                                Next
                            End If
                        End If


                        If G_ReportOptions.blnUseMetricImperial Then
                            ' Metric Gross/Net and Imperial Gross/Net

                            If G_ReportOptions.blnIncludeImperialQtyNet Then
                                ' Imperial Quantity Net
                                Dim strImpNetQty As String = ""
                                'Dim dblImpNetQty As Double = CDbl(RwVw("netquantity"))
                                Dim dblImpNetQty As Double = CDbl(RwVw("itemImperialqty"))

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then ''AMTLA 2014.06.19 change "or" to "and" CWM-14648
                                    If Not strImpUnvalidatedQty Is Nothing And Not strImpUnvalidatedQty = "" Then
                                        strImpNetQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                    End If
                                    strUnit = strImpUnvalidatedUnit
                                Else
                                    'strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                        strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        If G_ReportOptions.blnUseFractions Then
                                            strImpNetQty = fctConvertToFraction(CDbl(strImpNetQty))
                                        Else
                                            strImpNetQty = CDbl(strImpNetQty)
                                        End If

                                        strUnit = RwVw("itemimperialunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strImpNetQty = ""
                                        Else
                                            strImpNetQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If



                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth

                                ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                                'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                                'If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Or strUnit.Trim = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                                If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                                xrIngRow.Cells.Add(xrIngCell)

                                ' Imperial Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strImpNetQty Is Nothing Or strImpNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)

                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                            If G_ReportOptions.blnIncludeImperialQtyGross Then
                                Dim strImpGrossQty As String = ""

                                'Dim dblImpGrossQty As Double = CDbl(RwVw("grossquantity"))
                                Dim dblImpGrossQty As Double = CDbl(RwVw("grossImperialQuantity"))

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strImpUnvalidatedQty Is Nothing Or Not strImpUnvalidatedQty = "" Then
                                        strImpGrossQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                    End If
                                    strUnit = strImpUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                        strImpGrossQty = fctFormatNumericQuantity(dblImpGrossQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        If G_ReportOptions.blnUseFractions Then
                                            strImpGrossQty = fctConvertToFraction(CDbl(strImpGrossQty))
                                        Else
                                            strImpGrossQty = CDbl(strImpGrossQty)
                                        End If

                                        strUnit = RwVw("itemimperialunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strImpGrossQty = ""
                                        Else
                                            strImpGrossQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If



                                ' Imperial Quantity Gross
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                                'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                                'If strImpGrossQty Is Nothing Or strImpGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpGrossQty
                                If strImpGrossQty Is Nothing Or strImpGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpGrossQty
                                xrIngRow.Cells.Add(xrIngCell)

                                ' Imperial Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim.ToUpper = "[_]" Or strImpGrossQty Is Nothing Or strImpGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                            If G_ReportOptions.blnIncludeMetricQtyNet Then
                                ' Metric Quantity Net
                                Dim strMetNetQty As String = ""
                                'Dim dblMetNetQty As Double = CDbl(RwVw("netquantity"))     ' RDC 09.03.2013 : Removed wrong output rendered
                                Dim dblMetNetQty As Double = CDbl(RwVw("ItemMetricQty"))    ' RDC 09.03.2013 : Correction

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                        strMetNetQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                    End If
                                    strUnit = strMetUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                        strMetNetQty = fctFormatNumericQuantity(dblMetNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        ' RDC 01.07.2014 :Bug CWM-10704 : The Metric Quantity should NOT be converted into Fraction format
                                        ' RDC 01.07.2014 : (Revert) If G_ReportOptions.blnUseFractions Or xlic.l_App = EgswKey.clsLicense.enumApp.RB Then to If G_ReportOptions.blnUseFractions Then
                                        ' RDC 01.07.2014 : Quantity convertion to fraction is not applicable to Metric Quantities as per QA
                                        'If G_ReportOptions.blnUseFractions Then
                                        '    strMetNetQty = fctConvertToFraction(CDbl(strMetNetQty))
                                        'Else
                                        '    strMetNetQty = CDbl(strMetNetQty)
                                        'End If

                                        strMetNetQty = CDbl(strMetNetQty)

                                        strUnit = RwVw("itemmetricunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strMetNetQty = ""
                                        Else
                                            strMetNetQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                                'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                                'If strMetNetQty Is Nothing Or strMetNetQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strMetNetQty
                                If strMetNetQty Is Nothing Or strMetNetQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strMetNetQty
                                xrIngRow.Cells.Add(xrIngCell)
                                ' Metric Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth

                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetNetQty Is Nothing Or strMetNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                            If G_ReportOptions.blnIncludeMetricQtyGross Then
                                ' Metric Quantity Gross
                                Dim strMetGrossQty As String = ""
                                Dim dblMetGrossQty As Double = CDbl(RwVw("grossMetricQuantity"))     ' RDC 09.03.2013 : Wrong output rendered.
                                'Dim dblMetGrossQty As Double = CDblDB(RwVw("itemMetricQty"))

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                        strMetGrossQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                    End If
                                    strUnit = strMetUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                        strMetGrossQty = fctFormatNumericQuantity(dblMetGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        ' RDC 01.07.2014 :Bug CWM-10704 : The Metric Quantity should NOT be converted into Fraction format
                                        ' RDC 01.07.2014 : (Revert) If G_ReportOptions.blnUseFractions Or xlic.l_App = EgswKey.clsLicense.enumApp.RB Then to If G_ReportOptions.blnUseFractions Then
                                        ' RDC 01.07.2014 : Quantity convertion to fraction is not applicable to Metric Quantities as per QA
                                        'If G_ReportOptions.blnUseFractions Then
                                        '    strMetGrossQty = fctConvertToFraction(CDbl(strMetGrossQty))
                                        'Else
                                        '    strMetGrossQty = CDbl(strMetGrossQty)
                                        'End If

                                        strMetGrossQty = CDbl(strMetGrossQty)

                                        strUnit = RwVw("itemmetricunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strMetGrossQty = ""
                                        Else
                                            strMetGrossQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                                'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                                'If strMetGrossQty Is Nothing Or strMetGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = " " Else xrIngCell.Text = strMetGrossQty
                                If strMetGrossQty Is Nothing Or strMetGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = " " Else xrIngCell.Text = strMetGrossQty
                                xrIngRow.Cells.Add(xrIngCell)
                                ' Metric Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetGrossQty Is Nothing Or strMetGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                        Else
                            'anm  

                            If G_ReportOptions.blnIncludeGrossQty Then
                                'Gross Qty

                                Dim strGrossQty As String = ""
                                Dim dblGrossQty As Double = CDbl(RwVw("grossquantity"))

                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                    strGrossQty = fctFormatNumericQuantity(dblGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strGrossQty = fctConvertToFraction(CDbl(strGrossQty))
                                    Else
                                        'strGrossQty = CDbl(strGrossQty)
                                        strGrossQty = dblGrossQty.ToString(RwVw("itemformat").ToString, userCulture)
                                    End If
                                    strUnit = RwVw("itemunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strGrossQty = ""
                                    Else
                                        strGrossQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If

                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strGrossQty Is Nothing Or strGrossQty = "0" Then strUnit = "" Else strUnit.Trim()


                                'If CDblDB(strGrossQty) = 0 Then
                                '    strGrossQty = ""
                                'End If

                                If first = 1 Then

                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 25
                                    xrIngCell.Text = cLang.GetString(132736) 'gross
                                    xrIngRow.Cells.Add(xrIngCell)
                                    'xrIngRow1.Cells.Add(xrIngCell1)

                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 25
                                    xrIngCell.Text = strGrossQty + " " + strUnit
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If

                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                            If G_ReportOptions.blnIncludeNetQty Then
                                'Net Qty
                                Dim strNetQty As String = ""
                                Dim dblNetQty As Double = CDbl(RwVw("itemqty"))
                                Dim FormatUnit As String = RwVw("Format")


                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode

                                If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                    strNetQty = fctFormatNumericQuantity(dblNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strNetQty = fctConvertToFraction(CDbl(strNetQty))
                                    Else
                                        strNetQty = CDbl(strNetQty)
                                    End If

                                    strUnit = RwVw("itemunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strNetQty = ""
                                    Else
                                        strNetQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If

                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strNetQty Is Nothing Or strNetQty = "0" Then strUnit = "" Else strUnit.Trim()

                                'If CDblDB(strNetQty) = 0 Then
                                '    strNetQty = ""
                                'End If

                                Dim exStrNetQty As Double


                                If first = 1 Then
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 20
                                    xrIngCell.Text = cLang.GetString(132614) '"Net Qty"
                                    xrIngRow.Cells.Add(xrIngCell)
                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 20
                                    If G_ReportOptions.blnUseFractions Then
                                        xrIngCell.Text = strNetQty + " " + strUnit
                                    Else
                                        If strNetQty = "" Then
                                            xrIngCell.Text = strNetQty + " " + strUnit
                                        Else
                                            Double.TryParse(strNetQty, exStrNetQty)
                                            'xrIngCell.Text = Format(exStrNetQty, FormatUnit) + " " + strUnit
                                            xrIngCell.Text = exStrNetQty.ToString(FormatUnit, userCulture) + " " + strUnit
                                        End If
                                    End If
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If
                            End If
                        End If

                        ' Wastage
                        If G_ReportOptions.blnIncludeWastage Then
                            Dim strWastage As String = ""
                            If RwVw("itemcode").ToString > 0 And Not RwVw("itemtype") = 4 Then
                                strWastage = RwVw("totalwastage").ToString & "%"
                            Else
                                strWastage = ""
                            End If

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intWastageWidth + 40
                                xrIngCell.Text = cLang.GetString(132974) + "%" '"waste"
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intWastageWidth + 40
                                    xrIngRow.Cells.Add(xrIngCell)
                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intWastageWidth + 40
                                    xrIngCell.Text = strWastage 'RwVw("totalwastage").ToString & "%"
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If


                            End If
                            'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode


                            'RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 30
                        End If

                        ' Ingredient Number
                        If G_ReportOptions.blnIncludeIngrNumber Then

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intItemNumWidth + 15
                                xrIngCell.Text = cLang.GetString(5500) '"number"
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intItemNumWidth + 15
                                xrIngCell.Text = RwVw("itemnumber").ToString
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 63
                        End If

                        'space between number and ingredient
                        If first = 1 Then
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth - 22
                            xrIngRow.Cells.Add(xrIngCell)

                        Else
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth - 22
                            xrIngRow.Cells.Add(xrIngCell)
                        End If

                        'bann
                        If complementAfterIngredient = True Then
                            Dim x As New RichTextBox
                            'Using x
                            x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strAltIngredient
                            If CBool(RwVw("isBrandedIngredient")) Then
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            Else
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            End If
                            If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                x.SelectedText = ""
                            Else
                                x.SelectedText = RwVw("itemname").ToString 'Ingredients Name
                            End If

                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strPrep
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strComple

                            Dim a As New XRRichText
                            a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            a.Width = intExcessSpace - 5
                            a.Rtf = x.Rtf

                            Dim b As New XRRichText
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            b.Width = intExcessSpace - 5
                            b.Rtf = x.Rtf

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                b.Text = cLang.GetString(5590) 'Ingredients
                                b.Width = intExcessSpace + 20 'LLG2016
                                b.Borders = DevExpress.XtraPrinting.BorderSide.None
                                'xrIngCellNew.Controls.Add(b)
                                'xrIngRowHeader.Cells.Add(xrIngCellNew)
                                xrIngCell.Width = intExcessSpace - 5
                                xrIngCell.Controls.Add(b)
                                xrIngRow.Cells.Add(xrIngCell)
                                ' xrIngCell.Dispose()
                            Else
                                ' RDC 08.14.2013 : Remove comma in complement.
                                If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                                If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = "," & strPrep.Trim Else strPrep = ""
                                If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = strAltIngredient.Trim Else strAltIngredient = ""
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    'strIngr = ""
                                    If strPrep = "" Then
                                        strIngr = RwVw("itemName").ToString.Trim & RwVw("Procedure").ToString.Trim
                                    Else
                                        strIngr = RwVw("itemName").ToString.Trim & RwVw("Procedure").ToString.Trim & strPrep
                                    End If
                                Else
                                    If strAltIngredient = "" Then
                                        strIngr = RwVw("itemname").ToString & " " & strComple & strAltIngredient & strPrep
                                    Else
                                        strIngr = RwVw("itemname").ToString & " " & strComple & "[" & strAltIngredient & "]" & strPrep
                                    End If
                                End If

                                xrIngCell = New XRTableCell
                                a.Text = strIngr
                                xrIngAutoGrillCell = New XRTableCell
                                If RwVw("itemType") = 8 Then
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                ElseIf RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                Else
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    '  xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                End If
                                ' RDC 07.29.2013 : Make ingredient font to bold when ingredient is a branded ingredient.
                                'If CBool(RwVw("isBrandedIngredient")) Then xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                                '    xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                '    xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                '    If G_ReportOptions.blnIncludeIngrNumber Then
                                '        xrIngAutoGrillCell.Width = 210
                                '    Else
                                '        xrIngAutoGrillCell.Width = 300
                                '    End If

                                'Else
                                '    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intExcessSpace - 5

                                'End If
                                xrIngCell.Controls.Add(a)
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                            'End Using
                        Else
                            Dim x As New RichTextBox
                            ' Using x
                            x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strComple
                            If CBool(RwVw("isBrandedIngredient")) Then
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            Else
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            End If
                            If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                x.SelectedText = ""
                            Else
                                x.SelectedText = RwVw("itemname").ToString 'Ingredients Name
                            End If
                            'x.SelectedText = RwVw("itemname").ToString 'Ingredients Name
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strAltIngredient
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strPrep

                            Dim a As New XRRichText
                            a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            a.Width = intExcessSpace - 5
                            a.Rtf = x.Rtf

                            Dim b As New XRRichText
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            b.Width = intExcessSpace - 5
                            b.Rtf = x.Rtf

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                b.Text = cLang.GetString(5590) 'Ingredients
                                b.Width = intExcessSpace + 20 'LLG2016
                                b.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.Width = intExcessSpace - 5
                                xrIngCell.Controls.Add(b)
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                ' RDC 08.14.2013 : Remove comma in complement.
                                If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                                If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = strPrep.Trim Else strPrep = ""
                                If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = strAltIngredient.Trim Else strAltIngredient = ""
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    strIngr = RwVw("itemName").ToString.Trim & RwVw("Procedure").ToString.Trim
                                Else
                                    If strAltIngredient = "" Then
                                        strIngr = strComple & RwVw("itemname").ToString & strAltIngredient & strPrep
                                    Else
                                        strIngr = strComple & RwVw("itemname").ToString & "[" & strAltIngredient & "]" & strPrep
                                    End If
                                End If
                                xrIngCell = New XRTableCell
                                a.Text = strIngr
                                xrIngAutoGrillCell = New XRTableCell
                                If RwVw("itemType") = 8 Then
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                Else
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    '  xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                End If
                                ' RDC 07.29.2013 : Make ingredient font to bold when ingredient is a branded ingredient.
                                'If CBool(RwVw("isBrandedIngredient")) Then xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                                '    xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                '    xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                '    If G_ReportOptions.blnIncludeIngrNumber Then
                                '        xrIngAutoGrillCell.Width = 210
                                '    Else
                                '        xrIngAutoGrillCell.Width = 300
                                '    End If

                                'Else
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intExcessSpace - 5

                                'End If
                                xrIngCell.Controls.Add(a)
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                            '  End Using

                        End If

                        If first = 1 Then
                            xrIngTable.Rows.Add(xrIngRow)
                        Else
                            xrIngTable.Rows.Add(xrIngRow)
                        End If
                    Case "02", "12", "22"

                        first += 1
                        xrIngRow = New XRTableRow
                        xrIngRow.Height = G_ReportOptions.sgFontSize2
                        xrIngAutoGrillCell = New XRTableCell  'KMQDC 8.3.2015 This is for adjusting column on print details
                        intQtyWidth = 40 'KMQDC 8.3.2015
                        intUnitWidth = 20 'KMQDC 8.3.2015
                        intItemNumWidth = 45 'KMQDC 8.3.2015

                        If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                            If first = 1 Then
                                'xrIngCell = New XRTableCell
                            Else
                                'xrIngCell = New XRTableCell

                                xrIngRow = fctMakeDataRow({RwVw("itemName").ToString.Trim, RwVw("Procedure").ToString.Trim}, {170, CInt(intAvailableWidth) - 60}, {TextAlignment.TopLeft, TextAlignment.TopLeft}, , FontStyle.Bold)
                                xrIngRow.Height += 5
                            End If
                            'xrIngRow = fctMakeDataRow({RwVw("itemName").ToString.Trim, RwVw("Procedure").ToString.Trim}, {60, CInt(intAvailableWidth) - 60}, {TextAlignment.TopLeft, TextAlignment.TopLeft}, , FontStyle.Bold)
                            'xrIngRow.Height += 5
                        End If



                        If complementAfterIngredient = True Then
                            Dim x As New RichTextBox
                            'Using x
                            x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strAltIngredient
                            If CBool(RwVw("isBrandedIngredient")) Then
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            Else
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            End If
                            If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                x.SelectedText = ""
                            Else
                                x.SelectedText = " " + RwVw("itemname").ToString 'Ingredients Name
                            End If
                            'x.SelectedText = " " + RwVw("itemname").ToString 'Ingredients Name
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strPrep
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strComple

                            Dim a As New XRRichText
                            a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            a.Width = intExcessSpace - 5
                            a.Rtf = x.Rtf

                            Dim b As New XRRichText
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            b.Width = intExcessSpace - 5
                            b.Rtf = x.Rtf

                            'x.Dispose()

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                b.Text = cLang.GetString(5590) 'Ingredients
                                b.Width = intExcessSpace + 20 'LLG2016
                                b.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.Width = intExcessSpace - 5
                                xrIngCell.Controls.Add(b)
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                ' RDC 08.14.2013 : Remove comma in complement.
                                If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                                If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = strPrep.Trim Else strPrep = ""
                                If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = strAltIngredient.Trim Else strAltIngredient = ""
                                'strIngr = RwVw("itemname").ToString & strAltIngredient & strPrep & " " & strComple
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    strIngr = ""
                                Else
                                    ' strIngr = RwVw("itemname").ToString & strAltIngredient & strPrep & " " & strComple
                                    If strAltIngredient = "" Then
                                        strIngr = RwVw("itemname").ToString & " " & strComple & strAltIngredient & strPrep
                                    Else
                                        If strAltIngredient = "" Then
                                            strIngr = RwVw("itemname").ToString & " " & strComple & strAltIngredient & strPrep
                                        Else
                                            strIngr = RwVw("itemname").ToString & " " & strComple & "[" & strAltIngredient & "]" & strPrep
                                        End If

                                    End If
                                End If
                                xrIngCell = New XRTableCell
                                a.Text = strIngr
                                xrIngAutoGrillCell = New XRTableCell
                                If RwVw("itemType") = 8 Then
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                Else
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                End If
                                'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                                '    xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                '    xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                '    If G_ReportOptions.blnIncludeIngrNumber Then
                                '        xrIngAutoGrillCell.Width = 210
                                '    Else
                                '        xrIngAutoGrillCell.Width = 300
                                '    End If

                                'Else
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intExcessSpace - 5

                                ' End If
                                xrIngCell.Controls.Add(a)
                                xrIngRow.Cells.Add(xrIngCell)
                            End If

                            ' End Using
                        Else
                            Dim x As New RichTextBox
                            'Using x
                            x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strComple
                            If CBool(RwVw("isBrandedIngredient")) Then
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            Else
                                x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            End If
                            If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                x.SelectedText = ""
                            Else
                                x.SelectedText = " " + RwVw("itemname").ToString 'Ingredients Name
                            End If
                            ' x.SelectedText = RwVw("itemname").ToString 'Ingredients Name
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strAltIngredient
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            x.SelectedText = strPrep

                            Dim a As New XRRichText
                            a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            a.Width = intExcessSpace - 5
                            a.Rtf = x.Rtf

                            Dim b As New XRRichText
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            b.Width = intExcessSpace - 5
                            b.Rtf = x.Rtf

                            'x.Dispose()

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                b.Text = cLang.GetString(5590) 'Ingredients
                                b.Width = intExcessSpace + 20 'LLG2016
                                b.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.Width = intExcessSpace - 5
                                xrIngCell.Controls.Add(b)
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                ' RDC 08.14.2013 : Remove comma in complement.
                                If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                                If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = strPrep.Trim Else strPrep = ""
                                If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = strAltIngredient.Trim Else strAltIngredient = ""
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                    strIngr = ""
                                Else
                                    '  strIngr = RwVw("itemname").ToString & strAltIngredient & strPreps" " & strComple
                                    If strAltIngredient = "" Then
                                        strIngr = strComple & RwVw("itemname").ToString & strAltIngredient & strPrep
                                    Else
                                        strIngr = strComple & RwVw("itemname").ToString & "[" & strAltIngredient & "]" & strPrep
                                    End If
                                End If
                                xrIngCell = New XRTableCell
                                a.Text = strIngr
                                xrIngAutoGrillCell = New XRTableCell
                                If RwVw("itemType") = 8 Then
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                Else
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                End If
                                'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                                '    xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                '    xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                '    If G_ReportOptions.blnIncludeIngrNumber Then
                                '        xrIngAutoGrillCell.Width = 210
                                '    Else
                                '        xrIngAutoGrillCell.Width = 300
                                '    End If

                                'Else
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intExcessSpace - 5

                                ' End If
                                xrIngCell.Controls.Add(a)
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                            '  End If
                            'End Using
                        End If



                        ' RDC 01.10.2014 : Display unvalidated quantities
                        Dim strImpUnvalidatedQty As String = "", strImpUnvalidatedUnit As String = ""
                        Dim strMetUnvalidatedQty As String = "", strMetUnvalidatedUnit As String = ""
                        Dim dtUnvalidated As New DataTable

                        If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                            dtUnvalidated = getUnavalidatedQuantity(RwVw("tmpqty"), RwVw("tmpunit").ToString, CIntDB(CodeSiteCO(row)), CIntDB(row("Codetrans")))
                            If Not dtUnvalidated Is Nothing Or Not dtUnvalidated.Rows.Count = 0 Then
                                For Each dr As DataRow In dtUnvalidated.Rows
                                    strImpUnvalidatedQty = dr("QtyImperial")
                                    strImpUnvalidatedUnit = dr("UnitImperial")
                                    strMetUnvalidatedQty = dr("QtyMetric")
                                    strMetUnvalidatedUnit = dr("UnitMetric")
                                Next
                            End If
                        End If


                        If G_ReportOptions.blnUseMetricImperial Then
                            ' Metric Gross/Net and Imperial Gross/Net

                            If G_ReportOptions.blnIncludeImperialQtyNet Then
                                ' Imperial Quantity Net
                                Dim strImpNetQty As String = ""
                                'Dim dblImpNetQty As Double = CDbl(RwVw("netquantity"))
                                Dim dblImpNetQty As Double = CDbl(RwVw("itemImperialqty"))

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then ''AMTLA 2014.06.19 change "or" to "and" CWM-14648
                                    If Not strImpUnvalidatedQty Is Nothing And Not strImpUnvalidatedQty = "" Then
                                        strImpNetQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                    End If
                                    strUnit = strImpUnvalidatedUnit
                                Else
                                    'strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                        strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        If G_ReportOptions.blnUseFractions Then
                                            strImpNetQty = fctConvertToFraction(CDbl(strImpNetQty))
                                        Else
                                            strImpNetQty = CDbl(strImpNetQty)
                                        End If

                                        strUnit = RwVw("itemimperialunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strImpNetQty = ""
                                        Else
                                            strImpNetQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If



                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth

                                ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                                'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                                'If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Or strUnit.Trim = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                                If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                                xrIngRow.Cells.Add(xrIngCell)

                                ' Imperial Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strImpNetQty Is Nothing Or strImpNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)

                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description

                            End If

                            If G_ReportOptions.blnIncludeImperialQtyGross Then
                                Dim strImpGrossQty As String = ""

                                'Dim dblImpGrossQty As Double = CDbl(RwVw("grossquantity"))
                                Dim dblImpGrossQty As Double = CDbl(RwVw("grossImperialQuantity"))

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strImpUnvalidatedQty Is Nothing Or Not strImpUnvalidatedQty = "" Then
                                        strImpGrossQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                    End If
                                    strUnit = strImpUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                        strImpGrossQty = fctFormatNumericQuantity(dblImpGrossQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        If G_ReportOptions.blnUseFractions Then
                                            strImpGrossQty = fctConvertToFraction(CDbl(strImpGrossQty))
                                        Else
                                            strImpGrossQty = CDbl(strImpGrossQty)
                                        End If

                                        strUnit = RwVw("itemimperialunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strImpGrossQty = ""
                                        Else
                                            strImpGrossQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If



                                ' Imperial Quantity Gross
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                If strImpGrossQty Is Nothing Or strImpGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpGrossQty
                                xrIngRow.Cells.Add(xrIngCell)

                                ' Imperial Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim.ToUpper = "[_]" Or strImpGrossQty Is Nothing Or strImpGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                                'intExcessSpace -= 110
                            End If

                            If G_ReportOptions.blnIncludeMetricQtyNet Then
                                ' Metric Quantity Net
                                Dim strMetNetQty As String = ""
                                'Dim dblMetNetQty As Double = CDbl(RwVw("netquantity"))     ' RDC 09.03.2013 : Removed wrong output rendered
                                Dim dblMetNetQty As Double = CDbl(RwVw("ItemMetricQty"))    ' RDC 09.03.2013 : Correction

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                        strMetNetQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                    End If
                                    strUnit = strMetUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                        strMetNetQty = fctFormatNumericQuantity(dblMetNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        strMetNetQty = CDbl(strMetNetQty)

                                        strUnit = RwVw("itemmetricunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strMetNetQty = ""
                                        Else
                                            strMetNetQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                If strMetNetQty Is Nothing Or strMetNetQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strMetNetQty
                                xrIngRow.Cells.Add(xrIngCell)
                                ' Metric Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth

                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetNetQty Is Nothing Or strMetNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                                ' RDC 08.30.2013 : computing excess space that will add to Ingredient description

                            End If

                            If G_ReportOptions.blnIncludeMetricQtyGross Then
                                ' Metric Quantity Gross
                                Dim strMetGrossQty As String = ""
                                Dim dblMetGrossQty As Double = CDbl(RwVw("grossMetricQuantity"))     ' RDC 09.03.2013 : Wrong output rendered.

                                ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                                If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                    If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                        strMetGrossQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                    End If
                                    strUnit = strMetUnvalidatedUnit
                                Else
                                    'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                    If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                        strMetGrossQty = fctFormatNumericQuantity(dblMetGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                        strMetGrossQty = CDbl(strMetGrossQty)

                                        strUnit = RwVw("itemmetricunit").ToString.Trim
                                    Else
                                        If RwVw("tmpqty").ToString <= "0" Then
                                            strMetGrossQty = ""
                                        Else
                                            strMetGrossQty = RwVw("tmpqty").ToString
                                        End If
                                        strUnit = RwVw("tmpunit").ToString.Trim
                                    End If
                                End If

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth
                                If strMetGrossQty Is Nothing Or strMetGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = " " Else xrIngCell.Text = strMetGrossQty
                                xrIngRow.Cells.Add(xrIngCell)
                                ' Metric Unit
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                xrIngCell.Width = intUnitWidth
                                ' RDC 05.23.2013 - Fix for Bug CWM-6115
                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetGrossQty Is Nothing Or strMetGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                                xrIngRow.Cells.Add(xrIngCell)
                            End If

                        Else
                            'anm  

                            If G_ReportOptions.blnIncludeGrossQty Then
                                'Gross Qty

                                Dim strGrossQty As String = ""
                                Dim dblGrossQty As Double = CDbl(RwVw("grossquantity"))

                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode

                                If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                    strGrossQty = fctFormatNumericQuantity(dblGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strGrossQty = fctConvertToFraction(CDbl(strGrossQty))
                                    Else
                                        strGrossQty = CDbl(strGrossQty)
                                    End If
                                    strUnit = RwVw("itemunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strGrossQty = ""
                                    Else
                                        strGrossQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If

                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strGrossQty Is Nothing Or strGrossQty = "0" Then strUnit = "" Else strUnit.Trim()


                                If CDblDB(strGrossQty) = 0 Then
                                    strGrossQty = ""
                                End If

                                If first = 1 Then
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 25
                                    xrIngCell.Text = cLang.GetString(132736) 'gross
                                    xrIngRow.Cells.Add(xrIngCell)

                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 25
                                    xrIngCell.Text = strGrossQty + " " + strUnit
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If
                            End If

                            If G_ReportOptions.blnIncludeNetQty Then
                                'Net Qty
                                Dim strNetQty As String = ""
                                Dim dblNetQty As Double = CDbl(RwVw("itemqty"))
                                Dim FormatUnit As String = RwVw("Format")

                                If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                    strNetQty = fctFormatNumericQuantity(dblNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strNetQty = fctConvertToFraction(CDbl(strNetQty))
                                    Else
                                        strNetQty = CDbl(strNetQty) 'IIf(xlic.l_App = EgswKey.clsLicense.enumApp.Autogrill, strNetQty, CDbl(strNetQty)) 'SM 20150706 should depend on the unit format for autogrill
                                    End If

                                    strUnit = RwVw("itemunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strNetQty = ""
                                    Else
                                        strNetQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If

                                If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strNetQty Is Nothing Or strNetQty = "0" Then strUnit = "" Else strUnit.Trim()

                                If CDblDB(strNetQty) = 0 Then
                                    strNetQty = ""
                                End If


                                Dim exStrNetQty As Double
                                Double.TryParse(strNetQty, exStrNetQty)

                                If first = 1 Then
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 20
                                    xrIngCell.Text = cLang.GetString(132614) '"Net Qty"
                                    xrIngRow.Cells.Add(xrIngCell)
                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intQtyWidth + 20
                                    If strNetQty = "" Then
                                        xrIngCell.Text = strNetQty + " " + strUnit
                                    Else
                                        xrIngCell.Text = Format(exStrNetQty, FormatUnit) + " " + strUnit
                                    End If
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If
                            End If
                        End If

                        ' Wastage
                        If G_ReportOptions.blnIncludeWastage Then
                            'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                            Dim strWastage As String = ""
                            If RwVw("itemcode").ToString > 0 And Not RwVw("itemtype") = 4 Then
                                strWastage = RwVw("totalwastage").ToString & "%"
                            Else
                                strWastage = ""
                            End If

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intWastageWidth + 40
                                xrIngCell.Text = cLang.GetString(132974) + "%" '"waste"
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                                Else
                                    xrIngCell = New XRTableCell
                                    xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                    xrIngCell.Width = intWastageWidth + 40
                                    xrIngCell.Text = strWastage 'RwVw("totalwastage").ToString & "%"
                                    xrIngRow.Cells.Add(xrIngCell)
                                End If

                            End If
                        End If

                        ' Ingredient Number
                        If G_ReportOptions.blnIncludeIngrNumber Then

                            If first = 1 Then
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intItemNumWidth + 15
                                xrIngCell.Text = cLang.GetString(5500) '"number"
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intItemNumWidth + 15
                                xrIngCell.Text = RwVw("itemnumber").ToString
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                        End If

                        If first = 1 Then
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth - 22
                            xrIngRow.Cells.Add(xrIngCell)

                        Else
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth - 22
                            xrIngRow.Cells.Add(xrIngCell)
                        End If

                        'End If
                        If first = 1 Then
                            xrIngTable.Rows.Add(xrIngRow)

                        End If
                        xrIngTable.Rows.Add(xrIngRow)

                End Select
            Next

            'anm 1-4-2016
            .Detail.Controls.Add(xrIngTable)

            intNewY += (xrIngTable.Height + 20)
            'intNewY += 20
            ' RDC force table to be plotted in X:0
            If strStyle = "003" Then
                intNewX = 0
            End If

            If dtListePreparation IsNot Nothing Then
                Dim xrStepTable As New XRTable
                Dim xrStepRow As New XRTableRow
                Dim xrStepCell As New XRTableCell
                Dim xrStepCellB As New XRTableCell

                xrStepTable.Location = New Point(intNewX, intNewY)
                xrStepTable.Width = intAvailableWidth
                xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None


                For Each drStep As DataRow In dtListePreparation
                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    'Using rtb
                    Using rtb
                        If Not G_ReportOptions.blnMode Then
                            If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(drStep("Note").ToString) Else rtb.AppendText(Chr(32))
                        Else
                            If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
                        End If
                        xrt.Rtf = rtb.Rtf
                    End Using
                    xrStepRow = New XRTableRow
                    xrStepRow.Height = G_ReportOptions.sgFontSize2
                    If G_ReportOptions.blnIncludePreparation Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout
                        Select Case row("MethodFormat").ToString.Trim.ToLower
                            Case "x", "" ' Not bulleted / numbered
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth
                                rtb.Width = intAvailableWidth
                                xrt.Width = intAvailableWidth


                                'xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                'xrStepRow.Cells.Add(xrStepCell)
                                Dim onceCount As Integer = 0
                                'anm
                                ' Dim currentHeight As New Integer
                                '  currentHeight = intNewY
                                Dim x As Integer = rtb.Lines.Count
                                Dim countTo3 As Integer = 0
                                Dim addToName As Integer = 0
                                Dim curY = intNewY + 10
                                Dim newLoop As Boolean = False
                                Dim rtbNew As New RichTextBox
                                'Dim aslow As String = rtbNew.Rtf.ToString()
                                Dim xrts As New XRRichText
                                Dim xrNewStepTable As New XRTable
                                Dim textLeftCount As Integer = rtb.Lines.Count Mod 3
                                Dim lineCountLeft As Integer = rtb.Lines.Count - textLeftCount
                                Dim LineCounter As Integer
                                For Each Line As String In rtb.Lines
                                    countTo3 += 1
                                    LineCounter += 1
                                    Using rtbNew
                                        If Line = "" Then
                                            rtbNew.AppendText(Environment.NewLine)
                                        Else
                                            If countTo3 = 1 Then
                                                rtbNew.AppendText(Line)
                                            Else
                                                rtbNew.AppendText(Line + Environment.NewLine)
                                            End If
                                        End If
                                        xrts.Rtf = rtbNew.Rtf

                                        If countTo3 = 1 Then
                                            countTo3 = 0
                                            xrts.Width = intAvailableWidth
                                            xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                                            xrts.CanShrink = True
                                            xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
                                            xrts.KeepTogether = True
                                            xrts.Location = New Point(intNewX, curY)
                                            .Detail.Controls.AddRange(New XRControl() {xrts})
                                            curY += (xrts.Height)
                                            rtbNew = New RichTextBox
                                            xrts = New XRRichText
                                            xrNewStepTable = New XRTable
                                        End If
                                    End Using
                                Next
                                intNewY = curY

                            'rtbNew.Dispose()
                            'xrts.Dispose()
                            'xrNewStepTable.Dispose()
                            Case "n" ' Number bullet
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                If G_ReportOptions.blnIncludeProcSequenceNo Then
                                    xrStepCell.Text = drStep("Position") & "."
                                End If
                                xrStepRow.Cells.Add(xrStepCell)
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                xrStepRow.Cells.Add(xrStepCell)
                                xrStepTable.Rows.Add(xrStepRow)
                                .Detail.Controls.Add(xrStepTable)
                                intNewY += (xrStepTable.Height + 20)
                            Case "b" ' Symbol bullet "•"
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                If G_ReportOptions.blnIncludeProcSequenceNo Then
                                    xrStepCell.Text = "•"
                                End If
                                xrStepRow.Cells.Add(xrStepCell)

                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                xrStepRow.Cells.Add(xrStepCell)
                                xrStepTable.Rows.Add(xrStepRow)
                                .Detail.Controls.Add(xrStepTable)
                                intNewY += (xrStepTable.Height + 20)
                        End Select
                        'xrStepTable.Rows.Add(xrStepRow) 'anm
                    End If
                    'End Using
                Next
            End If

            intNewX = 0

            Dim strServeWithNotes As String = Nothing
            Dim strFootnote1 As String = Nothing
            Dim strFootnote2 As String = Nothing

            For Each rwRecipeNotes As DataRow In G_ReportOptions.dtNotes.Select("Code=" & intRecipeCode)
                strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
                strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
                strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
            Next

            Dim xrNotesTable As New XRTable
            Dim xrNotesRow As New XRTableRow
            Dim xrNotesCell As New XRTableCell

            If G_ReportOptions.blnIncludeServeWith Then
                ' Serve with
                If strServeWithNotes.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote2.Trim)
                    xrt.Rtf = rtb.Rtf
                    xrt.CanGrow = True
                    xrt.Height = CIntDB(rtb.Height) + CIntDB(50)
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.ServeWith).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)

                    xrNotesRow = New XRTableRow
                    xrNotesRow.CanGrow = True
                    'xrNotesRow = fctMakeDataRow({strServeWithNotes.Trim}, {intAvailableWidth}, {TextAlignment.TopJustify})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.CanGrow = True

                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)
                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                    'rtb.Dispose()
                End If


            End If

            If G_ReportOptions.blnIncludeNotes Then
                ' Notes
                If strFootnote1.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote1.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.CanGrow = True
                    xrNotes2Cell.WordWrap = True
                    xrNotes2Cell.CanShrink = True
                    xrNotes2Cell.Multiline = True
                    xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)

                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                    'rtb.Dispose()
                    'xrt.Dispose()
                End If

            End If

            If G_ReportOptions.blnIncludeAddNotes Then
                ' Additional Notes
                If strFootnote2.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    'Using rtb
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote2.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.Height = 500
                    xrNotes2Cell.CanShrink = False
                    xrNotes2Cell.CanGrow = False
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)
                    xrNotesTable.CanShrink = True
                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                    'End Using

                    'rtb.Dispose()
                    'xrt.Dispose()
                End If
            End If

            '    If strServeWithNotes.Length > 0 Then
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.ServeWith).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '        ' RDC 04.15.2013 - Added Line
            '        intNewY += 10
            '        '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            '        'intNewY += 10

            '        For Each strWord In strServeWithNotes.Split(chrSplitChar)
            '            If CLng(strPartialWord.Length + strWord.Length) <= lngLineLen Then
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '            Else
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                intNewY += GetLineSpace(intTextHeight)
            '                strPartialWord = ""
            '            End If
            '        Next
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '        intNewY += GetLineSpace(intTextHeight)
            '        ' RDC 04.27.2013 - CMW-5630 Fix
            '        intNewY += 20
            '    End If

            '    If strFootnote1.Length > 0 Then
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.RecipeNotes).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '        ' RDC 04.16.2013 - Added Line
            '        intNewY += 20
            '        '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            '        'intNewY += 10
            '        strPartialWord = ""
            '        For Each strWord In strFootnote1.Split(chrSplitChar)
            '            If CLng(strPartialWord.Length + strWord.Length) <= lngLineLen Then
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '            Else
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                intNewY += GetLineSpace(intTextHeight)
            '                strPartialWord = ""
            '            End If
            '        Next
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '        intNewY += GetLineSpace(intTextHeight)
            '        ' RDC 04.27.2013 - CMW-5630 Fix
            '        intNewY += 20
            '    End If

            '    If strFootnote2.Length > 0 Then
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.RecipeAdditionalNotes).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '        ' RDC 04.15.2013 - Added Line
            '        intNewY += 10
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            '        intNewY += 10
            '        strPartialWord = ""
            '        For Each strWord In strFootnote2.Split(chrSplitChar)
            '            If CLng(strPartialWord.Length + strWord.Length) <= lngLineLen Then
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '            Else
            '                strPartialWord = strPartialWord & strWord & chrSplitChar
            '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopJustify)})
            '                intNewY += GetLineSpace(intTextHeight)
            '                strPartialWord = ""
            '            End If
            '        Next
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPartialWord, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '        ' RDC 04.27.2013 - CMW-5630 Fix
            '        intNewY += 20
            '    End If
            'End If
            ''End

            'HACCP
            intNewX = 0
            'intNewY = intNewY + 30

            If G_ReportOptions.blnIncludeHACCP Then

                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                End With

                Dim strCoolingTime As String = ""
                Dim strHeatingTime As String = ""
                Dim strHeatingTemp As String = ""
                Dim strHeatingMode As String = ""
                Dim strCCPDesc As String = ""
                Dim strStoringTemp As String = "" 'VRP 21.08.2008"
                Dim strStoringTime As String = "" 'VRP 21.08.2008
                Dim strHACCP As String = ""

                If Not IsDBNull(row("CCPDescriptionTrans").ToString) Then
                    If row("CCPDescriptionTrans").ToString.Length <> 0 Then
                        row("CCPDescription") = row("CCPDescriptionTrans").ToString
                    End If
                End If

                If Not IsDBNull(row("StoringTempTrans").ToString) Then 'VRP 21.08.2008
                    If row("StoringTempTrans").ToString.Length <> 0 Then
                        row("StoringTemp") = row("StoringTempTrans").ToString
                    End If
                End If

                If Not IsDBNull(row("StoringTimeTrans").ToString) Then 'VRP 21.08.2008
                    If row("StoringTimeTrans").ToString.Length <> 0 Then
                        row("StoringTime") = row("StoringTimeTrans").ToString
                    End If
                End If

                If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(row("CoolingTime").ToString)
                If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(row("HeatingTime").ToString)
                If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemp = Trim(row("HeatingTemperature").ToString)
                If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(row("HeatingMode").ToString)
                If Not IsDBNull(row("CCPDescription")) Then strCCPDesc = Trim(row("CCPDescription").ToString)
                If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(row("HACCP").ToString)
                If Not IsDBNull(row("StoringTemp")) Then strStoringTemp = Trim(row("StoringTemp").ToString) 'VRP 21.08.2008
                If Not IsDBNull(row("StoringTime")) Then strStoringTime = Trim(row("StoringTime").ToString) 'VRP 21.08.2008


                ' RDC 05.20.2013 - Removed 
                'If strStyle = "003" Then     'For Two Columns
                '    intNewY += GetLineSpace(intTextHeight)
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 10
                'End If
                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemp, strHeatingMode, strCCPDesc, strStyle, strStoringTime, strStoringTemp, strHACCP)
            End If

            If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
                dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)
            End If

            Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
            Dim intSelCodeTrans As Integer = 0
            Dim intCodeSet As Integer = 0
            For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
                intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
                intSelCodeTrans = CInt(drDispSet("codeTrans"))
                intCodeSet = CInt(drDispSet("CodeSet"))
            Next

            intNewY += 20

            ' RDC 08.14.2013 : Nutrients()
            If G_ReportOptions.blnIncludeNutrients Then
                ' Section Header
                Dim xrNutHeader As New XRTable
                xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutritionalInfo), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)  'LLG 05.16.2016 for lepause issue
                .Detail.Controls.Add(xrNutHeader)

                intNewY += (xrNutHeader.Height + 10)

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSet, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice, CIntDB(row("RecipeVersion")), userLocale:=userLocale)

                intNewY += 50  'LLG 05.16.2016 for lepause issue
            End If

            ' RDC 08.14.2013 : Removed and replaced code above
            ' RDC 02.25.2013 Moved Nutrient and GDA information after Keywords
            'Nutrients()
            'intNewX = 0
            'If G_ReportOptions.blnIncludeNutrients Then
            '    ' RDC 03.21.2013 - CWM-4808 fix
            '    Dim dt As DataTable
            '    'dt = Me.fctSetVisibleNutrients(CIntDB(row("CodeListeMain")), CIntDB(row("CodeSet")))
            '    dt = Me.fctSetVisibleNutrients(CIntDB(row("CodeListeMain")), G_ReportOptions.intSelectedNutrientSet)
            '    If dt.Rows.Count > 0 Then
            '        If CBoolDB(dt.Rows(0).Item("DisplayNutrition")) = True Then
            '            ' RDC 05.20.2013 - Remove due to not in use
            '            'If strStyle = "003" Then     'For Two Columns

            '            '    Me.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            '            '    intNewY += 20
            '            '    intTextHeight = Me.MeasureText(cLang.GetString(clsEGSLanguage.CodeType.Nutrients).Trim, fntBold, intAvailableWidth, sf, Me.Padding).Height
            '            '    Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Nutrients).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '            '    intNewY += 20
            '            'End If
            '            'subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, strStyle, CIntDB(row("CodeListeMain"))) '
            '            'subDisplayNutrients(strNutrientServing, dblNutrientFactor, L_Nutrient, strStyle, CIntDB(row("CodeListeMain")), CIntDB(row("CodeSet")))
            '            strNutrientServing = CStrDB(row("ImposedServing"))
            '            'subDisplayNutrientsRecipedia(strNutrientServing, dblNutrientFactor, L_Nutrient, strStyle, CIntDB(row("CodeListeMain")), CIntDB(row("CodeSet")))
            '            subDisplayNutrientsRecipedia(strNutrientServing, dblNutrientFactor, L_Nutrient, strStyle, CIntDB(row("CodeListeMain")), G_ReportOptions.intSelectedNutrientSet)
            '        End If
            '    End If
            'End If

            'GDA()
            intNewX = 0
            If G_ReportOptions.blnIncludeGDA Then
                ' RDC 05.20.2013 - Remove due to not in use
                'If strStyle = "003" Then     'For Two Columns
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 10
                'End If
                'subDisplayNutrientsGDA(strYieldName, dblNutrientFactor, L_Nutrient, strStyle)
                Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                Detail.Controls.Add(xrGDAHeader)
                intNewY += (xrGDAHeader.Height) + 10

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayGDAComputation(row("Code"), intCodeSet, intSelCodeTrans, intCodeSetPrice, userLocale:=userLocale)
            End If
            'End

            'Keywords()
            intNewX = 0

            ' RDC 04.29.2013 - Checking datarows per recipe code; if returns 0 no header will be printe

            If G_ReportOptions.blnIncludeKeyword AndAlso
   foundKeywords IsNot Nothing AndAlso foundKeywords.Count > 0 Then
                ' RDC 05.20.2013 - Removed
                'If strStyle = "003" Then     'For Two Columns
                '    intNewY += GetLineSpace(intTextHeight)
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 10
                'End If
                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                    'xrSectionHeaderTable.Dispose()
                End With

                subDisplayKeywords(foundKeywords, strStyle)
            End If

            ' RDC 04.27.2013 - CMW-5630 Fix
            intNewY += 20
            intNewX = 0

            ' RDC 07.10.2013 - Kiosk
            If G_ReportOptions.blnIncludeKiosk And Not G_ReportOptions.dtKiosk Is Nothing Then
                If G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode).Count > 0 Then
                    Dim xrKioskTable As New XRTable
                    Dim xrKioskRows As New XRTableRow

                    xrKioskTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Kiosk), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += xrKioskTable.Height + 10

                    xrKioskTable = New XRTable
                    xrKioskTable.Width = intAvailableWidth
                    xrKioskTable.Location = New Point(intNewX, intNewY)

                    For Each drKioskRows As DataRow In G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode)
                        'AGL 2013.08.22 - added checking for blank dates
                        If CStrDB(drKioskRows("BrandSiteDateFrom")) = "" Or CStrDB(drKioskRows("BrandSiteDateTo")) = "" Then
                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                        Else
                            ' RDC 08.14.2013 : Do not display date if date is equal to 01/01/1900
                            If CDate(drKioskRows("BrandSiteDateFrom")).Year = 1900 And CDate(drKioskRows("BrandSiteDateTo")).Year = 1900 Then
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            Else
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim & " " & Format(CDate(drKioskRows("BrandSiteDateFrom")), "MM/dd/yyyy") & " - " & Format(CDate(drKioskRows("BrandSiteDateTo")), "MM/dd/yyyy")}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            End If
                        End If

                    Next
                    xrKioskTable.Rows.Add(xrKioskRows)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += (xrKioskTable.Height + 20)

                    ' xrKioskTable.Dispose()
                    ' xrKioskRows.Dispose()
                End If

            End If

            ' RDC 02.22.2013
            ' Brands and Publications
            If G_ReportOptions.dtBrands IsNot Nothing Then
                If G_ReportOptions.blnIncludeBrand And G_ReportOptions.dtBrands.Select("RecipeCode= " & row("Code")).Count > 0 Then
                    '' RDC 03.21.2013 - CWM-4808 fix
                    'If strStyle = "003" Then
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                    '    intNewY += 20
                    '    intTextHeight = ReportingTextUtils.MeasureText(cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim, fntBold, intAvailableWidth, sf, Me.Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.None, , False)})
                    '    intNewY += intTextHeight '20
                    'Else
                    '    intNewY += 5 ' RDC 02.25.2013 Added Spacing
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
                    '    ' RDC 04.15.2013 - Added Line
                    '    intNewY += 20
                    '    '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                    '    'intNewY += 10
                    'End If
                    Dim xrBrandTable As New XRTable
                    Dim xrBrandRow As New XRTableRow
                    Dim xrBrandCell As New XRTableCell

                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        If .blnIncludeHighlightSection Then
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.LightGray
                            xrBrandTable.BorderColor = Color.Black
                        Else
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.White
                            xrBrandTable.BorderColor = Color.Black
                        End If

                        xrBrandRow.Height = .sgFontSize2
                        xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                        xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                        xrBrandCell.Text = cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim
                        xrBrandRow.Cells.Add(xrBrandCell)
                        xrBrandTable.Rows.Add(xrBrandRow)

                    End With
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 10)

                    xrBrandTable = New XRTable
                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    Dim cLangData As New clsLanguage(enumAppType.WebApp, G_strConnection)
                    Dim cLangFromCodeTrans As New clsEGSLanguage(cLangData.GetCodeLang(G_ReportOptions.intTranslation))
                    Dim strBrandClassification As String = ""

                    For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
                        With G_ReportOptions
                            xrBrandRow = New XRTableRow
                            xrBrandRow.Height = .sgFontSize2
                            xrBrandCell = New XRTableCell
                            xrBrandCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Regular)
                            xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft

                            If drBrand("BrandClass").ToString.ToLower = "primary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173883)
                            ElseIf drBrand("BrandClass").ToString.ToLower = "secondary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173884)
                            Else
                                strBrandClassification = drBrand("BrandClass").ToString
                            End If
                            xrBrandCell.Text = drBrand("Brand").ToString & " ~ " & strBrandClassification
                            xrBrandRow.Cells.Add(xrBrandCell)
                            xrBrandTable.Rows.Add(xrBrandRow)
                        End With
                    Next
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 20)

                    'For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
                    '    intTextHeight = ReportingTextUtils.MeasureText(drBrand("Brand").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drBrand("Brand").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , , , , , , False)})
                    '    intNewY += intTextHeight '10
                    'Next
                    ' xrBrandTable.Dispose()
                    '  xrBrandRow.Dispose()
                    '  xrBrandCell.Dispose()
                End If
            End If
            ' RDC 04.27.2013 - CMW-5630 Fix
            'intNewY += 20

            If G_ReportOptions.blnIncludePublication AndAlso G_ReportOptions.dtPublications IsNot Nothing Then
                'And G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode).Count > 0
                '' RDC 03.21.2013 - CWM-4808 fix
                'If strStyle = "003" Then
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 20
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '    intNewY += 20
                'Else
                '    intNewY += 5 ' RDC 02.25.2013 Added Spacing
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
                '    intNewY += 20
                'End If

                Dim xrPublicationTable As New XRTable
                Dim xrPublicationRow As New XRTableRow
                Dim xrPublicationCell As New XRTableCell

                xrPublicationTable.Width = intAvailableWidth
                xrPublicationTable.Location = New Point(intNewX, intNewY)

                If G_ReportOptions.blnIncludeHighlightSection Then
                    xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                    xrPublicationTable.BorderWidth = 1
                    xrPublicationTable.BackColor = Color.LightGray
                    xrPublicationTable.BorderColor = Color.Black
                Else
                    xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                    xrPublicationTable.BorderWidth = 1
                    xrPublicationTable.BackColor = Color.White
                    xrPublicationTable.BorderColor = Color.Black
                End If

                xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrPublicationCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim
                xrPublicationRow.Cells.Add(xrPublicationCell)
                xrPublicationTable.Rows.Add(xrPublicationRow)

                .Detail.Controls.Add(xrPublicationTable)

                intNewY += (xrPublicationTable.Height + 10)

                xrPublicationTable = New XRTable
                xrPublicationTable.Width = intAvailableWidth
                xrPublicationTable.Location = New Point(intNewX, intNewY)


                For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                    'Dim publicationDate As String
                    'publicationDate = drPublication("PlacementDate").ToShortDateString

                    xrPublicationRow = New XRTableRow
                    xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                    xrPublicationCell = New XRTableCell
                    xrPublicationCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                    xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    ' xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim
                    xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & fctConvertDate(CType(drPublication("PlacementDate"), Date))
                    xrPublicationRow.Cells.Add(xrPublicationCell)
                    xrPublicationTable.Rows.Add(xrPublicationRow)
                Next

                .Detail.Controls.Add(xrPublicationTable)
                intNewY += (xrPublicationTable.Height + 20)

                ' xrPublicationTable.Dispose()
                ' xrPublicationRow.Dispose()
                ' xrPublicationCell.Dispose()

                'For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                '    intTextHeight = ReportingTextUtils.MeasureText(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '    intNewY += intTextHeight
                'Next
                '' RDC 04.27.2013 - CMW-5630 Fix
                'intNewY += 20
            End If

            ' End

            ' RDC 07.10.2013 - Cookbook
            If G_ReportOptions.blnIncludeCookbook And Not G_ReportOptions.dtCookbook Is Nothing Then
                If G_ReportOptions.dtCookbook.Select("RecipeCode=" & row("Code")).Count > 0 Then
                    Dim xrCookbookTable As New XRTable
                    Dim xrCookbookRow As New XRTableRow

                    xrCookbookTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Cookbook), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 10)

                    xrCookbookTable = New XRTable
                    xrCookbookTable.Width = intAvailableWidth
                    xrCookbookTable.Location = New Point(intNewX, intNewY)

                    For Each drCookbookRow As DataRow In G_ReportOptions.dtCookbook.Select("RecipeCode=" & row("Code"))
                        xrCookbookRow = fctMakeDataRow({drCookbookRow("Name").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCookbookTable.Rows.Add(xrCookbookRow)
                    Next
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 20)
                    ' xrCookbookTable.Dispose()
                    ' xrCookbookRow.Dispose()
                End If
            End If

            ' RDC 07.10.2013 - Comments
            If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
                If G_ReportOptions.dtComment.Select("RecipeCode=" & row("Code")).Count > 0 Then
                    Dim xrCommentTable As New XRTable
                    Dim xrCommentRow As New XRTableRow

                    xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 10)

                    xrCommentTable = New XRTable
                    xrCommentTable.Width = intAvailableWidth
                    xrCommentTable.Location = New Point(intNewX, intNewY)

                    For Each drComment As DataRow In G_ReportOptions.dtComment.Select("RecipeCode=" & row("Code"))
                        xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCommentTable.Rows.Add(xrCommentRow)
                    Next
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 20)
                    'xrCommentTable.Dispose()
                    ' xrCommentRow.Dispose()
                End If
            End If


            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens And Not foundAllergens Is Nothing Then
                If strStyle = "003" Then     'For Two Columns
                    intNewY += GetLineSpace(intTextHeight)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                    intNewY += 10
                End If
                'subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, strStyle)
                Dim blnManor As Boolean = False
                If blnManor = False Then
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    With Me
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                        Select Case strStyle

                            Case "001", "002", "003"
                                Dim xrAllergensTable As New XRTable
                                Dim xrAllergensRow As New XRTableRow
                                Dim xrAllergensCell As New XRTableCell

                                xrAllergensTable.Width = intAvailableWidth
                                xrAllergensTable.Location = New Point(intNewX, intNewY)

                                If G_ReportOptions.blnIncludeHighlightSection Then
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.LightGray
                                    xrAllergensTable.BorderColor = Color.Black
                                Else
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.White
                                    xrAllergensTable.BorderColor = Color.Black
                                End If

                                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrAllergensCell.Text = strX.Trim
                                xrAllergensRow.Cells.Add(xrAllergensCell)
                                xrAllergensTable.Rows.Add(xrAllergensRow)

                                .Detail.Controls.Add(xrAllergensTable)

                                intNewX += (xrAllergensTable.Height + 10)

                                ' RDC 05.15.2013 - Removed.
                                'Case "002"  'Modern
                                '    intNewY += 10
                                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                                'Case "003"
                                '    intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                '  xrAllergensTable.Dispose()
                                '  xrAllergensRow.Dispose()
                                '  xrAllergensCell.Dispose()

                            Case "003Menu"
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                            Case "004" 'Merchandise Details
                                intNewY += 30

                                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                            Case Else
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End Select


                        intNewY += intTextHeight + 10
                    End With
                Else
                    intNewY += GetLineSpace(intTextHeight)
                End If
                Dim row1 As DataRow = foundDetails(0) 'KMQDC 6.15.2015

                Dim CodeAllergenTranslation As Integer 'KMQDC 6.15.2015
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer) 'KMQDC 6.15.2015


                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, strStyle, False, True, strCnn, CodeAllergenTranslation)
            End If

            'End of Allergens

            'AGL 2014.11.17
            intNewY += 30 'KMQDC 6.10.2015 original 10
            intNewX = 0

            'Composition
            If G_ReportOptions.blnIncludeComposition And G_ReportOptions.intfoodLaw = 3 Then
                If G_ReportOptions.blnIncludeAllergens Then
                    intNewY += CInt(GetLineSpace(intTextHeight))
                End If
            End If
            If strStyle = "003" Then     'For Two Columns
                intNewY += GetLineSpace(intTextHeight)
                .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                'intNewY += 10
            End If
            'G_ReportOptions.blnIncludeComposition = False 'KMQDC 6.11.2015
            If G_ReportOptions.blnIncludeComposition Then

                Dim xrCompositionTable As New XRTable
                Dim xrCompositionRow As New XRTableRow
                Dim xrCompositionCell As New XRTableCell

                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    If .blnIncludeHighlightSection Then
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.LightGray
                        xrCompositionTable.BorderColor = Color.Black
                    Else
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.White
                        xrCompositionTable.BorderColor = Color.Black
                    End If

                    xrCompositionRow.Height = .sgFontSize2
                    xrCompositionCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                    xrCompositionCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                    xrCompositionCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Composition).Trim
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    xrCompositionTable.Rows.Add(xrCompositionRow)

                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 10)

                xrCompositionTable = New XRTable
                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    xrCompositionRow = New XRTableRow
                    '   xrCompositionRow.Height = .sgFontSize
                    xrCompositionTable.Width = intAvailableWidth
                    xrCompositionCell = New XRTableCell

                    '--------------keen dela cruz
                    Dim str As String = row("Composition").ToString
                    str = str.Replace("<b>", "\b ")
                    str = str.Replace("</b>", "\b0")
                    str = str.Replace("<p>", "")
                    str = str.Replace("</p>", "")
                    str = str.Replace("<br>", "")
                    str = str.Replace("<i>", "\i ")
                    str = str.Replace("</i>", "\i0")
                    str = str.Replace("{", "")
                    str = str.Replace("}", "")
                    str = str.Replace("<div>", "\line \div ")
                    str = str.Replace("</div>", "\line \div0 ")
                    str = str.Replace("&nbsp;", " ")
                    Dim strhtml As String = ParseHtmlToRTF(str)  'LLG 05.16.2016 for lepause issue
                    Dim ss As String = row("Composition").ToString
                    Dim XrRichText1 As New XRRichText
                    XrRichText1.Width = 630
                    XrRichText1.CanGrow = True
                    XrRichText1.CanShrink = True
                    XrRichText1.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    XrRichText1.Rtf = strhtml
                    xrCompositionCell.Controls.Add(XrRichText1)


                    ' OLD (causes NullReference when the row has 0 cells):
                    ' xrCompositionRow.InsertCell(xrCompositionCell, 1)

                    ' NEW (safe): just add the cell (or InsertCell at index 0)
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    ' Or: xrCompositionRow.InsertCell(xrCompositionCell, 0, False)

                    xrCompositionTable.Rows.Add(xrCompositionRow)
                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 20)

                ' xrCompositionTable.Dispose()
                ' xrCompositionRow.Dispose()
                ' xrCompositionCell.Dispose()

                'Me.Detail.Controls.Add(fctMakeXRLabel(row("Composition"), fntRegular, 0, intNewY, intAvailableWidth, 100, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.None, True))
            End If


            'xrIngTable.Dispose()
            'xrIngTableNew.Dispose()
            'xrIngRow.Dispose()
            'xrIngCell.Dispose()
            'xrIngCellNew.Dispose()
            'xrIngRowHeader.Dispose()
            'xrIngRow1.Dispose()
            'xrIngCell1.Dispose()

        End With
        Return Me


        fctPrintRecipeDetailEgs.Dispose()

    End Function
    Private Function ParseHtmlToRTF(strHtml As String) As String
        strHtml = strHtml.Replace("<strong>", " \b\fs16 ")
        strHtml = strHtml.Replace("<STRONG>", " \b\fs16 ")
        strHtml = strHtml.Replace("</strong>", " \b0 ")
        strHtml = strHtml.Replace("</STRONG>", " \b0 ")
        strHtml = strHtml.Replace("<em>", " \i\fs16 ")
        strHtml = strHtml.Replace("<EM>", " \i\fs16 ")
        strHtml = strHtml.Replace("</em>", " \i0 ")
        strHtml = strHtml.Replace("</EM>", " \i0 ")
        strHtml = strHtml.Replace("<u>", " \ul\fs16 ")
        strHtml = strHtml.Replace("<U>", " \ul\fs16 ")
        strHtml = strHtml.Replace("</u>", " \ulnone ")
        strHtml = strHtml.Replace("</U>", " \ulnone ")
        strHtml = strHtml.Replace("&lt;STRONG&gt;", "\b\fs16")
        strHtml = strHtml.Replace("&lt;strong&gt;", "\b\fs16")
        strHtml = strHtml.Replace("&lt;/STRONG&gt;", " \b0 ")
        strHtml = strHtml.Replace("&lt;/strong&gt;", " \b0 ")
        strHtml = strHtml.Replace("&lt;em&gt;", "\i\fs16")
        strHtml = strHtml.Replace("&lt;EM&gt;", "\i\fs16")
        strHtml = strHtml.Replace("&lt;/em&gt;", "\i0")
        strHtml = strHtml.Replace("&lt;/EM&gt;", "\i0")
        strHtml = strHtml.Replace("&lt;u&gt;", "\ul\fs16")
        strHtml = strHtml.Replace("&lt;U&gt;", "ul\fs16")
        strHtml = strHtml.Replace("&lt;/u&gt;", "\ulnone")
        strHtml = strHtml.Replace("&lt;/U&gt;", "\ulnone")
        Return "{\rtf1\ansi{\fonttbl\f0\fswiss Arial;}\f0\pard\fs16" & strHtml & " }"
    End Function
    Function manageExtendedLine(rtb As RichTextBox, currentHeight As Integer, xrStepCell As XRTableCell) As XRTable
        Dim i As Integer = 0
        Dim onceCount As Integer = 0
        Dim rtbNew As New RichTextBox 'anm
        Dim xrt As New XRRichText
        Dim xrStepRow As New XRTableRow
        Dim xrStepTable As New XRTable
        rtb.Width = xrStepCell.Width
        xrt.Width = xrStepCell.Width
        xrStepCell.Width = intAvailableWidth
        For Each Line As String In rtb.Lines
            onceCount += 1
            Using rtbNew
                If Not currentHeight > 470 Then
                    If Line = "" Then
                        rtbNew.AppendText(Environment.NewLine)

                    Else
                        rtbNew.AppendText(Environment.NewLine + Line)
                    End If
                    xrt.Rtf = rtbNew.Rtf
                    xrStepCell.Controls.Add(xrt)
                    xrStepRow.Cells.Add(xrStepCell)
                    xrStepTable.Rows.Add(xrStepRow)
                    currentHeight += (xrStepTable.Height)
                Else
                    If onceCount Then
                        rtbNew.AppendText(Environment.NewLine + Environment.NewLine + Environment.NewLine + Line)
                    Else
                        rtbNew.AppendText(Environment.NewLine + Line)
                    End If
                    xrt.Rtf = rtbNew.Rtf
                    xrStepCell.Controls.Add(xrt)
                    xrStepRow.Cells.Add(xrStepCell)
                    xrStepTable.Rows.Add(xrStepRow)
                    currentHeight += (xrStepTable.Height)
                End If
            End Using
        Next
        Return xrStepTable
    End Function
    Function fctPrintRecipeCostingEGSStandard(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow,
                                               ByVal foundAllergens() As DataRow, ByVal dtIngredients As DataTable, Optional ByVal dtListePreparation As DataTable = Nothing, Optional strConn As String = "") As XtraReport

        '483 height to manage
        Dim fntFont As Font
        Dim intRecipeCode As Long
        Dim intDictionary As Integer
        Dim L_CurrencyName As String
        Dim dblCoefficient As Double
        Dim dblTaxValue As Double
        Dim dblImposedPrice As Double
        Dim strName As String
        Dim strPortionUnit2Format As String
        Dim strCategoryName As String
        Dim strNumber As String
        Dim strSourceName As String = Nothing
        Dim strRemarks As String
        Dim strDate As String = Nothing
        Dim strPreparation As String = ""
        Dim strCoolingTime As String = ""
        Dim strHeatingTime As String = ""
        Dim strHeatingTemperature As String = ""
        Dim strHeatingMode As String = ""
        Dim strCCPdescription As String = ""
        Dim strStoringTemp As String = "" 'VRP 21.08.2008"
        Dim strStoringTime As String = "" 'VRP 21.08.2008
        Dim strHACCP As String = ""
        Dim strRecipeName As String
        Dim strServings As String
        Dim strYieldName As String
        Dim strNumberOfServings As String
        Dim strSubRecipeUnit As String
        Dim dblPercent As Double
        Dim dblYieldQty As Double
        Dim dblTotal As Double
        Dim dblPrice As Double
        Dim CurRate As Double
        Dim dblUnitFactor As Double
        Dim dblWastage As Double
        Dim dblFactor As Double
        Dim dblQuantityNet As Double
        Dim strQuantityNet As String = "0"
        Dim strUnit As String
        'Dim strUnitFormat As String
        Dim dblQuantityBrut As Double
        Dim strQuantityBrut As String = "0"
        Dim dblTotalLaborCost As Double
        Dim dblCoefficientBelvoir As Double
        Dim dblItemPrice As Double
        Dim strNetQty As String
        Dim strGrossQty As String
        Dim strDisplayUnit As String
        Dim lngDisplayUnit As Long
        Dim strPriceFormat As String

        Dim lngKiloCode As Long
        Dim lngLiterCode As Long
        'Dim str3Pictures As String = Nothing
        'Dim strPicture(0 To 2) As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007

        Dim intAvailableWidth As Integer
        Dim intSpace As Integer
        Dim strX As String

        Dim dblYield2 As Double
        Dim blnSubRecipeComputation As Boolean = False

        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

        fctPrintRecipeCostingEGSStandard = Nothing

        sf = New StringFormat(StringFormatFlags.NoClip)

        Dim arrNutrientName As New ArrayList
        For Each tNut As tNutrient In G_Nutrient
            arrNutrientName.Add(tNut.Name)
        Next

        Try
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            End If

            'SM 2015.05.15 added try catch for font that does not support regular fontstyle
            Try
                fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            Catch ex As Exception
                'fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try

            'SM 2015.05.15 added try catch for font that does not support bold fontstyle
            Try
                fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            Catch ex As Exception
                ' fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try

            'SM 2015.05.15 added try catch for font that does not support Italic fontstyle
            Try
                fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            Catch ex As Exception
                ' fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try
        Catch ex As Exception

            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        ReDim L_lngCol(0 To 12)

        Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, G_strConnection) 'VRP 08.01.2009
        End If

        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)
        End If

        intDictionary = G_Language
        If G_ReportOptions.intTranslation > 0 Then
            intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
        End If
        G_Language = intDictionary

        strPriceFormat = CType(CStrDB(row("curFormat")), String)
        L_CurrencyName = CType(CStrDB(row("Currency")), String)
        dblCoefficient = CType(CDblDB(row("coeff")), Double)
        dblTaxValue = CType(CDblDB(row("TaxValue")), Double)
        dblImposedPrice = CType(CDblDB(row("ImposedPrice")), Double)
        strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
        strPortionUnit2Format = G_FormatOneDecimal
        If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(CStrDB(row("PortionUnit2Format")), String)
        strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
        strNumber = fctNumber2Text(Trim(CType(CStrDB(row("RecipeNumber")), String)))
        intRecipeCode = row("Code")
        If CType(CIntDB(row("codesource")), Integer) = 0 Then
            strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
        Else
            strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
        End If

        strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
        If Not IsDBNull(row("Dates")) Then strDate = CType(CStrDB(row("Dates")), String)

        strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

        'If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(CType(CStrDB(row("CoolingTime")), String))
        'If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(CType(CStrDB(row("HeatingTime")), String))
        'If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(CType(CStrDB(row("HeatingTemperature")), String))
        'If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(CType(CStrDB(row("HeatingMode")), String))
        'strCCPdescription = fctGetTranslatedText(row, "CCPdescription", "CCPdescriptionTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CCPdescription)
        'If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(CType(CStrDB(row("HACCP")), String))

        If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(row("CoolingTime").ToString)
        If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(row("HeatingTime").ToString)
        If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(row("HeatingTemperature").ToString)
        If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(row("HeatingMode").ToString)
        If Not IsDBNull(row("CCPDescription")) Then strCCPdescription = Trim(row("CCPDescription").ToString)
        If Not IsDBNull(row("StoringTemp")) Then strStoringTemp = Trim(row("StoringTemp").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("StoringTime")) Then strStoringTime = Trim(row("StoringTime").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(row("HACCP").ToString)


        For i As Integer = 1 To 34 '15
            L_Nutrient(i).Value = -1
        Next


        Dim strFieldname As String = Nothing
        Dim strFieldnameForPercent As String = Nothing
        For i As Integer = 1 To 34 '15
            strFieldname = "N" & i.ToString
            'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
            strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
            If Not IsDBNull(row(strFieldname)) And
               Not IsDBNull(row(strFieldnameForPercent)) Then
                If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                    L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                    G_Nutrient(i).Unit = "%"
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                Else
                    L_Nutrient(i).Value = CType(row(strFieldname), Double)
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                End If
            End If
        Next

        lngKiloCode = fctGetUnitCodeFromType(100)
        lngLiterCode = fctGetUnitCodeFromType(200)


        Dim intDPic As Integer
        If row.Table.Columns.Contains("DefaultPicture") Then
            intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
        Else
            intDPic = 1
        End If

        If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
        Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
        '------ 

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)



            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'page header
            '-------------------------------------------
            'brag
            intNewX = 0
            intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
            strX = " "
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)


            intNewX = 0
            intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

            'Recipe Name
            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            'intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            ' .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            'intNewY += GetLineSpace(intTextHeight) + 20

            Dim xRecipeName As New XRTable
            Dim xRecipeRow As New XRTableRow
            Dim xRecipeCell As New XRTableCell
            xRecipeName.Location = New System.Drawing.Point(intNewX, intNewY)
            xRecipeName.Width = intAvailableWidth

            If G_ReportOptions.blnIncludeHighlightSection Then
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.LightGray
            Else
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.White
            End If

            xRecipeRow.Padding = New DevExpress.XtraPrinting.PaddingInfo(0, 0, 0, 0)
            xRecipeRow.Height = CInt(G_ReportOptions.sgFontTitleSize)
            xRecipeCell.Text = New String(strRecipeName)
            xRecipeCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            If G_ReportOptions.blnIncludeHighlightSection Then xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            xRecipeCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xRecipeRow.Cells.Add(xRecipeCell)
            xRecipeName.Rows.Add(xRecipeRow)

            xRecipeName.KeepTogether = False
            .PageHeader.Controls.Add(xRecipeName)

            'xRecipeName.Dispose()
            'xRecipeRow.Dispose()
            'xRecipeCell.Dispose()
            ''-------------------------------------------

            ' RDC 08.29.2013 : Applied enhancements to code
            intNewX = 0
            intNewY = 20
            Dim xrRecipeMenuInfo As New XRTable 'anm first input with table 
            xrRecipeMenuInfo.Width = intAvailableWidth
            xrRecipeMenuInfo.Location = New Point(intNewX, intNewY)
            Dim xrRecipeMenuRow As New XRTableRow
            If G_ReportOptions.blnIncludeNumber Then
                If G_ReportOptions.blnRecipe Then
                    ' Recipe #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

                Else
                    ' Menu #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Menu_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                End If
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeCategory Then
                ' Category
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category), ": " & strCategoryName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeSource Then
                ' Source
                ' RDC 09.03.2013 : Change display from NO SOURCE to NOT DEFINED
                If strSourceName.ToUpper.Trim = "NO SOURCE" Or strSourceName Is Nothing Or strSourceName.Trim = "" Then strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source), ": " & strSourceName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeDate Then
                ' Date
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_), ": " & DirectCast(row("Dates"), DateTime).ToShortDateString()}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeRemark Then
                ' Remarks
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark), ": " & strRemarks}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                ' xrRecipeMenuRow.Dispose()
            End If


            strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)
            'strYieldName = row("itemUnit").ToString

            '-- VRP 20.01.2009
            dblYieldQty = CType(row("Yield"), Double)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)

            Dim intYieldUnitOriginal As Integer = 0
            If row.Table.Columns.Contains("YieldUnitOriginalCode") Then intYieldUnitOriginal = CType(row("YieldUnitOriginalCode"), Integer) 'JTOC 31.05.2013

            Dim dblYieldQtyOrig As Double = 0.0
            If row.Table.Columns.Contains("YieldOriginalFactor") Then dblYieldQtyOrig = row("YieldOriginalFactor") 'JTOC 31.05.2013


            Dim strYieldUnitNameOrig As String = ""
            If row.Table.Columns.Contains("YieldUnitOriginalName") Then strYieldUnitNameOrig = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 'JTOC 31.05.2013
            '---


            If G_Options.QtyType = 0 Then
                strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strNumberOfServings = strNumberOfServings & "/" &
                     fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
                    'fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            Else
                strNumberOfServings = fctConvertToFraction(CDbl(dblYieldQty)) & " " & strYieldName
                ' strNumberOfServings = fctConvertToFraction(CType(row("Yield")) & " " & strYieldName)
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    'If G_ReportOptions.blnUseFractions Then
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & _
                    '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'Else
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    CType(row("Yield2"), Double) & " " & _
                    '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'End If
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction(CType(row("Yield2"), Double)) & " " & strYieldUnitNameOrig
                    ' fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)

                    strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            End If
            xrRecipeMenuRow.Dispose()

            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
            ' RDC 09.09.2013 :  CWM-8307 Fix
            strServings = strServings.Replace("[_]", "").Replace("N/A", "").Replace("n/a", "")
            ' 
            xrRecipeMenuRow = New XRTableRow
            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.For_), ": " & strServings}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

            .Detail.Controls.Add(xrRecipeMenuInfo)
            intNewY += (xrRecipeMenuInfo.Height + 20)




            '' RDC 08.29.2013 : Code Enhancement
            '' Ingredient Header

            Dim xrIngredientHeader As New XRTable
            Dim xrIngredientHRow As New XRTableRow
            Dim xrIngredientCell As New XRTableCell

            Dim intExcessSpace As Integer = 0

            xrIngredientHeader.Location = New Point(intNewX, intNewY - 12) 'KMQDC 11.26.2015 original no -12
            xrIngredientHeader.Width = intAvailableWidth
            xrIngredientHeader.Borders = DevExpress.XtraPrinting.BorderSide.Top + DevExpress.XtraPrinting.BorderSide.Bottom
            xrIngredientHeader.BorderWidth = 1S

            If G_ReportOptions.blnIncludeHighlightSection Then
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.LightGray
            Else
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.White
            End If

            xrIngredientHRow.Height = CInt(40)

            Dim strNumberHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Number)
            Dim strMerchHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Product)
            Dim strWastePctHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
            Dim strPriceHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Price)
            Dim strNetQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
            Dim strGrossQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
            Dim strAmountHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Amount)

            ' Recipe / Menu number
            If G_ReportOptions.blnIncludeIngrNumber Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNumberHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(50)
            End If

            ' Merchandise / Ingredients

            xrIngredientCell = New XRTableCell
            xrIngredientCell.Width = CInt(160)
            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            xrIngredientCell.Text = strMerchHeader
            xrIngredientHRow.Cells.Add(xrIngredientCell)



            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Waste Percentage
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strWastePctHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)

                ' Price
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strPriceHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            ' Net Quantity
            If G_ReportOptions.blnIncludeNetQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNetQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If

            ' Gross Quantity
            If G_ReportOptions.blnIncludeGrossQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strGrossQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If
            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Amount
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strAmountHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngredientHRow.Cells(0).Width += intExcessSpace Else xrIngredientHRow.Cells(1).Width += intExcessSpace

            xrIngredientHeader.Rows.Add(xrIngredientHRow)
            .Detail.Controls.Add(xrIngredientHeader)

            intNewY += (xrIngredientHeader.Height + 5)

            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            Dim xrIngrInfo As New XRTable
            Dim xrIngrRow As New XRTableRow
            Dim xrIngrCell As New XRTableCell
            xrIngrInfo.Width = intAvailableWidth
            xrIngrInfo.Location = New Point(intNewX, intNewY)

            Dim newdvIng As New DataView(dtIngredients)

            newdvIng.Sort = "step asc"
            newdvIng.RowFilter = "CodeMain=" & row("Code") & " AND ID =" & row("ID") 'MKAM 2015.07.02

            Dim NewDtTable As New DataTable
            NewDtTable = newdvIng.ToTable()

            For Each drIngredient As DataRow In NewDtTable.Rows

                ' For Each drIngredient As DataRow In dtIngredients.Select("CodeMain=" & row("Code")) 'AGL 2013.11.06 - 9372 - added filter
                xrIngrRow = New XRTableRow
                xrIngrRow.Width = xrIngrInfo.Width
                xrIngrRow.Height = G_ReportOptions.sgFontSize2

                Dim strIngrFormat As String = fctNullToString(drIngredient("ItemFormat"))
                If strIngrFormat = "" Then strIngrFormat = "#,###.00"

                Dim fntFontType As FontStyle = FontStyle.Regular
                Select Case CIntDB(drIngredient("ItemType"))
                    Case ID_Recipe
                        fntFontType = FontStyle.Italic
                    Case Else

                End Select

                ' Item Number
                If G_ReportOptions.blnIncludeIngrNumber Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(50)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                    If IsDBNull(drIngredient("ItemNumber")) Then xrIngrCell.Text = "" Else xrIngrCell.Text = drIngredient("ItemNumber")
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                ' Item Name
                Dim strIngrComple As String = "", strIngrName As String = ""

                If CInt(drIngredient("ItemType")) = 0 Then
                    strIngrComple = drIngredient("tmpComplement").ToString
                    strIngrName = drIngredient("tmpName").ToString
                Else
                    strIngrComple = fctGetTranslatedText(drIngredient, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    strIngrName = fctGetTranslatedText(drIngredient, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)
                End If

                Dim xrRText As New XRRichText
                Dim RText As New RichTextBox

                If CBoolDB(drIngredient("isBrandedIngredient")) Then
                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                Else
                    Try
                        RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    Catch ex As Exception
                        RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                End If
                RText.SelectedText = strIngrName & " "
                Try
                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                Catch ex As Exception
                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                End Try
                If G_ReportOptions.blnIncludeIngredientComplement Then strIngrComple = strIngrComple.Trim & " " Else strIngrComple = ""
                'RText.SelectedText = strIngrComple

                xrRText.Rtf = RText.Rtf
                xrRText.Width = CInt(160)

                xrIngrCell = New XRTableCell
                xrIngrCell.Width = CInt(160)
                Try
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                Catch ex As Exception
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                End Try
                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                xrIngrCell.Controls.Add(xrRText)
                xrIngrRow.Cells.Add(xrIngrCell)
                Dim strIngrUnitPrice As String = ""
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Wastage Percentage
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(50)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    If Not drIngredient("ItemType") = 0 Then
                        If CDblDB(drIngredient("TotalWastage")) > 0 Then xrIngrCell.Text = drIngredient("TotalWastage").ToString Else xrIngrCell.Text = ""
                    Else
                        xrIngrCell.Text = ""
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                ' Price
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = CStrDB(drIngredient("tmpUnit")) Else strIngrUnitPrice = " / " & CStrDB(drIngredient("PriceUnit"))
                    If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                    Dim dblIngrPrice As Double = CDblDB(drIngredient("ItemPrice"))

                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblIngrPrice, G_strPriceFormat) & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else

                        xrIngrCell.Text = Format(dblIngrPrice, strPriceFormat) & strIngrUnitPrice
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                'start LLG 10.20.2015 commented and replace Net QTY,Gross QTY and Amount'
                ' Net Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeNetQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = "" 
                    'End If
                    'bragadigdig
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("NetQuantity")) & " " & strIngrUnitPrice
                        Else
                            xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                ' Gross Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeGrossQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("GrossQuantity")) & " " & strIngrUnitPrice
                        Else
                            xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Amount
                    Dim dblAmount As Double

                    If drIngredient("PriceUnit").ToString = drIngredient("itemUnit").ToString Then
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("GrossQuantity"))
                    Else
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("unitFactor")) * CDblDB(drIngredient("GrossQuantity"))
                    End If
                    dblTotal += dblAmount



                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight


                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblAmount, G_strPriceFormat)
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        xrIngrCell.Text = Format(dblAmount, strPriceFormat)
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                If intExcessSpace > 0 Then
                    If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngrRow.Cells(0).Width += intExcessSpace Else xrIngrRow.Cells(1).Width += intExcessSpace
                End If
                xrIngrInfo.Rows.Add(xrIngrRow)
            Next
            NewDtTable.Dispose()
            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            .Detail.Controls.Add(xrIngrInfo)
            intNewY += (xrIngrInfo.Height + 5)

            'xrIngrInfo.Dispose()
            'xrIngrRow.Dispose()
            'xrIngrCell.Dispose()

            If G_ReportOptions.blnIncludeCostOfGoods Then
                dblPercent = CType(row("DishPercent"), Double) / 100
                dblYieldQty = CType(row("Yield"), Double)
                'dblTotal = 0
                dblPrice = 0
                Dim borderSideText As DevExpress.XtraPrinting.BorderSide = GetLabelBorderSide()
                For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
                    CurRate = 0
                    If Not IsDBNull(foundDetails(rowIng)("Rate")) Then CurRate = CType(foundDetails(rowIng)("Rate"), Double)
                    dblUnitFactor = 0
                    If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double)

                    If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
                        dblWastage = 100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100
                        dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
                    End If
                    If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)
                    If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)
                    If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)
                    dblWastage = (100 - dblWastage)
                    dblPrice = 0
                    dblFactor = 1
                    If Not IsDBNull(foundDetails(rowIng)("Factor")) Then dblFactor = CType(foundDetails(rowIng)("Factor"), Double)
                    If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblPrice = CType(foundDetails(rowIng)("ItemPrice"), Double) * CurRate * dblFactor
                    If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then dblQuantityNet = CType(foundDetails(rowIng)("Quantity"), Double)


                    dblQuantityBrut = dblQuantityNet / (1 - (dblWastage / 100))

                    dblPrice = (dblQuantityBrut * dblPrice * dblUnitFactor)

                    'dblTotal += dblPrice

                Next
                ''-------------------------------------------
                'dblTotal = 0
                dblTotalLaborCost = 0
                If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double)
                dblCoefficientBelvoir = 0
                If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double)


                'Cost of Goods

                Dim dblMerchandiseCost As Double
                Dim dblPriceTax As Double
                Dim dblImposedPriceTax As Double
                Dim dblImposedPriceNoTax As Double
                Dim dblImposedCoeff As Double
                Dim dblSellingPriceYield As Double

                'AGL 2013.11.04 - 9277 START - commented this portion, duplicate costing appearing on report ===========================================================
                intNewX = 0
                intNewY += 10
                'sf = New StringFormat(StringFormatFlags.DirectionVertical)
                strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
                L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


                strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
                L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                L_lngCol(3) = (L_lngCol(1) / 2)

                L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

                'Dim intNumberOfRows As Integer = 4
                Dim intCurY As Integer
                'Dim intCurX As Integer
                'If dblTaxValue <> 0 Then intNumberOfRows = 8

                intCurY = intNewY
                intNewY += GetLineSpace(intTextHeight) - 10 'KMQDC 11.26.2015 original no -10
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 1


                If Not G_ReportOptions.bFoodcostOnly Then
                    Select Case G_Options.FactorType
                        'Selling Price/const
                        Case 0
                            dblCoefficient = Format(dblCoefficient, "Standard")
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
                        Case 1
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
                            strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
                        Case 2
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
                            strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
                    End Select
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewY += GetLineSpace(intTextHeight)
                    'anm noted 2


                    dblMerchandiseCost = 0
                    If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

                    If dblTaxValue <> 0 Then
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            'dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
                        strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 3

                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 4
                        Select Case G_Options.FactorType
                            'Imposed selling price/const
                            Case 0
                                strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                            Case 1
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                            Case 2
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 5
                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
                        strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 6
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 7
                    Else
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            ' dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        Select Case G_Options.FactorType
                            Case 0
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                            Case 1
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                            Case 2
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 8
                    End If


                    intNewX = 0

                End If

                'AGL 2013.11.04 - 9277 END===========================================================

                'Per X Yield
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)
                'AGL 2013.11.04
                subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)
                '  subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)

                intNewX = 0
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3)
                dblMerchandiseCost = 0
                If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
                dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
                'Per 1 yield
                'AGL 2013.11.04
                subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice / dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)
                ' subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)

                Dim dblRatioYield1Yield2 As Double
                Dim dblSellingPriceSubRecipe As Double
                If blnSubRecipeComputation Then
                    dblRatioYield1Yield2 = 0
                    dblMerchandiseCost = 0
                    If dblYield2 <> 0 Then
                        dblRatioYield1Yield2 = dblYieldQty / dblYield2
                        dblMerchandiseCost = dblTotal / dblYield2
                    End If

                    dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
                    dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

                    'per 1 Subrecipe Unit
                    subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit, strPriceFormat)
                End If
            End If


            intNewX = 0
            intNewY += GetLineSpace(intTextHeight)
            'anm noted 9

            'str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007

            '------------------------------------------------------


            'intNewY += 20
            ' RDC force table to be plotted in X:0
            'PREPARATION
            intNewX = 0
            Dim xrStepTable As New XRTable
            Dim xrStepRow As New XRTableRow
            Dim xrStepCell As New XRTableCell
            Dim xrStepCellB As New XRTableCell

            xrStepTable.Location = New Point(intNewX, intNewY)
            xrStepTable.Width = intAvailableWidth
            xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None

            For Each drStep As DataRow In dtListePreparation.Select("Codeliste=" & CIntDB(row("Code")))
                ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                Dim rtb As New RichTextBox
                rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                Dim xrt As New XRRichText
                xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                If Not G_ReportOptions.blnMode Then
                    If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(drStep("Note").ToString) Else rtb.AppendText(Chr(32))
                Else
                    If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
                End If

                xrt.Rtf = rtb.Rtf

                xrStepRow = New XRTableRow
                xrStepRow.Height = G_ReportOptions.sgFontSize2

                If G_ReportOptions.blnIncludePreparation Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout


                    Select Case row("MethodFormat").ToString.Trim.ToLower
                        Case "x", "" ' Not bulleted / numbered
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth
                            rtb.Width = intAvailableWidth
                            xrt.Width = intAvailableWidth


                            'xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            'xrStepRow.Cells.Add(xrStepCell)
                            Dim onceCount As Integer = 0
                            'anm
                            ' Dim currentHeight As New Integer
                            '  currentHeight = intNewY
                            Dim x As Integer = rtb.Lines.Count
                            Dim countTo3 As Integer = 0
                            Dim addToName As Integer = 0
                            Dim curY = intNewY + 10
                            Dim newLoop As Boolean = False
                            Dim rtbNew As New RichTextBox
                            'Dim aslow As String = rtbNew.Rtf.ToString()
                            Dim xrts As New XRRichText
                            Dim xrNewStepTable As New XRTable
                            Dim textLeftCount As Integer = rtb.Lines.Count Mod 3
                            Dim lineCountLeft As Integer = rtb.Lines.Count - textLeftCount
                            Dim LineCounter As Integer
                            For Each Line As String In rtb.Lines
                                countTo3 += 1
                                LineCounter += 1
                                If Line = "" Then
                                    rtbNew.AppendText(Environment.NewLine)
                                Else
                                    If countTo3 = 1 Then
                                        rtbNew.AppendText(Line)
                                    Else
                                        rtbNew.AppendText(Line + Environment.NewLine)
                                    End If
                                End If
                                xrts.Rtf = rtbNew.Rtf

                                If countTo3 = 1 Then
                                    countTo3 = 0
                                    xrts.Width = intAvailableWidth
                                    xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                                    xrts.CanShrink = True
                                    xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrts.KeepTogether = True
                                    xrts.Location = New Point(intNewX, curY)
                                    .Detail.Controls.AddRange(New XRControl() {xrts})
                                    curY += (xrts.Height)
                                    rtbNew = New RichTextBox
                                    xrts = New XRRichText
                                    xrNewStepTable = New XRTable
                                End If
                            Next
                            intNewY = curY

                        Case "n" ' Number bullet
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = drStep("Position") & "."
                            End If
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                        Case "b" ' Symbol bullet "•"
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = "•"
                            End If
                            xrStepRow.Cells.Add(xrStepCell)

                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                    End Select
                    'xrStepTable.Rows.Add(xrStepRow) 'anm
                End If
            Next

            If G_ReportOptions.blnIncludePreparation Then
                intNewY = intNewY + 90
            Else
                intNewY = intNewY + 90
            End If



            Dim strServeWithNotes As String = Nothing
            Dim strFootnote1 As String = Nothing
            Dim strFootnote2 As String = Nothing

            For Each rwRecipeNotes As DataRow In G_ReportOptions.dtNotes.Select("Code=" & intRecipeCode)
                strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
                strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
                strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
            Next

            Dim xrNotesTable As New XRTable
            Dim xrNotesRow As New XRTableRow
            Dim xrNotesCell As New XRTableCell

            If G_ReportOptions.blnIncludeNotes Then
                ' Notes
                If strFootnote1.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote1.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.CanGrow = True
                    xrNotes2Cell.WordWrap = True
                    xrNotes2Cell.CanShrink = True
                    xrNotes2Cell.Multiline = True
                    xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)

                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                End If

            End If

            If G_ReportOptions.blnIncludeAddNotes Then
                ' Additional Notes
                If strFootnote2.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote2.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.Height = 500
                    xrNotes2Cell.CanShrink = False
                    xrNotes2Cell.CanGrow = False
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)
                    xrNotesTable.CanShrink = True
                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)

                End If
            End If

            If G_ReportOptions.blnIncludeHACCP Then
                '  subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001")
                'subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strStoringTemp, strStoringTime, strCCPdescription, strHACCP, "001")
                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                End With
                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001", strStoringTime, strStoringTemp, strHACCP)
                intNewY += intTextHeight
                'anm noted 10
            End If

            '---JRN 17.03.2010
            'For keywords
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then

                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                    'xrSectionHeaderTable.Dispose()
                End With

                subDisplayKeywords(foundKeywords, "001")
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 11
            End If

            '   Kiosk
            If G_ReportOptions.blnIncludeKiosk And Not G_ReportOptions.dtKiosk Is Nothing Then
                If G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode).Count > 0 Then
                    Dim xrKioskTable As New XRTable
                    Dim xrKioskRows As New XRTableRow

                    xrKioskTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Kiosk), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += xrKioskTable.Height + 10

                    xrKioskTable = New XRTable
                    xrKioskTable.Width = intAvailableWidth
                    xrKioskTable.Location = New Point(intNewX, intNewY)

                    For Each drKioskRows As DataRow In G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode)
                        'AGL 2013.08.22 - added checking for blank dates
                        If CStrDB(drKioskRows("BrandSiteDateFrom")) = "" Or CStrDB(drKioskRows("BrandSiteDateTo")) = "" Then
                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                        Else
                            ' RDC 08.14.2013 : Do not display date if date is equal to 01/01/1900
                            If CDate(drKioskRows("BrandSiteDateFrom")).Year = 1900 And CDate(drKioskRows("BrandSiteDateTo")).Year = 1900 Then
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            Else
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim & " " & Format(CDate(drKioskRows("BrandSiteDateFrom")), "MM/dd/yyyy") & " - " & Format(CDate(drKioskRows("BrandSiteDateTo")), "MM/dd/yyyy")}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            End If
                        End If

                    Next
                    xrKioskTable.Rows.Add(xrKioskRows)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += (xrKioskTable.Height + 20)
                End If
            End If

            ' RDC 02.22.2013
            ' Brands 
            If G_ReportOptions.blnIncludeBrand Then
                If G_ReportOptions.dtBrands.Select("RecipeCode= " & intRecipeCode).Count > 0 Then
                    Dim xrBrandTable As New XRTable
                    Dim xrBrandRow As New XRTableRow
                    Dim xrBrandCell As New XRTableCell

                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        If .blnIncludeHighlightSection Then
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.LightGray
                            xrBrandTable.BorderColor = Color.Black
                        Else
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.White
                            xrBrandTable.BorderColor = Color.Black
                        End If

                        xrBrandRow.Height = .sgFontSize2
                        xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                        xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                        xrBrandCell.Text = cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim
                        xrBrandRow.Cells.Add(xrBrandCell)
                        xrBrandTable.Rows.Add(xrBrandRow)

                    End With
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 10)

                    xrBrandTable = New XRTable
                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    Dim cLangData As New clsLanguage(enumAppType.WebApp, G_strConnection)
                    Dim cLangFromCodeTrans As New clsEGSLanguage(cLangData.GetCodeLang(G_ReportOptions.intTranslation))
                    Dim strBrandClassification As String = ""

                    For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
                        With G_ReportOptions
                            xrBrandRow = New XRTableRow
                            xrBrandRow.Height = .sgFontSize2
                            xrBrandCell = New XRTableCell
                            xrBrandCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Regular)
                            xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft

                            If drBrand("BrandClass").ToString.ToLower = "primary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173883)
                            ElseIf drBrand("BrandClass").ToString.ToLower = "secondary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173884)
                            Else
                                strBrandClassification = drBrand("BrandClass").ToString
                            End If
                            xrBrandCell.Text = drBrand("Brand").ToString & " ~ " & strBrandClassification
                            xrBrandRow.Cells.Add(xrBrandCell)
                            xrBrandTable.Rows.Add(xrBrandRow)
                        End With
                    Next
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 20)

                End If
            End If
            'Publications
            If G_ReportOptions.blnIncludePublication AndAlso G_ReportOptions.dtPublications IsNot Nothing Then
                If G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode).Count > 0 Then

                    Dim xrPublicationTable As New XRTable
                    Dim xrPublicationRow As New XRTableRow
                    Dim xrPublicationCell As New XRTableCell

                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.LightGray
                        xrPublicationTable.BorderColor = Color.Black
                    Else
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.White
                        xrPublicationTable.BorderColor = Color.Black
                    End If

                    xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                    xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrPublicationCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim
                    xrPublicationRow.Cells.Add(xrPublicationCell)
                    xrPublicationTable.Rows.Add(xrPublicationRow)

                    .Detail.Controls.Add(xrPublicationTable)

                    intNewY += (xrPublicationTable.Height + 10)

                    xrPublicationTable = New XRTable
                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                        xrPublicationRow = New XRTableRow
                        xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                        xrPublicationCell = New XRTableCell
                        xrPublicationCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                        ' xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim
                        xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & fctConvertDate(CType(drPublication("PlacementDate"), Date))
                        xrPublicationRow.Cells.Add(xrPublicationCell)
                        xrPublicationTable.Rows.Add(xrPublicationRow)
                    Next

                    .Detail.Controls.Add(xrPublicationTable)
                    intNewY += (xrPublicationTable.Height + 20)

                    'For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                    '    intTextHeight = ReportingTextUtils.MeasureText(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '    intNewY += intTextHeight
                    'Next
                    '' RDC 04.27.2013 - CMW-5630 Fix
                    'intNewY += 20
                End If
            End If

            ' End

            If G_ReportOptions.blnIncludeNutrients Then
                subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001")
                intNewY += GetLineSpace(intTextHeight)
            End If

            ' RDC 09.05.2013 : Nutrient enhancement
            Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
            Dim intSelCodeTrans As Integer = 0
            Dim intCodeSetDisplay As Integer = 0
            For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
                intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
                intSelCodeTrans = CInt(drDispSet("codeTrans"))
                intCodeSetDisplay = CInt(drDispSet("CodeSet"))
            Next

            intNewY += 20
            If G_ReportOptions.blnIncludeNutrients Then
                ' Section Header
                Dim xrNutHeader As New XRTable
                xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutrientInformation), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrNutHeader)

                intNewY += (xrNutHeader.Height + 10)

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSetDisplay, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice)

                intNewY += 20
            End If


            'GDA
            If G_ReportOptions.blnIncludeGDA Then

                Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                Detail.Controls.Add(xrGDAHeader)
                intNewY += (xrGDAHeader.Height) + 10

                subDisplayGDAComputation(CInt(row("Code")), intCodeSetDisplay, intSelCodeTrans, CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice")))
                ' ''    subDisplayNutrientsGDA(strYieldName, _
                ' ''        dblNutrientFactor, L_Nutrient, "001")
                ' ''    intNewY += GetLineSpace(intTextHeight)
            End If

            '- Cookbook
            ' If enumPrintOptions.RecipeCosting Then
            If G_ReportOptions.blnIncludeCookbook And Not G_ReportOptions.dtCookbook Is Nothing Then
                If G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCookbookTable As New XRTable
                    Dim xrCookbookRow As New XRTableRow

                    xrCookbookTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Cookbook), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 10)

                    xrCookbookTable = New XRTable
                    xrCookbookTable.Width = intAvailableWidth
                    xrCookbookTable.Location = New Point(intNewX, intNewY)

                    For Each drCookbookRow As DataRow In G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode)
                        xrCookbookRow = fctMakeDataRow({drCookbookRow("Name").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCookbookTable.Rows.Add(xrCookbookRow)
                    Next
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 20)
                End If
            End If
            ' End If
            '---
            'Comments
            If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
                If G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCommentTable As New XRTable
                    Dim xrCommentRow As New XRTableRow

                    xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 10)

                    xrCommentTable = New XRTable
                    xrCommentTable.Width = intAvailableWidth
                    xrCommentTable.Location = New Point(intNewX, intNewY)

                    For Each drComment As DataRow In G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode)
                        xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCommentTable.Rows.Add(xrCommentRow)
                    Next
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 20)

                End If
            End If

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then


                intNewY -= 15
                '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                '  subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", , , strConn, row("Code"))
                Dim blnManor As Boolean = False
                Dim strStyle As String = "003"
                If blnManor = False Then
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    With Me
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                        Select Case strStyle

                            Case "001", "002", "003"
                                Dim xrAllergensTable As New XRTable
                                Dim xrAllergensRow As New XRTableRow
                                Dim xrAllergensCell As New XRTableCell

                                xrAllergensTable.Width = intAvailableWidth
                                xrAllergensTable.Location = New Point(intNewX, intNewY)

                                If G_ReportOptions.blnIncludeHighlightSection Then
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.LightGray
                                    xrAllergensTable.BorderColor = Color.Black
                                Else
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.White
                                    xrAllergensTable.BorderColor = Color.Black
                                End If

                                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrAllergensCell.Text = strX.Trim
                                xrAllergensRow.Cells.Add(xrAllergensCell)
                                xrAllergensTable.Rows.Add(xrAllergensRow)

                                .Detail.Controls.Add(xrAllergensTable)

                                intNewX += (xrAllergensTable.Height + 10)

                                ' RDC 05.15.2013 - Removed.
                                'Case "002"  'Modern
                                '    intNewY += 10
                                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                                'Case "003"
                                '    intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                '  xrAllergensTable.Dispose()
                                '  xrAllergensRow.Dispose()
                                '  xrAllergensCell.Dispose()

                            Case "003Menu"
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                            Case "004" 'Merchandise Details
                                intNewY += 30

                                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                            Case Else
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End Select


                        intNewY += intTextHeight + 10
                    End With
                Else
                    intNewY += GetLineSpace(intTextHeight)
                End If
                'intNewY += GetLineSpace(intTextHeight)
                'anm noted 12
                Dim row1 As DataRow = foundDetails(0) 'KMQDC 11.24.2015

                Dim CodeAllergenTranslation As Integer
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)


                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", False, False, strConn, CodeAllergenTranslation)
            End If
            'End of Allergens

            intNewX = 0
            intNewY = intNewY + 30
            ' composition
            If G_ReportOptions.blnIncludeComposition Then
                Dim xrCompositionTable As New XRTable
                Dim xrCompositionRow As New XRTableRow
                Dim xrCompositionCell As New XRTableCell

                If G_ReportOptions.blnIncludeAllergens And G_ReportOptions.intfoodLaw = 3 Then
                    intNewY += CInt(GetLineSpace(intTextHeight))
                End If

                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    If .blnIncludeHighlightSection Then
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.LightGray
                        xrCompositionTable.BorderColor = Color.Black
                    Else
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.White
                        xrCompositionTable.BorderColor = Color.Black
                    End If

                    xrCompositionRow.Height = .sgFontSize2
                    xrCompositionCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                    xrCompositionCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                    xrCompositionCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Composition).Trim
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    xrCompositionTable.Rows.Add(xrCompositionRow)

                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 10)

                xrCompositionTable = New XRTable
                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    xrCompositionRow = New XRTableRow
                    '   xrCompositionRow.Height = .sgFontSize
                    xrCompositionTable.Width = intAvailableWidth
                    xrCompositionCell = New XRTableCell

                    '--------------keen dela cruz
                    Dim str As String = row("Composition").ToString
                    str = str.Replace("<b>", "\b ")
                    str = str.Replace("</b>", "\b0")
                    str = str.Replace("<p>", "")
                    str = str.Replace("</p>", "")
                    str = str.Replace("<br>", "")
                    str = str.Replace("<i>", "\i ")
                    str = str.Replace("</i>", "\i0")
                    str = str.Replace("{", "")
                    str = str.Replace("}", "")
                    str = str.Replace("<div>", "\line \div ")
                    str = str.Replace("</div>", "\line \div0 ")
                    Dim strhtml As String = ParseHtmlToRTF(str)  'LLG 05.16.2016 for lepause issue
                    Dim ss As String = row("Composition").ToString
                    Dim XrRichText1 As New XRRichText
                    XrRichText1.Width = 630
                    XrRichText1.CanGrow = True
                    XrRichText1.CanShrink = True
                    XrRichText1.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    XrRichText1.Rtf = strhtml
                    xrCompositionCell.Controls.Add(XrRichText1)
                    ' OLD (causes NullReference when the row has 0 cells):
                    ' xrCompositionRow.InsertCell(xrCompositionCell, 1)

                    ' NEW (safe): just add the cell (or InsertCell at index 0)
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    ' Or: xrCompositionRow.InsertCell(xrCompositionCell, 0, False)

                    xrCompositionTable.Rows.Add(xrCompositionRow)
                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 20)
                'Me.Detail.Controls.Add(fctMakeXRLabel(row("Composition"), fntRegular, 0, intNewY, intAvailableWidth, 100, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.None, True))
            End If

            intNewY = intNewY + 30

            Dim dblMaxWidthPicture As Double
            Dim dblMaxHeightPicture As Double
            intNewX = 0
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                dblMaxHeightPicture = 250
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If


            'For j As Integer = 0 To 2
            '    strPicture(j) = ""
            '    strPicture(j) = fctGetPictureName(str3Pictures, j)
            'Next

            If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            Dim strFileName As String


            ''---GDA Image JRN 06.07.2010
            If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
                Dim bShowGDAImage As Boolean = False
                For Each arr As tNutrient In G_Nutrient
                    If CDblDB(arr.GDA) > 0 Then
                        bShowGDAImage = True
                        Exit For
                    End If
                Next
                If bShowGDAImage Then
                    G_ReportOptions.blnIncludeGDA = False
                    Dim intGDAPanelHeight = 70
                    Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                    Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                    Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                    .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
                End If
            End If

            '---

            '--- VRP 07.11.2007
            If G_ReportOptions.blnPicturesAll = True Then
                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To UBound(arrPicture)
                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                        End If
                        intNewX += CInt(G_dblMaxWidthPicture) + 5
                    Next
                    intNewY += CInt(G_dblMaxHeightPicture)
                    'anm noted 10
                End If
                intNewY += 10
                intNewX = 0
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += G_dblMaxWidthPicture + 20
                            'intCurY = intNewY
                        Else
                            For j As Integer = 0 To UBound(arrPicture)
                                If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                    strFileName = G_strPhotoPath & arrPicture(j)
                                    .Detail.Controls.AddRange(New XRControl() _
                                     {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                    intNewX += G_dblMaxWidthPicture + 20
                                    'intCurY = intNewY
                                    Exit For
                                End If
                            Next
                        End If

                    End If
                End If
            End If
            '--------
        End With
        Return Me
    End Function
    'Function fctPrintRecipeCostingEGSStandard(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow, _
    '                                           ByVal foundAllergens() As DataRow, ByVal dtIngredients As DataTable, Optional ByVal dtListePreparation As DataTable = Nothing, Optional strConn As String = "", Optional ByVal CodeUser As Integer = 0) As XtraReport

    '    '483 height to manage
    '    Dim fntFont As Font
    '    Dim intRecipeCode As Long
    '    Dim intDictionary As Integer
    '    Dim L_CurrencyName As String
    '    Dim dblCoefficient As Double
    '    Dim dblTaxValue As Double
    '    Dim dblImposedPrice As Double
    '    Dim strName As String
    '    Dim strPortionUnit2Format As String
    '    Dim strCategoryName As String
    '    Dim strNumber As String
    '    Dim strSourceName As String = Nothing
    '    Dim strRemarks As String
    '    Dim strDate As String = Nothing
    '    Dim strPreparation As String = ""
    '    Dim strCoolingTime As String = ""
    '    Dim strHeatingTime As String = ""
    '    Dim strHeatingTemperature As String = ""
    '    Dim strHeatingMode As String = ""
    '    Dim strCCPdescription As String = ""
    '    Dim strStoringTemp As String = "" 'VRP 21.08.2008"
    '    Dim strStoringTime As String = "" 'VRP 21.08.2008
    '    Dim strHACCP As String = ""
    '    Dim strRecipeName As String
    '    Dim strServings As String
    '    Dim strYieldName As String
    '    Dim strNumberOfServings As String
    '    Dim strSubRecipeUnit As String
    '    Dim dblPercent As Double
    '    Dim dblYieldQty As Double
    '    Dim dblTotal As Double
    '    Dim dblPrice As Double
    '    Dim CurRate As Double
    '    Dim dblUnitFactor As Double
    '    Dim dblWastage As Double
    '    Dim dblFactor As Double
    '    Dim dblQuantityNet As Double
    '    Dim strQuantityNet As String = "0"
    '    Dim strUnit As String
    '    'Dim strUnitFormat As String
    '    Dim dblQuantityBrut As Double
    '    Dim strQuantityBrut As String = "0"
    '    Dim dblTotalLaborCost As Double
    '    Dim dblCoefficientBelvoir As Double
    '    Dim dblItemPrice As Double
    '    Dim strNetQty As String
    '    Dim strGrossQty As String
    '    Dim strDisplayUnit As String
    '    Dim lngDisplayUnit As Long
    '    Dim strPriceFormat As String

    '    Dim lngKiloCode As Long
    '    Dim lngLiterCode As Long
    '    'Dim str3Pictures As String = Nothing
    '    'Dim strPicture(0 To 2) As String
    '    Dim strPictureAll As String = "" 'VRP 07.11.2007

    '    Dim intAvailableWidth As Integer
    '    Dim intSpace As Integer
    '    Dim strX As String

    '    Dim dblYield2 As Double
    '    Dim blnSubRecipeComputation As Boolean = False

    '    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '    fctPrintRecipeCostingEGSStandard = Nothing

    '    sf = New StringFormat(StringFormatFlags.NoClip)

    '    Dim arrNutrientName As New ArrayList
    '    For Each tNut As tNutrient In G_Nutrient
    '        arrNutrientName.Add(tNut.Name)
    '    Next

    '    Try
    '        'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
    '        'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
    '        'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
    '        'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

    '        If G_ReportOptions.blnPictureOneRight Then
    '            fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
    '        Else
    '            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
    '        End If

    '        'SM 2015.05.15 added try catch for font that does not support regular fontstyle
    '        Try
    '            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '        Catch ex As Exception
    '            'fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try

    '        'SM 2015.05.15 added try catch for font that does not support bold fontstyle
    '        Try
    '            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        Catch ex As Exception
    '            ' fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try

    '        'SM 2015.05.15 added try catch for font that does not support Italic fontstyle
    '        Try
    '            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
    '        Catch ex As Exception
    '            ' fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try
    '    Catch ex As Exception

    '        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '        Return Me
    '    End Try

    '    If foundDetails.Length <= 0 Then
    '        Exit Function
    '    End If

    '    ReDim L_lngCol(0 To 12)

    '    Dim row As DataRow = foundDetails(0)
    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        'fctGetNutrientDetails()
    '        fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
    '    End If

    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        dblNutrientFactor = GetNutrientFactor(CInt(row("Code")))
    '    End If

    '    intDictionary = G_Language
    '    If G_ReportOptions.intTranslation > 0 Then
    '        intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
    '    End If
    '    G_Language = intDictionary

    '    strPriceFormat = CType(CStrDB(row("curFormat")), String)
    '    L_CurrencyName = CType(CStrDB(row("Currency")), String)
    '    dblCoefficient = CType(CDblDB(row("coeff")), Double)
    '    dblTaxValue = CType(CDblDB(row("TaxValue")), Double)
    '    dblImposedPrice = CType(CDblDB(row("ImposedPrice")), Double)
    '    strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
    '    strPortionUnit2Format = G_FormatOneDecimal
    '    If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(CStrDB(row("PortionUnit2Format")), String)
    '    strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
    '    strNumber = fctNumber2Text(Trim(CType(CStrDB(row("RecipeNumber")), String)))
    '    intRecipeCode = row("Code")
    '    If CType(CIntDB(row("codesource")), Integer) = 0 Then
    '        strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
    '    Else
    '        strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
    '    End If

    '    strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
    '    If Not IsDBNull(row("Dates")) Then strDate = CType(CStrDB(row("Dates")), String)

    '    strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

    '    'If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(CType(CStrDB(row("CoolingTime")), String))
    '    'If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(CType(CStrDB(row("HeatingTime")), String))
    '    'If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(CType(CStrDB(row("HeatingTemperature")), String))
    '    'If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(CType(CStrDB(row("HeatingMode")), String))
    '    'strCCPdescription = fctGetTranslatedText(row, "CCPdescription", "CCPdescriptionTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CCPdescription)
    '    'If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(CType(CStrDB(row("HACCP")), String))

    '    If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(row("CoolingTime").ToString)
    '    If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(row("HeatingTime").ToString)
    '    If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(row("HeatingTemperature").ToString)
    '    If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(row("HeatingMode").ToString)
    '    If Not IsDBNull(row("CCPDescription")) Then strCCPdescription = Trim(row("CCPDescription").ToString)
    '    If Not IsDBNull(row("StoringTemp")) Then strStoringTemp = Trim(row("StoringTemp").ToString) 'VRP 21.08.2008
    '    If Not IsDBNull(row("StoringTime")) Then strStoringTime = Trim(row("StoringTime").ToString) 'VRP 21.08.2008
    '    If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(row("HACCP").ToString)


    '    For i As Integer = 1 To 34 '15
    '        L_Nutrient(i).Value = -1
    '    Next


    '    Dim strFieldname As String = Nothing
    '    Dim strFieldnameForPercent As String = Nothing
    '    For i As Integer = 1 To 34 '15
    '        strFieldname = "N" & i.ToString
    '        'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '        strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
    '        If Not IsDBNull(row(strFieldname)) And _
    '           Not IsDBNull(row(strFieldnameForPercent)) Then
    '            If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
    '                L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
    '                G_Nutrient(i).Unit = "%"
    '                L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            Else
    '                L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '                L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            End If
    '        End If
    '    Next

    '    lngKiloCode = fctGetUnitCodeFromType(100)
    '    lngLiterCode = fctGetUnitCodeFromType(200)


    '    Dim intDPic As Integer
    '    If row.Table.Columns.Contains("DefaultPicture") Then
    '        intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
    '    Else
    '        intDPic = 1
    '    End If

    '    If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
    '    Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
    '    '------ 

    '    With Me
    '        'Papersize
    '        '------------
    '        .PaperKind = Printing.PaperKind.Custom
    '        .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

    '        'Margins
    '        '------------
    '        .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
    '        .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
    '        .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
    '        .Margins.Right = CInt(G_ReportOptions.dblRightMargin)



    '        'Orientation
    '        '-----------
    '        If G_ReportOptions.blLandscape Then
    '            .Landscape = True
    '            intAvailableWidth = .PageHeight
    '        Else
    '            .Landscape = False
    '            intAvailableWidth = .PageWidth
    '        End If

    '        intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

    '        'page header
    '        '-------------------------------------------
    '        'brag
    '        intNewX = 0
    '        intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
    '        'strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
    '        strX = " "
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        intNewY += GetLineSpace(intTextHeight)


    '        intNewX = 0
    '        intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

    '        'Recipe Name
    '        strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
    '        'intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        ' .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
    '        'intNewY += GetLineSpace(intTextHeight) + 20

    '        Dim xRecipeName As New XRTable
    '        Dim xRecipeRow As New XRTableRow
    '        Dim xRecipeCell As New XRTableCell
    '        xRecipeName.Location = New System.Drawing.Point(intNewX, intNewY)
    '        xRecipeName.Width = intAvailableWidth

    '        If G_ReportOptions.blnIncludeHighlightSection Then
    '            xRecipeName.BorderWidth = 1
    '            xRecipeName.BackColor = Color.LightGray
    '        Else
    '            xRecipeName.BorderWidth = 1
    '            xRecipeName.BackColor = Color.White
    '        End If

    '        xRecipeRow.Padding = 0
    '        xRecipeRow.Height = CInt(G_ReportOptions.sgFontTitleSize)
    '        xRecipeCell.Text = New String(strRecipeName)
    '        xRecipeCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
    '        If G_ReportOptions.blnIncludeHighlightSection Then xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.None
    '        xRecipeCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '        xRecipeRow.Cells.Add(xRecipeCell)
    '        xRecipeName.Rows.Add(xRecipeRow)

    '        xRecipeName.KeepTogether = False
    '        .PageHeader.Controls.Add(xRecipeName)

    '        'xRecipeName.Dispose()
    '        'xRecipeRow.Dispose()
    '        'xRecipeCell.Dispose()
    '        ''-------------------------------------------

    '        ' RDC 08.29.2013 : Applied enhancements to code
    '        intNewX = 0
    '        intNewY = 20
    '        Dim xrRecipeMenuInfo As New XRTable 'anm first input with table 
    '        xrRecipeMenuInfo.Width = intAvailableWidth
    '        xrRecipeMenuInfo.Location = New Point(intNewX, intNewY)
    '        Dim xrRecipeMenuRow As New XRTableRow
    '        If G_ReportOptions.blnIncludeNumber Then
    '            If G_ReportOptions.blnRecipe Then
    '                ' Recipe #
    '                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

    '            Else
    '                ' Menu #
    '                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Menu_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '            End If
    '            'xrRecipeMenuRow.Dispose()
    '        End If

    '        If G_ReportOptions.blnIncludeCategory Then
    '            ' Category
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category), ": " & strCategoryName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '            'xrRecipeMenuRow.Dispose()
    '        End If

    '        If G_ReportOptions.blnIncludeSource Then
    '            ' Source
    '            ' RDC 09.03.2013 : Change display from NO SOURCE to NOT DEFINED
    '            If strSourceName.ToUpper.Trim = "NO SOURCE" Or strSourceName Is Nothing Or strSourceName.Trim = "" Then strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source), ": " & strSourceName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '            'xrRecipeMenuRow.Dispose()
    '        End If

    '        If G_ReportOptions.blnIncludeDate Then
    '            ' Date
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_), ": " & DirectCast(row("Dates"), DateTime).ToShortDateString()}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '            'xrRecipeMenuRow.Dispose()
    '        End If

    '        If G_ReportOptions.blnIncludeRemark Then
    '            ' Remarks
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark), ": " & strRemarks}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '            ' xrRecipeMenuRow.Dispose()
    '        End If


    '        strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)
    '        'strYieldName = row("itemUnit").ToString

    '        '-- VRP 20.01.2009
    '        dblYieldQty = CType(row("Yield"), Double)
    '        Dim strYieldFormat As String = row("YieldFormat").ToString
    '        Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)

    '        Dim intYieldUnitOriginal As Integer = 0
    '        If row.Table.Columns.Contains("YieldUnitOriginalCode") Then intYieldUnitOriginal = CType(row("YieldUnitOriginalCode"), Integer) 'JTOC 31.05.2013

    '        Dim dblYieldQtyOrig As Double = 0.0
    '        If row.Table.Columns.Contains("YieldOriginalFactor") Then dblYieldQtyOrig = row("YieldOriginalFactor") 'JTOC 31.05.2013


    '        Dim strYieldUnitNameOrig As String = ""
    '        If row.Table.Columns.Contains("YieldUnitOriginalName") Then strYieldUnitNameOrig = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 'JTOC 31.05.2013
    '        '---


    '        If G_Options.QtyType = 0 Then
    '            strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
    '            If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                strNumberOfServings = strNumberOfServings & "/" & _
    '                 fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
    '                'fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                'strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                dblYield2 = CType(row("Yield2"), Double)
    '                'blnSubRecipeComputation = True
    '            End If
    '        Else
    '            strNumberOfServings = fctConvertToFraction(CDbl(dblYieldQty)) & " " & strYieldName
    '            ' strNumberOfServings = fctConvertToFraction(CType(row("Yield")) & " " & strYieldName)
    '            If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                'If G_ReportOptions.blnUseFractions Then
    '                '    strNumberOfServings = strNumberOfServings & "/" & _
    '                '    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & _
    '                '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                'Else
    '                '    strNumberOfServings = strNumberOfServings & "/" & _
    '                '    CType(row("Yield2"), Double) & " " & _
    '                '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                'End If
    '                strNumberOfServings = strNumberOfServings & "/" & _
    '                    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & strYieldUnitNameOrig
    '                ' fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)

    '                strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                dblYield2 = CType(row("Yield2"), Double)
    '                'blnSubRecipeComputation = True
    '            End If
    '        End If
    '        xrRecipeMenuRow.Dispose()

    '        strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
    '        ' RDC 09.09.2013 :  CWM-8307 Fix
    '        strServings = strServings.Replace("[_]", "").Replace("N/A", "").Replace("n/a", "")
    '        ' 
    '        xrRecipeMenuRow = New XRTableRow
    '        xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.For_), ": " & strServings}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '        xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

    '        .Detail.Controls.Add(xrRecipeMenuInfo)
    '        intNewY += (xrRecipeMenuInfo.Height + 20)




    '        '' RDC 08.29.2013 : Code Enhancement
    '        '''''''''''''''''''''''''''
    '        '''' Ingredient Header'''''
    '        '''''''''''''''''''''''''''

    '        Dim xrIngredientHeader As New XRTable
    '        Dim xrIngredientHRow As New XRTableRow
    '        Dim xrIngredientCell As New XRTableCell

    '        Dim intExcessSpace As Integer = 0

    '        xrIngredientHeader.Location = New Point(intNewX, intNewY - 12) 'KMQDC 11.26.2015 original no -12
    '        xrIngredientHeader.Width = intAvailableWidth
    '        xrIngredientHeader.Borders = DevExpress.XtraPrinting.BorderSide.Top + DevExpress.XtraPrinting.BorderSide.Bottom
    '        xrIngredientHeader.BorderWidth = 1S

    '        If G_ReportOptions.blnIncludeHighlightSection Then
    '            xrIngredientHeader.BorderColor = Color.Black
    '            xrIngredientHeader.BackColor = Color.LightGray
    '        Else
    '            xrIngredientHeader.BorderColor = Color.Black
    '            xrIngredientHeader.BackColor = Color.White
    '        End If

    '        xrIngredientHRow.Height = CInt(40)

    '        Dim strNumberHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Number)
    '        Dim strMerchHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Merchandise)
    '        Dim strWastePctHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
    '        Dim strPriceHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Price)
    '        Dim strNetQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
    '        Dim strGrossQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
    '        Dim strAmountHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Amount)

    '        ' Recipe / Ingredient number Column1 in UI
    '        If G_ReportOptions.blnIncludeIngrNumber Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(50)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strNumberHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(50)
    '        End If

    '        ' Merchandise / Ingredients Name Column2 in UI

    '        xrIngredientCell = New XRTableCell
    '        xrIngredientCell.Width = CInt(160)
    '        xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '        xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        xrIngredientCell.Text = strMerchHeader
    '        xrIngredientHRow.Cells.Add(xrIngredientCell)



    '        If G_ReportOptions.blnIncludeCostOfGoods Then
    '            ' Waste Percentage 
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(50)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strWastePctHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)

    '            ' Price 
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strPriceHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        End If
    '        ' Net Quantity
    '        If G_ReportOptions.blnIncludeNetQty Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strNetQtyHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(85)
    '        End If

    '        ' Gross Quantity
    '        If G_ReportOptions.blnIncludeGrossQty Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strGrossQtyHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(85)
    '        End If
    '        If G_ReportOptions.blnIncludeCostOfGoods Then
    '            ' Amount
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strAmountHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        End If
    '        If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngredientHRow.Cells(0).Width += intExcessSpace Else xrIngredientHRow.Cells(1).Width += intExcessSpace

    '        xrIngredientHeader.Rows.Add(xrIngredientHRow)
    '        .Detail.Controls.Add(xrIngredientHeader)

    '        intNewY += (xrIngredientHeader.Height + 5)

    '        'xrIngredientHeader.Dispose()
    '        'xrIngredientHRow.Dispose()
    '        'xrIngredientCell.Dispose()

    '        '''''''''''''''''''''''''''
    '        '''' Ingredient Values'''''
    '        '''''''''''''''''''''''''''
    '        Dim xrIngrInfo As New XRTable
    '        Dim xrIngrRow As New XRTableRow
    '        Dim xrIngrCell As New XRTableCell
    '        xrIngrInfo.Width = intAvailableWidth
    '        xrIngrInfo.Location = New Point(intNewX, intNewY)

    '        Dim newdvIng As New DataView(dtIngredients)

    '        newdvIng.Sort = "step asc"
    '        newdvIng.RowFilter = "CodeMain=" & row("Code") & " AND ID =" & row("ID") 'MKAM 2015.07.02

    '        Dim NewDtTable As New DataTable
    '        NewDtTable = newdvIng.ToTable()
    '        Log.Info("before drIngredient")
    '        For Each drIngredient As DataRow In NewDtTable.Rows
    '            Log.Info("inside for each drIngredient")
    '            ' For Each drIngredient As DataRow In dtIngredients.Select("CodeMain=" & row("Code")) 'AGL 2013.11.06 - 9372 - added filter
    '            xrIngrRow = New XRTableRow
    '            xrIngrRow.Width = xrIngrInfo.Width
    '            xrIngrRow.Height = G_ReportOptions.sgFontSize2

    '            Dim strIngrFormat As String = fctNullToString(drIngredient("ItemFormat"))
    '            If strIngrFormat = "" Then strIngrFormat = "#,###.00"

    '            Dim fntFontType As FontStyle = FontStyle.Regular
    '            Select Case CIntDB(drIngredient("ItemType"))
    '                Case ID_Recipe
    '                    fntFontType = FontStyle.Italic
    '                Case Else

    '            End Select

    '            ' Item Number
    '            If G_ReportOptions.blnIncludeIngrNumber Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(50)
    '                Try
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                Catch ex As Exception
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                If IsDBNull(drIngredient("ItemNumber")) Then xrIngrCell.Text = "" Else xrIngrCell.Text = drIngredient("ItemNumber")
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If


    '            ' Item Name
    '            Dim strIngrComple As String = "", strIngrName As String = ""

    '            If CInt(drIngredient("ItemType")) = 0 Then
    '                strIngrComple = drIngredient("tmpComplement").ToString
    '                strIngrName = drIngredient("tmpName").ToString
    '            Else
    '                strIngrComple = fctGetTranslatedText(drIngredient, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
    '                strIngrName = fctGetTranslatedText(drIngredient, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)
    '            End If

    '            Dim xrRText As New XRRichText
    '            Dim RText As New RichTextBox

    '            Try
    '                If CBoolDB(drIngredient("isBrandedIngredient")) Then
    '                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                Else
    '                    Try
    '                        RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                    Catch ex As Exception
    '                        RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                        Log.Info("Error in Rtext.SelectionFont: " & ex.InnerException.ToString)
    '                    End Try
    '                End If
    '                RText.SelectedText = strIngrName & " "
    '                Try
    '                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                Catch ex As Exception
    '                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '                If G_ReportOptions.blnIncludeIngredientComplement Then strIngrComple = strIngrComple.Trim & " " Else strIngrComple = ""
    '                'RText.SelectedText = strIngrComple

    '                xrRText.Rtf = RText.Rtf
    '                xrRText.Width = CInt(160)
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(160)
    '            Catch ex As Exception
    '                Log.Info("error: " & ex.InnerException.ToString)
    '            Finally
    '                If Not RText.IsDisposed Then
    '                    RText.Dispose()
    '                    Log.Info("passed rText disposal in drIngredient")
    '                End If
    '            End Try

    '            Try
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '            Catch ex As Exception
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                Log.Info("xrIngrCell.Font erro: " & ex.Message)
    '            End Try
    '            xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '            xrIngrCell.Controls.Add(xrRText)
    '            xrIngrRow.Cells.Add(xrIngrCell)
    '            Dim strIngrUnitPrice As String = ""
    '            If G_ReportOptions.blnIncludeCostOfGoods Then
    '                ' Wastage Percentage
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(50)
    '                Try
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                Catch ex As Exception
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                If Not drIngredient("ItemType") = 0 Then
    '                    If CDblDB(drIngredient("TotalWastage")) > 0 Then xrIngrCell.Text = drIngredient("TotalWastage").ToString Else xrIngrCell.Text = ""
    '                Else
    '                    xrIngrCell.Text = ""
    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If
    '            ' Price
    '            If G_ReportOptions.blnIncludeCostOfGoods Then
    '                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = CStrDB(drIngredient("tmpUnit")) Else strIngrUnitPrice = " / " & CStrDB(drIngredient("PriceUnit"))
    '                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '                Dim dblIngrPrice As Double = CDblDB(drIngredient("ItemPrice"))

    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                Try
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                Catch ex As Exception
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                'If Not drIngredient("ItemType") = 0 Then
    '                '    xrIngrCell.Text = Format(dblIngrPrice, G_strPriceFormat) & strIngrUnitPrice
    '                'Else
    '                '    xrIngrCell.Text = ""
    '                'End If
    '                If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
    '                    xrIngrCell.Text = ""
    '                Else

    '                    xrIngrCell.Text = Format(dblIngrPrice, strPriceFormat) & strIngrUnitPrice
    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If


    '            'start LLG 10.20.2015 commented and replace Net QTY,Gross QTY and Amount'
    '            ' Net Quantity
    '            If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
    '            If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '            If G_ReportOptions.blnIncludeNetQty Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                'If Not drIngredient("ItemType") = 0 Then
    '                '    xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
    '                'Else
    '                '    xrIngrCell.Text = "" 
    '                'End If
    '                'bragadigdig
    '                If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
    '                    xrIngrCell.Text = ""
    '                Else
    '                    If G_ReportOptions.blnUseFractions Then
    '                        xrIngrCell.Text = fctConvertToFraction(drIngredient("NetQuantity")) & " " & strIngrUnitPrice
    '                    Else
    '                        xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
    '                    End If

    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If

    '            ' Gross Quantity
    '            If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
    '            If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '            If G_ReportOptions.blnIncludeGrossQty Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                'If Not drIngredient("ItemType") = 0 Then
    '                '    xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
    '                'Else
    '                '    xrIngrCell.Text = ""
    '                'End If
    '                If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
    '                    xrIngrCell.Text = ""
    '                Else
    '                    If G_ReportOptions.blnUseFractions Then
    '                        xrIngrCell.Text = fctConvertToFraction(drIngredient("GrossQuantity")) & " " & strIngrUnitPrice
    '                    Else
    '                        xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
    '                    End If

    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If
    '            If G_ReportOptions.blnIncludeCostOfGoods Then
    '                ' Amount
    '                Dim dblAmount As Double

    '                If drIngredient("PriceUnit").ToString = drIngredient("itemUnit").ToString Then
    '                    dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("GrossQuantity"))
    '                Else
    '                    dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("unitFactor")) * CDblDB(drIngredient("GrossQuantity"))
    '                End If
    '                dblTotal += dblAmount

    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight


    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                'If Not drIngredient("ItemType") = 0 Then
    '                '    xrIngrCell.Text = Format(dblAmount, G_strPriceFormat)
    '                'Else
    '                '    xrIngrCell.Text = ""
    '                'End If
    '                If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
    '                    xrIngrCell.Text = ""
    '                Else
    '                    xrIngrCell.Text = Format(dblAmount, strPriceFormat)
    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If

    '            If intExcessSpace > 0 Then
    '                If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngrRow.Cells(0).Width += intExcessSpace Else xrIngrRow.Cells(1).Width += intExcessSpace
    '            End If
    '            xrIngrInfo.Rows.Add(xrIngrRow)
    '            Log.Info("for each drIngredient END")
    '        Next
    '        NewDtTable.Dispose()

    '        .Detail.Controls.Add(xrIngrInfo)
    '        intNewY += (xrIngrInfo.Height + 5)

    '        'xrIngredientHeader.Dispose()
    '        'xrIngredientHRow.Dispose()
    '        'xrIngredientCell.Dispose()


    '        'xrIngrInfo.Dispose()
    '        'xrIngrRow.Dispose()
    '        'xrIngrCell.Dispose()

    '        If G_ReportOptions.blnIncludeCostOfGoods Then
    '            Log.Info("inside if blnIncludeCostOfGoods")
    '            dblPercent = CType(row("DishPercent"), Double) / 100
    '            dblYieldQty = CType(row("Yield"), Double)
    '            'dblTotal = 0
    '            dblPrice = 0
    '            Dim borderSideText As DevExpress.XtraPrinting.BorderSide = GetLabelBorderSide()
    '            For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
    '                CurRate = 0
    '                If Not IsDBNull(foundDetails(rowIng)("Rate")) Then CurRate = CType(foundDetails(rowIng)("Rate"), Double)
    '                dblUnitFactor = 0
    '                If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double)

    '                If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
    '                    dblWastage = 100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100
    '                    dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
    '                End If
    '                If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)
    '                If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)
    '                If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)
    '                dblWastage = (100 - dblWastage)
    '                dblPrice = 0
    '                dblFactor = 1
    '                If Not IsDBNull(foundDetails(rowIng)("Factor")) Then dblFactor = CType(foundDetails(rowIng)("Factor"), Double)
    '                If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblPrice = CType(foundDetails(rowIng)("ItemPrice"), Double) * CurRate * dblFactor
    '                If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then dblQuantityNet = CType(foundDetails(rowIng)("Quantity"), Double)


    '                dblQuantityBrut = dblQuantityNet / (1 - (dblWastage / 100))

    '                dblPrice = (dblQuantityBrut * dblPrice * dblUnitFactor)

    '                'dblTotal += dblPrice

    '            Next
    '            ''-------------------------------------------
    '            'dblTotal = 0
    '            dblTotalLaborCost = 0
    '            If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double)
    '            dblCoefficientBelvoir = 0
    '            If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double)


    '            'Cost of Goods

    '            Dim dblMerchandiseCost As Double
    '            Dim dblPriceTax As Double
    '            Dim dblImposedPriceTax As Double
    '            Dim dblImposedPriceNoTax As Double
    '            Dim dblImposedCoeff As Double
    '            Dim dblSellingPriceYield As Double

    '            'AGL 2013.11.04 - 9277 START - commented this portion, duplicate costing appearing on report ===========================================================
    '            intNewX = 0
    '            intNewY += 10
    '            'sf = New StringFormat(StringFormatFlags.DirectionVertical)
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
    '            L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


    '            strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
    '            L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            L_lngCol(3) = (L_lngCol(1) / 2)

    '            L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
    '            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
    '            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

    '            'Dim intNumberOfRows As Integer = 4
    '            Dim intCurY As Integer
    '            'Dim intCurX As Integer
    '            'If dblTaxValue <> 0 Then intNumberOfRows = 8

    '            intCurY = intNewY
    '            intNewY += GetLineSpace(intTextHeight) - 10 'KMQDC 11.26.2015 original no -10
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 1


    '            If Not G_ReportOptions.bFoodcostOnly Then
    '                Select Case G_Options.FactorType
    '                    'Selling Price/const
    '                    Case 0
    '                        dblCoefficient = Format(dblCoefficient, "Standard")
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
    '                    Case 1
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
    '                        strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
    '                    Case 2
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
    '                        strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
    '                End Select
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 2


    '                dblMerchandiseCost = 0
    '                If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

    '                If dblTaxValue <> 0 Then
    '                    dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
    '                    dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
    '                    dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

    '                    If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
    '                        'dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
    '                        dblImposedCoeff = dblCoefficient
    '                    Else
    '                        dblImposedCoeff = 0
    '                    End If

    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
    '                    strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 3

    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 4
    '                    Select Case G_Options.FactorType
    '                        'Imposed selling price/const
    '                        Case 0
    '                            strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
    '                            strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                        Case 1
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
    '                            strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
    '                        Case 2
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
    '                            strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
    '                    End Select
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 5
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
    '                    strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 6
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 7
    '                Else
    '                    dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
    '                    dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
    '                    dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

    '                    If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
    '                        ' dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
    '                        dblImposedCoeff = dblCoefficient
    '                    Else
    '                        dblImposedCoeff = 0
    '                    End If

    '                    Select Case G_Options.FactorType
    '                        Case 0
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
    '                            strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                        Case 1
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
    '                            strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
    '                        Case 2
    '                            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
    '                            strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
    '                    End Select
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                    intNewY += GetLineSpace(intTextHeight)
    '                    'anm noted 8
    '                End If


    '                intNewX = 0

    '            End If

    '            'AGL 2013.11.04 - 9277 END===========================================================

    '            'Per X Yield
    '            intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
    '            intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)
    '            'AGL 2013.11.04
    '            subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)
    '            '  subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)

    '            intNewX = 0
    '            intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
    '            intNewX += L_lngNameW + L_lngCol(3)
    '            dblMerchandiseCost = 0
    '            If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
    '            dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
    '            'Per 1 yield
    '            'AGL 2013.11.04
    '            subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice / dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)
    '            ' subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)

    '            Dim dblRatioYield1Yield2 As Double
    '            Dim dblSellingPriceSubRecipe As Double
    '            If blnSubRecipeComputation Then
    '                dblRatioYield1Yield2 = 0
    '                dblMerchandiseCost = 0
    '                If dblYield2 <> 0 Then
    '                    dblRatioYield1Yield2 = dblYieldQty / dblYield2
    '                    dblMerchandiseCost = dblTotal / dblYield2
    '                End If

    '                dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
    '                dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

    '                'per 1 Subrecipe Unit
    '                subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit, strPriceFormat)
    '            End If
    '        End If
    '        Log.Info("end if blnIncludeCostOfGoods")

    '        intNewX = 0
    '        intNewY += GetLineSpace(intTextHeight)
    '        'anm noted 9

    '        'str3Pictures = ""
    '        If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007

    '        '------------------------------------------------------


    '        'intNewY += 20
    '        ' RDC force table to be plotted in X:0
    '        'PREPARATION
    '        intNewX = 0
    '        Dim xrStepTable As New XRTable
    '        Dim xrStepRow As New XRTableRow
    '        Dim xrStepCell As New XRTableCell
    '        Dim xrStepCellB As New XRTableCell

    '        xrStepTable.Location = New Point(intNewX, intNewY)
    '        xrStepTable.Width = intAvailableWidth
    '        xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None

    '        For Each drStep As DataRow In dtListePreparation.Select("Codeliste=" & CIntDB(row("Code")))
    '            Log.Info("inside for each drStep")
    '            ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
    '            Dim rtb As New RichTextBox
    '            Dim xrt As New XRRichText
    '            Try
    '                rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '            Catch ex As Exception
    '                rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                Log.Info("Error in ListePrep: " & ex.InnerException.ToString)
    '                rtb = New RichTextBox
    '                xrt = New XRRichText
    '            Finally
    '                rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                Log.Info("passed finally in drStep")
    '            End Try

    '            Using rtb
    '                If Not G_ReportOptions.blnMode Then
    '                    If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(drStep("Note").ToString) Else rtb.AppendText(Chr(32))
    '                Else
    '                    If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
    '                End If

    '                xrt.Rtf = rtb.Rtf
    '            End Using

    '            xrStepRow = New XRTableRow
    '            xrStepRow.Height = G_ReportOptions.sgFontSize2

    '            If G_ReportOptions.blnIncludePreparation Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout


    '                Select Case row("MethodFormat").ToString.Trim.ToLower
    '                    Case "x", "" ' Not bulleted / numbered
    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth
    '                        rtb.Width = intAvailableWidth
    '                        xrt.Width = intAvailableWidth


    '                        'xrStepCell.Controls.Add(xrt)
    '                        ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        'xrStepRow.Cells.Add(xrStepCell)
    '                        Dim onceCount As Integer = 0
    '                        'anm
    '                        ' Dim currentHeight As New Integer
    '                        '  currentHeight = intNewY
    '                        Dim x As Integer = rtb.Lines.Count
    '                        Dim countTo3 As Integer = 0
    '                        Dim addToName As Integer = 0
    '                        Dim curY = intNewY + 10
    '                        Dim newLoop As Boolean = False
    '                        Dim rtbNew As New RichTextBox
    '                        'Dim aslow As String = rtbNew.Rtf.ToString()
    '                        Dim xrts As New XRRichText
    '                        Dim xrNewStepTable As New XRTable
    '                        Dim textLeftCount As Integer = rtb.Lines.Count Mod 3
    '                        Dim lineCountLeft As Integer = rtb.Lines.Count - textLeftCount
    '                        Dim LineCounter As Integer
    '                        For Each Line As String In rtb.Lines
    '                            Using rtbNew
    '                                countTo3 += 1
    '                                LineCounter += 1
    '                                If Line = "" Then
    '                                    rtbNew.AppendText(Environment.NewLine)
    '                                Else
    '                                    If countTo3 = 1 Then
    '                                        rtbNew.AppendText(Line)
    '                                    Else
    '                                        rtbNew.AppendText(Line + Environment.NewLine)
    '                                    End If
    '                                End If
    '                                xrts.Rtf = rtbNew.Rtf

    '                                If countTo3 = 1 Then
    '                                    countTo3 = 0
    '                                    xrts.Width = intAvailableWidth
    '                                    xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                                    xrts.CanShrink = True
    '                                    xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                                    xrts.KeepTogether = True
    '                                    xrts.Location = New Point(intNewX, curY)
    '                                    .Detail.Controls.AddRange(New XRControl() {xrts})
    '                                    curY += (xrts.Height)
    '                                    rtbNew = New RichTextBox
    '                                    xrts = New XRRichText
    '                                    xrNewStepTable = New XRTable
    '                                End If
    '                            End Using

    '                        Next
    '                        intNewY = curY

    '                    Case "n" ' Number bullet
    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                        If G_ReportOptions.blnIncludeProcSequenceNo Then
    '                            xrStepCell.Text = drStep("Position") & "."
    '                        End If
    '                        xrStepRow.Cells.Add(xrStepCell)
    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Controls.Add(xrt)
    '                        ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        xrStepRow.Cells.Add(xrStepCell)
    '                        xrStepTable.Rows.Add(xrStepRow)
    '                        .Detail.Controls.Add(xrStepTable)
    '                        intNewY += (xrStepTable.Height + 20)
    '                    Case "b" ' Symbol bullet "•"
    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                        If G_ReportOptions.blnIncludeProcSequenceNo Then
    '                            xrStepCell.Text = "•"
    '                        End If
    '                        xrStepRow.Cells.Add(xrStepCell)

    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Controls.Add(xrt)
    '                        ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        xrStepRow.Cells.Add(xrStepCell)
    '                        xrStepTable.Rows.Add(xrStepRow)
    '                        .Detail.Controls.Add(xrStepTable)
    '                        intNewY += (xrStepTable.Height + 20)
    '                End Select
    '                'xrStepTable.Rows.Add(xrStepRow) 'anm
    '            End If
    '        Next
    '        Log.Info("end for each drStep")
    '        If G_ReportOptions.blnIncludePreparation Then
    '            intNewY = intNewY + 90
    '        Else
    '            intNewY = intNewY + 90
    '        End If

    '        Dim strServeWithNotes As String = Nothing
    '        Dim strFootnote1 As String = Nothing
    '        Dim strFootnote2 As String = Nothing

    '        For Each rwRecipeNotes As DataRow In G_ReportOptions.dtNotes.Select("Code=" & intRecipeCode)
    '            strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
    '            strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
    '            strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
    '        Next

    '        Dim xrNotesTable As New XRTable
    '        Dim xrNotesRow As New XRTableRow
    '        Dim xrNotesCell As New XRTableCell

    '        If G_ReportOptions.blnIncludeNotes Then
    '            ' Notes
    '            If strFootnote1.Trim.Length > 0 Then

    '                ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
    '                Dim rtb As New RichTextBox
    '                Dim xrt As New XRRichText


    '                Try
    '                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                Catch ex As Exception
    '                    Log.Info("Error in Notes")
    '                    rtb = New RichTextBox
    '                    xrt = New XRRichText
    '                Finally
    '                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    Log.Info("passed Notes")
    '                End Try

    '                rtb.Width = intAvailableWidth
    '                xrt.Width = intAvailableWidth
    '                rtb.AppendText(strFootnote1.Trim)
    '                xrt.Rtf = rtb.Rtf

    '                With G_ReportOptions
    '                    Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
    '                    Detail.Controls.Add(xrHeaderSectionTable)
    '                    intNewY += (xrHeaderSectionTable.Height + 10)
    '                End With

    '                xrNotesTable = New XRTable
    '                xrNotesTable.Width = intAvailableWidth
    '                xrNotesTable.Location = New Point(intNewX, intNewY)
    '                xrNotesRow = New XRTableRow
    '                'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
    '                Dim xrNotes2Cell As New XRTableCell
    '                xrNotes2Cell.Width = xrNotesRow.Width
    '                xrNotes2Cell.CanGrow = True
    '                xrNotes2Cell.WordWrap = True
    '                xrNotes2Cell.CanShrink = True
    '                xrNotes2Cell.Multiline = True
    '                xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
    '                xrNotes2Cell.Controls.Add(xrt)
    '                xrNotesRow.Cells.Add(xrNotes2Cell)
    '                xrNotesTable.Rows.Add(xrNotesRow)

    '                .Detail.Controls.Add(xrNotesTable)
    '                intNewY += (xrNotesTable.Height + 20)
    '            End If

    '        End If
    '        Log.Info("notes END")
    '        If G_ReportOptions.blnIncludeAddNotes Then
    '            ' Additional Notes
    '            If strFootnote2.Trim.Length > 0 Then

    '                ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
    '                Dim rtb As New RichTextBox
    '                Dim xrt As New XRRichText
    '                Try
    '                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                Catch ex As Exception
    '                    Log.Info("error in notes")
    '                    rtb = New RichTextBox
    '                    xrt = New XRRichText
    '                Finally
    '                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                    Log.Info("passed notes")
    '                End Try
    '                rtb.Width = intAvailableWidth
    '                xrt.Width = intAvailableWidth
    '                rtb.AppendText(strFootnote2.Trim)
    '                xrt.Rtf = rtb.Rtf

    '                With G_ReportOptions
    '                    Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
    '                    Detail.Controls.Add(xrHeaderSectionTable)
    '                    intNewY += (xrHeaderSectionTable.Height + 10)
    '                End With

    '                xrNotesTable = New XRTable
    '                xrNotesTable.Width = intAvailableWidth
    '                xrNotesTable.Location = New Point(intNewX, intNewY)
    '                xrNotesRow = New XRTableRow
    '                'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
    '                Dim xrNotes2Cell As New XRTableCell
    '                xrNotes2Cell.Width = xrNotesRow.Width
    '                xrNotes2Cell.Height = 500
    '                xrNotes2Cell.CanShrink = False
    '                xrNotes2Cell.CanGrow = False
    '                xrNotes2Cell.Controls.Add(xrt)
    '                xrNotesRow.Cells.Add(xrNotes2Cell)
    '                xrNotesTable.Rows.Add(xrNotesRow)
    '                xrNotesTable.CanShrink = True
    '                .Detail.Controls.Add(xrNotesTable)
    '                intNewY += (xrNotesTable.Height + 20)
    '            End If
    '        End If

    '        If G_ReportOptions.blnIncludeHACCP Then
    '            '  subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001")
    '            'subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strStoringTemp, strStoringTime, strCCPdescription, strHACCP, "001")
    '            With G_ReportOptions
    '                Dim xrSectionHeaderTable As New XRTable
    '                xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
    '                Detail.Controls.Add(xrSectionHeaderTable)
    '                intNewY += (xrSectionHeaderTable.Height + 10)
    '            End With
    '            subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001", strStoringTime, strStoringTemp, strHACCP)
    '            intNewY += intTextHeight
    '            'anm noted 10
    '        End If

    '        '---JRN 17.03.2010
    '        'For keywords
    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeKeyword Then

    '            With G_ReportOptions
    '                Dim xrSectionHeaderTable As New XRTable
    '                xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
    '                Detail.Controls.Add(xrSectionHeaderTable)
    '                intNewY += (xrSectionHeaderTable.Height + 10)
    '                'xrSectionHeaderTable.Dispose()
    '            End With

    '            subDisplayKeywords(foundKeywords, "001")
    '            intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 11
    '        End If

    '        '   Kiosk
    '        If G_ReportOptions.blnIncludeKiosk And Not G_ReportOptions.dtKiosk Is Nothing Then
    '            If G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode).Count > 0 Then
    '                Dim xrKioskTable As New XRTable
    '                Dim xrKioskRows As New XRTableRow

    '                xrKioskTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Kiosk), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
    '                .Detail.Controls.Add(xrKioskTable)

    '                intNewY += xrKioskTable.Height + 10

    '                xrKioskTable = New XRTable
    '                xrKioskTable.Width = intAvailableWidth
    '                xrKioskTable.Location = New Point(intNewX, intNewY)

    '                For Each drKioskRows As DataRow In G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode)
    '                    'AGL 2013.08.22 - added checking for blank dates
    '                    If CStrDB(drKioskRows("BrandSiteDateFrom")) = "" Or CStrDB(drKioskRows("BrandSiteDateTo")) = "" Then
    '                        xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
    '                    Else
    '                        ' RDC 08.14.2013 : Do not display date if date is equal to 01/01/1900
    '                        If CDate(drKioskRows("BrandSiteDateFrom")).Year = 1900 And CDate(drKioskRows("BrandSiteDateTo")).Year = 1900 Then
    '                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
    '                        Else
    '                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim & " " & Format(CDate(drKioskRows("BrandSiteDateFrom")), "MM/dd/yyyy") & " - " & Format(CDate(drKioskRows("BrandSiteDateTo")), "MM/dd/yyyy")}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
    '                        End If
    '                    End If

    '                Next
    '                xrKioskTable.Rows.Add(xrKioskRows)
    '                .Detail.Controls.Add(xrKioskTable)

    '                intNewY += (xrKioskTable.Height + 20)
    '            End If
    '        End If

    '        ' RDC 02.22.2013
    '        ' Brands 
    '        If G_ReportOptions.blnIncludeBrand Then
    '            If G_ReportOptions.dtBrands.Select("RecipeCode= " & intRecipeCode).Count > 0 Then
    '                Dim xrBrandTable As New XRTable
    '                Dim xrBrandRow As New XRTableRow
    '                Dim xrBrandCell As New XRTableCell

    '                xrBrandTable.Width = intAvailableWidth
    '                xrBrandTable.Location = New Point(intNewX, intNewY)

    '                With G_ReportOptions
    '                    If .blnIncludeHighlightSection Then
    '                        xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
    '                        xrBrandTable.BorderWidth = 1
    '                        xrBrandTable.BackColor = Color.LightGray
    '                        xrBrandTable.BorderColor = Color.Black
    '                    Else
    '                        xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
    '                        xrBrandTable.BorderWidth = 1
    '                        xrBrandTable.BackColor = Color.White
    '                        xrBrandTable.BorderColor = Color.Black
    '                    End If

    '                    xrBrandRow.Height = .sgFontSize2
    '                    xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
    '                    xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
    '                    xrBrandCell.Text = cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim
    '                    xrBrandRow.Cells.Add(xrBrandCell)
    '                    xrBrandTable.Rows.Add(xrBrandRow)

    '                End With
    '                .Detail.Controls.Add(xrBrandTable)
    '                intNewY += (xrBrandTable.Height + 10)

    '                xrBrandTable = New XRTable
    '                xrBrandTable.Width = intAvailableWidth
    '                xrBrandTable.Location = New Point(intNewX, intNewY)

    '                Dim cLangData As New clsLanguage(enumAppType.WebApp, G_strConnection)
    '                Dim cLangFromCodeTrans As New clsEGSLanguage(cLangData.GetCodeLang(G_ReportOptions.intTranslation))
    '                Dim strBrandClassification As String = ""

    '                For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
    '                    With G_ReportOptions
    '                        xrBrandRow = New XRTableRow
    '                        xrBrandRow.Height = .sgFontSize2
    '                        xrBrandCell = New XRTableCell
    '                        xrBrandCell.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                        xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Regular)
    '                        xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft

    '                        If drBrand("BrandClass").ToString.ToLower = "primary" Then
    '                            strBrandClassification = cLangFromCodeTrans.GetString(173883)
    '                        ElseIf drBrand("BrandClass").ToString.ToLower = "secondary" Then
    '                            strBrandClassification = cLangFromCodeTrans.GetString(173884)
    '                        Else
    '                            strBrandClassification = drBrand("BrandClass").ToString
    '                        End If
    '                        xrBrandCell.Text = drBrand("Brand").ToString & " ~ " & strBrandClassification
    '                        xrBrandRow.Cells.Add(xrBrandCell)
    '                        xrBrandTable.Rows.Add(xrBrandRow)
    '                    End With
    '                Next
    '                .Detail.Controls.Add(xrBrandTable)
    '                intNewY += (xrBrandTable.Height + 20)

    '            End If
    '        End If
    '        'Publications
    '        If G_ReportOptions.blnIncludePublication Then
    '            If G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode).Count > 0 Then

    '                Dim xrPublicationTable As New XRTable
    '                Dim xrPublicationRow As New XRTableRow
    '                Dim xrPublicationCell As New XRTableCell

    '                xrPublicationTable.Width = intAvailableWidth
    '                xrPublicationTable.Location = New Point(intNewX, intNewY)

    '                If G_ReportOptions.blnIncludeHighlightSection Then
    '                    xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
    '                    xrPublicationTable.BorderWidth = 1
    '                    xrPublicationTable.BackColor = Color.LightGray
    '                    xrPublicationTable.BorderColor = Color.Black
    '                Else
    '                    xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
    '                    xrPublicationTable.BorderWidth = 1
    '                    xrPublicationTable.BackColor = Color.White
    '                    xrPublicationTable.BorderColor = Color.Black
    '                End If

    '                xrPublicationRow.Height = G_ReportOptions.sgFontSize2
    '                xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '                xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                xrPublicationCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim
    '                xrPublicationRow.Cells.Add(xrPublicationCell)
    '                xrPublicationTable.Rows.Add(xrPublicationRow)

    '                .Detail.Controls.Add(xrPublicationTable)

    '                intNewY += (xrPublicationTable.Height + 10)

    '                xrPublicationTable = New XRTable
    '                xrPublicationTable.Width = intAvailableWidth
    '                xrPublicationTable.Location = New Point(intNewX, intNewY)

    '                For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
    '                    xrPublicationRow = New XRTableRow
    '                    xrPublicationRow.Height = G_ReportOptions.sgFontSize2
    '                    xrPublicationCell = New XRTableCell
    '                    xrPublicationCell.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                    xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                    xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '                    ' xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim
    '                    xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & fctConvertDate(CType(drPublication("PlacementDate"), Date))
    '                    xrPublicationRow.Cells.Add(xrPublicationCell)
    '                    xrPublicationTable.Rows.Add(xrPublicationRow)
    '                Next

    '                .Detail.Controls.Add(xrPublicationTable)
    '                intNewY += (xrPublicationTable.Height + 20)

    '                'For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
    '                '    intTextHeight = ReportingTextUtils.MeasureText(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                '    intNewY += intTextHeight
    '                'Next
    '                '' RDC 04.27.2013 - CMW-5630 Fix
    '                'intNewY += 20
    '            End If
    '        End If

    '        ' End

    '        If G_ReportOptions.blnIncludeNutrients Then
    '            subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001")
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        ' RDC 09.05.2013 : Nutrient enhancement
    '        Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
    '        Dim intSelCodeTrans As Integer = 0
    '        Dim intCodeSetDisplay As Integer = 0
    '        For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
    '            intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
    '            intSelCodeTrans = CInt(drDispSet("codeTrans"))
    '            intCodeSetDisplay = CInt(drDispSet("CodeSet"))
    '        Next

    '        intNewY += 20
    '        If G_ReportOptions.blnIncludeNutrients Then
    '            ' Section Header
    '            Dim xrNutHeader As New XRTable
    '            xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutrientInformation), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
    '            .Detail.Controls.Add(xrNutHeader)

    '            intNewY += (xrNutHeader.Height + 10)

    '            Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
    '            subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSetDisplay, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice)

    '            intNewY += 20
    '        End If


    '        'GDA
    '        If G_ReportOptions.blnIncludeGDA Then

    '            Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
    '            Detail.Controls.Add(xrGDAHeader)
    '            intNewY += (xrGDAHeader.Height) + 10

    '            subDisplayGDAComputation(CInt(row("Code")), intCodeSetDisplay, intSelCodeTrans, CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice")))
    '            ' ''    subDisplayNutrientsGDA(strYieldName, _
    '            ' ''        dblNutrientFactor, L_Nutrient, "001")
    '            ' ''    intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        '- Cookbook
    '        ' If enumPrintOptions.RecipeCosting Then
    '        If G_ReportOptions.blnIncludeCookbook And Not G_ReportOptions.dtCookbook Is Nothing Then
    '            If G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode).Count > 0 Then
    '                Dim xrCookbookTable As New XRTable
    '                Dim xrCookbookRow As New XRTableRow

    '                xrCookbookTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Cookbook), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
    '                .Detail.Controls.Add(xrCookbookTable)

    '                intNewY += (xrCookbookTable.Height + 10)

    '                xrCookbookTable = New XRTable
    '                xrCookbookTable.Width = intAvailableWidth
    '                xrCookbookTable.Location = New Point(intNewX, intNewY)

    '                For Each drCookbookRow As DataRow In G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode)
    '                    xrCookbookRow = fctMakeDataRow({drCookbookRow("Name").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
    '                    xrCookbookTable.Rows.Add(xrCookbookRow)
    '                Next
    '                .Detail.Controls.Add(xrCookbookTable)

    '                intNewY += (xrCookbookTable.Height + 20)
    '            End If
    '        End If
    '        ' End If
    '        '---
    '        'Comments
    '        If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
    '            If G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode).Count > 0 Then
    '                Dim xrCommentTable As New XRTable
    '                Dim xrCommentRow As New XRTableRow

    '                xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
    '                .Detail.Controls.Add(xrCommentTable)

    '                intNewY += (xrCommentTable.Height + 10)

    '                xrCommentTable = New XRTable
    '                xrCommentTable.Width = intAvailableWidth
    '                xrCommentTable.Location = New Point(intNewX, intNewY)

    '                For Each drComment As DataRow In G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode)
    '                    xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
    '                    xrCommentTable.Rows.Add(xrCommentRow)
    '                Next
    '                .Detail.Controls.Add(xrCommentTable)

    '                intNewY += (xrCommentTable.Height + 20)

    '            End If
    '        End If

    '        'Allergens MCM 03.03.06
    '        '----------------------
    '        If G_ReportOptions.blnIncludeAllergens Then


    '            intNewY -= 15
    '            '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
    '            '  subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", , , strConn, row("Code"))
    '            Dim blnManor As Boolean = False
    '            Dim strStyle As String = "003"
    '            If blnManor = False Then
    '                sf = New StringFormat(StringFormatFlags.NoClip)
    '                With Me
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
    '                    Select Case strStyle

    '                        Case "001", "002", "003"
    '                            Dim xrAllergensTable As New XRTable
    '                            Dim xrAllergensRow As New XRTableRow
    '                            Dim xrAllergensCell As New XRTableCell

    '                            xrAllergensTable.Width = intAvailableWidth
    '                            xrAllergensTable.Location = New Point(intNewX, intNewY)

    '                            If G_ReportOptions.blnIncludeHighlightSection Then
    '                                xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
    '                                xrAllergensTable.BorderWidth = 1
    '                                xrAllergensTable.BackColor = Color.LightGray
    '                                xrAllergensTable.BorderColor = Color.Black
    '                            Else
    '                                xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
    '                                xrAllergensTable.BorderWidth = 1
    '                                xrAllergensTable.BackColor = Color.White
    '                                xrAllergensTable.BorderColor = Color.Black
    '                            End If

    '                            xrAllergensRow.Height = G_ReportOptions.sgFontSize2
    '                            xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '                            xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                            xrAllergensCell.Text = strX.Trim
    '                            xrAllergensRow.Cells.Add(xrAllergensCell)
    '                            xrAllergensTable.Rows.Add(xrAllergensRow)

    '                            .Detail.Controls.Add(xrAllergensTable)

    '                            intNewX += (xrAllergensTable.Height + 10)

    '                            ' RDC 05.15.2013 - Removed.
    '                            'Case "002"  'Modern
    '                            '    intNewY += 10
    '                            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
    '                            'Case "003"
    '                            '    intNewY += 10
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                            '  xrAllergensTable.Dispose()
    '                            '  xrAllergensRow.Dispose()
    '                            '  xrAllergensCell.Dispose()

    '                        Case "003Menu"
    '                            intNewY += 10
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
    '                        Case "004" 'Merchandise Details
    '                            intNewY += 30

    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
    '                        Case Else
    '                            intNewY += 10
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    End Select


    '                    intNewY += intTextHeight + 10
    '                End With
    '            Else
    '                intNewY += GetLineSpace(intTextHeight)
    '            End If
    '            'intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 12
    '            Dim row1 As DataRow = foundDetails(0) 'KMQDC 11.24.2015

    '            Dim CodeAllergenTranslation As Integer
    '            CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)


    '            subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", False, False, strConn, CodeAllergenTranslation)
    '        End If
    '        'End of Allergens

    '        intNewX = 0
    '        intNewY = intNewY + 30
    '        ' composition
    '        If G_ReportOptions.blnIncludeComposition Then
    '            Dim xrCompositionTable As New XRTable
    '            Dim xrCompositionRow As New XRTableRow
    '            Dim xrCompositionCell As New XRTableCell

    '            If G_ReportOptions.blnIncludeAllergens And G_ReportOptions.intfoodLaw = 3 Then
    '                intNewY += CInt(GetLineSpace(intTextHeight))
    '            End If

    '            xrCompositionTable.Width = intAvailableWidth
    '            xrCompositionTable.Location = New Point(intNewX, intNewY)

    '            With G_ReportOptions
    '                If .blnIncludeHighlightSection Then
    '                    xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
    '                    xrCompositionTable.BorderWidth = 1
    '                    xrCompositionTable.BackColor = Color.LightGray
    '                    xrCompositionTable.BorderColor = Color.Black
    '                Else
    '                    xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
    '                    xrCompositionTable.BorderWidth = 1
    '                    xrCompositionTable.BackColor = Color.White
    '                    xrCompositionTable.BorderColor = Color.Black
    '                End If

    '                xrCompositionRow.Height = .sgFontSize2
    '                xrCompositionCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
    '                xrCompositionCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
    '                xrCompositionCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Composition).Trim
    '                xrCompositionRow.Cells.Add(xrCompositionCell)
    '                xrCompositionTable.Rows.Add(xrCompositionRow)

    '            End With
    '            .Detail.Controls.Add(xrCompositionTable)
    '            intNewY += (xrCompositionTable.Height + 10)

    '            xrCompositionTable = New XRTable
    '            xrCompositionTable.Width = intAvailableWidth
    '            xrCompositionTable.Location = New Point(intNewX, intNewY)

    '            With G_ReportOptions
    '                xrCompositionRow = New XRTableRow
    '                '   xrCompositionRow.Height = .sgFontSize
    '                xrCompositionTable.Width = intAvailableWidth
    '                xrCompositionCell = New XRTableCell

    '                '--------------keen dela cruz
    '                Dim str As String = row("Composition").ToString
    '                str = str.Replace("<b>", "\b ")
    '                str = str.Replace("</b>", "\b0")
    '                str = str.Replace("<p>", "")
    '                str = str.Replace("</p>", "")
    '                str = str.Replace("<br>", "")
    '                str = str.Replace("<i>", "\i ")
    '                str = str.Replace("</i>", "\i0")
    '                str = str.Replace("{", "")
    '                str = str.Replace("}", "")
    '                str = str.Replace("<div>", "\line \div ")
    '                str = str.Replace("</div>", "\line \div0 ")
    '                Dim strhtml As String = ParseHtmlToRTF(str)  'LLG 05.16.2016 for lepause issue
    '                Dim ss As String = row("Composition").ToString
    '                Dim XrRichText1 As New XRRichText
    '                XrRichText1.Width = 630
    '                XrRichText1.CanGrow = True
    '                XrRichText1.CanShrink = True
    '                XrRichText1.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '                XrRichText1.Rtf = strhtml
    '                xrCompositionCell.Controls.Add(XrRichText1)


    '                xrCompositionRow.InsertCell(xrCompositionCell, 1)
    '                xrCompositionTable.Rows.Add(xrCompositionRow)
    '            End With
    '            .Detail.Controls.Add(xrCompositionTable)
    '            intNewY += (xrCompositionTable.Height + 20)
    '            'Me.Detail.Controls.Add(fctMakeXRLabel(row("Composition"), fntRegular, 0, intNewY, intAvailableWidth, 100, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.None, True))
    '        End If

    '        intNewY = intNewY + 30

    '        Dim dblMaxWidthPicture As Double
    '        Dim dblMaxHeightPicture As Double
    '        intNewX = 0
    '        If G_ReportOptions.blnPicturesAll = True Then
    '            G_ReportOptions.blnWithPicture = False

    '            dblMaxWidthPicture = (intAvailableWidth - 200) / 3
    '            dblMaxHeightPicture = dblMaxWidthPicture * 1.5
    '        Else
    '            dblMaxHeightPicture = 250
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

    '        End If


    '        'For j As Integer = 0 To 2
    '        '    strPicture(j) = ""
    '        '    strPicture(j) = fctGetPictureName(str3Pictures, j)
    '        'Next

    '        If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
    '            dblMaxHeightPicture = 350
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '        End If

    '        Dim strFileName As String


    '        ''---GDA Image JRN 06.07.2010
    '        If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
    '            Dim bShowGDAImage As Boolean = False
    '            For Each arr As tNutrient In G_Nutrient
    '                If CDblDB(arr.GDA) > 0 Then
    '                    bShowGDAImage = True
    '                    Exit For
    '                End If
    '            Next
    '            If bShowGDAImage Then
    '                G_ReportOptions.blnIncludeGDA = False
    '                Dim intGDAPanelHeight = 70
    '                Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
    '                Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
    '                Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
    '                .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
    '            End If
    '        End If

    '        '---

    '        '--- VRP 07.11.2007
    '        If G_ReportOptions.blnPicturesAll = True Then
    '            If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                For j As Integer = 0 To UBound(arrPicture)
    '                    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                        strFileName = G_strPhotoPath & arrPicture(j)
    '                        .Detail.Controls.AddRange(New XRControl() _
    '                         {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                    End If
    '                    intNewX += CInt(G_dblMaxWidthPicture) + 5
    '                Next
    '                intNewY += CInt(G_dblMaxHeightPicture)
    '                'anm noted 10
    '            End If
    '            intNewY += 10
    '            intNewX = 0
    '        Else
    '            If G_ReportOptions.blnWithPicture = True Then
    '                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                    If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
    '                        strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
    '                        .Detail.Controls.AddRange(New XRControl() _
    '                         {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                        intNewX += G_dblMaxWidthPicture + 20
    '                        'intCurY = intNewY
    '                    Else
    '                        For j As Integer = 0 To UBound(arrPicture)
    '                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                                strFileName = G_strPhotoPath & arrPicture(j)
    '                                .Detail.Controls.AddRange(New XRControl() _
    '                                 {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                                intNewX += G_dblMaxWidthPicture + 20
    '                                'intCurY = intNewY
    '                                Exit For
    '                            End If
    '                        Next
    '                    End If

    '                End If
    '            End If
    '        End If
    '        '--------
    '    End With
    '    Return Me
    'End Function
    ' RDC 08.29.2013 : Added Optional dtListePreparation As DataTable = Nothing
    'Function fctPrintRecipeCostingEGSStandard(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow, _
    '                                           ByVal foundAllergens() As DataRow, ByVal dtIngredients As DataTable, Optional dtListePreparation As DataTable = Nothing, Optional strConn As String = "") As XtraReport
    '    '483 height to manage
    '    Dim fntFont As Font

    '    Dim intDictionary As Integer
    '    Dim L_CurrencyName As String
    '    Dim dblCoefficient As String
    '    Dim dblTaxValue As Double
    '    Dim dblImposedPrice As Double
    '    Dim strName As String
    '    Dim strPortionUnit2Format As String
    '    Dim strCategoryName As String
    '    Dim strNumber As String
    '    Dim strSourceName As String = Nothing
    '    Dim strRemarks As String
    '    Dim strDate As String = Nothing
    '    Dim strPreparation As String = ""
    '    Dim strCoolingTime As String = ""
    '    Dim strHeatingTime As String = ""
    '    Dim strHeatingTemperature As String = ""
    '    Dim strHeatingMode As String = ""
    '    Dim strCCPdescription As String = ""
    '    Dim strHACCP As String = ""
    '    Dim strRecipeName As String
    '    Dim strServings As String
    '    Dim strYieldName As String
    '    Dim strNumberOfServings As String
    '    Dim strSubRecipeUnit As String
    '    Dim dblPercent As Double
    '    Dim dblYieldQty As Double
    '    Dim dblTotal As Double
    '    Dim dblPrice As Double
    '    Dim CurRate As Double
    '    Dim dblUnitFactor As Double
    '    Dim dblWastage As Double
    '    Dim dblFactor As Double
    '    Dim dblQuantityNet As Double
    '    Dim strQuantityNet As String = "0"
    '    Dim strUnit As String
    '    'Dim strUnitFormat As String
    '    Dim dblQuantityBrut As Double
    '    Dim strQuantityBrut As String = "0"
    '    Dim dblTotalLaborCost As Double
    '    Dim dblCoefficientBelvoir As Double
    '    Dim dblItemPrice As Double
    '    Dim strNetQty As String
    '    Dim strGrossQty As String
    '    Dim strDisplayUnit As String
    '    Dim lngDisplayUnit As Long


    '    Dim lngKiloCode As Long
    '    Dim lngLiterCode As Long
    '    'Dim str3Pictures As String = Nothing
    '    'Dim strPicture(0 To 2) As String
    '    Dim strPictureAll As String = "" 'VRP 07.11.2007

    '    Dim intAvailableWidth As Integer
    '    Dim intSpace As Integer
    '    Dim strX As String

    '    Dim dblYield2 As Double
    '    Dim blnSubRecipeComputation As Boolean = False

    '    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '    fctPrintRecipeCostingEGSStandard = Nothing

    '    sf = New StringFormat(StringFormatFlags.NoClip)

    '    Dim arrNutrientName As New ArrayList
    '    For Each tNut As tNutrient In G_Nutrient
    '        arrNutrientName.Add(tNut.Name)
    '    Next

    '    Try
    '        'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
    '        'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
    '        'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
    '        'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

    '        If G_ReportOptions.blnPictureOneRight Then
    '            fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
    '        Else
    '            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
    '        End If

    '        'SM 2015.05.15 added try catch for font that does not support regular fontstyle
    '        Try
    '            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '        Catch ex As Exception
    '            'fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try

    '        'SM 2015.05.15 added try catch for font that does not support bold fontstyle
    '        Try
    '            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        Catch ex As Exception
    '            ' fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try

    '        'SM 2015.05.15 added try catch for font that does not support Italic fontstyle
    '        Try
    '            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
    '        Catch ex As Exception
    '            ' fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '        End Try
    '    Catch ex As Exception

    '        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '        Return Me
    '    End Try

    '    If foundDetails.Length <= 0 Then
    '        Exit Function
    '    End If

    '    ReDim L_lngCol(0 To 12)

    '    Dim row As DataRow = foundDetails(0)
    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        'fctGetNutrientDetails()
    '        fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
    '    End If

    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        dblNutrientFactor = GetNutrientFactor(CInt(row("Code")))
    '    End If

    '    intDictionary = G_Language
    '    If G_ReportOptions.intTranslation > 0 Then
    '        intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
    '    End If
    '    G_Language = intDictionary

    '    L_CurrencyName = CType(CStrDB(row("Currency")), String)
    '    dblCoefficient = CType(CDblDB(row("coeff")), Double)
    '    dblTaxValue = CType(CDblDB(row("TaxValue")), Double)
    '    dblImposedPrice = CType(CDblDB(row("ImposedPrice")), Double)
    '    strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
    '    strPortionUnit2Format = G_FormatOneDecimal
    '    If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(CStrDB(row("PortionUnit2Format")), String)
    '    strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
    '    strNumber = fctNumber2Text(Trim(CType(CStrDB(row("RecipeNumber")), String)))

    '    If CType(CIntDB(row("codesource")), Integer) = 0 Then
    '        strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
    '    Else
    '        strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
    '    End If

    '    strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
    '    If Not IsDBNull(row("Dates")) Then strDate = CType(CStrDB(row("Dates")), String)

    '    strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

    '    If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(CType(CStrDB(row("CoolingTime")), String))
    '    If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(CType(CStrDB(row("HeatingTime")), String))
    '    If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(CType(CStrDB(row("HeatingTemperature")), String))
    '    If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(CType(CStrDB(row("HeatingMode")), String))
    '    strCCPdescription = fctGetTranslatedText(row, "CCPdescription", "CCPdescriptionTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CCPdescription)
    '    If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(CType(CStrDB(row("HACCP")), String))

    '    For i As Integer = 1 To 34 '15
    '        L_Nutrient(i).Value = -1
    '    Next


    '    Dim strFieldname As String = Nothing
    '    Dim strFieldnameForPercent As String = Nothing
    '    For i As Integer = 1 To 34 '15
    '        strFieldname = "N" & i.ToString
    '        'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '        strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
    '        If Not IsDBNull(row(strFieldname)) And _
    '           Not IsDBNull(row(strFieldnameForPercent)) Then
    '            If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
    '                L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
    '                G_Nutrient(i).Unit = "%"
    '                L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            Else
    '                L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '                L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            End If
    '        End If
    '    Next

    '    lngKiloCode = fctGetUnitCodeFromType(100)
    '    lngLiterCode = fctGetUnitCodeFromType(200)


    '    Dim intDPic As Integer
    '    If row.Table.Columns.Contains("DefaultPicture") Then
    '        intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
    '    Else
    '        intDPic = 1
    '    End If

    '    If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
    '    Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
    '    '------ 

    '    With Me
    '        'Papersize
    '        '------------
    '        .PaperKind = Printing.PaperKind.Custom
    '        .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

    '        'Margins
    '        '------------
    '        .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
    '        .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
    '        .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
    '        .Margins.Right = CInt(G_ReportOptions.dblRightMargin)



    '        'Orientation
    '        '-----------
    '        If G_ReportOptions.blLandscape Then
    '            .Landscape = True
    '            intAvailableWidth = .PageHeight
    '        Else
    '            .Landscape = False
    '            intAvailableWidth = .PageWidth
    '        End If

    '        intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

    '        'page header
    '        '-------------------------------------------
    '        intNewX = 0
    '        intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        intNewY += GetLineSpace(intTextHeight)



    '        intNewX = 0
    '        intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

    '        'Recipe Name
    '        strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
    '        intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
    '        intNewY += GetLineSpace(intTextHeight) + 20
    '        '-------------------------------------------

    '        ' RDC 08.29.2013 : Applied enhancements to code
    '        intNewX = 0
    '        intNewY = 20

    '        Dim xrRecipeMenuInfo As New XRTable 'anm first input with table 
    '        xrRecipeMenuInfo.Width = intAvailableWidth
    '        xrRecipeMenuInfo.Location = New Point(intNewX, intNewY)
    '        Dim xrRecipeMenuRow As New XRTableRow

    '        If G_ReportOptions.blnRecipe Then
    '            ' Recipe #
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

    '        Else
    '            ' Menu #
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Menu_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '        End If

    '        If G_ReportOptions.blnIncludeCategory Then
    '            ' Category
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category), ": " & strCategoryName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '        End If

    '        If G_ReportOptions.blnIncludeSource Then
    '            ' Source
    '            ' RDC 09.03.2013 : Change display from NO SOURCE to NOT DEFINED
    '            If strSourceName.ToUpper.Trim = "NO SOURCE" Or strSourceName Is Nothing Or strSourceName.Trim = "" Then strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source), ": " & strSourceName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '        End If

    '        If G_ReportOptions.blnIncludeDate Then
    '            ' Date
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_), ": " & Format(CDateDB(strDate), "dd/MM/yyyy")}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '        End If

    '        If G_ReportOptions.blnIncludeRemark Then
    '            ' Remarks
    '            xrRecipeMenuRow = New XRTableRow
    '            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark), ": " & strRemarks}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
    '        End If


    '        strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)

    '        '-- VRP 20.01.2009
    '        dblYieldQty = CType(row("Yield"), Double)
    '        Dim strYieldFormat As String = row("YieldFormat").ToString
    '        Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)

    '        Dim intYieldUnitOriginal As Integer = 0
    '        If row.Table.Columns.Contains("YieldUnitOriginalCode") Then intYieldUnitOriginal = CType(row("YieldUnitOriginalCode"), Integer) 'JTOC 31.05.2013

    '        Dim dblYieldQtyOrig As Double = 0.0
    '        If row.Table.Columns.Contains("YieldOriginalFactor") Then dblYieldQtyOrig = CType(row("YieldOriginalFactor"), Double) 'JTOC 31.05.2013


    '        Dim strYieldUnitNameOrig As String = ""
    '        If row.Table.Columns.Contains("YieldUnitOriginalName") Then strYieldUnitNameOrig = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 'JTOC 31.05.2013
    '        '---


    '        If G_Options.QtyType = 0 Then
    '            strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
    '            If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                strNumberOfServings = strNumberOfServings & "/" & _
    '                 fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " & _
    '                fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                dblYield2 = CType(row("Yield2"), Double)
    '                'blnSubRecipeComputation = True
    '            End If
    '        Else
    '            strNumberOfServings = fctConvertToFraction(CType(row("Yield"), Double) & " " & strYieldName)
    '            If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                'If G_ReportOptions.blnUseFractions Then
    '                '    strNumberOfServings = strNumberOfServings & "/" & _
    '                '    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & _
    '                '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                'Else
    '                '    strNumberOfServings = strNumberOfServings & "/" & _
    '                '    CType(row("Yield2"), Double) & " " & _
    '                '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                'End If
    '                strNumberOfServings = strNumberOfServings & "/" & _
    '                    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & _
    '                    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)

    '                strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
    '                dblYield2 = CType(row("Yield2"), Double)
    '                'blnSubRecipeComputation = True
    '            End If
    '        End If

    '        strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
    '        ' RDC 09.09.2013 :  CWM-8307 Fix
    '        strServings = strServings.Replace("[_]", "").Replace("N/A", "").Replace("n/a", "")
    '        ' 
    '        xrRecipeMenuRow = New XRTableRow
    '        xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.For_), ": " & strServings}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
    '        xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

    '        .Detail.Controls.Add(xrRecipeMenuInfo)
    '        intNewY += (xrRecipeMenuInfo.Height + 20)




    '        '' RDC 08.29.2013 : Code Enhancement
    '        '' Ingredient Header


    '        Dim xrIngredientHeader As New XRTable
    '        Dim xrIngredientHRow As New XRTableRow
    '        Dim xrIngredientCell As New XRTableCell

    '        Dim intExcessSpace As Integer = 0

    '        xrIngredientHeader.Location = New Point(intNewX, intNewY - 12) 'KMQDC 11.26.2015 original no -12
    '        xrIngredientHeader.Width = intAvailableWidth
    '        xrIngredientHeader.Borders = DevExpress.XtraPrinting.BorderSide.Top + DevExpress.XtraPrinting.BorderSide.Bottom
    '        xrIngredientHeader.BorderWidth = 1

    '        xrIngredientHRow.Height = CInt(40)

    '        Dim strNumberHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Number)
    '        Dim strMerchHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Merchandise)
    '        Dim strWastePctHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
    '        Dim strPriceHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Price)
    '        Dim strNetQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
    '        Dim strGrossQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
    '        Dim strAmountHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Amount)

    '        ' Recipe / Menu number
    '        If G_ReportOptions.blnIncludeNumber  Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(50)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strNumberHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(50)
    '        End If

    '        ' Merchandise / Ingredients
    '        xrIngredientCell = New XRTableCell
    '        xrIngredientCell.Width = CInt(160)
    '        xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
    '        xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        xrIngredientCell.Text = strMerchHeader
    '        xrIngredientHRow.Cells.Add(xrIngredientCell)

    '        ' Waste Percentage
    '        xrIngredientCell = New XRTableCell
    '        xrIngredientCell.Width = CInt(50)
    '        xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '        xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        xrIngredientCell.Text = strWastePctHeader
    '        xrIngredientHRow.Cells.Add(xrIngredientCell)

    '        ' Price
    '        xrIngredientCell = New XRTableCell
    '        xrIngredientCell.Width = CInt(85)
    '        xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '        xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        xrIngredientCell.Text = strPriceHeader
    '        xrIngredientHRow.Cells.Add(xrIngredientCell)

    '        ' Net Quantity
    '        If G_ReportOptions.blnIncludeNetQty Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strNetQtyHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(85)
    '        End If

    '        ' Gross Quantity
    '        If G_ReportOptions.blnIncludeGrossQty Then
    '            xrIngredientCell = New XRTableCell
    '            xrIngredientCell.Width = CInt(85)
    '            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            xrIngredientCell.Text = strGrossQtyHeader
    '            xrIngredientHRow.Cells.Add(xrIngredientCell)
    '        Else
    '            intExcessSpace += CInt(85)
    '        End If

    '        ' Amount
    '        xrIngredientCell = New XRTableCell
    '        xrIngredientCell.Width = CInt(85)
    '        xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
    '        xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        xrIngredientCell.Text = strAmountHeader
    '        xrIngredientHRow.Cells.Add(xrIngredientCell)

    '        If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngredientHRow.Cells(0).Width += intExcessSpace Else xrIngredientHRow.Cells(1).Width += intExcessSpace

    '        xrIngredientHeader.Rows.Add(xrIngredientHRow)
    '        .Detail.Controls.Add(xrIngredientHeader)

    '        intNewY += (xrIngredientHeader.Height + 5)

    '        Dim xrIngrInfo As New XRTable
    '        Dim xrIngrRow As New XRTableRow
    '        Dim xrIngrCell As New XRTableCell
    '        xrIngrInfo.Width = intAvailableWidth
    '        xrIngrInfo.Location = New Point(intNewX, intNewY)

    '        For Each drIngredient As DataRow In dtIngredients.Select("CodeMain=" & row("Code")) 'AGL 2013.11.06 - 9372 - added filter
    '            xrIngrRow = New XRTableRow
    '            xrIngrRow.Width = xrIngrInfo.Width
    '            xrIngrRow.Height = G_ReportOptions.sgFontSize2

    '            Dim strIngrFormat As String = fctNullToString(drIngredient("ItemFormat"))
    '            If strIngrFormat = "" Then strIngrFormat = "#,###.00"

    '            Dim fntFontType As FontStyle = FontStyle.Regular
    '            Select Case CIntDB(drIngredient("ItemType"))
    '                Case ID_Recipe
    '                    fntFontType = FontStyle.Italic
    '                Case Else

    '            End Select

    '            ' Item Number
    '            If G_ReportOptions.blnIncludeIngrNumber Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(50)
    '                Try
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                Catch ex As Exception
    '                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                If IsDBNull(drIngredient("ItemNumber")) Then xrIngrCell.Text = "" Else xrIngrCell.Text = drIngredient("ItemNumber")
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If


    '            ' Item Name
    '            Dim strIngrComple As String = "", strIngrName As String = ""
    '            If CInt(drIngredient("ItemType")) = 0 Then
    '                strIngrComple = drIngredient("tmpComplement").ToString
    '                strIngrName = drIngredient("tmpName").ToString
    '            Else
    '                strIngrComple = fctGetTranslatedText(drIngredient, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
    '                strIngrName = fctGetTranslatedText(drIngredient, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)
    '            End If

    '            Dim xrRText As New XRRichText
    '            Dim RText As New RichTextBox

    '            If CBoolDB(drIngredient("isBrandedIngredient")) Then
    '                RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            Else
    '                Try
    '                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                Catch ex As Exception
    '                    RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '                End Try
    '            End If
    '            RText.SelectedText = strIngrName & " "
    '            Try
    '                RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '            Catch ex As Exception
    '                RText.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            End Try
    '            RText.SelectedText = strIngrComple

    '            xrRText.Rtf = RText.Rtf
    '            xrRText.Width = CInt(160)

    '            xrIngrCell = New XRTableCell
    '            xrIngrCell.Width = CInt(160)
    '            Try
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '            Catch ex As Exception
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            End Try
    '            xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '            xrIngrCell.Controls.Add(xrRText)
    '            xrIngrRow.Cells.Add(xrIngrCell)

    '            ' Wastage Percentage
    '            xrIngrCell = New XRTableCell
    '            xrIngrCell.Width = CInt(50)
    '            Try
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '            Catch ex As Exception
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            End Try
    '            xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '            ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '            If Not drIngredient("ItemType") = 0 Then
    '                If CDblDB(drIngredient("TotalWastage")) > 0 Then xrIngrCell.Text = drIngredient("TotalWastage").ToString Else xrIngrCell.Text = ""
    '            Else
    '                xrIngrCell.Text = ""
    '            End If
    '            xrIngrRow.Cells.Add(xrIngrCell)

    '            ' Price
    '            Dim strIngrUnitPrice As String = ""
    '            If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = CStrDB(drIngredient("tmpUnit")) Else strIngrUnitPrice = " / " & CStrDB(drIngredient("PriceUnit"))
    '            If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '            Dim dblIngrPrice As Double = CDblDB(drIngredient("ItemPrice"))

    '            xrIngrCell = New XRTableCell
    '            xrIngrCell.Width = CInt(85)
    '            Try
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '            Catch ex As Exception
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '            End Try
    '            xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '            ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '            If Not drIngredient("ItemType") = 0 Then
    '                xrIngrCell.Text = Format(dblIngrPrice, G_strPriceFormat) & strIngrUnitPrice
    '            Else
    '                xrIngrCell.Text = ""
    '            End If
    '            xrIngrRow.Cells.Add(xrIngrCell)
    '            'start LLG 10.20.2015 commented and replace Net QTY,Gross QTY and Amount'
    '            ' Net Quantity
    '            If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
    '            If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '            If G_ReportOptions.blnIncludeNetQty Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                If Not drIngredient("ItemType") = 0 Then
    '                    xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
    '                Else
    '                    xrIngrCell.Text = ""
    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If

    '            ' Gross Quantity
    '            If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
    '            If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

    '            If G_ReportOptions.blnIncludeGrossQty Then
    '                xrIngrCell = New XRTableCell
    '                xrIngrCell.Width = CInt(85)
    '                xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '                If Not drIngredient("ItemType") = 0 Then
    '                    xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
    '                Else
    '                    xrIngrCell.Text = ""
    '                End If
    '                xrIngrRow.Cells.Add(xrIngrCell)
    '            End If
    '            ' Amount
    '            Dim dblAmount As Double = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("GrossQuantity")) '/ dblYieldQty
    '            dblTotal += dblAmount

    '            xrIngrCell = New XRTableCell
    '            xrIngrCell.Width = CInt(85)
    '            xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
    '            xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight


    '            ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
    '            If Not drIngredient("ItemType") = 0 Then
    '                xrIngrCell.Text = Format(dblAmount, G_strPriceFormat)
    '            Else
    '                xrIngrCell.Text = ""
    '            End If
    '            xrIngrRow.Cells.Add(xrIngrCell)

    '            If intExcessSpace > 0 Then
    '                If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngrRow.Cells(0).Width += intExcessSpace Else xrIngrRow.Cells(1).Width += intExcessSpace
    '            End If

    '            xrIngrInfo.Rows.Add(xrIngrRow)

    '        Next

    '        .Detail.Controls.Add(xrIngrInfo)
    '        intNewY += (xrIngrInfo.Height + 5)




    '        dblPercent = CType(row("DishPercent"), Double) / 100
    '        dblYieldQty = CType(row("Yield"), Double)
    '        'dblTotal = 0
    '        dblPrice = 0
    '        Dim borderSideText As DevExpress.XtraPrinting.BorderSide = GetLabelBorderSide()
    '        For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
    '            CurRate = 0
    '            If Not IsDBNull(foundDetails(rowIng)("Rate")) Then CurRate = CType(foundDetails(rowIng)("Rate"), Double)
    '            dblUnitFactor = 0
    '            If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double)

    '            If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
    '                dblWastage = 100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100
    '                dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
    '            End If
    '            If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)
    '            If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)
    '            If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)
    '            dblWastage = (100 - dblWastage)
    '            dblPrice = 0
    '            dblFactor = 1
    '            If Not IsDBNull(foundDetails(rowIng)("Factor")) Then dblFactor = CType(foundDetails(rowIng)("Factor"), Double)
    '            If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblPrice = CType(foundDetails(rowIng)("ItemPrice"), Double) * CurRate * dblFactor
    '            If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then dblQuantityNet = CType(foundDetails(rowIng)("Quantity"), Double)


    '            dblQuantityBrut = dblQuantityNet / (1 - (dblWastage / 100))

    '            dblPrice = (dblQuantityBrut * dblPrice * dblUnitFactor)

    '            'dblTotal += dblPrice

    '        Next
    '        ''-------------------------------------------
    '        'dblTotal = 0
    '        dblTotalLaborCost = 0
    '        If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double)
    '        dblCoefficientBelvoir = 0
    '        If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double)


    '        'Cost of Goods

    '        Dim dblMerchandiseCost As Double
    '        Dim dblPriceTax As Double
    '        Dim dblImposedPriceTax As Double
    '        Dim dblImposedPriceNoTax As Double
    '        Dim dblImposedCoeff As Double
    '        Dim dblSellingPriceYield As Double

    '        'AGL 2013.11.04 - 9277 START - commented this portion, duplicate costing appearing on report ===========================================================
    '        intNewX = 0
    '        intNewY += 10
    '        'sf = New StringFormat(StringFormatFlags.DirectionVertical)
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
    '        L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


    '        strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
    '        L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '        L_lngCol(3) = (L_lngCol(1) / 2)

    '        L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
    '        L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
    '        L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

    '        'Dim intNumberOfRows As Integer = 4
    '        Dim intCurY As Integer
    '        'Dim intCurX As Integer
    '        'If dblTaxValue <> 0 Then intNumberOfRows = 8

    '        intCurY = intNewY
    '        intNewY += GetLineSpace(intTextHeight) - 10 'KMQDC 11.26.2015 original no -10
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewY += GetLineSpace(intTextHeight)
    '        'anm noted 1


    '        If Not G_ReportOptions.bFoodcostOnly Then

    '            Select Case G_Options.FactorType
    '                'Selling Price/const
    '                Case 0
    '                    dblCoefficient = Format(dblCoefficient, "Standard")
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
    '                Case 1
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
    '                    strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
    '                Case 2
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
    '                    strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
    '            End Select
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 2


    '            dblMerchandiseCost = 0
    '            If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

    '            If dblTaxValue <> 0 Then
    '                dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
    '                dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
    '                dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

    '                If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
    '                    dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
    '                Else
    '                    dblImposedCoeff = 0
    '                End If

    '                strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
    '                strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 3

    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 4
    '                Select Case G_Options.FactorType
    '                    'Imposed selling price/const
    '                    Case 0
    '                        strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
    '                        strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                    Case 1
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
    '                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
    '                    Case 2
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
    '                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
    '                End Select
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 5
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
    '                strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 6
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 7
    '            Else
    '                dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
    '                dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
    '                dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

    '                If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
    '                    dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
    '                Else
    '                    dblImposedCoeff = 0
    '                End If

    '                Select Case G_Options.FactorType
    '                    Case 0
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
    '                        strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
    '                    Case 1
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
    '                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
    '                    Case 2
    '                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
    '                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
    '                End Select
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewY += GetLineSpace(intTextHeight)
    '                'anm noted 8
    '            End If


    '            intNewX = 0

    '        End If

    '        'AGL 2013.11.04 - 9277 END===========================================================

    '        'Per X Yield
    '        intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
    '        intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)
    '        'AGL 2013.11.04
    '        subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName)

    '        intNewX = 0
    '        intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
    '        intNewX += L_lngNameW + L_lngCol(3)
    '        dblMerchandiseCost = 0
    '        If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
    '        dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
    '        'Per 1 yield
    '        'AGL 2013.11.04
    '        subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strYieldName)

    '        Dim dblRatioYield1Yield2 As Double
    '        Dim dblSellingPriceSubRecipe As Double
    '        If blnSubRecipeComputation Then
    '            dblRatioYield1Yield2 = 0
    '            dblMerchandiseCost = 0
    '            If dblYield2 <> 0 Then
    '                dblRatioYield1Yield2 = dblYieldQty / dblYield2
    '                dblMerchandiseCost = dblTotal / dblYield2
    '            End If

    '            dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
    '            dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

    '            'per 1 Subrecipe Unit
    '            subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit)
    '        End If


    '        intNewX = 0
    '        intNewY += GetLineSpace(intTextHeight)
    '        'anm noted 9

    '        'str3Pictures = ""
    '        If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007


    '        '------------------------------------------------------

    '        'Preparation
    '        intNewX = 0


    '        ' RDC 09.04.2013 : Preparation layout using table control
    '        If G_ReportOptions.blnIncludePreparation And Not dtListePreparation Is Nothing Then
    '            Dim xrStepTable As New XRTable 'anm 1
    '            Dim xrStepRow As New XRTableRow
    '            Dim xrStepCell As New XRTableCell
    '            Dim xrStepCellB As New XRTableCell

    '            xrStepTable.Location = New Point(intNewX, intNewY - 35) 'KMQDC 11.26.2015 original no -35

    '            xrStepTable.Width = intAvailableWidth
    '            xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None
    '            'xrStepCell.CanGrow = True
    '            'xrStepCellB.CanGrow = True
    '            xrStepCell.CanShrink = True
    '            xrStepCellB.CanShrink = True

    '            For Each drStep As DataRow In dtListePreparation.Select("Codeliste=" & CIntDB(row("Code")))
    '                'xrStepRow = New XRTableRow  'original
    '                'xrStepRow.Height = G_ReportOptions.sgFontSize2  'original

    '                ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
    '                Dim rtb As New RichTextBox
    '                rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                Dim xrt As New XRRichText
    '                xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                'xrt.CanGrow = True
    '                xrt.CanShrink = True
    '                If Not G_ReportOptions.blnMode Then
    '                    If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(Environment.NewLine + Environment.NewLine + Environment.NewLine + drStep("Note").ToString) Else rtb.AppendText(Chr(32)) 'KMQDC 11.26.2015
    '                Else
    '                    If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(Environment.NewLine + Environment.NewLine + Environment.NewLine + drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
    '                End If

    '                'Dim i As Integer = 0
    '                'Dim rtbNew As New RichTextBox 'anm 1-8-2016
    '                'For Each Line As String In rtb.Lines
    '                '    i += 1
    '                '    If i <= 15 Then
    '                '        If Line = "" Then
    '                '            rtbNew.AppendText(Environment.NewLine)
    '                '        Else
    '                '            rtbNew.AppendText(Environment.NewLine + Line)
    '                '        End If


    '                '    Else
    '                '        rtbNew.AppendText(Environment.NewLine + Environment.NewLine + Line)
    '                '    End If
    '                '    If i = 15 Then
    '                '        xrt.Rtf = rtbNew.Rtf
    '                '        xrStepCell.Controls.Add(xrt)
    '                '        xrStepRow.Cells.Add(xrStepCell)
    '                '        xrStepTable.Rows.Add(xrStepRow)
    '                '        .Detail.Controls.Add(xrStepTable)
    '                '        intNewY += (xrStepTable.Height + 20)
    '                '    End If

    '                'Next

    '                ' xrt.Rtf = rtbNew.Rtf
    '                xrt.Rtf = rtb.Rtf

    '                xrStepRow = New XRTableRow
    '                xrStepRow.Height = G_ReportOptions.sgFontSize2

    '                Select Case row("MethodFormat").ToString.Trim.ToLower  'original


    '                    Case "x", "" ' Not bulleted / numbered
    '                        'xrStepCell = New XRTableCell
    '                        'xrStepCell.Width = intAvailableWidth
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        'xrStepRow.Cells.Add(xrStepCell)


    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth
    '                        rtb.Width = intAvailableWidth
    '                        xrt.Width = intAvailableWidth
    '                        xrStepCell.CanGrow = False
    '                        'xrStepCell.Controls.Add(xrt)
    '                        'xrStepRow.Cells.Add(xrStepCell) 'KMQDC 11.24.2015
    '                        'xrStepTable.Rows.Add(xrStepRow)
    '                        '.Detail.Controls.Add(xrStepTable)
    '                        'intNewY += (xrStepTable.Height + 20)
    '                        'xrStepTable = manageExtendedLine(rtb, intNewY, xrStepCell)

    '                        Dim onceCount As Integer = 0
    '                        'anm
    '                        ' Dim currentHeight As New Integer
    '                        '  currentHeight = intNewY
    '                        Dim x As Integer = rtb.Lines.Count
    '                        Dim countTo3 As Integer = 0
    '                        Dim addToName As Integer = 0
    '                        Dim curY = intNewY - 35
    '                        Dim newLoop As Boolean = False
    '                        Dim rtbNew As New RichTextBox
    '                        Dim xrts As New XRRichText
    '                        Dim xrNewStepTable As New XRTable
    '                        Dim textLeftCount As Integer = rtb.Lines.Count Mod 3
    '                        Dim lineCountLeft As Integer = rtb.Lines.Count - textLeftCount
    '                        Dim LineCounter As Integer
    '                        For Each Line As String In rtb.Lines
    '                            countTo3 += 1
    '                            LineCounter += 1
    '                            If Line = "" Then
    '                                rtbNew.AppendText(Environment.NewLine)
    '                            Else
    '                                If countTo3 = 1 Then
    '                                    rtbNew.AppendText(Line)
    '                                Else
    '                                    rtbNew.AppendText(Line + Environment.NewLine)
    '                                End If
    '                            End If
    '                            xrts.Rtf = rtbNew.Rtf

    '                            If countTo3 = 1 Then
    '                                countTo3 = 0
    '                                xrts.Width = intAvailableWidth
    '                                xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                                xrts.CanShrink = True
    '                                xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                                xrts.KeepTogether = True
    '                                xrts.Location = New Point(intNewX, curY)
    '                                .Detail.Controls.AddRange(New XRControl() {xrts})
    '                                curY += (xrts.Height)
    '                                rtbNew = New RichTextBox
    '                                xrts = New XRRichText
    '                                xrNewStepTable = New XRTable
    '                            End If
    '                            'If LineCounter = lineCountLeft Then
    '                            '    If countTo3 = textLeftCount Then
    '                            '        countTo3 = 0
    '                            '        xrts.Width = intAvailableWidth
    '                            '        xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                            '        xrts.CanShrink = True
    '                            '        xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                            '        xrts.KeepTogether = True
    '                            '        xrts.Location = New Point(intNewX, curY)
    '                            '        .Detail.Controls.AddRange(New XRControl() {xrts})
    '                            '        curY += (xrts.Height)
    '                            '        rtbNew = New RichTextBox
    '                            '        xrts = New XRRichText
    '                            '        xrNewStepTable = New XRTable
    '                            '    End If
    '                            'Else
    '                            '    If countTo3 = 3 Then
    '                            '        countTo3 = 0
    '                            '        xrts.Width = intAvailableWidth
    '                            '        xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
    '                            '        xrts.CanShrink = True
    '                            '        xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                            '        xrts.KeepTogether = True
    '                            '        xrts.Location = New Point(intNewX, curY)
    '                            '        .Detail.Controls.AddRange(New XRControl() {xrts})
    '                            '        curY += (xrts.Height)
    '                            '        rtbNew = New RichTextBox
    '                            '        xrts = New XRRichText
    '                            '        xrNewStepTable = New XRTable
    '                            '    End If
    '                            'End If



    '                            'If Not countTo3 > 3 Then
    '                            'If countTo3 = 3 Then
    '                            '    countTo3 = 0
    '                            '    xrts.Location = New Point(intNewX, curY)
    '                            '    xrts.KeepTogether = True
    '                            '    Dim xrNewStepTable As New XRTable
    '                            '    xrNewStepTable.Location = New Point(intNewX, curY)
    '                            '    xrNewStepTable.Width = intAvailableWidth
    '                            '    xrNewStepTable.Borders = DevExpress.XtraPrinting.BorderSide.All
    '                            '    xrNewStepTable.KeepTogether = True
    '                            '    xrNewStepTable.Rows.Add(xrStepRow)
    '                            '    .Detail.Controls.AddRange(New XRControl() {xrts})
    '                            '    curY += (xrts.Height)
    '                            '    rtbNew = New RichTextBox
    '                            '   countTo3 += 1
    '                            'End If
    '                            ' End If
    '                            'If Not currentHeight > 485 Then
    '                            '    rtbNew.AppendText(Environment.NewLine + Line)
    '                            '    xrt.Rtf = rtbNew.Rtf
    '                            '    xrStepCell.Controls.Add(xrt)
    '                            '    xrStepRow.Cells.Add(xrStepCell)
    '                            '    currentHeight += 2
    '                            'Else
    '                            '    onceCount += 1
    '                            '    If onceCount = 1 Then
    '                            '        rtbNew.AppendText(Environment.NewLine + Environment.NewLine + Line)
    '                            '    Else
    '                            '        rtbNew.AppendText(Environment.NewLine + Line)
    '                            '    End If
    '                            '    xrt.Rtf = rtbNew.Rtf

    '                            '    xrStepCell.Controls.Add(xrt)
    '                            '    xrStepRow.Cells.Add(xrStepCell)
    '                            '    currentHeight += xrt.Height
    '                            'End If
    '                        Next
    '                        intNewY = curY
    '                    Case "n" ' Number bullet
    '                        'xrStepCell = New XRTableCell
    '                        'xrStepCell.Width = 15
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                        'xrStepCell.Text = drStep("Position") & "."
    '                        'xrStepRow.Cells.Add(xrStepCell)

    '                        'xrStepCell = New XRTableCell
    '                        'xrStepCell.Width = intAvailableWidth - 15
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        'xrStepRow.Cells.Add(xrStepCell)

    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                        xrStepCell.Text = drStep("Position") & "."
    '                        xrStepRow.Cells.Add(xrStepCell)

    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Controls.Add(xrt)
    '                        xrStepRow.Cells.Add(xrStepCell) 'KMQDC 11.24.2015
    '                        xrStepTable.Rows.Add(xrStepRow)
    '                        .Detail.Controls.Add(xrStepTable)
    '                        intNewY += (xrStepTable.Height + 20)
    '                    Case "b" ' Symbol bullet "•"
    '                        'xrStepCell = New XRTableCell
    '                        'xrStepCell.Width = 15
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
    '                        'xrStepCell.Text = "•"
    '                        'xrStepRow.Cells.Add(xrStepCell)

    '                        'xrStepCell = New XRTableCell
    '                        'xrStepCell.Width = intAvailableWidth - 15
    '                        'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
    '                        'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
    '                        'xrStepRow.Cells.Add(xrStepCell)

    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '                        xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
    '                        xrStepCell.Text = "•"
    '                        xrStepRow.Cells.Add(xrStepCell)

    '                        xrStepCell = New XRTableCell
    '                        xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
    '                        xrStepCell.Controls.Add(xrt)
    '                        xrStepRow.Cells.Add(xrStepCell) 'KMQDC 11.24.2015
    '                        xrStepTable.Rows.Add(xrStepRow)
    '                        .Detail.Controls.Add(xrStepTable)
    '                        intNewY += (xrStepTable.Height + 20)
    '                End Select
    '                'xrStepTable.Rows.Add(xrStepRow)
    '            Next

    '            '.Detail.Controls.Add(xrStepTable)

    '        End If



    '        If G_ReportOptions.blnIncludeHACCP Then
    '            subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001")
    '            intNewY += intTextHeight
    '            'anm noted 10
    '        End If

    '        '---JRN 17.03.2010
    '        'For keywords
    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeKeyword Then
    '            subDisplayKeywords(foundKeywords, "001")
    '            intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 11
    '        End If


    '        'If G_ReportOptions.blnIncludeNutrients Then
    '        '    subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001")
    '        '    intNewY += GetLineSpace(intTextHeight)
    '        'End If

    '        ' RDC 09.05.2013 : Nutrient enhancement
    '        Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
    '        Dim intSelCodeTrans As Integer = 0
    '        Dim intCodeSetDisplay As Integer = 0
    '        For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
    '            intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
    '            intSelCodeTrans = CInt(drDispSet("codeTrans"))
    '            intCodeSetDisplay = CInt(drDispSet("CodeSet"))
    '        Next

    '        intNewY += 20

    '        If G_ReportOptions.blnIncludeNutrients Then
    '            ' Section Header
    '            Dim xrNutHeader As New XRTable
    '            xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutrientInformation), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
    '            .Detail.Controls.Add(xrNutHeader)

    '            intNewY += (xrNutHeader.Height + 10)

    '            Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
    '            subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSetDisplay, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice)

    '            intNewY += 20
    '        End If


    '        'GDA
    '        If G_ReportOptions.blnIncludeGDA Then
    '            subDisplayGDAComputation(CInt(row("Code")), intCodeSetDisplay, intSelCodeTrans, CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice")))
    '            ' ''    subDisplayNutrientsGDA(strYieldName, _
    '            ' ''        dblNutrientFactor, L_Nutrient, "001")
    '            ' ''    intNewY += GetLineSpace(intTextHeight)
    '        End If



    '        '---

    '        'Allergens MCM 03.03.06
    '        '----------------------
    '        If G_ReportOptions.blnIncludeAllergens Then
    '            intNewY -= 15
    '            '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
    '            '  subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", , , strConn, row("Code"))
    '            intNewY += GetLineSpace(intTextHeight)
    '            'anm noted 12
    '            Dim row1 As DataRow = foundDetails(0) 'KMQDC 11.24.2015

    '            Dim CodeAllergenTranslation As Integer 'KMQDC 11.24.2015
    '            CodeAllergenTranslation = CType(row1("CodeTrans"), Integer) 'KMQDC 11.24.2015


    '            subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", False, False, strConn)
    '        End If
    '        'End of Allergens




    '        Dim dblMaxWidthPicture As Double
    '        Dim dblMaxHeightPicture As Double
    '        intNewX = 0
    '        If G_ReportOptions.blnPicturesAll = True Then
    '            G_ReportOptions.blnWithPicture = False

    '            dblMaxWidthPicture = (intAvailableWidth - 200) / 3
    '            dblMaxHeightPicture = dblMaxWidthPicture * 1.5
    '        Else
    '            dblMaxHeightPicture = 250
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

    '        End If


    '        'For j As Integer = 0 To 2
    '        '    strPicture(j) = ""
    '        '    strPicture(j) = fctGetPictureName(str3Pictures, j)
    '        'Next

    '        If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
    '            dblMaxHeightPicture = 350
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '        End If

    '        Dim strFileName As String


    '        ''---GDA Image JRN 06.07.2010
    '        If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
    '            Dim bShowGDAImage As Boolean = False
    '            For Each arr As tNutrient In G_Nutrient
    '                If CDblDB(arr.GDA) > 0 Then
    '                    bShowGDAImage = True
    '                    Exit For
    '                End If
    '            Next
    '            If bShowGDAImage Then
    '                G_ReportOptions.blnIncludeGDA = False
    '                Dim intGDAPanelHeight = 70
    '                Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
    '                Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
    '                Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
    '                .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
    '            End If
    '        End If

    '        '---

    '        '--- VRP 07.11.2007
    '        If G_ReportOptions.blnPicturesAll = True Then
    '            If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                For j As Integer = 0 To UBound(arrPicture)
    '                    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                        strFileName = G_strPhotoPath & arrPicture(j)
    '                        .Detail.Controls.AddRange(New XRControl() _
    '                         {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                    End If
    '                    intNewX += CInt(G_dblMaxWidthPicture) + 5
    '                Next
    '                intNewY += CInt(G_dblMaxHeightPicture)
    '                'anm noted 10
    '            End If
    '            intNewY += 10
    '            intNewX = 0
    '        Else
    '            If G_ReportOptions.blnWithPicture = True Then
    '                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                    If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
    '                        strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
    '                        .Detail.Controls.AddRange(New XRControl() _
    '                         {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                        intNewX += G_dblMaxWidthPicture + 20
    '                        'intCurY = intNewY
    '                    Else
    '                        For j As Integer = 0 To UBound(arrPicture)
    '                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                                strFileName = G_strPhotoPath & arrPicture(j)
    '                                .Detail.Controls.AddRange(New XRControl() _
    '                                 {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                                intNewX += G_dblMaxWidthPicture + 20
    '                                'intCurY = intNewY
    '                                Exit For
    '                            End If
    '                        Next
    '                    End If

    '                End If
    '            End If
    '        End If
    '        '--------
    '    End With
    '    Return Me
    'End Function
    Function fctPrintRecipeCostingEGSStandard2(ByVal row As DataRow, ByVal foundKeywords() As DataRow,
                                            ByVal foundAllergens() As DataRow, ByVal dtIngredients As DataTable) As XtraReport

        Dim fntFont As Font

        Dim intDictionary As Integer
        Dim L_CurrencyName As String
        Dim dblCoefficient As String
        Dim dblTaxValue As Double
        Dim dblImposedPrice As Double
        Dim strName As String
        Dim strPortionUnit2Format As String
        Dim strCategoryName As String
        Dim strNumber As String
        Dim strSourceName As String = Nothing
        Dim strRemarks As String
        Dim strDate As String = Nothing
        Dim strPreparation As String = ""
        Dim strCoolingTime As String = ""
        Dim strHACCP As String = ""
        Dim strHeatingTime As String = ""
        Dim strHeatingTemperature As String = ""
        Dim strHeatingMode As String = ""
        Dim strCCPdescription As String = ""
        Dim strRecipeName As String
        Dim strServings As String
        Dim strYieldName As String
        Dim strNumberOfServings As String
        Dim strSubRecipeUnit As String
        Dim dblPercent As Double
        Dim dblYieldQty As Double
        Dim dblTotal As Double
        Dim dblPrice As Double
        Dim CurRate As Double
        Dim dblUnitFactor As Double
        Dim dblWastage As Double
        Dim dblFactor As Double
        Dim dblQuantityNet As Double
        Dim strUnit As String
        'Dim strUnitFormat As String
        Dim dblQuantityBrut As Double
        Dim dblTotalLaborCost As Double
        Dim dblCoefficientBelvoir As Double
        Dim dblItemPrice As Double
        Dim strNetQty As String
        Dim strGrossQty As String
        Dim strDisplayUnit As String
        Dim lngDisplayUnit As Long
        Dim strPriceFormat As String

        Dim lngKiloCode As Long
        Dim lngLiterCode As Long
        'Dim str3Pictures As String = Nothing
        'Dim strPicture(0 To 2) As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007

        Dim intAvailableWidth As Integer
        Dim intSpace As Integer
        Dim strX As String

        Dim dblYield2 As Double
        Dim blnSubRecipeComputation As Boolean = False

        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

        fctPrintRecipeCostingEGSStandard2 = Nothing

        sf = New StringFormat(StringFormatFlags.NoClip)

        Try
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            End If
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        'If foundDetails.Length <= 0 Then
        '    Exit Function
        'End If

        ReDim L_lngCol(0 To 12)

        'Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, G_strConnection) 'VRP 08.01.2009
        End If

        intDictionary = G_Language
        If G_ReportOptions.intTranslation > 0 Then
            intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
        End If
        G_Language = intDictionary


        strPriceFormat = CType(CStrDB(row("curFormat")), String)
        L_CurrencyName = CType(row("Currency"), String)
        dblCoefficient = CType(row("coeff"), Double)
        dblTaxValue = CType(row("TaxValue"), Double)
        dblImposedPrice = CType(row("ImposedPrice"), Double)
        strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
        strPortionUnit2Format = G_FormatOneDecimal
        If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(row("PortionUnit2Format"), String)
        strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
        strNumber = fctNumber2Text(Trim(CType(row("RecipeNumber"), String)))

        If CType(row("codesource"), Integer) = 0 Then
            strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
        Else
            strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
        End If

        strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
        If Not IsDBNull(row("Dates")) Then strDate = CType(row("Dates"), String)

        strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

        If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(CType(row("CoolingTime"), String))
        If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(CType(row("HeatingTime"), String))
        If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(CType(row("HeatingTemperature"), String))
        If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(CType(row("HeatingMode"), String))
        strCCPdescription = fctGetTranslatedText(row, "CCPdescription", "CCPdescriptionTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CCPdescription)
        If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(CType(row("HACCP"), String))

        For i As Integer = 1 To 34 '15
            L_Nutrient(i).Value = -1
        Next

        'If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
        'If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
        'If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
        'If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
        'If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
        'If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
        'If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
        'If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
        'If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
        'If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
        'If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
        'If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
        'If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
        'If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
        'If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

        Dim strFieldname As String = Nothing
        Dim strFieldnameForPercent As String = Nothing
        For i As Integer = 1 To 34 '15
            strFieldname = "N" & i.ToString
            'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
            strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
            If Not IsDBNull(row(strFieldname)) And
               Not IsDBNull(row(strFieldnameForPercent)) Then
                If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                    L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                    G_Nutrient(i).Unit = "%"
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                Else
                    L_Nutrient(i).Value = CType(row(strFieldname), Double)
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                End If
            End If
        Next

        lngKiloCode = fctGetUnitCodeFromType(100)
        lngLiterCode = fctGetUnitCodeFromType(200)

        'dblNutrientFactor = fctGetNutrientFactor(False, CType(row("YieldUnit1"), Long), _
        '                    CType(row("SrUnit"), Long), _
        '                    CType(row("SrQty"), Double), _
        '                    CType(row("SrLevel"), Double), lngKiloCode, lngLiterCode)

        'For j As Integer = 0 To 2
        '    strPicture(j) = ""
        'Next

        'If Not IsDBNull(row("Pix")) Then str3Pictures = CType(row("Pix"), String)
        'If str3Pictures <> "" Then
        '    For j As Integer = 0 To 2
        '        strPicture(j) = fctGetPictureName(str3Pictures, j)
        '    Next
        'End If

        '--- VRP 07.11.2007
        If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
        Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
        '------ 

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)


            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'page header
            '-------------------------------------------
            intNewX = 0
            intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
            strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)

            intNewX = 0
            intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

            'Recipe Name
            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            intNewY += GetLineSpace(intTextHeight) + 20
            '-------------------------------------------


            intNewX = 0
            intNewY = 0
            intSpace = 0
            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
            intNewY += intTextHeight
            sf = New StringFormat(StringFormatFlags.DirectionVertical)
            If G_ReportOptions.blnRecipe Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)           'Recipe #
                intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)
            Else
                strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)             'Menu #
                intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)
            End If

            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                'Category
            intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Source)                  'Source
            intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)                   'Date
            intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)

            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)             'Cost of Goods
            intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                  'Remarks
            intSpace = fctGetWidest(strX, intTextHeight, intSpace, fntRegular)
            intSpace *= 1.5

            If G_ReportOptions.blnIncludeNumber Then
                If G_ReportOptions.blnRecipe Then
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Recipe_No)           'Recipe #
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                Else
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)             'Menu #
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                End If

                intNewX += intSpace
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strNumber, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            If G_ReportOptions.blnIncludeCategory Then
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)            'Category
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                intNewX += intSpace
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strCategoryName, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            If G_ReportOptions.blnIncludeSource Then
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)              'Source
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                intNewX += intSpace
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strSourceName, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            If G_ReportOptions.blnIncludeDate Then
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)               'Date
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                intNewX += intSpace

                Dim date1 As Date
                Try
                    date1 = CType(strDate, Date)
                Catch ex As Exception
                    date1 = strDate.Replace(".", "/")
                End Try
                strDate = Format(date1, G_strDateFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strDate, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            If G_ReportOptions.blnIncludeRemark Then
                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)              'Remark
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                intNewX += intSpace
                strDate = Format(CType(strDate, Date), G_strDateFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strRemarks, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)


            If G_Options.QtyType = 0 Then
                strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
                If CType(row("Yield2"), String) > 0 Then
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " &
                    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            Else
                If G_ReportOptions.blnUseFractions Then
                    strNumberOfServings = fctConvertToFraction(CType(row("Yield"), Double) & " " & strYieldName)
                Else
                    strNumberOfServings = CType(row("Yield"), Double) & " " & strYieldName
                End If

                If CType(row("Yield2"), Double) > 0 Then
                    If G_ReportOptions.blnUseFractions Then
                        strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction(CType(row("Yield2"), Double)) & " " &
                        fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    Else
                        strNumberOfServings = strNumberOfServings & "/" &
                        CType(row("Yield2"), Double) & " " &
                        fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    End If

                    strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            End If



            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.For_) 'For
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            intNewX += intSpace
            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
            'strServings = strNumberOfServings & " at " & Format(CType(row("DishPercent"), Double), G_FormatWhole) & "%" 'Replace(Replace(FTB(133351), "%y", strNumberOfServings), "%p", rsX!DishPercent)     '"Ingredients for " & strNumberOfServings & " at " & rsX!DishPercent & "% (Net Quantity)" 
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strServings, fntRegular, intNewX, intNewY, intAvailableWidth - intSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)



            '-------------------------------------------
            sf = New StringFormat(StringFormatFlags.DirectionVertical)
            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
            L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE    'FTB(5500)

            strX = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"      'Waste
            L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            strX = "WWW"
            L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            strX = "/W"
            L_lngCol(3) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            strX = "/W"
            L_lngCol(5) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            If G_ReportOptions.blnIncludeNetQty Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Net)   'Net
                L_lngCol(4) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

                strX = cLang.GetString(clsEGSLanguage.CodeType.Qty)     'Qty
                If ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(4) Then L_lngCol(4) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
            End If

            If G_ReportOptions.blnIncludeGrossQty Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Gross)  'Gross
                L_lngCol(6) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

                strX = cLang.GetString(clsEGSLanguage.CodeType.Qty)     'Qty
                If ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(6) Then L_lngCol(6) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
            End If

            strX = cLang.GetString(clsEGSLanguage.CodeType.Amount)  'Amount
            L_lngCol(8) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)  'Number
            L_lngCol(11) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
            '-------------------------------------------






            '//// INGREDIENTS /////
            '----------- VRP 18.02.2009 ------------------
            Dim intCodeMain As Integer = CIntDB(row("Code"))

            'Measure ingredients
            For Each rowIng As DataRow In dtIngredients.Rows
                If intCodeMain = rowIng("CodeMain") Then
                    strX = ""

                    'Wastage
                    dblWastage = rowIng("TotalWastage")
                    strX = Format(dblWastage, G_FormatWhole)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(1) Then L_lngCol(1) = intTextWidth

                    'Item Number
                    If Not IsDBNull(rowIng("ItemNumber")) Then strX = fctNumber2Text(CType(rowIng("ItemNumber"), String))
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(11) Then L_lngCol(11) = intTextWidth

                    'Price
                    If Not IsDBNull(rowIng("ItemPrice")) Then dblPrice = CType(rowIng("ItemPrice"), Double) Else dblPrice = 0
                    strX = Format(dblPrice, G_strPriceFormat)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(2) Then L_lngCol(2) = intTextWidth

                    'Unit
                    strX = "/" & G_strDisplayUnit
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(3) Then L_lngCol(3) = intTextWidth

                    'If Not IsDBNull(rowIng("unitformat")) Then strUnitFormat = Trim(CType(rowIng("unitformat"), String)) Else strUnitFormat = ""

                    'Net Qty
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        If Not IsDBNull(rowIng("tmpQty")) Then dblQuantityNet = CType(rowIng("tmpQty"), Double)
                    Else
                        If Not IsDBNull(rowIng("NetQuantity")) Then dblQuantityNet = CType(rowIng("NetQuantity"), Double)
                    End If

                    If G_ReportOptions.blnIncludeNetQty Then
                        'Qty
                        If G_Options.QtyType = 0 Then
                            strX = Format(dblQuantityNet, "#,##0.00")
                        Else
                            'If G_ReportOptions.blnUseFractions Then
                            '    strX = fctConvertToFraction(dblQuantityNet)
                            'Else
                            '    strX = dblQuantityNet
                            'End If
                            strX = fctConvertToFraction(dblQuantityNet)

                        End If
                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                        If intTextWidth > L_lngCol(4) Then L_lngCol(4) = intTextWidth
                    End If


                    'Gross Qty
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        If Not IsDBNull(rowIng("tmpQty")) Then dblQuantityBrut = CType(rowIng("tmpQty"), Double)
                    Else
                        If Not IsDBNull(rowIng("grossQuantity")) Then dblQuantityBrut = CType(rowIng("grossQuantity"), Double)
                    End If
                    If G_ReportOptions.blnIncludeGrossQty Then
                        'Qty
                        If G_Options.QtyType = 0 Then
                            strX = Format(dblQuantityBrut, "#,##0.00")
                        Else
                            strX = fctConvertToFraction(dblQuantityBrut)
                        End If

                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                        If intTextWidth > L_lngCol(6) Then L_lngCol(6) = intTextWidth
                    End If

                    'Unit
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        strX = CStrDB(rowIng("tmpUnit"))
                    Else
                        strX = fctGetTranslatedText(rowIng, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!ItemUnit)
                    End If

                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(5) Then L_lngCol(5) = intTextWidth

                    'Price
                    If Not IsDBNull(rowIng("ItemCost")) Then dblTotal = CType(rowIng("ItemCost"), Double) Else dblTotal = 0
                    strX = Format(dblTotal, G_strPriceFormat)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                    If intTextWidth > L_lngCol(8) Then L_lngCol(8) = intTextWidth
                End If
            Next

            dblTotal = 0
            If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double) Else dblTotalLaborCost = 0
            If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double) Else dblCoefficientBelvoir = 0

            If L_lngCol(8) > L_lngCol(2) Then L_lngCol(2) = L_lngCol(8)
            If L_lngCol(2) > L_lngCol(8) Then L_lngCol(8) = L_lngCol(2)

            L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(4))
            If G_ReportOptions.blnIncludeNetQty Then L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(5))
            If G_ReportOptions.blnIncludeGrossQty Then L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(5))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(6))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(8))




            'Print Ingredients
            intNewX = 0
            intNewY += 10
            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})

            intNewY += 10
            sf = New StringFormat(StringFormatFlags.NoClip)
            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height

            'Number
            If G_ReportOptions.blnIncludeIngrNumber Then
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(11))
                strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(11), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewX += L_lngCol(11)
            End If

            'Ingredients
            strX = cLang.GetString(clsEGSLanguage.CodeType.Products) ' RBAJ-2012.10.08
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredients)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewX += L_lngNameW

            'Waste
            strX = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(1), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(1)

            'Price
            strX = cLang.GetString(clsEGSLanguage.CodeType.Price) & " " & vbCrLf & L_CurrencyName
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(2) + L_lngCol(3)

            'Net Qty
            If G_ReportOptions.blnIncludeNetQty Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(4) + L_lngCol(5)
            End If

            'Gross Qty
            If G_ReportOptions.blnIncludeGrossQty Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(6), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(6) + L_lngCol(5)
            End If

            'Amount
            strX = cLang.GetString(clsEGSLanguage.CodeType.Amount) & " " & vbCrLf & L_CurrencyName
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(8), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})


            intNewX = 0
            intNewY += 30
            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            intNewY += 20


            For Each rowIng As DataRow In dtIngredients.Rows
                If intCodeMain = rowIng("CodeMain") Then
                    strX = ""


                    'If Not IsDBNull(rowIng("unitformat")) Then strUnitFormat = Trim(CType(rowIng("unitformat"), String)) Else strUnitFormat = ""

                    If Not IsDBNull(rowIng("ItemType")) Then
                        If CType(rowIng("ItemType"), Integer) = ID_Recipe Then fntFont = fntItalic Else fntFont = fntRegular
                    Else
                        fntFont = fntRegular
                    End If


                    'Number
                    If G_ReportOptions.blnIncludeIngrNumber Then
                        'Item Number
                        If Not IsDBNull(rowIng("ItemNumber")) Then strX = fctNumber2Text(CType(rowIng("ItemNumber"), String)) Else strX = ""
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(11) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += L_lngCol(11)
                    End If

                    'Ingredient Name 
                    Dim strComplement As String
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        strX = CStrDB(rowIng("tmpName"))
                        strComplement = CStrDB(rowIng("tmpComplement"))
                    Else
                        strX = fctGetTranslatedText(rowIng, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Ingredient)
                        strComplement = fctGetTranslatedText(rowIng, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)  'Trim(rsX!Complement)
                    End If
                    If strComplement <> "" Then strX = strX & " '" & strComplement & "'" Else strX = strX
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += L_lngNameW


                    'Wastage
                    dblWastage = CDblDB(rowIng("TotalWastage"))
                    If dblWastage <> 0 Then
                        strX = Format(dblWastage, G_FormatWhole)
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(1) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    End If
                    intNewX += L_lngCol(1)


                    'Price
                    dblPrice = CDblDB(rowIng("ItemPrice"))
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Format(dblPrice, G_strPriceFormat), fntFont, intNewX, intNewY, L_lngCol(2) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewX += L_lngCol(2)


                    'Unit
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        strX = CStrDB(rowIng("tmpUnit"))
                    Else
                        strX = "/" & G_strDisplayUnit
                    End If
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(3) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += L_lngCol(3)

                    'Net Qty
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        If Not IsDBNull(rowIng("tmpQty")) Then dblQuantityNet = CType(rowIng("tmpQty"), Double)
                    Else
                        If Not IsDBNull(rowIng("NetQuantity")) Then dblQuantityNet = CType(rowIng("NetQuantity"), Double)
                    End If

                    If G_ReportOptions.blnIncludeNetQty Then
                        'Qty
                        If G_Options.QtyType = 0 Then
                            strX = Format(dblQuantityNet, "#,##0.00")
                        Else
                            'If G_ReportOptions.blnUseFractions Then
                            '    strX = fctConvertToFraction(dblQuantityNet)
                            'Else
                            '    strX = dblQuantityNet
                            'End If
                            strX = fctConvertToFraction(dblQuantityNet)
                        End If

                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(4) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewX += L_lngCol(4)

                        'Unit
                        If CIntDB(rowIng("ItemType")) = 0 Then
                            strX = CStrDB(rowIng("tmpUnit"))
                        Else
                            strX = fctGetTranslatedText(rowIng, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!ItemUnit)
                        End If

                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(5) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += L_lngCol(5)
                    End If

                    'Gross Qty
                    If CIntDB(rowIng("ItemType")) = 0 Then
                        dblQuantityBrut = CDblDB(rowIng("tmpQty"))
                    Else
                        If Not IsDBNull(rowIng("GrossQuantity")) Then dblQuantityBrut = CType(rowIng("GrossQuantity"), Double)
                    End If

                    If G_ReportOptions.blnIncludeGrossQty Then
                        'Qty
                        If G_Options.QtyType = 0 Then
                            strX = Format(dblQuantityBrut, "#,##0.00")
                        Else
                            strX = fctConvertToFraction(dblQuantityBrut)
                        End If

                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(6) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewX += L_lngCol(6)

                        'Unit
                        If CIntDB(rowIng("ItemType")) = 0 Then
                            strX = CStrDB(rowIng("tmpUnit"))
                        Else
                            strX = fctGetTranslatedText(rowIng, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!ItemUnit)
                        End If
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(5) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += L_lngCol(5)
                    End If


                    'Amount
                    If Not IsDBNull(rowIng("ItemCost")) Then dblTotal = CType(rowIng("ItemCost"), Double) Else dblTotal = 0
                    strX = Format(dblTotal, G_strPriceFormat)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntFont, intNewX, intNewY, L_lngCol(8) - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewY += GetLineSpace(intTextHeight)
                End If
                intNewX = 0
            Next


            'Cost of Goods
            intNewX = 0
            intNewY += 10
            sf = New StringFormat(StringFormatFlags.DirectionVertical)
            strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
            L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


            strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
            L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
            L_lngCol(3) = (L_lngCol(1) / 2)

            L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

            Dim intNumberOfRows As Integer = 4
            Dim intCurY As Integer
            Dim intCurX As Integer
            If dblTaxValue <> 0 Then intNumberOfRows = 8

            intCurY = intNewY
            intNewY += GetLineSpace(intTextHeight)
            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += GetLineSpace(intTextHeight)

            Select Case G_Options.FactorType
                'Selling Price/const
                Case 0
                    dblCoefficient = Format(dblCoefficient, "Standard")
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
                Case 1
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
                    strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
                Case 2
                    strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
                    strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
            End Select
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += GetLineSpace(intTextHeight)

            Dim dblMerchandiseCost As Double
            Dim dblPriceTax As Double
            Dim dblImposedPriceTax As Double
            Dim dblImposedPriceNoTax As Double
            Dim dblImposedCoeff As Double

            dblMerchandiseCost = 0
            If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

            If dblTaxValue <> 0 Then
                dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                    dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                Else
                    dblImposedCoeff = 0
                End If

                strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
                strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)


                strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)

                Select Case G_Options.FactorType
                    'Imposed selling price/const
                    Case 0
                        strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                        strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                    Case 1
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                    Case 2
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                End Select
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)

                strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
                strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)

                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)
            Else
                dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                    dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                Else
                    dblImposedCoeff = 0
                End If

                Select Case G_Options.FactorType
                    Case 0
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                        strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                    Case 1
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                    Case 2
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                        strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                End Select
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)
            End If

            Dim dblSellingPriceYield As Double
            intNewX = 0
            intNewY = intCurY
            intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)

            'Per X Yield
            subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)

            intNewX = 0
            intNewY = intCurY
            intNewX += L_lngNameW + L_lngCol(3)
            dblMerchandiseCost = 0
            If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
            dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
            'Per 1 yield
            subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strYieldName, strPriceFormat)

            Dim dblRatioYield1Yield2 As Double
            Dim dblSellingPriceSubRecipe As Double
            If blnSubRecipeComputation Then
                dblRatioYield1Yield2 = 0
                dblMerchandiseCost = 0
                If dblYield2 <> 0 Then
                    dblRatioYield1Yield2 = dblYieldQty / dblYield2
                    dblMerchandiseCost = dblTotal / dblYield2
                End If

                dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
                dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

                'per 1 Subrecipe Unit
                subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit, strPriceFormat)
            End If

            intNewX = 0
            intNewY += GetLineSpace(intTextHeight)


            'str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007


            '------------------------------------------------------

            'Preparation
            intNewX = 0
            Dim intTextHeightPrep As Integer
            'intNewY += intTextHeight
            If G_ReportOptions.blnIncludePreparation Then
                'sf = New StringFormat(StringFormatFlags.NoClip)
                'strPreparation = UCase(Trim(Replace(strPreparation, vbCrLf & "#", vbCrLf)))
                'strPreparation = UCase(Trim(Replace(strPreparation, vbCrLf & "#", vbCrLf)))
                'If Mid(strPreparation, 1, 1) = "#" Then strPreparation = Mid(strPreparation, 2)

                'SplitNote(strPreparation, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)
                ''intTextHeightPrep = ReportingTextUtils.MeasureText(strPreparation, fntRegular, intAvailableWidth, sf, me.padding).Height
                ''.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPreparation, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeightPrep, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                ''intNewY += intTextHeightPrep

                '--- VRP 26.06.2008
                Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))
                Dim sNote As String = row("Note")
                Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)

                If nCodeTemplate = 0 Then
                    sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
                    sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
                    If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

                    If Not IsNothing(sNote) Then intNewY += 10
                    SplitNote(sNote, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
                Else
                    Dim sNotes() As String = sNote.Split(CChar("¤"))
                    Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

                    For i As Integer = 0 To UBound(sNotesHeader)
                        If Not sNotes(i) = "" Then
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            intNewY += intTextHeight

                            sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
                            sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
                            If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

                            If IsNothing(sNotes(i)) Then intNewY += 10
                            SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
                            intNewY += GetLineSpace(intTextHeight)
                        End If
                    Next
                End If '--------
            End If

            If G_ReportOptions.blnIncludeHACCP Then
                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001", "", "", strHACCP)
                'intNewY += intTextHeight
            End If


            '---JRN 17.03.2010
            'For keywords
            If G_ReportOptions.blnIncludeKeyword Then
                subDisplayKeywords(foundKeywords, "001")
                'intNewY += GetLineSpace(intTextHeight)
            End If

            '---
            If G_ReportOptions.blnIncludeNutrients Then
                subDisplayNutrients(strYieldName,
                    dblNutrientFactor, L_Nutrient, "001")
                intNewY += GetLineSpace(intTextHeight)
            End If

            'GDA
            If G_ReportOptions.blnIncludeGDA Then
                subDisplayNutrientsGDA(strYieldName,
                    dblNutrientFactor, L_Nutrient, "001")
                intNewY += GetLineSpace(intTextHeight)
            End If

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                intNewY -= 15
                ''  subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                intNewY += GetLineSpace(intTextHeight)
            End If
            'End of Allergens



            Dim dblMaxWidthPicture As Double
            Dim dblMaxHeightPicture As Double
            intNewX = 0
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                dblMaxHeightPicture = 250
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If


            'For j As Integer = 0 To 2
            '    strPicture(j) = ""
            '    strPicture(j) = fctGetPictureName(str3Pictures, j)
            'Next

            If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            Dim strFileName As String
            'If G_ReportOptions.blnPicturesAll = True Then

            '    If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
            '        For j As Integer = 0 To 2
            '            If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
            '                strFileName = G_strPhotoPath & strPicture(j)
            '                .Detail.Controls.AddRange(New XRControl() _
            '                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

            '            End If
            '            intNewX += CInt(G_dblMaxWidthPicture) + 5
            '        Next
            '        intNewY += CInt(G_dblMaxHeightPicture)
            '    End If
            '    intNewY += 10
            '    intNewX = 0
            'Else
            '    If G_ReportOptions.blnWithPicture = True Then
            '        If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
            '            For j As Integer = 0 To 2
            '                If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
            '                    strFileName = G_strPhotoPath & strPicture(j)
            '                    .Detail.Controls.AddRange(New XRControl() _
            '                        {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
            '                    intNewX += G_dblMaxWidthPicture + 20
            '                    intCurY = intNewY
            '                    Exit For
            '                End If
            '            Next
            '        End If
            '    End If
            'End If

            '--- VRP 07.11.2007
            If G_ReportOptions.blnPicturesAll = True Then
                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To UBound(arrPicture)
                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                        End If
                        intNewX += CInt(G_dblMaxWidthPicture) + 5
                    Next
                    intNewY += CInt(G_dblMaxHeightPicture)
                End If
                intNewY += 10
                intNewX = 0
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        For j As Integer = 0 To UBound(arrPicture)
                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                strFileName = G_strPhotoPath & arrPicture(j)
                                .Detail.Controls.AddRange(New XRControl() _
                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                intNewX += G_dblMaxWidthPicture + 20
                                intCurY = intNewY
                                Exit For
                            End If
                        Next
                    End If
                End If
            End If
            '--------
        End With
        Return Me
    End Function

    Function fctPrintRecipeEgsLayout(ByVal foundDetails() As DataRow) As XtraReport

        Dim intAvailableWidth As Long

        Dim strRecipeName As String
        Dim strDescription As String
        Dim lngMaxHeightPicture As Long
        Dim lngMaxWidthPicture As Long
        'Dim strPicture(0 To 2) As String
        'Dim str3Pictures As String
        Dim strPictureAll As String = "" 'VRP 06.11.2007
        Dim intTextHeight As Integer
        Dim intNewX As Integer
        Dim intNewY As Integer
        Dim sf As StringFormat = New StringFormat(StringFormatFlags.NoClip)

        Try
            fctPrintRecipeEgsLayout = Nothing
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
        Catch ex As Exception
            Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        '        If foundDetails.GetUpperBound(0) > 0 Then
        Dim row As DataRow = foundDetails(0)
        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'page header
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            intNewX = 0
            intNewY = CInt(G_ReportOptions.dblTopMargin)

            If G_ReportOptions.dblReportType = 24 Then
                strRecipeName = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)
            Else
                strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            End If
            intTextHeight = MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

            intNewX = 0
            intNewY = 0

            intTextHeight = MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
            intNewY += GetLineSpace(intTextHeight)

            lngMaxWidthPicture = intAvailableWidth
            If G_ReportOptions.strSubStyle = "41" Then
                'just picture
                lngMaxHeightPicture = .PageHeight - .Margins.Top - .Margins.Bottom - 100
            Else
                'picture + procedure
                lngMaxHeightPicture = .PageHeight / 2 - .Margins.Top - intTextHeight - 20
            End If

            intNewX = 0
            'str3Pictures = ""
            'For j As Integer = 0 To 2
            '    strPicture(j) = ""
            'Next

            'Dim strFileName As String
            'If Not IsDBNull(row("Pix")) Then str3Pictures = row("Pix") & ""
            'intNewY += intTextHeight + 20
            'If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
            '    For j As Integer = 0 To 2
            '        strPicture(j) = fctGetPictureName(str3Pictures, j)
            '        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
            '            strFileName = G_strPhotoPath & strPicture(j)
            '            .Detail.Controls.AddRange(New XRControl() _
            '                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(lngMaxWidthPicture), CInt(lngMaxHeightPicture))})
            '            Exit For
            '        End If
            '    Next
            'End If

            'SM 20251201 update For Azure blob
            Dim coreCodeGroup As String = "0"
            If Not IsDBNull(row("CoreCodeGroup").ToString) Then coreCodeGroup = CryptoService.Get25CharString(row("CoreCodeGroup").ToString)
            If Not IsDBNull(row("Pix").ToString) Then G_strPhotoPath = G_strPhotoPath.Replace("CoreCodeGroup", coreCodeGroup)

            '--- VRP 07.11.2007
            Dim strFileName As String
            If Not IsDBNull(row("Pix")) Then strPictureAll = row("Pix") & ""
            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
            intNewY += intTextHeight + 20
            If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                For j As Integer = 0 To UBound(arrPicture)
                    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                        strFileName = G_strPhotoPath & arrPicture(j)
                        .Detail.Controls.AddRange(New XRControl() _
                            {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(lngMaxWidthPicture), CInt(lngMaxHeightPicture))})
                        Exit For
                    End If
                Next
            End If
            '--------

            If G_ReportOptions.strSubStyle = "42" Then
                intNewY += G_dblMaxHeightPicture + 20
                strDescription = fctGetTranslatedText(row, "Description", "DescriptionTrans", G_ReportOptions.intTranslation)
                strDescription = Trim(Replace(strDescription, vbCrLf & "#", vbCrLf))
                If Mid(strDescription, 1, 1) = "#" Then strDescription = Mid(strDescription, 2)
                SplitNote(strDescription, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)
                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strDescription, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            End If

        End With
        'End If
        Return Me
    End Function

    Private Function GetLabelBorderSide(Optional ByVal value As String = "") As DevExpress.XtraPrinting.BorderSide
        If value = "" Then value = G_ReportOptions.strTextItemFormat
        If value = "" Then GoTo Blank
        If value.Split("_").Length < 4 Then GoTo Blank

        Dim arr() As String = value.Split("_")
        'all
        If CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 1 And CInt(arr(3)) = 1 Then
            Return DevExpress.XtraPrinting.BorderSide.All

            'top
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 0 And CInt(arr(2)) = 0 And CInt(arr(3)) = 0 Then
            Return DevExpress.XtraPrinting.BorderSide.Top

            'bottom
        ElseIf CInt(arr(0)) = 0 And CInt(arr(1)) = 1 And CInt(arr(2)) = 0 And CInt(arr(3)) = 0 Then
            Return DevExpress.XtraPrinting.BorderSide.Bottom

            'left
        ElseIf CInt(arr(0)) = 0 And CInt(arr(1)) = 0 And CInt(arr(2)) = 1 And CInt(arr(3)) = 0 Then
            Return DevExpress.XtraPrinting.BorderSide.Left

            'right
        ElseIf CInt(arr(0)) = 0 And CInt(arr(1)) = 0 And CInt(arr(2)) = 0 And CInt(arr(3)) = 1 Then
            Return DevExpress.XtraPrinting.BorderSide.Right

            'top bottom left
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 1 And CInt(arr(3)) = 0 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Bottom Or DevExpress.XtraPrinting.BorderSide.Left), DevExpress.XtraPrinting.BorderSide)

            'top bottom right
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 0 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Bottom Or DevExpress.XtraPrinting.BorderSide.Right), DevExpress.XtraPrinting.BorderSide)

            'top left
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 1 And CInt(arr(3)) = 0 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Left), DevExpress.XtraPrinting.BorderSide)

            'top right
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 0 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Right), DevExpress.XtraPrinting.BorderSide)

            'top bottom
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 0 And CInt(arr(3)) = 0 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Bottom), DevExpress.XtraPrinting.BorderSide)

            'bottom left
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 1 And CInt(arr(3)) = 0 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Bottom Or DevExpress.XtraPrinting.BorderSide.Left), DevExpress.XtraPrinting.BorderSide)

            'bott0m right
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 1 And CInt(arr(2)) = 0 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Bottom Or DevExpress.XtraPrinting.BorderSide.Right), DevExpress.XtraPrinting.BorderSide)

            'right left
        ElseIf CInt(arr(0)) = 0 And CInt(arr(1)) = 0 And CInt(arr(2)) = 0 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Right Or DevExpress.XtraPrinting.BorderSide.Left), DevExpress.XtraPrinting.BorderSide)

            'right left bottom
        ElseIf CInt(arr(0)) = 0 And CInt(arr(1)) = 1 And CInt(arr(2)) = 1 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Right Or DevExpress.XtraPrinting.BorderSide.Left Or DevExpress.XtraPrinting.BorderSide.Bottom), DevExpress.XtraPrinting.BorderSide)

            'right left top
        ElseIf CInt(arr(0)) = 1 And CInt(arr(1)) = 0 And CInt(arr(2)) = 1 And CInt(arr(3)) = 1 Then
            Return CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Right Or DevExpress.XtraPrinting.BorderSide.Left), DevExpress.XtraPrinting.BorderSide)
        End If
Blank:
        Return DevExpress.XtraPrinting.BorderSide.None
        'CType((DevExpress.XtraPrinting.BorderSide.Top Or DevExpress.XtraPrinting.BorderSide.Bottom), DevExpress.XtraPrinting.BorderSide)
    End Function

    Function fctPrintRecipeCostingEGSStandard3(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow,
                                               ByVal foundAllergens() As DataRow, ByVal dtIngredients As DataTable, Optional ByVal dtListePreparation As DataTable = Nothing, Optional strConn As String = "", Optional ByVal CodeUser As Integer = 0) As XtraReport

        '483 height to manage
        Dim fntFont As Font
        Dim intRecipeCode As Long
        Dim intDictionary As Integer
        Dim L_CurrencyName As String
        Dim dblCoefficient As Double
        Dim dblTaxValue As Double
        Dim dblImposedPrice As Double
        Dim strName As String
        Dim strPortionUnit2Format As String
        Dim strCategoryName As String
        Dim strNumber As String
        Dim strSourceName As String = Nothing
        Dim strRemarks As String
        Dim strDate As String = Nothing
        Dim strPreparation As String = ""
        Dim strCoolingTime As String = ""
        Dim strHeatingTime As String = ""
        Dim strHeatingTemperature As String = ""
        Dim strHeatingMode As String = ""
        Dim strCCPdescription As String = ""
        Dim strStoringTemp As String = "" 'VRP 21.08.2008"
        Dim strStoringTime As String = "" 'VRP 21.08.2008
        Dim strHACCP As String = ""
        Dim strRecipeName As String
        Dim strServings As String
        Dim strYieldName As String
        Dim strNumberOfServings As String
        Dim strSubRecipeUnit As String
        Dim dblPercent As Double
        Dim dblYieldQty As Double
        Dim dblTotal As Double
        Dim dblPrice As Double
        Dim CurRate As Double
        Dim dblUnitFactor As Double
        Dim dblWastage As Double
        Dim dblFactor As Double
        Dim dblQuantityNet As Double
        Dim strQuantityNet As String = "0"
        Dim strUnit As String
        'Dim strUnitFormat As String
        Dim dblQuantityBrut As Double
        Dim strQuantityBrut As String = "0"
        Dim dblTotalLaborCost As Double
        Dim dblCoefficientBelvoir As Double
        Dim dblItemPrice As Double
        Dim strNetQty As String
        Dim strGrossQty As String
        Dim strDisplayUnit As String
        Dim lngDisplayUnit As Long
        Dim strPriceFormat As String

        Dim lngKiloCode As Long
        Dim lngLiterCode As Long
        'Dim str3Pictures As String = Nothing
        'Dim strPicture(0 To 2) As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007

        Dim intAvailableWidth As Integer
        Dim intSpace As Integer
        Dim strX As String

        Dim dblYield2 As Double
        Dim blnSubRecipeComputation As Boolean = False

        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

        'fctPrintRecipeCostingEGSStandard3 = Nothing

        sf = New StringFormat(StringFormatFlags.NoClip)

        Dim arrNutrientName As New ArrayList
        For Each tNut As tNutrient In G_Nutrient
            arrNutrientName.Add(tNut.Name)
        Next

        Try
            fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails.Length <= 0 Then
            Exit Function
        End If

        ReDim L_lngCol(0 To 12)

        Dim row As DataRow = foundDetails(0)
        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, G_strConnection) 'VRP 08.01.2009
        End If

        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)
        End If

        intDictionary = G_Language
        If G_ReportOptions.intTranslation > 0 Then
            intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
        End If
        G_Language = intDictionary

        strPriceFormat = CType(CStrDB(row("curFormat")), String)
        L_CurrencyName = CType(CStrDB(row("Currency")), String)
        dblCoefficient = CType(CDblDB(row("coeff")), Double)
        dblTaxValue = CType(CDblDB(row("TaxValue")), Double)
        dblImposedPrice = CType(CDblDB(row("ImposedPrice")), Double)
        strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
        strPortionUnit2Format = G_FormatOneDecimal
        If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(CStrDB(row("PortionUnit2Format")), String)
        strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
        strNumber = fctNumber2Text(Trim(CType(CStrDB(row("RecipeNumber")), String)))
        intRecipeCode = row("Code")
        If CType(CIntDB(row("codesource")), Integer) = 0 Then
            strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
        Else
            strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
        End If

        strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
        If Not IsDBNull(row("Dates")) Then strDate = CType(CStrDB(row("Dates")), String)

        strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

        'If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(CType(CStrDB(row("CoolingTime")), String))
        'If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(CType(CStrDB(row("HeatingTime")), String))
        'If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(CType(CStrDB(row("HeatingTemperature")), String))
        'If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(CType(CStrDB(row("HeatingMode")), String))
        'strCCPdescription = fctGetTranslatedText(row, "CCPdescription", "CCPdescriptionTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CCPdescription)
        'If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(CType(CStrDB(row("HACCP")), String))

        If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(row("CoolingTime").ToString)
        If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(row("HeatingTime").ToString)
        If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(row("HeatingTemperature").ToString)
        If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(row("HeatingMode").ToString)
        If Not IsDBNull(row("CCPDescription")) Then strCCPdescription = Trim(row("CCPDescription").ToString)
        If Not IsDBNull(row("StoringTemp")) Then strStoringTemp = Trim(row("StoringTemp").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("StoringTime")) Then strStoringTime = Trim(row("StoringTime").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(row("HACCP").ToString)


        For i As Integer = 1 To 34 '15
            L_Nutrient(i).Value = -1
        Next


        Dim strFieldname As String = Nothing
        Dim strFieldnameForPercent As String = Nothing
        For i As Integer = 1 To 34 '15
            strFieldname = "N" & i.ToString
            'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
            strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
            If Not IsDBNull(row(strFieldname)) And
               Not IsDBNull(row(strFieldnameForPercent)) Then
                If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                    L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                    G_Nutrient(i).Unit = "%"
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                Else
                    L_Nutrient(i).Value = CType(row(strFieldname), Double)
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                End If
            End If
        Next

        lngKiloCode = fctGetUnitCodeFromType(100)
        lngLiterCode = fctGetUnitCodeFromType(200)


        Dim intDPic As Integer
        If row.Table.Columns.Contains("DefaultPicture") Then
            intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
        Else
            intDPic = 1
        End If

        If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
        Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
        '------ 

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)



            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'page header
            '-------------------------------------------
            'brag
            intNewX = 0
            intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
            strX = " "
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            '.PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)


            intNewX = 0
            intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

            'Recipe Name
            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            'intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            ' .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            'intNewY += GetLineSpace(intTextHeight) + 20

            Dim xRecipeName As New XRTable
            Dim xRecipeRow As New XRTableRow
            Dim xRecipeCell As New XRTableCell
            xRecipeName.Location = New System.Drawing.Point(intNewX, intNewY)
            xRecipeName.Width = intAvailableWidth

            If G_ReportOptions.blnIncludeHighlightSection Then
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.LightGray
            Else
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.White
            End If

            xRecipeRow.Padding = New DevExpress.XtraPrinting.PaddingInfo(0, 0, 0, 0)
            xRecipeRow.Height = CInt(G_ReportOptions.sgFontTitleSize)
            xRecipeCell.Text = New String(strRecipeName)
            xRecipeCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            If G_ReportOptions.blnIncludeHighlightSection Then xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            xRecipeCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xRecipeRow.Cells.Add(xRecipeCell)
            xRecipeName.Rows.Add(xRecipeRow)

            xRecipeName.KeepTogether = False
            .PageHeader.Controls.Add(xRecipeName)

            'xRecipeName.Dispose()
            'xRecipeRow.Dispose()
            'xRecipeCell.Dispose()
            ''-------------------------------------------

            ' RDC 08.29.2013 : Applied enhancements to code
            intNewX = 0
            intNewY = 20
            Dim xrRecipeMenuInfo As New XRTable 'anm first input with table 
            xrRecipeMenuInfo.Width = intAvailableWidth
            xrRecipeMenuInfo.Location = New Point(intNewX, intNewY)
            Dim xrRecipeMenuRow As New XRTableRow
            If G_ReportOptions.blnIncludeNumber Then
                If G_ReportOptions.blnRecipe Then
                    ' Recipe #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

                Else
                    ' Menu #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Menu_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                End If
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeCategory Then
                ' Category
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category), ": " & strCategoryName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeSource Then
                ' Source
                ' RDC 09.03.2013 : Change display from NO SOURCE to NOT DEFINED
                If strSourceName.ToUpper.Trim = "NO SOURCE" Or strSourceName Is Nothing Or strSourceName.Trim = "" Then strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source), ": " & strSourceName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeDate Then
                ' Date
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_), ": " & DirectCast(row("Dates"), DateTime).ToShortDateString()}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeRemark Then
                ' Remarks
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark), ": " & strRemarks}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                ' xrRecipeMenuRow.Dispose()
            End If


            strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)
            'strYieldName = row("itemUnit").ToString

            '-- VRP 20.01.2009
            dblYieldQty = CType(row("Yield"), Double)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)

            Dim intYieldUnitOriginal As Integer = 0
            If row.Table.Columns.Contains("YieldUnitOriginalCode") Then intYieldUnitOriginal = CType(row("YieldUnitOriginalCode"), Integer) 'JTOC 31.05.2013

            Dim dblYieldQtyOrig As Double = 0.0
            If row.Table.Columns.Contains("YieldOriginalFactor") Then dblYieldQtyOrig = row("YieldOriginalFactor") 'JTOC 31.05.2013


            Dim strYieldUnitNameOrig As String = ""
            If row.Table.Columns.Contains("YieldUnitOriginalName") Then strYieldUnitNameOrig = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 'JTOC 31.05.2013
            '---


            If G_Options.QtyType = 0 Then
                strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strNumberOfServings = strNumberOfServings & "/" &
                     fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
                    'fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            Else
                strNumberOfServings = fctConvertToFraction(CDbl(dblYieldQty)) & " " & strYieldName
                ' strNumberOfServings = fctConvertToFraction(CType(row("Yield")) & " " & strYieldName)
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    'If G_ReportOptions.blnUseFractions Then
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    fctConvertToFraction(CType(row("Yield2"), Double)) & " " & _
                    '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'Else
                    '    strNumberOfServings = strNumberOfServings & "/" & _
                    '    CType(row("Yield2"), Double) & " " & _
                    '    fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'End If
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction(CType(row("Yield2"), Double)) & " " & strYieldUnitNameOrig
                    ' fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)

                    strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            End If
            xrRecipeMenuRow.Dispose()

            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
            ' RDC 09.09.2013 :  CWM-8307 Fix
            strServings = strServings.Replace("[_]", "").Replace("N/A", "").Replace("n/a", "")
            ' 
            xrRecipeMenuRow = New XRTableRow
            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.For_), ": " & strServings}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

            .Detail.Controls.Add(xrRecipeMenuInfo)
            intNewY += (xrRecipeMenuInfo.Height + 20)




            '' RDC 08.29.2013 : Code Enhancement
            '''''''''''''''''''''''''''
            '''' Ingredient Header'''''
            '''''''''''''''''''''''''''

            Dim xrIngredientHeader As New XRTable
            Dim xrIngredientHRow As New XRTableRow
            Dim xrIngredientCell As New XRTableCell

            Dim intExcessSpace As Integer = 0

            xrIngredientHeader.Location = New Point(intNewX, intNewY - 12) 'KMQDC 11.26.2015 original no -12
            xrIngredientHeader.Width = intAvailableWidth
            xrIngredientHeader.Borders = DevExpress.XtraPrinting.BorderSide.Top + DevExpress.XtraPrinting.BorderSide.Bottom
            xrIngredientHeader.BorderWidth = 1S

            If G_ReportOptions.blnIncludeHighlightSection Then
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.LightGray
            Else
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.White
            End If

            xrIngredientHRow.Height = CInt(40)

            Dim strNumberHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Number)
            Dim strMerchHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Product)
            Dim strWastePctHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
            Dim strPriceHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Price)
            Dim strNetQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
            Dim strGrossQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
            Dim strAmountHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Amount)

            ' Recipe / Ingredient number Column1 in UI
            If G_ReportOptions.blnIncludeIngrNumber Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNumberHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(50)
            End If

            ' Merchandise / Ingredients Name Column2 in UI

            xrIngredientCell = New XRTableCell
            xrIngredientCell.Width = CInt(160)
            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            xrIngredientCell.Text = strMerchHeader
            xrIngredientHRow.Cells.Add(xrIngredientCell)



            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Waste Percentage 
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strWastePctHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)

                ' Price 
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strPriceHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            ' Net Quantity
            If G_ReportOptions.blnIncludeNetQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNetQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If

            ' Gross Quantity
            If G_ReportOptions.blnIncludeGrossQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strGrossQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If
            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Amount
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strAmountHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngredientHRow.Cells(0).Width += intExcessSpace Else xrIngredientHRow.Cells(1).Width += intExcessSpace

            xrIngredientHeader.Rows.Add(xrIngredientHRow)
            .Detail.Controls.Add(xrIngredientHeader)

            intNewY += (xrIngredientHeader.Height + 5)

            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            '''''''''''''''''''''''''''
            '''' Ingredient Values'''''
            '''''''''''''''''''''''''''
            Dim xrIngrInfo As New XRTable
            Dim xrIngrRow As New XRTableRow
            Dim xrIngrCell As New XRTableCell
            xrIngrInfo.Width = intAvailableWidth
            xrIngrInfo.Location = New Point(intNewX, intNewY)
            Dim newdvIng As New DataView(dtIngredients)

            newdvIng.Sort = "step asc"
            newdvIng.RowFilter = "CodeMain=" & row("Code") & " AND ID =" & row("ID") 'MKAM 2015.07.02

            Dim NewDtTable As New DataTable
            NewDtTable = newdvIng.ToTable()

            For Each drIngredient As DataRow In NewDtTable.Rows
                ' For Each drIngredient As DataRow In dtIngredients.Select("CodeMain=" & row("Code")) 'AGL 2013.11.06 - 9372 - added filter
                xrIngrRow = New XRTableRow
                xrIngrRow.Width = xrIngrInfo.Width
                xrIngrRow.Height = G_ReportOptions.sgFontSize2

                Dim strIngrFormat As String = fctNullToString(drIngredient("ItemFormat"))
                If strIngrFormat = "" Then strIngrFormat = "#,###.00"

                Dim fntFontType As FontStyle = FontStyle.Regular
                Select Case CIntDB(drIngredient("ItemType"))
                    Case ID_Recipe
                        fntFontType = FontStyle.Italic
                    Case Else

                End Select

                ' Item Number
                If G_ReportOptions.blnIncludeIngrNumber Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(70)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                    If IsDBNull(drIngredient("ItemNumber")) Then xrIngrCell.Text = "" Else xrIngrCell.Text = drIngredient("ItemNumber")
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                ' Item Name
                Dim strIngrComple As String = "", strIngrName As String = ""

                If CInt(drIngredient("ItemType")) = 0 Then
                    strIngrComple = drIngredient("tmpComplement").ToString
                    strIngrName = drIngredient("tmpName").ToString
                Else
                    strIngrComple = fctGetTranslatedText(drIngredient, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    strIngrName = fctGetTranslatedText(drIngredient, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)
                End If

                'Dim xrRTextIngredient As New XRRichText
                Dim RTextIngredient As New RichTextBox
                Dim XRLabel As New XRLabel

                Try
                    If CBoolDB(drIngredient("isBrandedIngredient")) Then
                        'RTextIngredient.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    Else
                        Try
                            XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        Catch ex As Exception
                            'XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            Log.Info("Error setting font for XRLabel")
                        Finally
                            XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        End Try
                    End If
                    XRLabel.Text = strIngrName & " "
                    'Try
                    '    XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    'Catch ex As Exception
                    '    XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    'End Try
                    If G_ReportOptions.blnIncludeIngredientComplement Then strIngrComple = strIngrComple.Trim & " " Else strIngrComple = ""
                    'RText.SelectedText = strIngrComple

                    XRLabel.Width = CInt(160)
                    'xrRTextIngredient.Rtf = RTextIngredient.Rtf
                    'xrRTextIngredient.Width = CInt(160)
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(160)
                    If Not RTextIngredient.IsDisposed Then
                        RTextIngredient.Clear()
                        RTextIngredient.Dispose()
                    End If
                Catch ex As Exception
                    Log.Info("Error in RTextIngredient: " & ex.Message.ToString)
                End Try
                Try
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                Catch ex As Exception
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    Log.Info(ex.Message)
                End Try
                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                xrIngrCell.Controls.Add(XRLabel)
                'xrIngrCell.Controls.Add(xrRTextIngredient)
                xrIngrRow.Cells.Add(xrIngrCell)

                Dim strIngrUnitPrice As String = ""
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Wastage Percentage
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(50)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    If Not drIngredient("ItemType") = 0 Then
                        If CDblDB(drIngredient("TotalWastage")) > 0 Then xrIngrCell.Text = drIngredient("TotalWastage").ToString Else xrIngrCell.Text = ""
                    Else
                        xrIngrCell.Text = ""
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                ' Price
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = CStrDB(drIngredient("tmpUnit")) Else strIngrUnitPrice = " / " & CStrDB(drIngredient("PriceUnit"))
                    If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                    Dim dblIngrPrice As Double = CDblDB(drIngredient("ItemPrice"))

                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblIngrPrice, G_strPriceFormat) & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else

                        xrIngrCell.Text = Format(dblIngrPrice, strPriceFormat) & strIngrUnitPrice
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                'start LLG 10.20.2015 commented and replace Net QTY,Gross QTY and Amount'
                ' Net Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeNetQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = "" 
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("NetQuantity")) & " " & strIngrUnitPrice
                        Else
                            xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                ' Gross Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeGrossQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("GrossQuantity")) & " " & strIngrUnitPrice
                        Else
                            xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Amount
                    Dim dblAmount As Double

                    If drIngredient("PriceUnit").ToString = drIngredient("itemUnit").ToString Then
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("GrossQuantity"))
                    Else
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("unitFactor")) * CDblDB(drIngredient("GrossQuantity"))
                    End If
                    dblTotal += dblAmount

                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight


                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblAmount, G_strPriceFormat)
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        xrIngrCell.Text = Format(dblAmount, strPriceFormat)
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                If intExcessSpace > 0 Then
                    If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngrRow.Cells(0).Width += intExcessSpace Else xrIngrRow.Cells(1).Width += intExcessSpace
                End If
                xrIngrInfo.Rows.Add(xrIngrRow)
                Try 'RDTC 2021.08.03
                    'xrRText.Dispose() 'dont dispose the devexpress object. it is "clearing/deleting" all the records in the table
                    RTextIngredient.Dispose()
                Catch ex As Exception
                End Try
            Next
            NewDtTable.Dispose()

            .Detail.Controls.Add(xrIngrInfo)
            intNewY += (xrIngrInfo.Height + 5)

            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            'xrIngrInfo.Dispose()
            'xrIngrRow.Dispose()
            'xrIngrCell.Dispose()

            If G_ReportOptions.blnIncludeCostOfGoods Then
                dblPercent = CType(row("DishPercent"), Double) / 100
                dblYieldQty = CType(row("Yield"), Double)
                'dblTotal = 0
                dblPrice = 0
                Dim borderSideText As DevExpress.XtraPrinting.BorderSide = GetLabelBorderSide()
                For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
                    CurRate = 0
                    If Not IsDBNull(foundDetails(rowIng)("Rate")) Then CurRate = CType(foundDetails(rowIng)("Rate"), Double)
                    dblUnitFactor = 0
                    If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double)

                    If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
                        dblWastage = 100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100
                        dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
                    End If
                    If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)
                    If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)
                    If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)
                    dblWastage = (100 - dblWastage)
                    dblPrice = 0
                    dblFactor = 1
                    If Not IsDBNull(foundDetails(rowIng)("Factor")) Then dblFactor = CType(foundDetails(rowIng)("Factor"), Double)
                    If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblPrice = CType(foundDetails(rowIng)("ItemPrice"), Double) * CurRate * dblFactor
                    If Not IsDBNull(foundDetails(rowIng)("Quantity")) Then dblQuantityNet = CType(foundDetails(rowIng)("Quantity"), Double)


                    dblQuantityBrut = dblQuantityNet / (1 - (dblWastage / 100))

                    dblPrice = (dblQuantityBrut * dblPrice * dblUnitFactor)

                    'dblTotal += dblPrice

                Next
                ''-------------------------------------------
                'dblTotal = 0
                dblTotalLaborCost = 0
                If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double)
                dblCoefficientBelvoir = 0
                If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double)


                'Cost of Goods

                Dim dblMerchandiseCost As Double
                Dim dblPriceTax As Double
                Dim dblImposedPriceTax As Double
                Dim dblImposedPriceNoTax As Double
                Dim dblImposedCoeff As Double
                Dim dblSellingPriceYield As Double

                'AGL 2013.11.04 - 9277 START - commented this portion, duplicate costing appearing on report ===========================================================
                intNewX = 0
                intNewY += 10
                'sf = New StringFormat(StringFormatFlags.DirectionVertical)
                strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
                L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


                strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
                L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                L_lngCol(3) = (L_lngCol(1) / 2)

                L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

                'Dim intNumberOfRows As Integer = 4
                Dim intCurY As Integer
                'Dim intCurX As Integer
                'If dblTaxValue <> 0 Then intNumberOfRows = 8

                intCurY = intNewY
                intNewY += GetLineSpace(intTextHeight) - 10 'KMQDC 11.26.2015 original no -10
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 1

                If Not G_ReportOptions.bFoodcostOnly Then
                    Select Case G_Options.FactorType
                        'Selling Price/const
                        Case 0
                            dblCoefficient = Format(dblCoefficient, "Standard")
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
                        Case 1
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
                            strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
                        Case 2
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
                            strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
                    End Select
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewY += GetLineSpace(intTextHeight)
                    'anm noted 2


                    dblMerchandiseCost = 0
                    If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

                    If dblTaxValue <> 0 Then
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            'dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
                        strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 3

                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 4
                        Select Case G_Options.FactorType
                            'Imposed selling price/const
                            Case 0
                                strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                            Case 1
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                            Case 2
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 5
                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
                        strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 6
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 7
                    Else
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            ' dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        Select Case G_Options.FactorType
                            Case 0
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                            Case 1
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                            Case 2
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 8
                    End If

                    intNewX = 0

                End If

                'AGL 2013.11.04 - 9277 END===========================================================

                'Per X Yield
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)
                'AGL 2013.11.04
                subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)
                '  subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)

                intNewX = 0
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3)
                dblMerchandiseCost = 0
                If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
                dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
                'Per 1 yield
                'AGL 2013.11.04
                subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice / dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)
                ' subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)

                Dim dblRatioYield1Yield2 As Double
                Dim dblSellingPriceSubRecipe As Double
                If blnSubRecipeComputation Then
                    dblRatioYield1Yield2 = 0
                    dblMerchandiseCost = 0
                    If dblYield2 <> 0 Then
                        dblRatioYield1Yield2 = dblYieldQty / dblYield2
                        dblMerchandiseCost = dblTotal / dblYield2
                    End If

                    dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
                    dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

                    'per 1 Subrecipe Unit
                    subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit, strPriceFormat)
                End If
            End If

            intNewX = 0
            intNewY += GetLineSpace(intTextHeight)
            'anm noted 9

            'str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007

            '------------------------------------------------------


            'intNewY += 20
            ' RDC force table to be plotted in X:0
            'PREPARATION
            intNewX = 0
            Dim xrStepTable As New XRTable
            Dim xrStepRow As New XRTableRow
            Dim xrStepCell As New XRTableCell
            Dim xrStepCellB As New XRTableCell

            xrStepTable.Location = New Point(intNewX, intNewY)
            xrStepTable.Width = intAvailableWidth
            xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None

            For Each drStep As DataRow In dtListePreparation.Select("Codeliste=" & CIntDB(row("Code")))
                ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                Dim rtbPreparation As New RichTextBox
                'Dim xrtPreparation As New XRRichText
                Dim XRLabel As New XRLabel

                rtbPreparation.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                'xrtPreparation.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                XRLabel.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                Using rtbPreparation
                    If Not G_ReportOptions.blnMode Then
                        If Not IsDBNull(drStep("Note").ToString) Then rtbPreparation.AppendText(drStep("Note").ToString) Else rtbPreparation.AppendText(Chr(32))
                    Else
                        If Not IsDBNull(drStep("CookMode").ToString) Then rtbPreparation.AppendText(drStep("CookMode").ToString) Else rtbPreparation.AppendText(Chr(32))
                    End If
                    ' xrtPreparation.Rtf = rtbPreparation.Rtf
                    XRLabel.Text = rtbPreparation.Text
                End Using

                xrStepRow = New XRTableRow
                xrStepRow.Height = G_ReportOptions.sgFontSize2
                If Not rtbPreparation.IsDisposed Then
                    rtbPreparation.Clear()
                    rtbPreparation.Dispose()
                End If

                If G_ReportOptions.blnIncludePreparation Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout


                    Select Case row("MethodFormat").ToString.Trim.ToLower
                        Case "x", "" ' Not bulleted / numbered
                            xrStepCell = New XRTableCell
                            'xrtPreparation = New XRRichText
                            rtbPreparation = New RichTextBox
                            xrStepCell.Width = intAvailableWidth
                            'rtbPreparation.Width = intAvailableWidth
                            'xrtPreparation.Width = intAvailableWidth
                            XRLabel.Width = intAvailableWidth
                            'xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            'xrStepRow.Cells.Add(xrStepCell)
                            Dim onceCount As Integer = 0
                            'anm
                            ' Dim currentHeight As New Integer
                            '  currentHeight = intNewY
                            Dim x As Integer = rtbPreparation.Lines.Count
                            Dim countTo3 As Integer = 0
                            Dim addToName As Integer = 0
                            Dim curY = intNewY + 10
                            Dim newLoop As Boolean = False
                            Dim rtbNewPreparation As New RichTextBox
                            'Dim aslow As String = rtbNew.Rtf.ToString()
                            'Dim xrts As New XRRichText
                            Dim XRLabel2 As New XRLabel
                            Dim xrNewStepTable As New XRTable
                            Dim textLeftCount As Integer = rtbPreparation.Lines.Count Mod 3
                            Dim lineCountLeft As Integer = rtbPreparation.Lines.Count - textLeftCount
                            Dim LineCounter As Integer
                            For Each Line As String In rtbPreparation.Lines
                                countTo3 += 1
                                LineCounter += 1
                                If Line = "" Then
                                    rtbNewPreparation.AppendText(Environment.NewLine)
                                Else
                                    If countTo3 = 1 Then
                                        rtbNewPreparation.AppendText(Line)
                                    Else
                                        rtbNewPreparation.AppendText(Line + Environment.NewLine)
                                    End If
                                End If
                                'xrts.Rtf = rtbNewPreparation.Rtf
                                XRLabel2.Text = rtbNewPreparation.Text

                                If countTo3 = 1 Then
                                    countTo3 = 0
                                    XRLabel2.Width = intAvailableWidth
                                    XRLabel2.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                                    XRLabel2.CanShrink = True
                                    XRLabel2.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    XRLabel2.KeepTogether = True
                                    XRLabel2.Location = New Point(intNewX, curY)
                                    .Detail.Controls.AddRange(New XRControl() {XRLabel2})
                                    curY += (XRLabel2.Height)
                                End If
                            Next
                            intNewY = curY
                            If Not rtbNewPreparation.IsDisposed Then
                                rtbNewPreparation.Clear()
                                rtbNewPreparation.Dispose()
                            End If
                            If Not rtbPreparation.IsDisposed Then
                                rtbPreparation.Clear()
                                rtbPreparation.Dispose()
                            End If
                            'xrts = New XRRichText
                            'xrNewStepTable = New XRTable
                        Case "n" ' Number bullet
                            xrStepCell = New XRTableCell
                            rtbPreparation = New RichTextBox
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = drStep("Position") & "."
                            End If
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtbPreparation.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            'xrtPreparation.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            XRLabel.Width = intAvailableWidth - 40
                            xrStepCell.Controls.Add(XRLabel)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                        Case "b" ' Symbol bullet "•"
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = "•"
                            End If

                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtbPreparation.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            'xrtPreparation.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            'xrStepCell.Controls.Add(xrtPreparation)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                    End Select
                    'xrStepTable.Rows.Add(xrStepRow) 'anm
                End If
            Next
            If G_ReportOptions.blnIncludePreparation Then
                intNewY = intNewY + 90
            Else
                intNewY = intNewY + 90
            End If

            Dim strServeWithNotes As String = Nothing
            Dim strFootnote1 As String = Nothing
            Dim strFootnote2 As String = Nothing

            For Each rwRecipeNotes As DataRow In G_ReportOptions.dtNotes.Select("Code=" & intRecipeCode)
                strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
                strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
                strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
            Next

            Dim xrNotesTable As New XRTable
            Dim xrNotesRow As New XRTableRow
            Dim xrNotesCell As New XRTableCell

            Try
                If G_ReportOptions.blnIncludeNotes Then
                    ' Notes
                    If Not strFootnote1 = Nothing Then 'SM 09.21.2021 added for error null object
                        If strFootnote1.Trim.Length > 0 Then
                            ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                            Dim rtbNotes As New RichTextBox
                            rtbNotes.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            Dim xrtNotes As New XRLabel 'XRRichText 'SM 09.20.2021 changed to XRLabel
                            xrtNotes.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            rtbNotes.Width = intAvailableWidth
                            xrtNotes.Width = intAvailableWidth
                            Using rtbNotes
                                rtbNotes.AppendText(strFootnote1.Trim)
                                'xrtNotes.Rtf = rtbNotes.Rtf
                                xrtNotes.Text = rtbNotes.Text
                            End Using

                            With G_ReportOptions
                                Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                                Detail.Controls.Add(xrHeaderSectionTable)
                                intNewY += (xrHeaderSectionTable.Height + 10)
                            End With

                            xrNotesTable = New XRTable
                            xrNotesTable.Width = intAvailableWidth
                            xrNotesTable.Location = New Point(intNewX, intNewY)
                            xrNotesRow = New XRTableRow
                            'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
                            Dim xrNotes2Cell As New XRTableCell
                            xrNotes2Cell.Width = xrNotesRow.Width
                            xrNotes2Cell.CanGrow = True
                            xrNotes2Cell.WordWrap = True
                            xrNotes2Cell.CanShrink = True
                            xrNotes2Cell.Multiline = True
                            xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
                            xrNotes2Cell.Controls.Add(xrtNotes)
                            xrNotesRow.Cells.Add(xrNotes2Cell)
                            xrNotesTable.Rows.Add(xrNotesRow)

                            .Detail.Controls.Add(xrNotesTable)
                            intNewY += (xrNotesTable.Height + 20)

                            Try 'RDTC 2021.08.03
                                rtbNotes.Dispose()
                                'xrtNotes.Dispose()
                            Catch ex As Exception
                                Log.Info("Failed to dispose some objects in Notes", ex)
                            End Try
                        End If
                    End If
                End If

                If G_ReportOptions.blnIncludeAddNotes Then
                    ' Additional Notes
                    If Not strFootnote2 = Nothing Then
                        If strFootnote2.Trim.Length > 0 Then

                            ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                            Dim rtbAddNotes As New RichTextBox
                            rtbAddNotes.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            Dim xrtAddNotes As New XRLabel 'XRRichText 'SM 09.20.2021 changed to XRLabel
                            xrtAddNotes.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            rtbAddNotes.Width = intAvailableWidth
                            xrtAddNotes.Width = intAvailableWidth
                            Using rtbAddNotes
                                rtbAddNotes.AppendText(strFootnote2.Trim)
                                'xrtAddNotes.Rtf = rtbAddNotes.Rtf
                                xrtAddNotes.Text = rtbAddNotes.Text
                            End Using

                            With G_ReportOptions
                                Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                                Detail.Controls.Add(xrHeaderSectionTable)
                                intNewY += (xrHeaderSectionTable.Height + 10)
                            End With

                            xrNotesTable = New XRTable
                            xrNotesTable.Width = intAvailableWidth
                            xrNotesTable.Location = New Point(intNewX, intNewY)
                            xrNotesRow = New XRTableRow
                            'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
                            Dim xrNotes2Cell As New XRTableCell
                            xrNotes2Cell.Width = xrNotesRow.Width
                            xrNotes2Cell.Height = 500
                            xrNotes2Cell.CanShrink = False
                            xrNotes2Cell.CanGrow = False
                            xrNotes2Cell.Controls.Add(xrtAddNotes)
                            xrNotesRow.Cells.Add(xrNotes2Cell)
                            xrNotesTable.Rows.Add(xrNotesRow)
                            xrNotesTable.CanShrink = True
                            .Detail.Controls.Add(xrNotesTable)
                            intNewY += (xrNotesTable.Height + 20)

                            Try 'RDTC 2021.08.03
                                rtbAddNotes.Dispose()
                                'xrtAddNotes.Dispose()
                            Catch ex As Exception
                                Log.Info("Failed to dispose rtbAddNotes")
                            End Try
                        End If
                    End If
                End If
            Catch ex As Exception
                Log.Info("Error in Notes: " & ex.Message)
                Log.Info(ex.StackTrace)
            End Try

            If G_ReportOptions.blnIncludeHACCP Then
                '  subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001")
                'subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strStoringTemp, strStoringTime, strCCPdescription, strHACCP, "001")
                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                End With
                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001", strStoringTime, strStoringTemp, strHACCP)
                intNewY += intTextHeight
                'anm noted 10
            End If

            '---JRN 17.03.2010
            'For keywords
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then

                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                    'xrSectionHeaderTable.Dispose()
                End With

                subDisplayKeywords(foundKeywords, "001")
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 11
            End If

            '   Kiosk
            If G_ReportOptions.blnIncludeKiosk And Not G_ReportOptions.dtKiosk Is Nothing Then
                If G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode).Count > 0 Then
                    Dim xrKioskTable As New XRTable
                    Dim xrKioskRows As New XRTableRow

                    xrKioskTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Kiosk), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += xrKioskTable.Height + 10

                    xrKioskTable = New XRTable
                    xrKioskTable.Width = intAvailableWidth
                    xrKioskTable.Location = New Point(intNewX, intNewY)

                    For Each drKioskRows As DataRow In G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode)
                        'AGL 2013.08.22 - added checking for blank dates
                        If CStrDB(drKioskRows("BrandSiteDateFrom")) = "" Or CStrDB(drKioskRows("BrandSiteDateTo")) = "" Then
                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                        Else
                            ' RDC 08.14.2013 : Do not display date if date is equal to 01/01/1900
                            If CDate(drKioskRows("BrandSiteDateFrom")).Year = 1900 And CDate(drKioskRows("BrandSiteDateTo")).Year = 1900 Then
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            Else
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim & " " & Format(CDate(drKioskRows("BrandSiteDateFrom")), "MM/dd/yyyy") & " - " & Format(CDate(drKioskRows("BrandSiteDateTo")), "MM/dd/yyyy")}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            End If
                        End If

                    Next
                    xrKioskTable.Rows.Add(xrKioskRows)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += (xrKioskTable.Height + 20)
                End If
            End If

            ' RDC 02.22.2013
            ' Brands 
            If G_ReportOptions.blnIncludeBrand Then
                If G_ReportOptions.dtBrands.Select("RecipeCode= " & intRecipeCode).Count > 0 Then
                    Dim xrBrandTable As New XRTable
                    Dim xrBrandRow As New XRTableRow
                    Dim xrBrandCell As New XRTableCell

                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        If .blnIncludeHighlightSection Then
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.LightGray
                            xrBrandTable.BorderColor = Color.Black
                        Else
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.White
                            xrBrandTable.BorderColor = Color.Black
                        End If

                        xrBrandRow.Height = .sgFontSize2
                        xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                        xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                        xrBrandCell.Text = cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim
                        xrBrandRow.Cells.Add(xrBrandCell)
                        xrBrandTable.Rows.Add(xrBrandRow)

                    End With
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 10)

                    xrBrandTable = New XRTable
                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    Dim cLangData As New clsLanguage(enumAppType.WebApp, G_strConnection)
                    Dim cLangFromCodeTrans As New clsEGSLanguage(cLangData.GetCodeLang(G_ReportOptions.intTranslation))
                    Dim strBrandClassification As String = ""

                    For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
                        With G_ReportOptions
                            xrBrandRow = New XRTableRow
                            xrBrandRow.Height = .sgFontSize2
                            xrBrandCell = New XRTableCell
                            xrBrandCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Regular)
                            xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft

                            If drBrand("BrandClass").ToString.ToLower = "primary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173883)
                            ElseIf drBrand("BrandClass").ToString.ToLower = "secondary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173884)
                            Else
                                strBrandClassification = drBrand("BrandClass").ToString
                            End If
                            xrBrandCell.Text = drBrand("Brand").ToString & " ~ " & strBrandClassification
                            xrBrandRow.Cells.Add(xrBrandCell)
                            xrBrandTable.Rows.Add(xrBrandRow)
                        End With
                    Next
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 20)

                End If
            End If
            'Publications
            If G_ReportOptions.blnIncludePublication AndAlso G_ReportOptions.dtPublications IsNot Nothing Then
                If G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode).Count > 0 Then

                    Dim xrPublicationTable As New XRTable
                    Dim xrPublicationRow As New XRTableRow
                    Dim xrPublicationCell As New XRTableCell

                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.LightGray
                        xrPublicationTable.BorderColor = Color.Black
                    Else
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.White
                        xrPublicationTable.BorderColor = Color.Black
                    End If

                    xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                    xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrPublicationCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim
                    xrPublicationRow.Cells.Add(xrPublicationCell)
                    xrPublicationTable.Rows.Add(xrPublicationRow)

                    .Detail.Controls.Add(xrPublicationTable)

                    intNewY += (xrPublicationTable.Height + 10)

                    xrPublicationTable = New XRTable
                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                        xrPublicationRow = New XRTableRow
                        xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                        xrPublicationCell = New XRTableCell
                        xrPublicationCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                        ' xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim
                        xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & fctConvertDate(CType(drPublication("PlacementDate"), Date))
                        xrPublicationRow.Cells.Add(xrPublicationCell)
                        xrPublicationTable.Rows.Add(xrPublicationRow)
                    Next

                    .Detail.Controls.Add(xrPublicationTable)
                    intNewY += (xrPublicationTable.Height + 20)

                    'For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                    '    intTextHeight = ReportingTextUtils.MeasureText(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '    intNewY += intTextHeight
                    'Next
                    '' RDC 04.27.2013 - CMW-5630 Fix
                    'intNewY += 20
                End If
            End If

            ' End

            If G_ReportOptions.blnIncludeNutrients Then
                subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001")
                intNewY += GetLineSpace(intTextHeight)
            End If

            ' RDC 09.05.2013 : Nutrient enhancement
            Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
            Dim intSelCodeTrans As Integer = 0
            Dim intCodeSetDisplay As Integer = 0
            For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
                intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
                intSelCodeTrans = CInt(drDispSet("codeTrans"))
                intCodeSetDisplay = CInt(drDispSet("CodeSet"))
            Next

            intNewY += 20
            If G_ReportOptions.blnIncludeNutrients Then
                ' Section Header
                Dim xrNutHeader As New XRTable
                xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutrientInformation), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrNutHeader)

                intNewY += (xrNutHeader.Height + 10)

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSetDisplay, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice)

                intNewY += 20
            End If


            'GDA
            If G_ReportOptions.blnIncludeGDA Then

                Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                Detail.Controls.Add(xrGDAHeader)
                intNewY += (xrGDAHeader.Height) + 10

                subDisplayGDAComputation(CInt(row("Code")), intCodeSetDisplay, intSelCodeTrans, CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice")))
                ' ''    subDisplayNutrientsGDA(strYieldName, _
                ' ''        dblNutrientFactor, L_Nutrient, "001")
                ' ''    intNewY += GetLineSpace(intTextHeight)
            End If

            '- Cookbook
            ' If enumPrintOptions.RecipeCosting Then
            If G_ReportOptions.blnIncludeCookbook And Not G_ReportOptions.dtCookbook Is Nothing Then
                If G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCookbookTable As New XRTable
                    Dim xrCookbookRow As New XRTableRow

                    xrCookbookTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Cookbook), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 10)

                    xrCookbookTable = New XRTable
                    xrCookbookTable.Width = intAvailableWidth
                    xrCookbookTable.Location = New Point(intNewX, intNewY)

                    For Each drCookbookRow As DataRow In G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode)
                        xrCookbookRow = fctMakeDataRow({drCookbookRow("Name").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCookbookTable.Rows.Add(xrCookbookRow)
                    Next
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 20)
                End If
            End If
            ' End If
            '---
            'Comments
            If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
                If G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCommentTable As New XRTable
                    Dim xrCommentRow As New XRTableRow

                    xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 10)

                    xrCommentTable = New XRTable
                    xrCommentTable.Width = intAvailableWidth
                    xrCommentTable.Location = New Point(intNewX, intNewY)

                    For Each drComment As DataRow In G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode)
                        xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCommentTable.Rows.Add(xrCommentRow)
                    Next
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 20)

                End If
            End If

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                intNewY -= 15
                '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                '  subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", , , strConn, row("Code"))
                Dim blnManor As Boolean = False
                Dim strStyle As String = "003"
                If blnManor = False Then
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    With Me
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                        Select Case strStyle

                            Case "001", "002", "003"
                                Dim xrAllergensTable As New XRTable
                                Dim xrAllergensRow As New XRTableRow
                                Dim xrAllergensCell As New XRTableCell

                                xrAllergensTable.Width = intAvailableWidth
                                xrAllergensTable.Location = New Point(intNewX, intNewY)

                                If G_ReportOptions.blnIncludeHighlightSection Then
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.LightGray
                                    xrAllergensTable.BorderColor = Color.Black
                                Else
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.White
                                    xrAllergensTable.BorderColor = Color.Black
                                End If

                                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrAllergensCell.Text = strX.Trim
                                xrAllergensRow.Cells.Add(xrAllergensCell)
                                xrAllergensTable.Rows.Add(xrAllergensRow)

                                .Detail.Controls.Add(xrAllergensTable)

                                intNewX += (xrAllergensTable.Height + 10)

                                ' RDC 05.15.2013 - Removed.
                                'Case "002"  'Modern
                                '    intNewY += 10
                                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                                'Case "003"
                                '    intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                '  xrAllergensTable.Dispose()
                                '  xrAllergensRow.Dispose()
                                '  xrAllergensCell.Dispose()

                            Case "003Menu"
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                            Case "004" 'Merchandise Details
                                intNewY += 30

                                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                            Case Else
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End Select


                        intNewY += intTextHeight + 10
                    End With
                Else
                    intNewY += GetLineSpace(intTextHeight)
                End If
                'intNewY += GetLineSpace(intTextHeight)
                'anm noted 12
                Dim row1 As DataRow = foundDetails(0) 'KMQDC 11.24.2015

                Dim CodeAllergenTranslation As Integer
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)


                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", False, False, strConn, CodeAllergenTranslation)
            End If
            'End of Allergens

            intNewX = 0
            intNewY = intNewY + 30
            ' composition
            If G_ReportOptions.blnIncludeComposition Then
                Dim xrCompositionTable As New XRTable
                Dim xrCompositionRow As New XRTableRow
                Dim xrCompositionCell As New XRTableCell

                If G_ReportOptions.blnIncludeAllergens And G_ReportOptions.intfoodLaw = 3 Then
                    intNewY += CInt(GetLineSpace(intTextHeight))
                End If

                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    If .blnIncludeHighlightSection Then
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.LightGray
                        xrCompositionTable.BorderColor = Color.Black
                    Else
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.White
                        xrCompositionTable.BorderColor = Color.Black
                    End If

                    xrCompositionRow.Height = .sgFontSize2
                    xrCompositionCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                    xrCompositionCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                    xrCompositionCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Composition).Trim
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    xrCompositionTable.Rows.Add(xrCompositionRow)

                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 10)

                xrCompositionTable = New XRTable
                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)
                Dim XrRichText1 As New XRLabel 'XRRichText
                Try
                    With G_ReportOptions
                        xrCompositionRow = New XRTableRow
                        '   xrCompositionRow.Height = .sgFontSize
                        xrCompositionTable.Width = intAvailableWidth
                        xrCompositionCell = New XRTableCell

                        '--------------keen dela cruz
                        Dim str As String = row("Composition").ToString
                        str = str.Replace("<b>", "\b ")
                        str = str.Replace("</b>", "\b0")
                        str = str.Replace("<p>", "")
                        str = str.Replace("</p>", "")
                        str = str.Replace("<br>", "")
                        str = str.Replace("<i>", "\i ")
                        str = str.Replace("</i>", "\i0")
                        str = str.Replace("{", "")
                        str = str.Replace("}", "")
                        str = str.Replace("<div>", "\line \div ")
                        str = str.Replace("</div>", "\line \div0 ")
                        'Dim strhtml As String = ParseHtmlToRTF(str)  'LLG 05.16.2016 for lepause issue

                        Using XrRichText1
                            XrRichText1.Width = 630
                            XrRichText1.CanGrow = True
                            XrRichText1.CanShrink = True
                            XrRichText1.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                            'XrRichText1.Rtf = strhtml
                            XrRichText1.Text = str
                            xrCompositionCell.Controls.Add(XrRichText1)
                            ' OLD (causes NullReference when the row has 0 cells):
                            ' xrCompositionRow.InsertCell(xrCompositionCell, 1)

                            ' NEW (safe): just add the cell (or InsertCell at index 0)
                            xrCompositionRow.Cells.Add(xrCompositionCell)
                            ' Or: xrCompositionRow.InsertCell(xrCompositionCell, 0, False)

                            xrCompositionTable.Rows.Add(xrCompositionRow)
                            Me.Detail.Controls.Add(xrCompositionTable)
                            intNewY += (xrCompositionTable.Height + 20)
                        End Using
                    End With
                Catch ex As Exception
                    Log.Info("error in Composition: " & ex.Message)
                    Log.Info("error in Composition: " & ex.StackTrace)
                End Try
            End If

            intNewY = intNewY + 30

            Dim dblMaxWidthPicture As Double
            Dim dblMaxHeightPicture As Double
            intNewX = 0
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                dblMaxHeightPicture = 250
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If

            'For j As Integer = 0 To 2
            '    strPicture(j) = ""
            '    strPicture(j) = fctGetPictureName(str3Pictures, j)
            'Next

            If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            Dim strFileName As String


            ''---GDA Image JRN 06.07.2010
            If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
                Dim bShowGDAImage As Boolean = False
                For Each arr As tNutrient In G_Nutrient
                    If CDblDB(arr.GDA) > 0 Then
                        bShowGDAImage = True
                        Exit For
                    End If
                Next
                If bShowGDAImage Then
                    G_ReportOptions.blnIncludeGDA = False
                    Dim intGDAPanelHeight = 70
                    Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                    Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                    Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                    .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
                End If
            End If

            '---

            '--- VRP 07.11.2007
            If G_ReportOptions.blnPicturesAll = True Then
                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To UBound(arrPicture)
                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                        End If
                        intNewX += CInt(G_dblMaxWidthPicture) + 5
                    Next
                    intNewY += CInt(G_dblMaxHeightPicture)
                    'anm noted 10
                End If
                intNewY += 10
                intNewX = 0
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += G_dblMaxWidthPicture + 20
                            'intCurY = intNewY
                        Else
                            For j As Integer = 0 To UBound(arrPicture)
                                If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                    strFileName = G_strPhotoPath & arrPicture(j)
                                    .Detail.Controls.AddRange(New XRControl() _
                                     {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                    intNewX += G_dblMaxWidthPicture + 20
                                    'intCurY = intNewY
                                    Exit For
                                End If
                            Next
                        End If

                    End If
                End If
            End If
            '--------
        End With
        Return Me
    End Function

    Function fctPrintRecipeCostingEGSStandard4(ByVal foundDetails2() As DataRow, ByVal foundKeywords2() As DataRow,
                                               ByVal foundAllergens2() As DataRow, ByVal dtIngredients2 As DataTable,
                                               Optional ByVal dtListePreparation2 As DataTable = Nothing, Optional strConn2 As String = "",
                                               Optional CodeUser As Integer = 0, Optional CodeListe As Integer = 0,
                                               Optional dtFootNotes As DataTable = Nothing, Optional strFilter As String = "",
                                               Optional CodeTrans As Integer = 1, Optional CodeLang As Integer = 1, Optional ByVal userLocale As String = "en-US") As XtraReport

        '483 height to manage
        Dim fntFont As Font
        Dim intRecipeCode As Long
        Dim intDictionary As Integer
        Dim L_CurrencyName As String
        Dim dblCoefficient As Double
        Dim dblFoodCostPercentage As Double
        Dim dblTaxValue As Double
        Dim dblImposedPrice As Double
        Dim strName As String
        Dim strPortionUnit2Format As String
        Dim strCategoryName As String
        Dim strNumber As String
        Dim strSourceName As String = Nothing
        Dim strRemarks As String
        Dim strDate As String = Nothing
        Dim strPreparation As String = ""
        Dim strCoolingTime As String = ""
        Dim strHeatingTime As String = ""
        Dim strHeatingTemperature As String = ""
        Dim strHeatingMode As String = ""
        Dim strCCPdescription As String = ""
        Dim strStoringTemp As String = "" 'VRP 21.08.2008"
        Dim strStoringTime As String = "" 'VRP 21.08.2008
        Dim strHACCP As String = ""
        Dim strRecipeName As String
        Dim strServings As String
        Dim strYieldName As String
        Dim strNumberOfServings As String
        Dim strSubRecipeUnit As String
        Dim dblPercent As Double
        Dim dblYieldQty As Double
        Dim dblTotal As Double
        Dim dblPrice As Double
        Dim CurRate As Double
        Dim dblUnitFactor As Double
        Dim dblWastage As Double
        Dim dblFactor As Double
        Dim dblQuantityNet As Double
        Dim strQuantityNet As String = "0"
        Dim strUnit As String
        'Dim strUnitFormat As String
        Dim dblQuantityBrut As Double
        Dim strQuantityBrut As String = "0"
        Dim dblTotalLaborCost As Double
        Dim dblCoefficientBelvoir As Double
        Dim dblItemPrice As Double
        Dim strNetQty As String
        Dim strGrossQty As String
        Dim strDisplayUnit As String
        Dim lngDisplayUnit As Long
        Dim strPriceFormat As String
        Dim lngKiloCode As Long
        Dim lngLiterCode As Long
        'Dim str3Pictures As String = Nothing
        'Dim strPicture(0 To 2) As String
        Dim strPictureAll As String = "" 'VRP 07.11.2007
        Dim intAvailableWidth As Integer
        Dim intSpace As Integer
        Dim strX As String
        Dim dblYield2 As Double
        Dim blnSubRecipeComputation As Boolean = False
        G_ReportOptions.intPageLanguage = CodeLang
        G_ReportOptions.intTranslation = CodeTrans
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        fctPrintRecipeCostingEGSStandard4 = Nothing

        sf = New StringFormat(StringFormatFlags.NoClip)

        Dim userCulture As CultureInfo = New CultureInfo(userLocale)

        Dim arrNutrientName As New ArrayList
        For Each tNut As tNutrient In G_Nutrient
            arrNutrientName.Add(tNut.Name)
        Next

        Try
            'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
            'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
            'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
            'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)

            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            End If

            'SM 2015.05.15 added try catch for font that does not support regular fontstyle
            Try
                fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            Catch ex As Exception
                'fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try

            'SM 2015.05.15 added try catch for font that does not support bold fontstyle
            Try
                fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            Catch ex As Exception
                ' fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try

            'SM 2015.05.15 added try catch for font that does not support Italic fontstyle
            Try
                fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            Catch ex As Exception
                ' fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
            End Try
        Catch ex As Exception

            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        If foundDetails2.Length <= 0 Then
            Log.Info("No details " & CodeUser & " | CodeListe " & CodeListe & " | Filter: " & strFilter)
            Exit Function
        End If

        ReDim L_lngCol(0 To 12)

        Dim row As DataRow = foundDetails2(0)
        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            'fctGetNutrientDetails()
            fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, G_strConnection) 'VRP 08.01.2009
        End If

        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
            dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)
        End If

        intDictionary = G_Language
        If G_ReportOptions.intTranslation > 0 Then
            intDictionary = IIf(IsDBNull(row("COdeDictionary")), G_Language, row("COdeDictionary"))
        End If
        G_Language = intDictionary

        strPriceFormat = CType(CStrDB(row("curFormat")), String)
        L_CurrencyName = CType(CStrDB(row("Currency")), String)
        dblCoefficient = CType(CDblDB(row("coeff")), Double)
        dblFoodCostPercentage = CType(CDblDB(row("Foodcostpercentage")), Double)
        dblTaxValue = CType(CDblDB(row("TaxValue")), Double)
        dblImposedPrice = CType(CDblDB(row("ImposedPrice")), Double)
        strName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
        strPortionUnit2Format = G_FormatOneDecimal
        If Not IsDBNull(row("PortionUnit2Format")) Then strPortionUnit2Format = CType(CStrDB(row("PortionUnit2Format")), String)
        strCategoryName = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation) 'Trim(rsX!CategoryName)
        strNumber = fctNumber2Text(Trim(CType(CStrDB(row("RecipeNumber")), String)))
        intRecipeCode = row("Code")
        If CType(CIntDB(row("codesource")), Integer) = 0 Then
            strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NoSource)  'No Source 
        Else
            strSourceName = fctGetTranslatedText(row, "Chef", "chef", G_ReportOptions.intTranslation)
        End If

        strRemarks = fctGetTranslatedText(row, "Remark1", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
        'If Not IsDBNull(row("Dates")) Then strDate = CType(CStrDB(row("Dates")), String)
        If Not IsDBNull(row("Dates")) Then
            Dim dt As DateTime = CType(row("Dates"), DateTime)
            strDate = dt.ToString("d", userCulture)
        End If

        strPreparation = fctGetTranslatedText(row, "note", "noteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!recipenote)

        If Not IsDBNull(row("CoolingTime")) Then strCoolingTime = Trim(row("CoolingTime").ToString)
        If Not IsDBNull(row("HeatingTime")) Then strHeatingTime = Trim(row("HeatingTime").ToString)
        If Not IsDBNull(row("HeatingTemperature")) Then strHeatingTemperature = Trim(row("HeatingTemperature").ToString)
        If Not IsDBNull(row("HeatingMode")) Then strHeatingMode = Trim(row("HeatingMode").ToString)
        If Not IsDBNull(row("CCPDescription")) Then strCCPdescription = Trim(row("CCPDescription").ToString)
        If Not IsDBNull(row("StoringTemp")) Then strStoringTemp = Trim(row("StoringTemp").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("StoringTime")) Then strStoringTime = Trim(row("StoringTime").ToString) 'VRP 21.08.2008
        If Not IsDBNull(row("HACCP")) Then strHACCP = Trim(row("HACCP").ToString)


        For i As Integer = 1 To 34 '15
            L_Nutrient(i).Value = -1
        Next


        Dim strFieldname As String = Nothing
        Dim strFieldnameForPercent As String = Nothing
        For i As Integer = 1 To 34 '15
            strFieldname = "N" & i.ToString
            'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
            strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
            If Not IsDBNull(row(strFieldname)) And
               Not IsDBNull(row(strFieldnameForPercent)) Then
                If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                    L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                    G_Nutrient(i).Unit = "%"
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                Else
                    L_Nutrient(i).Value = CType(row(strFieldname), Double)
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                End If
            End If
        Next

        lngKiloCode = fctGetUnitCodeFromType(100)
        lngLiterCode = fctGetUnitCodeFromType(200)


        Dim intDPic As Integer
        If row.Table.Columns.Contains("DefaultPicture") Then
            intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
        Else
            intDPic = 1
        End If

        If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
        Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
        '------ 

        With Me
            'Papersize
            '------------
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margins
            '------------
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)



            'Orientation
            '-----------
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If

            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

            'page header
            '-------------------------------------------
            'brag
            intNewX = 0
            intNewY = IIf(CInt(G_ReportOptions.dblTopMargin) > 20, 20, 0)
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation
            strX = " "
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += GetLineSpace(intTextHeight)


            intNewX = 0
            intNewY = IIf(intNewY < CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblTopMargin), intNewY)

            'Recipe Name
            strRecipeName = fctGetTranslatedText(row, "RecipeName", "RecipeNameTrans", G_ReportOptions.intTranslation)
            'intTextHeight = ReportingTextUtils.MeasureText(strRecipeName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            ' .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntReportTitle, intNewX, intNewY, intAvailableWidth, (intTextHeight * 2), DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            'intNewY += GetLineSpace(intTextHeight) + 20

            Dim xRecipeName As New XRTable
            Dim xRecipeRow As New XRTableRow
            Dim xRecipeCell As New XRTableCell
            xRecipeName.Location = New System.Drawing.Point(intNewX, intNewY)
            xRecipeName.Width = intAvailableWidth

            If G_ReportOptions.blnIncludeHighlightSection Then
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.LightGray
            Else
                xRecipeName.BorderWidth = 1
                xRecipeName.BackColor = Color.White
            End If

            xRecipeRow.Padding = New DevExpress.XtraPrinting.PaddingInfo(0, 0, 0, 0)
            xRecipeRow.Height = CInt(G_ReportOptions.sgFontTitleSize)
            xRecipeCell.Text = New String(strRecipeName)
            xRecipeCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            If G_ReportOptions.blnIncludeHighlightSection Then xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.Top Else xRecipeCell.Borders = DevExpress.XtraPrinting.BorderSide.None
            xRecipeCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xRecipeRow.Cells.Add(xRecipeCell)
            xRecipeName.Rows.Add(xRecipeRow)

            xRecipeName.KeepTogether = False
            .PageHeader.Controls.Add(xRecipeName)

            'xRecipeName.Dispose()
            'xRecipeRow.Dispose()
            'xRecipeCell.Dispose()
            ''-------------------------------------------

            ' RDC 08.29.2013 : Applied enhancements to code
            intNewX = 0
            intNewY = 20
            Dim xrRecipeMenuInfo As New XRTable 'anm first input with table 
            xrRecipeMenuInfo.Width = intAvailableWidth
            xrRecipeMenuInfo.Location = New Point(intNewX, intNewY)
            Dim xrRecipeMenuRow As New XRTableRow
            If G_ReportOptions.blnIncludeNumber Then
                If G_ReportOptions.blnRecipe Then
                    ' Recipe #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Recipe_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

                Else
                    ' Menu #
                    xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Menu_No), ": " & strNumber}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                    xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                End If
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeCategory Then
                ' Category
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Category), ": " & strCategoryName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeSource Then
                ' Source
                ' RDC 09.03.2013 : Change display from NO SOURCE to NOT DEFINED
                If strSourceName.ToUpper.Trim = "NO SOURCE" Or strSourceName Is Nothing Or strSourceName.Trim = "" Then strSourceName = cLang.GetString(clsEGSLanguage.CodeType.NotDefined2)
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Source), ": " & strSourceName}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeDate Then
                ' Date
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Date_), ": " & strDate}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                'xrRecipeMenuRow.Dispose()
            End If

            If G_ReportOptions.blnIncludeRemark Then
                ' Remarks
                xrRecipeMenuRow = New XRTableRow
                xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.Remark), ": " & strRemarks}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)
                ' xrRecipeMenuRow.Dispose()
            End If


            strYieldName = fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit)
            'strYieldName = row("itemUnit").ToString

            '-- VRP 20.01.2009
            dblYieldQty = CType(row("Yield"), Double)
            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)

            Dim intYieldUnitOriginal As Integer = 0
            If row.Table.Columns.Contains("YieldUnitOriginalCode") Then intYieldUnitOriginal = CType(row("YieldUnitOriginalCode"), Integer) 'JTOC 31.05.2013

            Dim dblYieldQtyOrig As Double = 0.0
            If row.Table.Columns.Contains("YieldOriginalFactor") Then dblYieldQtyOrig = row("YieldOriginalFactor") 'JTOC 31.05.2013


            Dim strYieldUnitNameOrig As String = ""
            If row.Table.Columns.Contains("YieldUnitOriginalName") Then strYieldUnitNameOrig = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 'JTOC 31.05.2013
            '---


            If G_Options.QtyType = 0 Then
                Dim dblY As Double = CType(row("Yield"), Double)
                'strNumberOfServings = fctFormatNumericQuantity(CType(row("Yield"), Double), G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & strYieldName
                strNumberOfServings = dblY.ToString(G_FormatOneDecimal, userCulture) & " " & strYieldName
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strNumberOfServings = strNumberOfServings & "/" &
                     fctFormatNumericQuantity(CType(row("Yield2"), Double), strPortionUnit2Format, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
                    'fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    'strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            Else
                strNumberOfServings = fctConvertToFraction(CDbl(dblYieldQty)) & " " & strYieldName
                ' strNumberOfServings = fctConvertToFraction(CType(row("Yield")) & " " & strYieldName)
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strNumberOfServings = strNumberOfServings & "/" &
                        fctConvertToFraction(CType(row("Yield2"), Double)) & " " & strYieldUnitNameOrig
                    ' fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)

                    strSubRecipeUnit = fctGetTranslatedText(row, "PortionUnit2", "PortionUnit2Trans", G_ReportOptions.intTranslation) 'Trim(rsX!PortionUnit2)
                    dblYield2 = CType(row("Yield2"), Double)
                    'blnSubRecipeComputation = True
                End If
            End If
            'xrRecipeMenuRow.Dispose()

            strServings = Replace(Replace(cLang.GetString(clsEGSLanguage.CodeType.IngredientsFor), "%y", strNumberOfServings), "%p", Format(CType(row("DishPercent"), Double), G_FormatWhole))
            ' RDC 09.09.2013 :  CWM-8307 Fix
            strServings = strServings.Replace("[_]", "").Replace("N/A", "").Replace("n/a", "")
            ' 
            xrRecipeMenuRow = New XRTableRow
            xrRecipeMenuRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.For_), ": " & strServings}, {CInt(100), CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
            xrRecipeMenuInfo.Rows.Add(xrRecipeMenuRow)

            .Detail.Controls.Add(xrRecipeMenuInfo)
            intNewY += (xrRecipeMenuInfo.Height + 20)




            '' RDC 08.29.2013 : Code Enhancement
            '' Ingredient Header

            Dim xrIngredientHeader As New XRTable
            Dim xrIngredientHRow As New XRTableRow
            Dim xrIngredientCell As New XRTableCell

            Dim intExcessSpace As Integer = 0

            xrIngredientHeader.Location = New Point(intNewX, intNewY - 12) 'KMQDC 11.26.2015 original no -12
            xrIngredientHeader.Width = intAvailableWidth
            xrIngredientHeader.Borders = DevExpress.XtraPrinting.BorderSide.Top + DevExpress.XtraPrinting.BorderSide.Bottom
            xrIngredientHeader.BorderWidth = 1S

            If G_ReportOptions.blnIncludeHighlightSection Then
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.LightGray
            Else
                xrIngredientHeader.BorderColor = Color.Black
                xrIngredientHeader.BackColor = Color.White
            End If

            xrIngredientHRow.Height = CInt(40)

            Dim strNumberHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Number)
            Dim strMerchHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Product)
            Dim strWastePctHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Waste) & "%"
            Dim strPriceHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Price)
            Dim strNetQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Net_Qty)
            Dim strGrossQtyHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Gross_Qty)
            Dim strAmountHeader As String = cLang.GetString(clsEGSLanguage.CodeType.Amount)

            ' Recipe / Menu number
            If G_ReportOptions.blnIncludeIngrNumber Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNumberHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(50)
            End If

            ' Merchandise / Ingredients

            xrIngredientCell = New XRTableCell
            xrIngredientCell.Width = CInt(160)
            xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            xrIngredientCell.Text = strMerchHeader
            xrIngredientHRow.Cells.Add(xrIngredientCell)



            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Waste Percentage
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(50)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strWastePctHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)

                ' Price
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strPriceHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            ' Net Quantity
            If G_ReportOptions.blnIncludeNetQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strNetQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If

            ' Gross Quantity
            If G_ReportOptions.blnIncludeGrossQty Then
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strGrossQtyHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            Else
                intExcessSpace += CInt(85)
            End If
            If G_ReportOptions.blnIncludeCostOfGoods Then
                ' Amount
                xrIngredientCell = New XRTableCell
                xrIngredientCell.Width = CInt(85)
                xrIngredientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleRight
                xrIngredientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                xrIngredientCell.Text = strAmountHeader
                xrIngredientHRow.Cells.Add(xrIngredientCell)
            End If
            If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngredientHRow.Cells(0).Width += intExcessSpace Else xrIngredientHRow.Cells(1).Width += intExcessSpace

            xrIngredientHeader.Rows.Add(xrIngredientHRow)
            .Detail.Controls.Add(xrIngredientHeader)

            intNewY += (xrIngredientHeader.Height + 5)

            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            Dim xrIngrInfo As New XRTable
            Dim xrIngrRow As New XRTableRow
            Dim xrIngrCell As New XRTableCell
            xrIngrInfo.Width = intAvailableWidth
            xrIngrInfo.Location = New Point(intNewX, intNewY)

            Dim NewDtTable As DataTable

            If dtIngredients2 Is Nothing OrElse dtIngredients2.Rows.Count = 0 Then
                ' No ingredient data available; use an empty table so the loop below is skipped.
                NewDtTable = New DataTable()
            Else
                Dim newdvIng As New DataView(dtIngredients2)
                newdvIng.Sort = "step asc"
                newdvIng.RowFilter = "CodeMain=" & row("Code") & " AND ID =" & row("ID") ' MKAM 2015.07.02
                NewDtTable = newdvIng.ToTable()
            End If

            For Each drIngredient As DataRow In NewDtTable.Rows

                ' For Each drIngredient As DataRow In dtIngredients.Select("CodeMain=" & row("Code")) 'AGL 2013.11.06 - 9372 - added filter
                xrIngrRow = New XRTableRow
                xrIngrRow.Width = xrIngrInfo.Width
                xrIngrRow.Height = G_ReportOptions.sgFontSize2

                Dim strIngrFormat As String = fctNullToString(drIngredient("ItemFormat"))
                If strIngrFormat = "" Then strIngrFormat = "#,###.00"

                Dim fntFontType As FontStyle = FontStyle.Regular
                Select Case CIntDB(drIngredient("ItemType"))
                    Case ID_Recipe
                        fntFontType = FontStyle.Italic
                    Case Else

                End Select

                ' Item Number
                If G_ReportOptions.blnIncludeIngrNumber Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(50)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                    If IsDBNull(drIngredient("ItemNumber")) Then xrIngrCell.Text = "" Else xrIngrCell.Text = drIngredient("ItemNumber")
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                ' Item Name
                Dim strIngrComple As String = "", strIngrName As String = ""

                If CInt(drIngredient("ItemType")) = 0 Then
                    strIngrComple = drIngredient("tmpComplement").ToString
                    strIngrName = drIngredient("tmpName").ToString
                Else
                    strIngrComple = fctGetTranslatedText(drIngredient, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    strIngrName = fctGetTranslatedText(drIngredient, "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)
                End If

                Dim xrRText As New XRLabel 'XRRichText
                'Dim RText As New RichTextBox

                If CBoolDB(drIngredient("isBrandedIngredient")) Then
                    xrRText.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                Else
                    Try
                        xrRText.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    Catch ex As Exception
                        xrRText.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                End If
                'RText.SelectedText = strIngrName & " "
                'xrRText.Text = strIngrName & " "
                If G_ReportOptions.blnIncludeIngredientComplement Then strIngrComple = strIngrComple.Trim & " " Else strIngrComple = ""
                'RText.SelectedText = strIngrComple
                xrRText.Text = strIngrName & " " & strIngrComple

                'xrRText.Rtf = RText.Rtf
                xrRText.Width = CInt(160)

                xrIngrCell = New XRTableCell
                xrIngrCell.Width = CInt(160)
                'If Not RText.IsDisposed Then
                '    RText.Clear()
                '    RText.Dispose()
                'End If
                Try
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                Catch ex As Exception
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                End Try
                xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                xrIngrCell.Controls.Add(xrRText)
                xrIngrRow.Cells.Add(xrIngrCell)
                Dim strIngrUnitPrice As String = ""
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Wastage Percentage
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(50)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    If Not drIngredient("ItemType") = 0 Then
                        If CDblDB(drIngredient("TotalWastage")) > 0 Then xrIngrCell.Text = drIngredient("TotalWastage").ToString Else xrIngrCell.Text = ""
                    Else
                        xrIngrCell.Text = ""
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                ' Price
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = CStrDB(drIngredient("tmpUnit")) Else strIngrUnitPrice = " / " & CStrDB(drIngredient("PriceUnit"))
                    If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                    Dim dblIngrPrice As Double = CDblDB(drIngredient("ItemPrice"))

                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    Try
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    Catch ex As Exception
                        xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    End Try
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblIngrPrice, G_strPriceFormat) & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else

                        'xrIngrCell.Text = Format(dblIngrPrice, strPriceFormat) & strIngrUnitPrice
                        xrIngrCell.Text = dblIngrPrice.ToString(strPriceFormat, userCulture) & strIngrUnitPrice
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If


                'start LLG 10.20.2015 commented and replace Net QTY,Gross QTY and Amount'
                ' Net Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeNetQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = "" 
                    'End If
                    'bragadigdig
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("NetQuantity")) & " " & strIngrUnitPrice
                        Else
                            'xrIngrCell.Text = Format(CDblDB(drIngredient("NetQuantity").ToString), strIngrFormat) & " " & strIngrUnitPrice
                            xrIngrCell.Text = CDblDB(drIngredient("NetQuantity").ToString()).ToString(strIngrFormat, userCulture) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                ' Gross Quantity
                If CIntDB(drIngredient("ItemType")) = 0 Then strIngrUnitPrice = drIngredient("tmpUnit").ToString Else strIngrUnitPrice = fctGetTranslatedText(drIngredient, "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation)
                If strIngrUnitPrice.ToUpper = " / N/A" Or strIngrUnitPrice = " / [_]" Or strIngrUnitPrice.ToUpper = "N/A" Or strIngrUnitPrice = "[_]" Then strIngrUnitPrice = " "

                If G_ReportOptions.blnIncludeGrossQty Then
                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            xrIngrCell.Text = fctConvertToFraction(drIngredient("GrossQuantity")) & " " & strIngrUnitPrice
                        Else
                            'xrIngrCell.Text = Format(CDblDB(drIngredient("GrossQuantity")), strIngrFormat) & " " & strIngrUnitPrice
                            xrIngrCell.Text = CDblDB(drIngredient("GrossQuantity")).ToString(strIngrFormat, userCulture) & " " & strIngrUnitPrice
                        End If

                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If
                If G_ReportOptions.blnIncludeCostOfGoods Then
                    ' Amount
                    Dim dblAmount As Double

                    If drIngredient("PriceUnit").ToString = drIngredient("itemUnit").ToString Then
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("GrossQuantity"))
                    Else
                        dblAmount = CDblDB(drIngredient("ItemPrice")) * CDblDB(drIngredient("unitFactor")) * CDblDB(drIngredient("GrossQuantity"))
                    End If
                    dblTotal += dblAmount



                    xrIngrCell = New XRTableCell
                    xrIngrCell.Width = CInt(85)
                    xrIngrCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                    xrIngrCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight


                    ' RDC 09.11.2013 : CWM-8267 - RECIPE: remove qty for ingredient texts and steps.
                    'If Not drIngredient("ItemType") = 0 Then
                    '    xrIngrCell.Text = Format(dblAmount, G_strPriceFormat)
                    'Else
                    '    xrIngrCell.Text = ""
                    'End If
                    If drIngredient("ItemType") = 75 Or drIngredient("ItemType") = 4 Then
                        xrIngrCell.Text = ""
                    Else
                        'xrIngrCell.Text = Format(dblAmount, strPriceFormat)
                        xrIngrCell.Text = dblAmount.ToString(strPriceFormat, userCulture)
                    End If
                    xrIngrRow.Cells.Add(xrIngrCell)
                End If

                If intExcessSpace > 0 Then
                    If Not G_ReportOptions.blnIncludeIngrNumber Then xrIngrRow.Cells(0).Width += intExcessSpace Else xrIngrRow.Cells(1).Width += intExcessSpace
                End If
                xrIngrInfo.Rows.Add(xrIngrRow)
            Next
            NewDtTable.Dispose()
            'xrIngredientHeader.Dispose()
            'xrIngredientHRow.Dispose()
            'xrIngredientCell.Dispose()

            .Detail.Controls.Add(xrIngrInfo)
            intNewY += (xrIngrInfo.Height + 5)

            'xrIngrInfo.Dispose()
            'xrIngrRow.Dispose()
            'xrIngrCell.Dispose()

            If G_ReportOptions.blnIncludeCostOfGoods Then
                dblPercent = CType(row("DishPercent"), Double) / 100
                dblYieldQty = CType(row("Yield"), Double)
                'dblTotal = 0
                dblPrice = 0
                Dim borderSideText As DevExpress.XtraPrinting.BorderSide = GetLabelBorderSide()
                For rowIng As Integer = 0 To foundDetails2.GetUpperBound(0)
                    CurRate = 0
                    If Not IsDBNull(foundDetails2(rowIng)("Rate")) Then CurRate = CType(foundDetails2(rowIng)("Rate"), Double)
                    dblUnitFactor = 0
                    If Not IsDBNull(foundDetails2(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails2(rowIng)("UnitFactor"), Double)

                    If Not IsDBNull(foundDetails2(rowIng)("wastage1")) Then
                        dblWastage = 100 * CType(foundDetails2(rowIng)("wastage1"), Double) / 100
                        dblWastage = 100 - (100 * CType(foundDetails2(rowIng)("wastage1"), Double) / 100)
                    End If
                    If Not IsDBNull(foundDetails2(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails2(rowIng)("wastage2"), Double) / 100)
                    If Not IsDBNull(foundDetails2(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails2(rowIng)("wastage3"), Double) / 100)
                    If Not IsDBNull(foundDetails2(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails2(rowIng)("wastage4"), Double) / 100)
                    dblWastage = (100 - dblWastage)
                    dblPrice = 0
                    dblFactor = 1
                    If Not IsDBNull(foundDetails2(rowIng)("Factor")) Then dblFactor = CType(foundDetails2(rowIng)("Factor"), Double)
                    If Not IsDBNull(foundDetails2(rowIng)("ItemPrice")) Then dblPrice = CType(foundDetails2(rowIng)("ItemPrice"), Double) * CurRate * dblFactor
                    If Not IsDBNull(foundDetails2(rowIng)("Quantity")) Then dblQuantityNet = CType(foundDetails2(rowIng)("Quantity"), Double)


                    dblQuantityBrut = dblQuantityNet / (1 - (dblWastage / 100))

                    dblPrice = (dblQuantityBrut * dblPrice * dblUnitFactor)

                    'dblTotal += dblPrice

                Next
                ''-------------------------------------------
                'dblTotal = 0
                dblTotalLaborCost = 0
                If Not IsDBNull(row("TotalLaborCost")) Then dblTotalLaborCost = CType(row("TotalLaborCost"), Double)
                dblCoefficientBelvoir = 0
                If Not IsDBNull(row("CoeffNew")) Then dblCoefficientBelvoir = CType(row("CoeffNew"), Double)


                'Cost of Goods

                Dim dblMerchandiseCost As Double
                Dim dblPriceTax As Double
                Dim dblImposedPriceTax As Double
                Dim dblImposedPriceNoTax As Double
                Dim dblImposedCoeff As Double
                Dim dblSellingPriceYield As Double

                'AGL 2013.11.04 - 9277 START - commented this portion, duplicate costing appearing on report ===========================================================
                intNewX = 0
                intNewY += 10
                'sf = New StringFormat(StringFormatFlags.DirectionVertical)
                strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)     'per serving
                L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


                strX = cLang.GetString(clsEGSLanguage.CodeType.per_) & " 100 " & cLang.GetString(clsEGSLanguage.CodeType.Servings) '"per 100 servings"
                L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
                L_lngCol(3) = (L_lngCol(1) / 2)

                L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))

                'Dim intNumberOfRows As Integer = 4
                Dim intCurY As Integer
                'Dim intCurX As Integer
                'If dblTaxValue <> 0 Then intNumberOfRows = 8

                intCurY = intNewY
                intNewY += GetLineSpace(intTextHeight) - 10 'KMQDC 11.26.2015 original no -10
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) 'Cost of Goods
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 1


                If Not G_ReportOptions.bFoodcostOnly Then
                    Dim dblX As Double = 0.0
                    Dim strY As String = ""

                    Select Case G_Options.FactorType
                        'Selling Price/const
                        Case 0
                            dblCoefficient = Format(dblCoefficient, "Standard")
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const)
                        Case 1
                            dblX = Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal)
                            strY = dblX.ToString(G_FormatOneDecimal, userCulture)

                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) '"Selling price/Profit"
                            'strX &= " " & Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal) & "%"
                            strX &= " " & strY & "%"
                        Case 2
                            dblX = Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal)
                            strY = dblX.ToString(G_FormatOneDecimal, userCulture)

                            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) '"Selling price/FC"
                            'strX &= " " & Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal) & "%"
                            strX &= " " & strY & "%"
                    End Select
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewY += GetLineSpace(intTextHeight)
                    'anm noted 2


                    dblMerchandiseCost = 0
                    If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty

                    If dblTaxValue <> 0 Then
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            'dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT
                        'strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        strX &= " " & dblTaxValue.ToString(G_FormatTwoDecimal, userCulture) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 3

                        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_)       '"Selling price + VAT"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 4
                        Select Case G_Options.FactorType
                            'Imposed selling price/const
                            Case 0
                                strX = Format(dblImposedCoeff, G_FormatTwoDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                'strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                                strX &= " " & dblImposedCoeff.ToString(G_FormatTwoDecimal, userCulture)
                            Case 1
                                Dim dblConvertCoeff1 As Double = Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                'strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                                strX &= " " & dblConvertCoeff1.ToString(G_FormatOneDecimal, userCulture) & "%"
                            Case 2
                                Dim dblConvertCoeff2 As Double = Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                'strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                                strX &= " " & dblConvertCoeff2.ToString(G_FormatOneDecimal, userCulture) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 5
                        strX = cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'VAT 
                        strX &= " " & Format(dblTaxValue, G_FormatTwoDecimal) & "%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 6
                        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & " + " & cLang.GetString(clsEGSLanguage.CodeType.VAT_) 'Imposed selling price + VAT
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 7
                    Else
                        dblPriceTax = dblMerchandiseCost * dblCoefficient * dblTaxValue / 100
                        dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                        dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                        If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                            ' dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                            dblImposedCoeff = dblCoefficient
                        Else
                            dblImposedCoeff = 0
                        End If

                        Select Case G_Options.FactorType
                            Case 0
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Const) ' Imposed Selling Price/Const.
                                'strX &= " " & Format(dblImposedCoeff, G_FormatTwoDecimal)
                                strX &= " " & dblImposedCoeff.ToString(G_FormatTwoDecimal, userCulture)
                            Case 1
                                Dim dblConvertCoeff1 As Double = Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.Profit) 'Imposed Selling Price/Profit
                                'strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 1), G_FormatOneDecimal) & "%"
                                strX &= " " & dblConvertCoeff1.ToString(G_FormatOneDecimal, userCulture) & "%"
                            Case 2
                                Dim dblConvertCoeff2 As Double = Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal)
                                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) & "/" & cLang.GetString(clsEGSLanguage.CodeType.FC) 'Imposed selling price/FC
                                'strX &= " " & Format(fctConvertCoeff(dblImposedCoeff, 2), G_FormatOneDecimal) & "%"
                                strX &= " " & dblConvertCoeff2.ToString(G_FormatOneDecimal, userCulture) & "%"
                        End Select
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngNameW - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                        intNewY += GetLineSpace(intTextHeight)
                        'anm noted 8
                    End If


                    intNewX = 0

                End If

                'AGL 2013.11.04 - 9277 END===========================================================

                'Per X Yield
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3) + L_lngCol(1)
                'AGL 2013.11.04
                subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat, dblFoodCostPercentage, userLocale:=userLocale)
                '  subDisplayStandardCalculation(1, dblTaxValue, dblCoefficient, dblTotal, dblImposedPrice * dblYieldQty, dblYieldQty, strYieldName, strPriceFormat)

                intNewX = 0
                intNewY = intCurY - 10 'KMQDC 11.26.2015 original no -10
                intNewX += L_lngNameW + L_lngCol(3)
                dblMerchandiseCost = 0
                If dblYieldQty <> 0 Then dblMerchandiseCost = dblTotal / dblYieldQty
                dblSellingPriceYield = dblMerchandiseCost * dblCoefficient
                'Per 1 yield
                'AGL 2013.11.04
                subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice / dblYieldQty, dblYieldQty, strYieldName, strPriceFormat, dblFoodCostPercentage, userLocale:=userLocale)
                ' subDisplayStandardCalculation(2, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, dblYieldQty, strYieldName, strPriceFormat)

                Dim dblRatioYield1Yield2 As Double
                Dim dblSellingPriceSubRecipe As Double
                If blnSubRecipeComputation Then
                    dblRatioYield1Yield2 = 0
                    dblMerchandiseCost = 0
                    If dblYield2 <> 0 Then
                        dblRatioYield1Yield2 = dblYieldQty / dblYield2
                        dblMerchandiseCost = dblTotal / dblYield2
                    End If

                    dblImposedPrice = dblImposedPrice * dblRatioYield1Yield2
                    dblSellingPriceSubRecipe = dblMerchandiseCost * dblCoefficient

                    'per 1 Subrecipe Unit
                    subDisplayStandardCalculation(3, dblTaxValue, dblCoefficient, dblMerchandiseCost, dblImposedPrice, 1, strSubRecipeUnit, strPriceFormat, userLocale:=userLocale)
                End If
            End If


            intNewX = 0
            intNewY += GetLineSpace(intTextHeight)
            'anm noted 9

            'str3Pictures = ""
            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString 'VRP 07.11.2007

            '------------------------------------------------------


            'intNewY += 20
            ' RDC force table to be plotted in X:0
            'PREPARATION
            intNewX = 0
            Dim xrStepTable As New XRTable
            Dim xrStepRow As New XRTableRow
            Dim xrStepCell As New XRTableCell
            Dim xrStepCellB As New XRTableCell
            xrStepTable.Location = New Point(intNewX, intNewY)
            xrStepTable.Width = intAvailableWidth
            xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None

            If G_ReportOptions.blnIncludePreparation AndAlso dtListePreparation2 IsNot Nothing AndAlso dtListePreparation2.Rows.Count > 0 Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout
                For Each drStep As DataRow In dtListePreparation2.Select("Codeliste=" & CIntDB(row("Code")))
                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New TextBox 'RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim xrt As New XRLabel 'XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim x As Integer
                    Dim textLeftCount As Integer
                    Dim lineCountLeft As Integer
                    Dim strlines() As String
                    Using rtb
                        If Not G_ReportOptions.blnMode Then
                            If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(drStep("Note").ToString) Else rtb.AppendText(Chr(32))
                        Else
                            If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
                        End If
                        xrt.Text = rtb.Text
                        x = rtb.Lines.Count
                        textLeftCount = rtb.Lines.Count Mod 3
                        lineCountLeft = rtb.Lines.Count - textLeftCount
                        strlines = rtb.Lines
                    End Using

                    xrStepRow = New XRTableRow
                    xrStepRow.Height = G_ReportOptions.sgFontSize2

                    Select Case row("MethodFormat").ToString.Trim.ToLower
                        Case "x", "" ' Not bulleted / numbered
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth
                            rtb.Width = intAvailableWidth
                            xrt.Width = intAvailableWidth

                            'xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            'xrStepRow.Cells.Add(xrStepCell)
                            Dim onceCount As Integer = 0
                            'anm
                            ' Dim currentHeight As New Integer
                            '  currentHeight = intNewY

                            Dim countTo3 As Integer = 0
                            Dim addToName As Integer = 0
                            Dim curY = intNewY + 10
                            Dim newLoop As Boolean = False
                            Dim rtbNew As New TextBox 'RichTextBox
                            'Dim aslow As String = rtbNew.Rtf.ToString()
                            Dim xrts As New XRLabel 'XRRichText
                            Dim xrNewStepTable As New XRTable
                            Dim LineCounter As Integer
                            For Each Line As String In strlines 'rtb.Lines
                                countTo3 += 1
                                LineCounter += 1
                                If Line = "" Then
                                    rtbNew.AppendText(Environment.NewLine)
                                Else
                                    If countTo3 = 1 Then
                                        rtbNew.AppendText(Line)
                                    Else
                                        rtbNew.AppendText(Line + Environment.NewLine)
                                    End If
                                End If
                                'xrts.Rtf = rtbNew.Rtf
                                xrts.Text = rtbNew.Text
                                If countTo3 = 1 Then
                                    countTo3 = 0
                                    xrts.Width = intAvailableWidth
                                    xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                                    xrts.CanShrink = True
                                    xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
                                    xrts.KeepTogether = True
                                    xrts.Location = New Point(intNewX, curY)
                                    .Detail.Controls.AddRange(New XRControl() {xrts})
                                    curY += (xrts.Height)

                                    xrts = New XRLabel 'XRRichText
                                    xrNewStepTable = New XRTable
                                    If Not rtbNew.IsDisposed Then
                                        rtbNew.Clear()
                                        rtbNew.Dispose()
                                    End If
                                End If
                                rtbNew = New TextBox 'RichTextBox
                            Next
                            intNewY = curY

                            If Not rtb.IsDisposed Then
                                rtb.Clear()
                                rtb.Dispose()
                            End If
                        Case "n" ' Number bullet
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = drStep("Position") & "."
                            End If
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                        Case "b" ' Symbol bullet "•"
                            xrStepCell = New XRTableCell
                            xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            If G_ReportOptions.blnIncludeProcSequenceNo Then
                                xrStepCell.Text = "•"
                            End If
                            xrStepRow.Cells.Add(xrStepCell)

                            xrStepCell = New XRTableCell
                            xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                            xrStepCell.Controls.Add(xrt)
                            ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                            'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                            xrStepRow.Cells.Add(xrStepCell)
                            xrStepTable.Rows.Add(xrStepRow)
                            .Detail.Controls.Add(xrStepTable)
                            intNewY += (xrStepTable.Height + 20)
                    End Select
                    'xrStepTable.Rows.Add(xrStepRow) 'anm
                Next
                intNewY += 20
            End If


            'If G_ReportOptions.blnIncludePreparation Then
            '    intNewY = intNewY + 90
            'Else
            '    intNewY = intNewY + 90
            'End If

            Dim strServeWithNotes As String = Nothing
            Dim strFootnote1 As String = ""
            Dim strFootnote2 As String = ""

            If dtFootNotes.Select("Code=" & intRecipeCode).Count > 0 Then
                For Each rwRecipeNotes As DataRow In dtFootNotes.Select("Code=" & intRecipeCode)
                    strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
                    strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
                    strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
                Next

                Dim xrNotesTable As New XRTable
                Dim xrNotesRow As New XRTableRow
                Dim xrNotesCell As New XRTableCell

                If G_ReportOptions.blnIncludeNotes Then
                    ' Notes
                    If Not strFootnote1 = Nothing Then
                        If strFootnote1.Trim.Length > 0 Then
                            ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                            Dim rtb As New TextBox 'RichTextBox
                            rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            Dim xrt As New XRLabel 'XRRichText
                            xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            rtb.Width = intAvailableWidth
                            xrt.Width = intAvailableWidth
                            Using rtb
                                rtb.AppendText(strFootnote1.Trim)
                                xrt.Text = rtb.Text
                                'xrt.Rtf = rtb.Rtf
                            End Using

                            With G_ReportOptions
                                Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                                Detail.Controls.Add(xrHeaderSectionTable)
                                intNewY += (xrHeaderSectionTable.Height + 10)
                            End With

                            xrNotesTable = New XRTable
                            xrNotesTable.Width = intAvailableWidth
                            xrNotesTable.Location = New Point(intNewX, intNewY)
                            xrNotesRow = New XRTableRow
                            'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
                            Dim xrNotes2Cell As New XRTableCell
                            xrNotes2Cell.Width = xrNotesRow.Width
                            xrNotes2Cell.CanGrow = True
                            xrNotes2Cell.WordWrap = True
                            xrNotes2Cell.CanShrink = True
                            xrNotes2Cell.Multiline = True
                            xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
                            xrNotes2Cell.Controls.Add(xrt)
                            xrNotesRow.Cells.Add(xrNotes2Cell)
                            xrNotesTable.Rows.Add(xrNotesRow)

                            .Detail.Controls.Add(xrNotesTable)
                            intNewY += (xrNotesTable.Height + 20)
                        End If
                    End If

                End If

                If G_ReportOptions.blnIncludeAddNotes Then
                    ' Additional Notes
                    If Not strFootnote2 = Nothing Then
                        If strFootnote2.Trim.Length > 0 Then
                            ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                            Dim rtb As New TextBox 'RichTextBox
                            rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                            Dim xrt As New XRLabel 'XRRichText
                            xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                            rtb.Width = intAvailableWidth
                            xrt.Width = intAvailableWidth
                            Using rtb
                                rtb.AppendText(strFootnote2.Trim)
                                xrt.Text = rtb.Text
                                'xrt.Rtf = rtb.Rtf
                            End Using

                            With G_ReportOptions
                                Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                                Detail.Controls.Add(xrHeaderSectionTable)
                                intNewY += (xrHeaderSectionTable.Height + 10)
                            End With

                            xrNotesTable = New XRTable
                            xrNotesTable.Width = intAvailableWidth
                            xrNotesTable.Location = New Point(intNewX, intNewY)
                            xrNotesRow = New XRTableRow
                            'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
                            Dim xrNotes2Cell As New XRTableCell
                            xrNotes2Cell.Width = xrNotesRow.Width
                            xrNotes2Cell.Height = 500
                            xrNotes2Cell.CanShrink = False
                            xrNotes2Cell.CanGrow = False
                            xrNotes2Cell.Controls.Add(xrt)
                            xrNotesRow.Cells.Add(xrNotes2Cell)
                            xrNotesTable.Rows.Add(xrNotesRow)
                            xrNotesTable.CanShrink = True
                            .Detail.Controls.Add(xrNotesTable)
                            intNewY += (xrNotesTable.Height + 20)

                        End If
                    End If
                End If
            End If

            If G_ReportOptions.blnIncludeHACCP Then
                '  subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001")
                'subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strStoringTemp, strStoringTime, strCCPdescription, strHACCP, "001")
                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                End With
                subDisplayHACCP(strCoolingTime, strHeatingTime, strHeatingTemperature, strHeatingMode, strCCPdescription, "001", strStoringTime, strStoringTemp, strHACCP)
                intNewY += intTextHeight
                'anm noted 10
            End If

            '---JRN 17.03.2010
            'For keywords
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then

                With G_ReportOptions
                    Dim xrSectionHeaderTable As New XRTable
                    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrSectionHeaderTable)
                    intNewY += (xrSectionHeaderTable.Height + 10)
                    'xrSectionHeaderTable.Dispose()
                End With

                subDisplayKeywords(foundKeywords2, "001")
                intNewY += GetLineSpace(intTextHeight)
                'anm noted 11
            End If

            '   Kiosk
            If G_ReportOptions.blnIncludeKiosk And Not G_ReportOptions.dtKiosk Is Nothing Then
                If G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode).Count > 0 Then
                    Dim xrKioskTable As New XRTable
                    Dim xrKioskRows As New XRTableRow

                    xrKioskTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Kiosk), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += xrKioskTable.Height + 10

                    xrKioskTable = New XRTable
                    xrKioskTable.Width = intAvailableWidth
                    xrKioskTable.Location = New Point(intNewX, intNewY)

                    For Each drKioskRows As DataRow In G_ReportOptions.dtKiosk.Select("CodeListe=" & intRecipeCode)
                        'AGL 2013.08.22 - added checking for blank dates
                        If CStrDB(drKioskRows("BrandSiteDateFrom")) = "" Or CStrDB(drKioskRows("BrandSiteDateTo")) = "" Then
                            xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                        Else
                            ' RDC 08.14.2013 : Do not display date if date is equal to 01/01/1900
                            If CDate(drKioskRows("BrandSiteDateFrom")).Year = 1900 And CDate(drKioskRows("BrandSiteDateTo")).Year = 1900 Then
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            Else
                                xrKioskRows = fctMakeDataRow({drKioskRows("Name").ToString.Trim & " " & Format(CDate(drKioskRows("BrandSiteDateFrom")), "MM/dd/yyyy") & " - " & Format(CDate(drKioskRows("BrandSiteDateTo")), "MM/dd/yyyy")}, {CInt(intAvailableWidth - 100)}, {TextAlignment.MiddleLeft})
                            End If
                        End If

                    Next
                    xrKioskTable.Rows.Add(xrKioskRows)
                    .Detail.Controls.Add(xrKioskTable)

                    intNewY += (xrKioskTable.Height + 20)
                End If
            End If

            ' RDC 02.22.2013
            ' Brands 
            If G_ReportOptions.blnIncludeBrand AndAlso G_ReportOptions.dtBrands IsNot Nothing Then
                If G_ReportOptions.dtBrands.Select("RecipeCode= " & intRecipeCode).Count > 0 Then
                    Dim xrBrandTable As New XRTable
                    Dim xrBrandRow As New XRTableRow
                    Dim xrBrandCell As New XRTableCell

                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        If .blnIncludeHighlightSection Then
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.LightGray
                            xrBrandTable.BorderColor = Color.Black
                        Else
                            xrBrandTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                            xrBrandTable.BorderWidth = 1
                            xrBrandTable.BackColor = Color.White
                            xrBrandTable.BorderColor = Color.Black
                        End If

                        xrBrandRow.Height = .sgFontSize2
                        xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                        xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                        xrBrandCell.Text = cLang.GetString(clsEGSLanguage.CodeType.RecipeBrands).Trim
                        xrBrandRow.Cells.Add(xrBrandCell)
                        xrBrandTable.Rows.Add(xrBrandRow)

                    End With
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 10)

                    xrBrandTable = New XRTable
                    xrBrandTable.Width = intAvailableWidth
                    xrBrandTable.Location = New Point(intNewX, intNewY)

                    Dim cLangData As New clsLanguage(enumAppType.WebApp, G_strConnection)
                    Dim cLangFromCodeTrans As New clsEGSLanguage(cLangData.GetCodeLang(G_ReportOptions.intTranslation))
                    Dim strBrandClassification As String = ""

                    For Each drBrand As DataRow In G_ReportOptions.dtBrands.Select("RecipeCode=" & intRecipeCode)
                        With G_ReportOptions
                            xrBrandRow = New XRTableRow
                            xrBrandRow.Height = .sgFontSize2
                            xrBrandCell = New XRTableCell
                            xrBrandCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrBrandCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Regular)
                            xrBrandCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft

                            If drBrand("BrandClass").ToString.ToLower = "primary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173883)
                            ElseIf drBrand("BrandClass").ToString.ToLower = "secondary" Then
                                strBrandClassification = cLangFromCodeTrans.GetString(173884)
                            Else
                                strBrandClassification = drBrand("BrandClass").ToString
                            End If
                            xrBrandCell.Text = drBrand("Brand").ToString & " ~ " & strBrandClassification
                            xrBrandRow.Cells.Add(xrBrandCell)
                            xrBrandTable.Rows.Add(xrBrandRow)
                        End With
                    Next
                    .Detail.Controls.Add(xrBrandTable)
                    intNewY += (xrBrandTable.Height + 20)

                End If
            End If
            'Publications
            If G_ReportOptions.blnIncludePublication AndAlso G_ReportOptions.dtPublications IsNot Nothing Then
                If G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode).Count > 0 Then

                    Dim xrPublicationTable As New XRTable
                    Dim xrPublicationRow As New XRTableRow
                    Dim xrPublicationCell As New XRTableCell

                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.LightGray
                        xrPublicationTable.BorderColor = Color.Black
                    Else
                        xrPublicationTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrPublicationTable.BorderWidth = 1
                        xrPublicationTable.BackColor = Color.White
                        xrPublicationTable.BorderColor = Color.Black
                    End If

                    xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                    xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrPublicationCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Publication).Trim
                    xrPublicationRow.Cells.Add(xrPublicationCell)
                    xrPublicationTable.Rows.Add(xrPublicationRow)

                    .Detail.Controls.Add(xrPublicationTable)

                    intNewY += (xrPublicationTable.Height + 10)

                    xrPublicationTable = New XRTable
                    xrPublicationTable.Width = intAvailableWidth
                    xrPublicationTable.Location = New Point(intNewX, intNewY)

                    For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                        xrPublicationRow = New XRTableRow
                        xrPublicationRow.Height = G_ReportOptions.sgFontSize2
                        xrPublicationCell = New XRTableCell
                        xrPublicationCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPublicationCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        xrPublicationCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                        ' xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim
                        xrPublicationCell.Text = drPublication("Placement").ToString.Trim & Space(3) & fctConvertDate(CType(drPublication("PlacementDate"), Date))
                        xrPublicationRow.Cells.Add(xrPublicationCell)
                        xrPublicationTable.Rows.Add(xrPublicationRow)
                    Next

                    .Detail.Controls.Add(xrPublicationTable)
                    intNewY += (xrPublicationTable.Height + 20)

                    'For Each drPublication As DataRow In G_ReportOptions.dtPublications.Select("CodeListe=" & intRecipeCode)
                    '    intTextHeight = ReportingTextUtils.MeasureText(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(drPublication("Placement").ToString.Trim & Space(3) & drPublication("PlacementDate").ToString.Trim, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '    intNewY += intTextHeight
                    'Next
                    '' RDC 04.27.2013 - CMW-5630 Fix
                    'intNewY += 20
                End If
            End If

            ' End

            'If G_ReportOptions.blnIncludeNutrients Then
            '    subDisplayNutrients(strYieldName, dblNutrientFactor, L_Nutrient, "001", userLocale:=userLocale)
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            ' RDC 09.05.2013 : Nutrient enhancement
            Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
            Dim intSelCodeTrans As Integer = 0
            Dim intCodeSetDisplay As Integer = 0
            For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
                intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
                intSelCodeTrans = CInt(drDispSet("codeTrans"))
                intCodeSetDisplay = CInt(drDispSet("CodeSet"))
            Next

            intNewY += 20
            If G_ReportOptions.blnIncludeNutrients Then
                ' Section Header
                Dim xrNutHeader As New XRTable
                xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutrientInformation), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
                .Detail.Controls.Add(xrNutHeader)

                intNewY += (xrNutHeader.Height + 10)

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSetDisplay, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice, userLocale:=userLocale)

                intNewY += 20
            End If


            'GDA
            If G_ReportOptions.blnIncludeGDA Then

                Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                Detail.Controls.Add(xrGDAHeader)
                intNewY += (xrGDAHeader.Height) + 20

                subDisplayGDAComputation(CInt(row("Code")), intCodeSetDisplay, intSelCodeTrans, CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice")), userLocale:=userLocale)
                ' ''    subDisplayNutrientsGDA(strYieldName, _
                ' ''        dblNutrientFactor, L_Nutrient, "001")
                ' ''    intNewY += GetLineSpace(intTextHeight)
            End If

            '- Cookbook
            ' If enumPrintOptions.RecipeCosting Then
            If G_ReportOptions.blnIncludeCookbook And Not G_ReportOptions.dtCookbook Is Nothing Then
                If G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCookbookTable As New XRTable
                    Dim xrCookbookRow As New XRTableRow

                    xrCookbookTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Cookbook), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 10)

                    xrCookbookTable = New XRTable
                    xrCookbookTable.Width = intAvailableWidth
                    xrCookbookTable.Location = New Point(intNewX, intNewY)

                    For Each drCookbookRow As DataRow In G_ReportOptions.dtCookbook.Select("Recipecode=" & intRecipeCode)
                        xrCookbookRow = fctMakeDataRow({drCookbookRow("Name").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCookbookTable.Rows.Add(xrCookbookRow)
                    Next
                    .Detail.Controls.Add(xrCookbookTable)

                    intNewY += (xrCookbookTable.Height + 20)
                End If
            End If
            ' End If
            '---
            'Comments
            If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
                If G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode).Count > 0 Then
                    Dim xrCommentTable As New XRTable
                    Dim xrCommentRow As New XRTableRow

                    xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 10)

                    xrCommentTable = New XRTable
                    xrCommentTable.Width = intAvailableWidth
                    xrCommentTable.Location = New Point(intNewX, intNewY)

                    For Each drComment As DataRow In G_ReportOptions.dtComment.Select("Recipecode=" & intRecipeCode)
                        xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCommentTable.Rows.Add(xrCommentRow)
                    Next
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 20)

                End If
            End If

            'Allergens MCM 03.03.06
            '----------------------
            If G_ReportOptions.blnIncludeAllergens Then
                intNewY -= 15
                '' subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
                '  subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003", , , strConn, row("Code"))
                Dim blnManor As Boolean = False
                Dim strStyle As String = "003"
                If blnManor = False Then
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    With Me
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                        Select Case strStyle

                            Case "001", "002", "003"
                                Dim xrAllergensTable As New XRTable
                                Dim xrAllergensRow As New XRTableRow
                                Dim xrAllergensCell As New XRTableCell

                                xrAllergensTable.Width = intAvailableWidth
                                xrAllergensTable.Location = New Point(intNewX, intNewY)

                                If G_ReportOptions.blnIncludeHighlightSection Then
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.LightGray
                                    xrAllergensTable.BorderColor = Color.Black
                                Else
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.White
                                    xrAllergensTable.BorderColor = Color.Black
                                End If

                                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrAllergensCell.Text = strX.Trim
                                xrAllergensRow.Cells.Add(xrAllergensCell)
                                xrAllergensTable.Rows.Add(xrAllergensRow)

                                .Detail.Controls.Add(xrAllergensTable)

                                intNewX += (xrAllergensTable.Height + 10)

                                ' RDC 05.15.2013 - Removed.
                                'Case "002"  'Modern
                                '    intNewY += 10
                                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                                'Case "003"
                                '    intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                '  xrAllergensTable.Dispose()
                                '  xrAllergensRow.Dispose()
                                '  xrAllergensCell.Dispose()

                            Case "003Menu"
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                            Case "004" 'Merchandise Details
                                intNewY += 30

                                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                            Case Else
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End Select


                        intNewY += intTextHeight + 10
                    End With
                Else
                    intNewY += GetLineSpace(intTextHeight)
                End If
                'intNewY += GetLineSpace(intTextHeight)
                'anm noted 12
                Dim row1 As DataRow = foundDetails2(0) 'KMQDC 11.24.2015

                Dim CodeAllergenTranslation As Integer
                CodeAllergenTranslation = CType(row1("CodeTrans"), Integer)


                subDisplayAllegensTest(foundAllergens2, intNewY, intTextHeight, fntBold, fntRegular, "003", False, False, strConn2, CodeAllergenTranslation)
                intNewX = 0
                intNewY = intNewY + 30
            End If
            'End of Allergens

            ' composition
            If G_ReportOptions.blnIncludeComposition Then
                Dim xrCompositionTable As New XRTable
                Dim xrCompositionRow As New XRTableRow
                Dim xrCompositionCell As New XRTableCell

                If G_ReportOptions.blnIncludeAllergens And G_ReportOptions.intfoodLaw = 3 Then
                    intNewY += CInt(GetLineSpace(intTextHeight))
                End If

                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    If .blnIncludeHighlightSection Then
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.LightGray
                        xrCompositionTable.BorderColor = Color.Black
                    Else
                        xrCompositionTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrCompositionTable.BorderWidth = 1
                        xrCompositionTable.BackColor = Color.White
                        xrCompositionTable.BorderColor = Color.Black
                    End If

                    xrCompositionRow.Height = .sgFontSize2
                    xrCompositionCell.Font = New Font(.strFontName2, .sgFontSize2, FontStyle.Bold)
                    xrCompositionCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleJustify
                    xrCompositionCell.Text = cLang.GetString(clsEGSLanguage.CodeType.Composition).Trim
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    xrCompositionTable.Rows.Add(xrCompositionRow)

                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 10)

                xrCompositionTable = New XRTable
                xrCompositionTable.Width = intAvailableWidth
                xrCompositionTable.Location = New Point(intNewX, intNewY)

                With G_ReportOptions
                    xrCompositionRow = New XRTableRow
                    '   xrCompositionRow.Height = .sgFontSize
                    xrCompositionTable.Width = intAvailableWidth
                    xrCompositionCell = New XRTableCell

                    '--------------keen dela cruz
                    Dim str As String = row("Composition").ToString
                    str = str.Replace("<b>", "\b ")
                    str = str.Replace("</b>", "\b0")
                    str = str.Replace("<p>", "")
                    str = str.Replace("</p>", "")
                    str = str.Replace("<br>", "")
                    str = str.Replace("<i>", "\i ")
                    str = str.Replace("</i>", "\i0")
                    str = str.Replace("{", "")
                    str = str.Replace("}", "")
                    str = str.Replace("<div>", "\line \div ")
                    str = str.Replace("</div>", "\line \div0 ")
                    Dim strhtml As String = ParseHtmlToRTF(str)  'LLG 05.16.2016 for lepause issue
                    Dim ss As String = row("Composition").ToString
                    Dim XrRichText1 As New XRLabel 'XRRichText
                    XrRichText1.Width = 630
                    XrRichText1.CanGrow = True
                    XrRichText1.CanShrink = True
                    XrRichText1.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    XrRichText1.Text = ss
                    'XrRichText1.Rtf = strhtml
                    xrCompositionCell.Controls.Add(XrRichText1)
                    ' OLD (causes NullReference when the row has 0 cells):
                    ' xrCompositionRow.InsertCell(xrCompositionCell, 1)

                    ' NEW (safe): just add the cell (or InsertCell at index 0)
                    xrCompositionRow.Cells.Add(xrCompositionCell)
                    ' Or: xrCompositionRow.InsertCell(xrCompositionCell, 0, False)

                    xrCompositionTable.Rows.Add(xrCompositionRow)
                End With
                .Detail.Controls.Add(xrCompositionTable)
                intNewY += (xrCompositionTable.Height + 20)
                'Me.Detail.Controls.Add(fctMakeXRLabel(row("Composition"), fntRegular, 0, intNewY, intAvailableWidth, 100, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.None, True))
                intNewY = intNewY + 30
            End If

            Dim dblMaxWidthPicture As Double
            Dim dblMaxHeightPicture As Double
            intNewX = 0
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False

                dblMaxWidthPicture = (intAvailableWidth - 200) / 3
                dblMaxHeightPicture = dblMaxWidthPicture * 1.5
            Else
                dblMaxHeightPicture = 250
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

            End If


            'For j As Integer = 0 To 2
            '    strPicture(j) = ""
            '    strPicture(j) = fctGetPictureName(str3Pictures, j)
            'Next

            If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            Dim strFileName As String


            ''---GDA Image JRN 06.07.2010
            If G_CLIENT = "SV" And G_ReportOptions.bIncludeGDAImage Then
                Dim bShowGDAImage As Boolean = False
                For Each arr As tNutrient In G_Nutrient
                    If CDblDB(arr.GDA) > 0 Then
                        bShowGDAImage = True
                        Exit For
                    End If
                Next
                If bShowGDAImage Then
                    G_ReportOptions.blnIncludeGDA = False
                    Dim intGDAPanelHeight = 70
                    Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                    Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                    Dim intGDAPanelWidth As Integer = ((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                    .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intAvailableWidth - intGDAPanelWidth, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, G_ReportOptions.intCodeTrans)})
                End If
            End If

            'SM 20251201 update For Azure blob
            Dim coreCodeGroup As String = "0"
            If Not IsDBNull(row("CoreCodeGroup").ToString) Then coreCodeGroup = CryptoService.Get25CharString(row("CoreCodeGroup").ToString)
            If Not IsDBNull(row("Pix").ToString) Then G_strPhotoPath = G_strPhotoPath.Replace("CoreCodeGroup", coreCodeGroup)

            '---

            '--- VRP 07.11.2007
            If G_ReportOptions.blnPicturesAll = True Then
                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                    For j As Integer = 0 To UBound(arrPicture)
                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(j)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

                        End If
                        intNewX += CInt(G_dblMaxWidthPicture) + 5
                    Next
                    intNewY += CInt(G_dblMaxHeightPicture)
                    'anm noted 10
                End If
                '''intNewY += 10
                intNewX = 0
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) And arrPicture(intDPic - 1) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
                            .Detail.Controls.AddRange(New XRControl() _
                             {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += G_dblMaxWidthPicture + 20
                            'intCurY = intNewY
                        Else
                            For j As Integer = 0 To UBound(arrPicture)
                                If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                                    strFileName = G_strPhotoPath & arrPicture(j)
                                    .Detail.Controls.AddRange(New XRControl() _
                                     {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                    intNewX += G_dblMaxWidthPicture + 20
                                    'intCurY = intNewY
                                    Exit For
                                End If
                            Next
                        End If

                    End If
                End If
            End If
            '--------
        End With
        Return Me
    End Function

#End Region

#Region " Menu Reports "

    'Function fctPrintMenuCostingEGSStandard(ByVal foundDetails() As DataRow, _
    '                                        ByVal foundKeywords() As DataRow, _
    '                                        ByVal foundAllergens() As DataRow, _
    '                                        Optional ByVal strCnn As String = "", _
    '                                        Optional ByVal flagmenudetails As Integer = -1, _
    '                                        Optional ByVal dtIngredients As DataTable = Nothing) As XtraReport


    '    'Select Case flagmenudetails
    '    '    Case 2 'ADF 'VRP 02.06.2008
    '    '        Return fctPrintRecipeDetailsADF(foundDetails, dtIngredients, strCnn)
    '    'End Select

    '    fctPrintMenuCostingEGSStandard = Nothing
    '    If foundDetails.Length <= 0 Then Exit Function
    '    Dim row As DataRow = foundDetails(0)
    '    Dim flagQtyFirst As Boolean = True

    '    'If CIntDB(row("ItemType")) = 8 Then 'RECIPE
    '    '    Return fctPrintRecipeCostingEGSStandard(foundDetails, foundKeywords, foundAllergens, dtIngredients)
    '    'End If

    '    Dim intAvailableWidth As Long
    '    Dim dblMaxHeightPicture As Double
    '    Dim dblMaxWidthPicture As Double
    '    Dim intDictionary As Integer
    '    Dim intCount As Integer
    '    Dim intNewX As Integer
    '    Dim intNewY As Integer
    '    'Dim strPicture(0 To 2) As String
    '    'Dim str3Pictures As String
    '    Dim strPictureAll As String = "" 'VRP 07.11.2007
    '    Dim lngSpace As Long
    '    Dim dblYieldQty As Double
    '    Dim strYieldName As String
    '    Dim strYieldDisplay As String
    '    Dim strYieldFormat As String
    '    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '    Dim intPixCount As Integer
    '    Dim dblCoefficient As Double
    '    Dim strCurrency As String
    '    Dim dblTaxValue As Double
    '    Dim dblPercent As Double
    '    Dim dblTotal As Double
    '    Dim dblTotalSellingPrice As Double
    '    Dim dblItemSellPrice As Double
    '    Dim dblItemCoeff As Double
    '    Dim strRemark As String
    '    Dim dblUnitFactor As Double
    '    Dim strUnit As String
    '    Dim dblCurRate As Double
    '    Dim strNumber As String
    '    Dim sgType As Single
    '    Dim strItemName As String
    '    Dim strPreparation As String
    '    Dim strComplement As String
    '    Dim strNameComplement As String
    '    Dim strCoeff As String
    '    Dim strQuantityNet As String
    '    Dim dblWastage As Double
    '    Dim strUnitFormat As String
    '    Dim dblMerchandiseCost As Double
    '    Dim strQuantityBrut As String
    '    Dim dblCalcPrice As Double
    '    Dim dblAverageMenuCoeff As Double
    '    Dim dblPriceNoTax As Double
    '    Dim dblTaxTotal As Double
    '    Dim dblPriceWTax As Double
    '    Dim dblPriceTax As Double
    '    Dim dblImposedPrice As Integer
    '    Dim dblImposedSellingPriceByServing As Double
    '    Dim flagWithGDA As Boolean




    '    Try
    '        'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
    '        'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
    '        'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
    '        'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
    '        fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '        fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
    '        If G_ReportOptions.blnPictureOneRight Then
    '            fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
    '        Else
    '            fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
    '        End If

    '    Catch ex As Exception
    '        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '        Return Me
    '    End Try

    '    G_Options.RemoveTrailingZero = True
    '    G_Options.FactorType = 1

    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        'fctGetNutrientDetails()
    '        fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
    '    End If

    '    With Me

    '        'Papersize
    '        '------------
    '        .PaperKind = Printing.PaperKind.Custom
    '        .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

    '        'Margins
    '        '------------
    '        .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
    '        .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
    '        .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
    '        .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

    '        'Orientation
    '        '-----------
    '        If G_ReportOptions.blLandscape Then
    '            .Landscape = True
    '            intAvailableWidth = .PageHeight
    '        Else
    '            .Landscape = False
    '            intAvailableWidth = .PageWidth
    '        End If

    '        intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin) - 30

    '        flagWithGDA = False
    '        intCount = 0
    '        For i As Integer = 1 To 15
    '            L_Nutrient(i).Format = G_Nutrient(i).Format
    '            L_Nutrient(i).Heading = G_Nutrient(i).Heading
    '            L_Nutrient(i).Name = G_Nutrient(i).Name
    '            L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            L_Nutrient(i).GDA = G_Nutrient(i).GDA 'DLS Aug112007
    '            L_Nutrient(i).FormatKCAL = G_Nutrient(i).FormatKCAL  'DLS Aug112007
    '            L_Nutrient(i).Value = -1
    '            If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
    '            If L_Nutrient(i).GDA > 0 Then flagWithGDA = True
    '        Next

    '        'If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
    '        'If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
    '        'If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
    '        'If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
    '        'If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
    '        'If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
    '        'If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
    '        'If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
    '        'If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
    '        'If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
    '        'If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
    '        'If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
    '        'If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
    '        'If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
    '        'If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)

    '        Dim strFieldname As String = Nothing
    '        For i As Integer = 1 To 15
    '            strFieldname = "N" & i.ToString
    '            If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '        Next

    '        intDictionary = G_Language

    '        If G_ReportOptions.intTranslation > 0 Then
    '            If IsDBNull(CType(row("COdeDictionary"), Integer)) Then
    '                intDictionary = G_Language
    '            Else
    '                intDictionary = CType(row("COdeDictionary"), Integer)
    '            End If
    '        End If
    '        G_Language = intDictionary

    '        'str3Pictures = ""
    '        'For intPixCount = 0 To 4
    '        '    strPicture(intPixCount) = ""
    '        'Next

    '        'If Not IsDBNull(row("Pix")) Then str3Pictures = CType(row("Pix"), String)
    '        'If str3Pictures <> "" Then
    '        '    For intPixCount = 0 To 4
    '        '        strPicture(intPixCount) = fctGetPictureName(str3Pictures, intPixCount)
    '        '    Next
    '        'End If

    '        '--- VRP 07.11.2007
    '        If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
    '        Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
    '        '------

    '        intNewX = 0
    '        intNewY = G_ReportOptions.dblTopMargin

    '        sf = New StringFormat(StringFormatFlags.NoClip)

    '        '-----------------------------------------------------------------------------
    '        'Calculation
    '        '-----------------------------------------------------------------------------
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)     'Calculation 
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        intNewY += intTextHeight

    '        '-----------------------------------------------------------------------------
    '        'Menu Name
    '        '-----------------------------------------------------------------------------
    '        strX = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
    '        intNewY += intTextHeight
    '        '-----------------------------------------------------------------------------


    '        intNewX = 0
    '        intNewY = 0

    '        intTextHeight = ReportingTextUtils.MeasureText("Menu", fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        intNewY += GetLineSpace(intTextHeight)

    '        'If dblYield = -1 Then
    '        dblYieldQty = CType(row("Yield"), Double)
    '        'Else
    '        'dblYieldQty = dblYield
    '        'End If

    '        strYieldName = fctGetTranslatedText(row, "YieldName", "YieldNameTrans", G_ReportOptions.intTranslation)
    '        strYieldFormat = row("DetailsYieldFormat").ToString

    '        '-- VRP 21.01.2009
    '        Dim dblYieldQtyOrig As Double = CType(row("YieldOriginalFactor"), Double)
    '        Dim strYieldUnitNameOrig As String = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 
    '        Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)
    '        Dim intYieldUnitOriginal As Integer = CType(row("YieldUnitOriginalCode"), Integer)
    '        '---

    '        If G_Options.QtyType = 0 Then
    '            'strYieldDisplay = fctFormatNumericQuantity(dblYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
    '            If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                strYieldDisplay = fctFormatNumericQuantity(dblYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
    '                strYieldDisplay &= "/" & fctFormatNumericQuantity(dblYieldQtyOrig, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
    '            Else
    '                If (dblYieldQty <> dblYieldQtyOrig) Or (strYieldName <> strYieldUnitNameOrig) Then 'VRP 15.01.2009
    '                    strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & Trim(UCase(strYieldName))
    '                    strYieldDisplay &= "/" & fctConvertToFraction(dblYieldQtyOrig) & " " & strYieldUnitNameOrig
    '                Else
    '                    strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & Trim(UCase(strYieldName))
    '                End If
    '            End If
    '        Else
    '            strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & strYieldName
    '        End If
    '        '==========================================================================================
    '        '------------------------------------------------------------------------------------------
    '        'Menu#          :
    '        'Category       :
    '        'Source         :
    '        'Date           :
    '        'Cost of Goods  :
    '        'Remark         :
    '        'For            :
    '        '------------------------------------------------------------------------------------------
    '        'Get Widest Width
    '        lngSpace = 0
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)                     'Menu #
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                    'Category
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Source)                      'Source
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)                       'Date
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)                 'Cost of goods
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                      'Remark
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)
    '        lngSpace = lngSpace * 1.5

    '        L_lngCol(0) = intAvailableWidth - lngSpace - INTCOLUMNSPACE - intNewX
    '        '------------------------------------------------------------------------------------------

    '        If G_ReportOptions.blnIncludeNumber Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)                 'Menu #
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctSqlReady(row("Number").ToString)
    '            strX = Replace(strX, Chr(1), "")
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeCategory Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                'Category
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeSource Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Source)                  'Source
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "Chef", "ChefTrans", G_ReportOptions.intTranslation)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strYieldDisplay, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeDate Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)                   'Date
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctConvertDate(row("Dates") & "")
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeCostOfGoods Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)             'Cost of Goods
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " ", fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


    '            strX = Trim(fctNullToString(row("Currency"))) & " " & Format(fctNullToZero(row("calcprice")), G_strPriceFormat) & " /" & strYieldName
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeRemark Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                  'Remarks
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "Remark", "RemarkTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.For_)                        'For
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strYieldDisplay, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        intNewY += (intTextHeight * 2)
    '        '==========================================================================================
    '        '------------------------------------------------------------------------------------
    '        'Number     Items               Quantity        Cost of Goods   Profit  Selling Price
    '        '                                                         PHP                     PHP
    '        '------------------------------------------------------------------------------------
    '        sf = New StringFormat(StringFormatFlags.DirectionVertical)
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Quantity)                    'Quantity
    '        L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)                 'Cost of Goods
    '        L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

    '        Select Case G_Options.FactorType
    '            Case 0 : strX = cLang.GetString(clsEGSLanguage.CodeType.Const)          'Const.
    '            Case 1 : strX = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"  'Profit
    '            Case 2 : strX = cLang.GetString(clsEGSLanguage.CodeType.FC) & " %"      'FC
    '        End Select
    '        L_lngCol(3) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price)               'Selling Price
    '        L_lngCol(4) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Number)                      'Number
    '        L_lngCol(5) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE


    '        dblCoefficient = CType(fctNullToZero(row("menucoeff")), Double)
    '        strCurrency = CType(fctNullToString(row("Currency")), String)
    '        dblTaxValue = CType(fctNullToZero(row("TaxValue")), Double)
    '        dblPercent = 1
    '        dblTotal = 0
    '        dblTotalSellingPrice = 0

    '        For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
    '            dblItemSellPrice = 0
    '            dblItemCoeff = 0
    '            strRemark = ""
    '            dblUnitFactor = 0
    '            strUnit = ""
    '            dblCurRate = 0
    '            strNumber = ""

    '            If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(CType(foundDetails(rowIng)("ItemNumber"), String))
    '            If Not IsDBNull(foundDetails(rowIng)("ItemType")) Then sgType = CType(foundDetails(rowIng)("ItemType"), Single)
    '            strItemName = fctGetTranslatedText(foundDetails(rowIng), "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)  'Trim(rsX!ItemName)
    '            strPreparation = ""
    '            strPreparation = fctGetTranslatedText(foundDetails(rowIng), "Preparation", "PreparationTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Preparation)
    '            strComplement = ""
    '            strComplement = fctGetTranslatedText(foundDetails(rowIng), "Complement", "ComplementTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Complement)

    '            If Not IsDBNull(foundDetails(rowIng)("Rate")) Then dblCurRate = CType(foundDetails(rowIng)("Rate"), Double)
    '            If Not IsDBNull(foundDetails(rowIng)("Itemcoeff")) Then dblItemCoeff = CType(foundDetails(rowIng)("Itemcoeff"), Double)

    '            If strComplement <> "" Then
    '                strNameComplement = strItemName & " '" & strComplement & "'"
    '            Else
    '                strNameComplement = strItemName
    '            End If

    '            Select Case G_Options.FactorType
    '                Case 0 : strCoeff = Format(dblItemCoeff, G_FormatTwoDecimal)
    '                Case 1 : strCoeff = Format(fctConvertCoeff(dblItemCoeff, 1), G_FormatOneDecimal)
    '                Case 2 : strCoeff = Format(fctConvertCoeff(dblItemCoeff, 2), G_FormatOneDecimal)
    '            End Select

    '            strQuantityNet = "0"
    '            'strQuantityNet = CType(foundDetails(rowIng)("ItemQty"), Double) * dblPercent * dblYieldQty MCM 15.02.06
    '            If Not IsDBNull(foundDetails(rowIng)("ItemQty")) Then strQuantityNet = CType(foundDetails(rowIng)("ItemQty"), Double) * dblPercent

    '            If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
    '                dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
    '            Else
    '                dblWastage = 100
    '            End If

    '            If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)

    '            If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)

    '            If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)

    '            dblWastage = (100 - dblWastage)
    '            dblWastage = dblWastage

    '            If dblWastage = 0 Then
    '                dblWastage = 0
    '            Else
    '                dblWastage = Format(dblWastage, G_FormatWhole)
    '            End If
    '            If IsDBNull(foundDetails(rowIng)("Format")) Then
    '                strUnitFormat = G_FormatOneDecimal
    '            Else
    '                strUnitFormat = CType(foundDetails(rowIng)("Format"), String)
    '            End If

    '            If CType(foundDetails(rowIng)("DetailsIsYieldUnit"), Boolean) Then
    '                dblUnitFactor = 1
    '                If Not IsDBNull(foundDetails(rowIng)("itemcalcprice")) Then dblMerchandiseCost = foundDetails(rowIng)("itemcalcprice") * dblCurRate * dblUnitFactor
    '                strUnit = fctGetTranslatedText(foundDetails(rowIng), "DetailsYieldName", "DetailsYieldNameTrans", G_ReportOptions.intTranslation) 'rsX!DetailsYieldName
    '                If Not IsDBNull(foundDetails(rowIng)("DetailsYieldFormat")) Then strUnitFormat = CType(foundDetails(rowIng)("DetailsYieldFormat"), String)
    '            Else
    '                If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double) 'factor between two units
    '                If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblMerchandiseCost = CType(foundDetails(rowIng)("ItemPrice"), Double) * dblCurRate * dblUnitFactor
    '                strUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation) 'rsX!ItemUnit
    '                'If G_Options.ConvertToBestUnit Then
    '                '    subConvertToBestQuantity(trX, rsX!UnitTypeMain, rsX!UnitFactor * trX.QuantityNet, intTranslation, rsX!Metric)
    '                '    trX.MerchandiseCost = 0
    '                '    If Not IsNull(rsX!ItemPrice) Then trX.MerchandiseCost = rsX!ItemPrice * CurRate * trX.UnitFactor
    '                'End If
    '            End If

    '            strQuantityBrut = strQuantityNet / (1 - (dblWastage / 100))
    '            dblMerchandiseCost *= strQuantityBrut
    '            dblCalcPrice = Format(dblMerchandiseCost, G_strPriceFormat)
    '            dblItemSellPrice = dblMerchandiseCost * dblItemCoeff

    '            dblTotal += dblMerchandiseCost
    '            dblTotalSellingPrice += dblItemSellPrice

    '            If sgType = ID_Recipe Or sgType = ID_Merchandise Then
    '                If G_Options.QtyType = 0 Then
    '                    strQuantityNet = fctFormatNumericQuantity(strQuantityNet, strUnitFormat, G_Options.RemoveTrailingZero)
    '                    strQuantityBrut = fctFormatNumericQuantity(strQuantityBrut, strUnitFormat, G_Options.RemoveTrailingZero)
    '                Else
    '                    strQuantityNet = fctConvertToFraction(strQuantityNet)
    '                    strQuantityBrut = fctConvertToFraction(strQuantityBrut)
    '                End If
    '            Else
    '                strQuantityBrut = ""
    '                strQuantityNet = ""
    '            End If

    '            strX = strQuantityBrut & " " & strUnit
    '            If .MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(1) Then
    '                L_lngCol(1) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            End If

    '            strX = Format(dblTotal, G_strPriceFormat)
    '            If .MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(2) Then
    '                L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            End If

    '            strX = strCoeff
    '            If .MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(3) Then
    '                L_lngCol(3) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            End If

    '            strX = Format(dblTotalSellingPrice, G_strPriceFormat)
    '            If .MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(4) Then
    '                L_lngCol(4) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            End If

    '            strX = ""
    '            If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strX = fctNumber2Text(foundDetails(rowIng)("ItemNumber"))
    '            If .MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE > L_lngCol(5) Then
    '                L_lngCol(5) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE
    '            End If
    '        Next

    '        L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(1))
    '        L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
    '        L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))
    '        L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(4))

    '        .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '        intNewY += 10

    '        If G_ReportOptions.blnIncludeIngrNumber Then
    '            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(5))
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewX += L_lngCol(5)
    '        End If

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Items)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '        intNewX += L_lngNameW

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Quantity)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(1), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX += L_lngCol(1)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) & " " & vbCrLf & strCurrency
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, True, , True)})
    '        intNewX += L_lngCol(2)

    '        Select Case G_Options.FactorType
    '            Case 0 : strCoeff = cLang.GetString(clsEGSLanguage.CodeType.Const)
    '            Case 1 : strCoeff = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"
    '            Case 2 : strCoeff = cLang.GetString(clsEGSLanguage.CodeType.FC) & " %"
    '        End Select

    '        strX = strCoeff
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX += L_lngCol(3)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " " & vbCrLf & strCurrency
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, True, , True)})
    '        intNewX += L_lngCol(4)

    '        '            intNewY += (intTextHeight * 2)
    '        intNewY += intTextHeight

    '        intNewX = 0
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '        intNewY += 10

    '        'End of Column header

    '        'Details
    '        dblTaxValue = CType(row("TaxValue"), Double)
    '        dblTotal = 0
    '        dblTotalSellingPrice = 0

    '        For rowIng As Integer = 0 To foundDetails.GetUpperBound(0)
    '            dblItemSellPrice = 0
    '            dblItemCoeff = 0
    '            strRemark = ""
    '            dblUnitFactor = 0
    '            strUnit = ""
    '            dblCurRate = 0
    '            strNumber = ""

    '            If Not IsDBNull(foundDetails(rowIng)("ItemNumber")) Then strNumber = fctNumber2Text(CType(foundDetails(rowIng)("ItemNumber"), String))
    '            If Not IsDBNull(foundDetails(rowIng)("ItemType")) Then sgType = CType(foundDetails(rowIng)("ItemType"), Single)
    '            strItemName = fctGetTranslatedText(foundDetails(rowIng), "ItemName", "ItemNameTrans", G_ReportOptions.intTranslation)  'Trim(rsX!ItemName)
    '            strPreparation = ""
    '            strPreparation = fctGetTranslatedText(foundDetails(rowIng), "Preparation", "PreparationTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Preparation)
    '            strComplement = ""
    '            strComplement = fctGetTranslatedText(foundDetails(rowIng), "Complement", "ComplementTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Complement)

    '            If Not IsDBNull(foundDetails(rowIng)("Rate")) Then dblCurRate = CType(foundDetails(rowIng)("Rate"), Double)
    '            If Not IsDBNull(foundDetails(rowIng)("Itemcoeff")) Then dblItemCoeff = CType(foundDetails(rowIng)("Itemcoeff"), Double)

    '            If strComplement <> "" Then
    '                strNameComplement = strItemName & " '" & strComplement & "'"
    '            Else
    '                strNameComplement = strItemName
    '            End If

    '            Select Case G_Options.FactorType
    '                Case 0 : strCoeff = Format(dblItemCoeff, G_FormatTwoDecimal)
    '                Case 1 : strCoeff = Format(fctConvertCoeff(dblItemCoeff, 1), G_FormatOneDecimal)
    '                Case 2 : strCoeff = Format(fctConvertCoeff(dblItemCoeff, 2), G_FormatOneDecimal)
    '            End Select

    '            'strQuantityNet = CType(foundDetails(rowIng)("ItemQty"), Double) * dblPercent * dblYieldQty
    '            strQuantityNet = "0"
    '            If Not IsDBNull(foundDetails(rowIng)("ItemQty")) Then strQuantityNet = CType(foundDetails(rowIng)("ItemQty"), Double) * dblPercent

    '            If Not IsDBNull(foundDetails(rowIng)("wastage1")) Then
    '                dblWastage = 100 - (100 * CType(foundDetails(rowIng)("wastage1"), Double) / 100)
    '            Else
    '                dblWastage = 100
    '            End If
    '            If Not IsDBNull(foundDetails(rowIng)("wastage2")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage2"), Double) / 100)
    '            If Not IsDBNull(foundDetails(rowIng)("wastage3")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage3"), Double) / 100)
    '            If Not IsDBNull(foundDetails(rowIng)("wastage4")) Then dblWastage = dblWastage - (dblWastage * CType(foundDetails(rowIng)("wastage4"), Double) / 100)
    '            dblWastage = (100 - dblWastage)
    '            dblWastage = dblWastage

    '            If dblWastage = 0 Then
    '                dblWastage = 0
    '            Else
    '                dblWastage = Format(dblWastage, G_FormatWhole)
    '            End If
    '            If IsDBNull(foundDetails(rowIng)("Format")) Then
    '                strUnitFormat = G_FormatOneDecimal
    '            Else
    '                strUnitFormat = CType(foundDetails(rowIng)("Format"), String)
    '            End If

    '            If CType(foundDetails(rowIng)("DetailsIsYieldUnit"), Boolean) Then
    '                dblUnitFactor = 1
    '                If Not IsDBNull(foundDetails(rowIng)("itemcalcprice")) Then dblMerchandiseCost = foundDetails(rowIng)("itemcalcprice") * dblCurRate * dblUnitFactor
    '                strUnit = fctGetTranslatedText(foundDetails(rowIng), "DetailsYieldName", "DetailsYieldNameTrans", G_ReportOptions.intTranslation) 'rsX!DetailsYieldName
    '                If Not IsDBNull(foundDetails(rowIng)("DetailsYieldFormat")) Then strUnitFormat = CType(foundDetails(rowIng)("DetailsYieldFormat"), String)
    '            Else
    '                If Not IsDBNull(foundDetails(rowIng)("UnitFactor")) Then dblUnitFactor = CType(foundDetails(rowIng)("UnitFactor"), Double) 'factor between two units
    '                If Not IsDBNull(foundDetails(rowIng)("ItemPrice")) Then dblMerchandiseCost = CType(foundDetails(rowIng)("ItemPrice"), Double) * dblCurRate * dblUnitFactor
    '                strUnit = fctGetTranslatedText(foundDetails(rowIng), "ItemUnit", "ItemUnitTrans", G_ReportOptions.intTranslation) 'rsX!ItemUnit
    '                'If G_Options.ConvertToBestUnit Then
    '                '    subConvertToBestQuantity(trX, rsX!UnitTypeMain, rsX!UnitFactor * trX.QuantityNet, intTranslation, rsX!Metric)
    '                '    trX.MerchandiseCost = 0
    '                '    If Not IsNull(rsX!ItemPrice) Then trX.MerchandiseCost = rsX!ItemPrice * CurRate * trX.UnitFactor
    '                'End If
    '            End If

    '            strQuantityBrut = strQuantityNet / (1 - (dblWastage / 100))
    '            dblMerchandiseCost *= strQuantityBrut
    '            dblCalcPrice = Format(dblMerchandiseCost, G_strPriceFormat)
    '            dblItemSellPrice = dblMerchandiseCost * dblItemCoeff

    '            dblTotal += dblMerchandiseCost
    '            dblTotalSellingPrice += dblItemSellPrice

    '            If sgType = ID_Recipe Or sgType = ID_Merchandise Then
    '                If G_Options.QtyType = 0 Then
    '                    strQuantityNet = fctFormatNumericQuantity(strQuantityNet, strUnitFormat, G_Options.RemoveTrailingZero)
    '                    strQuantityBrut = fctFormatNumericQuantity(strQuantityBrut, strUnitFormat, G_Options.RemoveTrailingZero)
    '                Else
    '                    strQuantityNet = fctConvertToFraction(strQuantityNet)
    '                    strQuantityBrut = fctConvertToFraction(strQuantityBrut)
    '                End If
    '            Else
    '                strQuantityBrut = ""
    '                strQuantityNet = ""
    '            End If

    '            intNewX = 0

    '            If G_ReportOptions.blnIncludeIngrNumber Then
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNumber, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                intNewX += L_lngCol(5)
    '            End If

    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNameComplement, fntRegular, intNewX, intNewY, L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewX += L_lngNameW

    '            strX = strQuantityBrut & " " & strUnit
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(1), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewX += L_lngCol(1)

    '            If dblCalcPrice > 0 Then
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(dblCalcPrice, fntRegular, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            End If
    '            intNewX += L_lngCol(2)

    '            If strCoeff <> "0" Then
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strCoeff, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            End If
    '            intNewX += L_lngCol(3)

    '            If sgType = ID_Recipe Or sgType = ID_Merchandise Then
    '                strX = Format(dblItemSellPrice, G_strPriceFormat)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            End If

    '            intNewY += GetLineSpace(intTextHeight)
    '        Next

    '        'Total
    '        intNewX = 0

    '        intNewX = L_lngCol(5) + L_lngNameW
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Total)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(1), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX += L_lngCol(1)


    '        strX = Format(dblTotal, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, , DevExpress.XtraPrinting.BorderSide.Top)})
    '        intNewX += L_lngCol(2) + L_lngCol(3)

    '        strX = Format(dblTotalSellingPrice, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, , DevExpress.XtraPrinting.BorderSide.Top)})

    '        intNewY += GetLineSpace(intTextHeight)

    '        intNewX = 0

    '        intNewX = L_lngCol(5)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(1) + L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX += L_lngCol(1) + L_lngNameW

    '        strX = Format(dblTotal / dblYieldQty, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX += L_lngCol(2) + L_lngCol(3)

    '        strX = Format(dblTotalSellingPrice / dblYieldQty, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewY += (GetLineSpace(intTextHeight) * 2)


    '        dblAverageMenuCoeff = dblTotalSellingPrice / dblTotal
    '        dblMerchandiseCost = dblTotal / dblYieldQty
    '        dblPriceNoTax = dblTotalSellingPrice / dblYieldQty
    '        dblTaxTotal = dblPriceNoTax * (dblTaxValue / 100)
    '        dblPriceWTax = dblPriceNoTax + dblTaxTotal

    '        If dblMerchandiseCost = 0 Then
    '            dblCoefficient = 0
    '        Else
    '            dblCoefficient = dblAverageMenuCoeff
    '        End If

    '        intNewX = 0

    '        If dblTaxValue <> 0 Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Tax) & " % " & Format(dblTaxValue, G_FormatOneDecimal) & "%"     '"Tax % " & " " & Format(dblTaxValue, G_FormatOneDecimal) & "%" 'FTB(10363) 
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewX += L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '            strX = Format(dblTaxTotal, G_strPriceFormat)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += GetLineSpace(intTextHeight)

    '            intNewX = 0

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.SellingPricebyServing) & " + " & cLang.GetString(clsEGSLanguage.CodeType.Tax)  ' "Selling Price by serving + Tax"           
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewX += L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '            strX = Format(dblPriceWTax, G_strPriceFormat)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += (GetLineSpace(intTextHeight) * 2)
    '        End If


    '        intNewX = 0
    '        intNewX = L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2)

    '        Select Case G_Options.FactorType
    '            Case 0
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Const)   '"Const."
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(dblCoefficient, G_FormatTwoDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            Case 1
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"   '"Profit %"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            Case 2
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.FC) & " %"   '"FC %"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        End Select

    '        intNewY += (GetLineSpace(intTextHeight) * 2)

    '        dblImposedPrice = CType(row("ImposedPrice"), Double)

    '        dblPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
    '        dblImposedSellingPriceByServing = dblImposedPrice - dblPriceTax
    '        dblCoefficient = dblImposedSellingPriceByServing / dblMerchandiseCost


    '        intNewX = 0

    '        If dblTaxValue <> 0 Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Tax) & "% " & Format(dblTaxValue, G_FormatOneDecimal) & "%"      '"Tax %" & " " & Format(dblTaxValue, G_FormatOneDecimal) & "%" 'FTB(10363) 
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewX += L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '            strX = Format(dblPriceTax, G_strPriceFormat)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += GetLineSpace(intTextHeight)

    '            intNewX = 0

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPricebyServingPlusTax)  '"Imposed selling price by serving + Tax"       
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewX += L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '            strX = Format(dblImposedPrice, G_strPriceFormat)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            intNewY += (GetLineSpace(intTextHeight) * 2)
    '        End If

    '        intNewX = 0

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) '"Imposed selling price" 
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX = L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '        strX = Format(dblImposedSellingPriceByServing * dblYieldQty, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewY += GetLineSpace(intTextHeight)

    '        intNewX = 0

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPricebyServing) '"Imposed selling price by serving"
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewX = L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2) + L_lngCol(3)

    '        strX = Format(dblImposedSellingPriceByServing, G_strPriceFormat)
    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        intNewY += (GetLineSpace(intTextHeight) * 2)


    '        intNewX = 0
    '        intNewX = L_lngCol(5) + L_lngNameW + L_lngCol(1) + L_lngCol(2)

    '        Select Case G_Options.FactorType
    '            Case 0
    '                strX = Trim(cLang.GetString(clsEGSLanguage.CodeType.Const)) '"Const."
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(dblCoefficient, G_FormatTwoDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            Case 1
    '                strX = Trim(cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %")     '"Profit %"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '            Case 2
    '                strX = Trim(cLang.GetString(clsEGSLanguage.CodeType.FC) & " %")         '"FC %"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '                intNewX += L_lngCol(3)

    '                strX = Format(fctConvertCoeff(dblCoefficient, 2), G_FormatOneDecimal)
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
    '        End Select

    '        intNewY += (GetLineSpace(intTextHeight) * 2)

    '        intNewX = 0

    '        '----------------------------------------------------------------------------
    '        'Note
    '        '----------------------------------------------------------------------------
    '        'Dim intNoteHeight As Integer
    '        'sf = New StringFormat(StringFormatFlags.NoClip)
    '        'strX = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Note)
    '        'intNoteHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        'If strX <> "" Then
    '        '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intAvailableWidth, intNoteHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, , True)})
    '        '    intNewY += intNoteHeight + GetLineSpace(intTextHeight)
    '        'End If

    '        ''If Not strCnn = "" Then 'VRP 23.06.2008
    '        ''    Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
    '        ''    Dim dt As DataTable = cListe.fctGetProcedureTemplateD(G_ReportOptions.intTranslation, row("TemplateCode"))
    '        ''    If Not dt Is Nothing Then
    '        ''        Dim sNote() As String = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation).ToString.Split(CChar("¤"))
    '        ''        Dim i As Integer = 0
    '        ''        strX += ""
    '        ''        For Each rw As DataRow In dt.Rows
    '        ''            If Not sNote(i).Trim = "" Then
    '        ''                strX = rw("Name")
    '        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        ''                intNewY += GetLineSpace(intTextHeight)

    '        ''                strX = sNote(i)
    '        ''                intTextHeight = ReportingTextUtils.MeasureText(sNote(i), fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        ''                intNewY += GetLineSpace(intTextHeight)
    '        ''                intNewY += GetLineSpace(intTextHeight)
    '        ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        ''            End If
    '        ''            i += 1
    '        ''        Next
    '        ''    Else
    '        ''        strX = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation)
    '        ''        strX = Trim(Replace(strX, vbCrLf & "#", vbCrLf))
    '        ''        strX = Trim(Replace(strX, Chr(1), vbCrLf))

    '        ''        If Mid(strX, 1, 1) = "#" Then strX = Mid(strX, 2)

    '        ''        If Not IsNothing(strX) Then intNewY += 10
    '        ''        SplitNote(strX, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopLeft)
    '        ''    End If '----
    '        ''End If

    '        '--- VRP 26.06.2008
    '        Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))
    '        Dim sNote As String = row("Note")
    '        Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)

    '        If nCodeTemplate = 0 Then
    '            sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
    '            sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
    '            If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

    '            If Not IsNothing(sNote) Then intNewY += 10
    '            SplitNote(sNote, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
    '        Else
    '            Dim sNotes() As String = sNote.Split(CChar("¤"))
    '            Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

    '            For i As Integer = 0 To UBound(sNotesHeader)
    '                If Not sNotes(i) = "" Then
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    intNewY += intTextHeight

    '                    sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
    '                    sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
    '                    If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

    '                    If IsNothing(sNotes(i)) Then intNewY += 10
    '                    SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
    '                    intNewY += GetLineSpace(intTextHeight)
    '                End If
    '            Next
    '        End If '--------

    '        '----------------------------------------------------------------------------

    '        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '            dblNutrientFactor = GetNutrientFactor(CInt(row("Code")))
    '        End If

    '        'Nutrients
    '        If G_ReportOptions.blnIncludeNutrients Then
    '            Dim strNutrient As String
    '            Dim strPerServings As String
    '            Dim intFirstRow As Integer
    '            Dim intTotalValue As Integer

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Nutrients) 'Nutrients
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            sf = New StringFormat(StringFormatFlags.DirectionVertical)
    '            G_intMaxRecipeDetailsWidth = 0
    '            For i As Integer = 1 To intCount
    '                If Trim(L_Nutrient(i).Name) <> "" Then
    '                    If i = 1 Then
    '                        strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                        strNutrient = L_Nutrient(i).Name & " kcal"
    '                    Else
    '                        strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                    End If
    '                    'Get Widest 
    '                    G_intMaxRecipeDetailsWidth = fctGetWidest(strNutrient, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
    '                End If
    '                intTotalValue += L_Nutrient(i).Value
    '            Next

    '            If intTotalValue > 0 Then
    '                Dim strNA As String = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"  
    '                Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

    '                intNewY += 20
    '                intNewX += G_intMaxRecipeDetailsWidth
    '                strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName)  'per %Y at 100%
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                intNewX += intRemainingColumn
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)  '"per 100g or 100ml at 100%"
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


    '                dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
    '                For i As Integer = 1 To intCount   '12
    '                    If Trim(L_Nutrient(i).Name) <> "" Then
    '                        intNewY += intTextHeight
    '                        intNewX = 0
    '                        If i = 1 Then
    '                            intFirstRow = intNewY
    '                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                            intNewY += intTextHeight
    '                            strNutrient = L_Nutrient(i).Name & " kcal"
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                        Else
    '                            'intNewY += intTextHeight
    '                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                        End If

    '                        If L_Nutrient(i).Value <> -1 Then
    '                            If i = 1 Then
    '                                'per servings at 100%
    '                                intNewY = intFirstRow
    '                                strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                                strPerServings = Format(L_Nutrient(i).Value / ENERGYFACTOR, L_Nutrient(i).FormatKCAL)
    '                                intNewY += GetLineSpace(intTextHeight)
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                                'per 100g or 100ml at 100%
    '                                intNewY = intFirstRow
    '                                If dblNutrientFactor > 0 Then
    '                                    strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                                    strNA = Format(L_Nutrient(i).Value / ENERGYFACTOR / dblNutrientFactor, L_Nutrient(i).FormatKCAL)
    '                                    intNewY += GetLineSpace(intTextHeight)
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                                Else
    '                                    intNewY = intFirstRow
    '                                    strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                                    intNewY += GetLineSpace(intTextHeight)
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                                End If
    '                            Else
    '                                strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                                If dblNutrientFactor > 0 Then
    '                                    strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
    '                                Else
    '                                    strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)
    '                                End If
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                            End If  'i=1

    '                        End If
    '                    End If

    '                Next
    '            End If
    '        End If

    '        'GDA 'DLS Aug112007
    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeGDA Then
    '            intNewY += 30
    '            Dim strNutrient As String
    '            Dim strPerServings As String
    '            Dim intTotalValue As Integer
    '            Dim dblValue As Double

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts) 'Guideline Daily Amounts
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            sf = New StringFormat(StringFormatFlags.DirectionVertical)
    '            G_intMaxRecipeDetailsWidth = 0
    '            For i As Integer = 1 To intCount
    '                If Trim(L_Nutrient(i).GDA) > 0 Then
    '                    strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                    'Get Widest 
    '                    G_intMaxRecipeDetailsWidth = fctGetWidest(strNutrient, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
    '                End If
    '                intTotalValue += L_Nutrient(i).Value
    '            Next

    '            If intTotalValue > 0 Then
    '                Dim strNA As String = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"  
    '                Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

    '                intNewY += 20
    '                intNewX += G_intMaxRecipeDetailsWidth
    '                strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName)  'per %Y at 100%
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                intNewX += intRemainingColumn

    '                If dblNutrientFactor > 0 Then
    '                    strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)  '"per 100g or 100ml at 100%"
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                End If



    '                dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
    '                For i As Integer = 1 To intCount   '12
    '                    If Trim(L_Nutrient(i).GDA) > 0 Then
    '                        intNewY += intTextHeight
    '                        intNewX = 0

    '                        'intNewY += intTextHeight
    '                        strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


    '                        If L_Nutrient(i).Value <> -1 Then

    '                            dblValue = (L_Nutrient(i).Value / L_Nutrient(i).GDA) * 100
    '                            If dblValue < 1 And dblValue <> 0 Then
    '                                strPerServings = "< 1%"
    '                            Else
    '                                strPerServings = FormatNumber(dblValue, 0) & "%"
    '                            End If
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '                            If dblNutrientFactor > 0 Then
    '                                dblValue = ((L_Nutrient(i).Value / dblNutrientFactor) / L_Nutrient(i).GDA) * 100
    '                                If dblValue < 1 And dblValue <> 0 Then
    '                                    strNA = "< 1%"
    '                                Else
    '                                    strNA = FormatNumber(dblValue, 0) & "%"
    '                                End If
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                            End If

    '                        End If
    '                    End If

    '                Next
    '            End If
    '        End If



    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeKeyword Then
    '            intNewY += 30

    '            strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Keywords))    'Keywords
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            Dim strKeyword As String
    '            Dim intPrevious As Integer
    '            intPrevious = -1

    '            For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)

    '                intNewY += GetLineSpace(intTextHeight)
    '                strKeyword = CType(foundKeywords(rowK)("Name"), String)

    '                If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
    '                    If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
    '                        If CType(foundKeywords(rowK)("derived"), Boolean) Then
    '                            fntFont = fntItalic
    '                        Else
    '                            fntFont = fntRegular
    '                        End If
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                    End If
    '                Else
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                End If

    '            Next
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If


    '        'Allergens MCM 03.03.06
    '        '----------------------
    '        If G_ReportOptions.blnIncludeAllergens Then
    '            subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
    '        End If
    '        'End of Allergens



    '        'Pictures
    '        intNewX = 0
    '        If G_ReportOptions.blnPicturesAll = True Then
    '            G_ReportOptions.blnWithPicture = False
    '            'dblMaxWidthPicture = (intAvailableWidth - 200) / 3.5
    '            'dblMaxHeightPicture = dblMaxWidthPicture * 1.5
    '            dblMaxHeightPicture = 250
    '            If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '        Else
    '            dblMaxHeightPicture = 250
    '            If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '        End If

    '        'str3Pictures = ""
    '        'If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

    '        'For intPixCount = 0 To 2
    '        '    strPicture(intPixCount) = ""
    '        '    strPicture(intPixCount) = fctGetPictureName(str3Pictures, intPixCount)
    '        'Next

    '        If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
    '            dblMaxHeightPicture = 350
    '            dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '        End If


    '        Dim strFileName As String = Nothing
    '        'If G_ReportOptions.blnPicturesAll = True Then

    '        '    If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '        '        For intPixCount = 0 To 2
    '        '            If UrlFileExists(G_strPhotoPath & strPicture(intPixCount)) And strPicture(intPixCount) <> "" Then
    '        '                strFileName = G_strPhotoPath & strPicture(intPixCount)
    '        '                .Detail.Controls.AddRange(New XRControl() _
    '        '                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '        '                intNewX += CInt(G_dblMaxWidthPicture) + 5
    '        '            End If
    '        '        Next
    '        '        If strFileName <> "" Then
    '        '            intNewY += CInt(G_dblMaxHeightPicture) + 10
    '        '            intNewX = 0
    '        '        End If
    '        '    End If
    '        'Else
    '        '    If G_ReportOptions.blnWithPicture = True Then
    '        '        If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '        '            For intPixCount = 0 To 2
    '        '                If UrlFileExists(G_strPhotoPath & strPicture(intPixCount)) And strPicture(intPixCount) <> "" Then
    '        '                    strFileName = G_strPhotoPath & strPicture(intPixCount)
    '        '                    .Detail.Controls.AddRange(New XRControl() _
    '        '                        {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '        '                    intNewX += G_dblMaxWidthPicture + 20
    '        '                    Exit For
    '        '                End If
    '        '            Next
    '        '        End If
    '        '    End If
    '        'End If

    '        '--- VRP 07.11.2007
    '        If G_ReportOptions.blnPicturesAll = True Then

    '            If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                For intPixCount = 0 To UBound(arrPicture)
    '                    If UrlFileExists(G_strPhotoPath & arrPicture(intPixCount)) And arrPicture(intPixCount) <> "" Then
    '                        strFileName = G_strPhotoPath & arrPicture(intPixCount)
    '                        .Detail.Controls.AddRange(New XRControl() _
    '                            {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                        intNewX += CInt(G_dblMaxWidthPicture) + 5
    '                    End If
    '                Next
    '                If strFileName <> "" Then
    '                    intNewY += CInt(G_dblMaxHeightPicture) + 10
    '                    intNewX = 0
    '                End If
    '            End If
    '        Else
    '            If G_ReportOptions.blnWithPicture = True Then
    '                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                    For intPixCount = 0 To UBound(arrPicture)
    '                        If UrlFileExists(G_strPhotoPath & arrPicture(intPixCount)) And arrPicture(intPixCount) <> "" Then
    '                            strFileName = G_strPhotoPath & arrPicture(intPixCount)
    '                            .Detail.Controls.AddRange(New XRControl() _
    '                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                            intNewX += G_dblMaxWidthPicture + 20
    '                            Exit For
    '                        End If
    '                    Next
    '                End If
    '            End If
    '        End If
    '        '------



    '    End With
    'End Function

    Function fctPrintMenuCostingEGSStandard(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow, ByVal foundAllergens() As DataRow,
                                            Optional ByVal strCnn As String = "", Optional ByVal flagmenudetails As Integer = -1,
                                            Optional ByVal dtIngredients As DataTable = Nothing) As XtraReport


        fctPrintMenuCostingEGSStandard = Nothing
        If foundDetails.Length <= 0 Then Exit Function
        Dim row As DataRow = foundDetails(0)
        Dim flagQtyFirst As Boolean = True
        Dim intDictionary As Integer
        G_Options.RemoveTrailingZero = True
        'G_Options.FactorType = 1

        If CIntDB(row("Type")) = 8 Then 'RECIPE
            Return fctPrintRecipeCostingEGSStandard2(row, foundKeywords, foundAllergens, dtIngredients)
            Exit Function
        End If


        '============= PAGE PROPERTIES =====================
        'Font
        Try
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            End If
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        With Me
            'Paper
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            'Margin
            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            'Orientation
            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If
            intAvailableWidth = intAvailableWidth - .Margins.Left - .Margins.Right

            'Language
            intDictionary = G_Language
            If G_ReportOptions.intTranslation > 0 Then
                If IsDBNull(CType(row("COdeDictionary"), Integer)) Then
                    intDictionary = G_Language
                Else
                    intDictionary = CType(row("COdeDictionary"), Integer)
                End If
            End If
            G_Language = intDictionary

        End With
        '============= PAGE PROPERTIES =====================

        '============= PAGE HEADER =====================
        intNewX = 0
        intNewY = Margins.Top

        With Me
            'Calculation
            strX = cLang.GetString(clsEGSLanguage.CodeType.Calculation)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += intTextHeight

            'Menu Name
            strX = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
            intNewY += intTextHeight
        End With
        '============= PAGE HEADER =====================


        '============= PAGE DETAIL =====================
        intNewX = 0
        intNewY = 10

        With Me

            Dim dblYieldQty As Double = CType(row("Yield"), Double)
            Dim strYieldName As String = fctGetTranslatedText(row, "YieldName", "YieldNameTrans", G_ReportOptions.intTranslation)
            Dim strYieldFormat As String = row("DetailsYieldFormat").ToString
            Dim dblYieldQtyOrig As Double = CType(row("YieldOriginalFactor"), Double)
            Dim strYieldUnitNameOrig As String = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 
            Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)
            Dim intYieldUnitOriginal As Integer = CType(row("YieldUnitOriginalCode"), Integer)
            Dim strYieldDisplay As String

            If G_Options.QtyType = 0 Then
                If (dblYieldQty <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strYieldDisplay = fctFormatNumericQuantity(dblYieldQty, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldName
                    strYieldDisplay &= "/" & fctFormatNumericQuantity(dblYieldQtyOrig, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
                Else
                    If (dblYieldQty <> dblYieldQtyOrig) Or (strYieldName <> strYieldUnitNameOrig) Then 'VRP 15.01.2009
                        'If G_ReportOptions.blnUseFractions Then
                        '    strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & Trim(UCase(strYieldName))
                        '    strYieldDisplay &= "/" & fctConvertToFraction(dblYieldQtyOrig) & " " & strYieldUnitNameOrig
                        'Else
                        '    strYieldDisplay = dblYieldQty & " " & Trim(UCase(strYieldName))
                        '    strYieldDisplay &= "/" & dblYieldQtyOrig & " " & strYieldUnitNameOrig
                        'End If
                        strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & Trim(UCase(strYieldName))
                        strYieldDisplay &= "/" & fctConvertToFraction(dblYieldQtyOrig) & " " & strYieldUnitNameOrig
                    Else
                        If G_ReportOptions.blnUseFractions Then
                            strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & Trim(UCase(strYieldName))
                        Else
                            strYieldDisplay = dblYieldQty & " " & Trim(UCase(strYieldName))
                        End If
                    End If
                End If
            Else
                If G_ReportOptions.blnUseFractions Then
                    strYieldDisplay = fctConvertToFraction(dblYieldQty) & " " & strYieldName
                Else
                    strYieldDisplay = dblYieldQty & " " & strYieldName
                End If
            End If

            'Measure Width
            Dim lngSpace As Integer = 0

            'Menu #
            strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth

            'Category
            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth

            'Source
            strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth

            'Date
            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth

            'Cost of goods
            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth

            'Remark
            strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            If lngSpace < intTextWidth Then lngSpace = intTextWidth
            lngSpace = lngSpace * 1.5

            L_lngCol(0) = intAvailableWidth - lngSpace - INTCOLUMNSPACE - intNewX


            'Print Menu Details
            Dim intDetailHeight As Integer = 0
            'Menu #
            If G_ReportOptions.blnIncludeNumber Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                strX = fctSqlReady(row("Number").ToString)
                strX = Replace(strX, Chr(1), "")
                strX = ": " & strX
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'Category
            If G_ReportOptions.blnIncludeCategory Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'Source
            If G_ReportOptions.blnIncludeSource Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                strX = fctGetTranslatedText(row, "Chef", "ChefTrans", G_ReportOptions.intTranslation)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'Date
            If G_ReportOptions.blnIncludeDate Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                strX = fctConvertDate(row("Dates") & "")
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'Cost of Goods
            If G_ReportOptions.blnIncludeCostOfGoods Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " ", fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


                strX = Trim(fctNullToString(row("Currency"))) & " " & Format(fctNullToZero(row("calcprice")), G_strPriceFormat) & " /" & strYieldName
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'Remarks
            If G_ReportOptions.blnIncludeRemark Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                strX = fctGetTranslatedText(row, "Remark", "RemarkTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
                If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewY += GetLineSpace(intDetailHeight)
            End If

            'For
            strX = cLang.GetString(clsEGSLanguage.CodeType.For_)
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngSpace, sf, Padding).Height
            If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

            strX = ": " & strYieldDisplay
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(0), sf, Padding).Height
            If intDetailHeight < intTextHeight Then intDetailHeight = intTextHeight
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewY += (intDetailHeight * 2)



            '---- Menu Item ----
            Dim strCurrency As String = CType(fctNullToString(row("Currency")), String)
            'Measure Width
            'Number 
            strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
            L_lngCol(0) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            'Quantity
            strX = cLang.GetString(clsEGSLanguage.CodeType.Quantity)
            L_lngCol(2) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            'Cost of goods
            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
            L_lngCol(3) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            'Profit
            strX = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"
            L_lngCol(4) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            'Selling Price
            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price)
            L_lngCol(5) = ReportingTextUtils.MeasureText(strX, fntBold, intTextHeight, sf, Me.Padding).Height + INTCOLUMNSPACE

            Dim strItemNumber As String
            Dim strItemName As String
            Dim dblItemCoeff As Double
            Dim dblQuantityNet As Double
            Dim itemType As Integer
            Dim dblCOG As Double
            Dim dblSellingPrice As Double

            Dim intCodeMain As Integer = CIntDB(row("Code"))
            For Each rowIng As DataRow In dtIngredients.Rows()
                If intCodeMain = rowIng("CodeMain") Then
                    itemType = CIntDB(rowIng("ItemType"))

                    'Number
                    strItemNumber = CStrDB(rowIng("ItemNumber"))
                    intTextWidth = ReportingTextUtils.MeasureText(strItemNumber, fntRegular, 0, sf, Padding).Width
                    If L_lngCol(0) < intTextWidth Then L_lngCol(0) = intTextWidth

                    'Quantity
                    If itemType = 0 Then
                        dblQuantityNet = CDblDB(IIf(rowIng("tmpQty") = "", 0, rowIng("tmpQty")))
                    Else
                        dblQuantityNet = CType(rowIng("ItemQty"), Double)
                    End If
                    If Not G_Options.QtyType = 0 Then
                        'If G_ReportOptions.blnUseFractions Then
                        '    dblQuantityNet = fctConvertToFraction(dblQuantityNet)
                        'Else
                        '    dblQuantityNet = dblQuantityNet
                        'End If
                        dblQuantityNet = fctConvertToFraction(dblQuantityNet)
                    End If
                    strX = Format(dblQuantityNet, "#,##0.00")
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    If L_lngCol(2) < intTextWidth Then L_lngCol(2) = intTextWidth

                    'Cost Of goods
                    If Not IsDBNull(rowIng("ItemCost")) Then dblCOG = CType(rowIng("ItemCost"), Double) Else dblCOG = 0
                    strX = Format(dblCOG, G_strPriceFormat)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    If L_lngCol(3) < intTextWidth Then L_lngCol(3) = intTextWidth

                    'Profit
                    If Not IsDBNull(rowIng("coefficient")) Then dblItemCoeff = CType(rowIng("coefficient"), Double)
                    strX = Format(dblItemCoeff, G_strPriceFormat)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    If L_lngCol(4) < intTextWidth Then L_lngCol(4) = intTextWidth

                    'Selling Price
                    If Not IsDBNull(rowIng("itemSellingPrice")) Then dblSellingPrice = CType(rowIng("itemSellingPrice"), Double)
                    strX = Format(dblSellingPrice, G_strPriceFormat)
                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    If L_lngCol(5) < intTextWidth Then L_lngCol(5) = intTextWidth

                End If
            Next

            L_lngNameW = Math.Abs(intAvailableWidth - L_lngCol(0))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(2))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(3))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(4))
            L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(5))

            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            intNewY += 10

            'Number
            If G_ReportOptions.blnIncludeIngrNumber Then
                L_lngNameW = Math.Abs(L_lngNameW - L_lngCol(0))
                strX = cLang.GetString(clsEGSLanguage.CodeType.Number)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                intNewX += L_lngCol(0)
            End If

            'Item Name
            strX = cLang.GetString(clsEGSLanguage.CodeType.Items)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
            intNewX += L_lngNameW

            'Quantity
            strX = cLang.GetString(clsEGSLanguage.CodeType.Quantity)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(2)

            'COst of goods
            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods) & " " & vbCrLf & strCurrency
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, True, , True)})
            intNewX += L_lngCol(3)

            'Profit
            strX = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(4)

            'Selling Price
            strX = cLang.GetString(clsEGSLanguage.CodeType.Selling_Price) & " " & vbCrLf & strCurrency
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, True, , True)})
            intNewX += L_lngCol(5)


            intTextHeight = ReportingTextUtils.MeasureText(" ", fntBold, L_lngCol(5), sf, Padding).Height
            intNewY += (intTextHeight * 2)

            intNewX = 0
            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
            intNewY += 10

            Dim intItemHeight As Integer = 0
            Dim dblTotal As Double = 0
            Dim dblTotalSellingPrice As Double = 0
            For Each rowIng As DataRow In dtIngredients.Rows()
                If intCodeMain = rowIng("CodeMain") Then
                    itemType = CIntDB(rowIng("ItemType"))
                    intItemHeight = 0

                    'Number
                    If G_ReportOptions.blnIncludeIngrNumber Then
                        strItemNumber = CStrDB(rowIng("ItemNumber"))
                        intTextHeight = ReportingTextUtils.MeasureText(strItemNumber, fntRegular, L_lngCol(0), sf, Padding).Height
                        If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strItemNumber, fntRegular, intNewX, intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += L_lngCol(0)
                    End If

                    'Item Name
                    If itemType = 0 Then
                        strItemName = CStrDB(rowIng("tmpName"))
                    Else
                        strItemName = CStrDB(rowIng("ItemName"))
                    End If
                    Dim sComplement As String = fctGetTranslatedText(rowIng, "Complement", "ComplementTrans", G_ReportOptions.intTranslation)
                    If sComplement <> "" Then
                        strItemName = strItemName & " '" & sComplement & "'"
                    Else
                        strItemName = strItemName
                    End If
                    intTextHeight = ReportingTextUtils.MeasureText(strItemName, fntRegular, L_lngNameW, sf, Padding).Height
                    If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strItemName, fntRegular, intNewX, intNewY, L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    intNewX += L_lngNameW

                    'Quantity
                    If itemType = 0 Then
                        dblQuantityNet = CDblDB(IIf(rowIng("tmpQty") = "", 0, rowIng("tmpQty")))
                    Else
                        dblQuantityNet = CType(rowIng("ItemQty"), Double)
                    End If
                    dblTotal += dblQuantityNet
                    If Not G_Options.QtyType = 0 Then
                        'If G_ReportOptions.blnUseFractions Then
                        '    dblQuantityNet = fctConvertToFraction(dblQuantityNet)
                        'Else
                        '    dblQuantityNet = dblQuantityNet
                        'End If
                        dblQuantityNet = fctConvertToFraction(dblQuantityNet)
                    End If

                    strX = Format(dblQuantityNet, "#,##0.00")
                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(2), sf, Padding).Height
                    If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(dblQuantityNet, fntRegular, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewX += L_lngCol(2)

                    'Cost Of goods
                    If Not IsDBNull(rowIng("ItemCost")) Then dblCOG = CType(rowIng("ItemCost"), Double) Else dblCOG = 0
                    strX = Format(dblCOG, G_strPriceFormat)
                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(3), sf, Padding).Height
                    If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewX += L_lngCol(3)

                    'Profit
                    If Not IsDBNull(rowIng("coefficient")) Then dblItemCoeff = CType(rowIng("coefficient"), Double)
                    strX = Format(dblItemCoeff, G_strPriceFormat)
                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(4), sf, Padding).Height
                    If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewX += L_lngCol(4)

                    'Selling Price
                    If Not IsDBNull(rowIng("itemSellingPrice")) Then dblSellingPrice = CType(rowIng("itemSellingPrice"), Double)
                    dblTotalSellingPrice += dblSellingPrice
                    strX = Format(dblSellingPrice, G_strPriceFormat)
                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, L_lngCol(5), sf, Padding).Height
                    If intItemHeight < intTextHeight Then intItemHeight = intTextHeight
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                    intNewX += L_lngCol(5)

                    intNewX = 0
                    intNewY += GetLineSpace(intItemHeight)
                End If
            Next

            'Total
            intNewX = L_lngCol(0) + L_lngNameW
            strX = cLang.GetString(clsEGSLanguage.CodeType.Total)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(2), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(2)


            strX = Format(dblTotal, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, , DevExpress.XtraPrinting.BorderSide.Top)})
            intNewX += L_lngCol(3) + L_lngCol(4)

            strX = Format(dblTotalSellingPrice, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight, , DevExpress.XtraPrinting.BorderSide.Top)})

            intNewY += GetLineSpace(intTextHeight)
            intNewX = 0
            intNewX = L_lngCol(0)

            strX = cLang.GetString(clsEGSLanguage.CodeType.per_serving)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(2) + L_lngNameW, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(2) + L_lngNameW

            strX = Format(dblTotal / dblYieldQty, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(3), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(3) + L_lngCol(4)

            strX = Format(dblTotalSellingPrice / dblYieldQty, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += (GetLineSpace(intTextHeight) * 2)


            Dim dblAverageMenuCoeff As Double = dblTotalSellingPrice / dblTotal
            Dim dblMerchandiseCost As Double = dblTotal / dblYieldQty
            Dim dblPriceNoTax As Double = dblTotalSellingPrice / dblYieldQty
            Dim dblTaxValue As Double = CDblDB(row("TaxValue")) 'AGL 2013.04.09 - changed to cdbldb
            Dim dblTaxTotal As Double = dblPriceNoTax * (dblTaxValue / 100)
            Dim dblPriceWTax As Double = dblPriceNoTax + dblTaxTotal
            Dim dblCoefficient As Double

            If dblMerchandiseCost = 0 Then dblCoefficient = 0 Else dblCoefficient = dblAverageMenuCoeff

            intNewX = 0
            'Tax % 
            If dblTaxValue <> 0 Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Tax) & " % " & Format(dblTaxValue, G_FormatOneDecimal) & "%"
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

                strX = Format(dblTaxTotal, G_strPriceFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)

                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.SellingPricebyServing) & " + " & cLang.GetString(clsEGSLanguage.CodeType.Tax)  ' "Selling Price by serving + Tax"           
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

                strX = Format(dblPriceWTax, G_strPriceFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += (GetLineSpace(intTextHeight) * 2)
            End If


            intNewX = 0
            intNewX = L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3)

            'Profit
            strX = cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %"
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(4)

            strX = Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})

            intNewY += (GetLineSpace(intTextHeight) * 2)

            Dim dblImposedPrice As Double = CDblDB(row("ImposedPrice")) 'AGL 2013.04.09 - changed to cdbldb
            Dim dblPriceTax As Double = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
            Dim dblImposedSellingPriceByServing As Double = dblImposedPrice - dblPriceTax
            dblCoefficient = dblImposedSellingPriceByServing / dblMerchandiseCost

            intNewX = 0
            If dblTaxValue <> 0 Then
                strX = cLang.GetString(clsEGSLanguage.CodeType.Tax) & "% " & Format(dblTaxValue, G_FormatOneDecimal) & "%"
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

                strX = Format(dblPriceTax, G_strPriceFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += GetLineSpace(intTextHeight)

                intNewX = 0
                strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPricebyServingPlusTax)  '"Imposed selling price by serving + Tax"       
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewX += L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

                strX = Format(dblImposedPrice, G_strPriceFormat)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
                intNewY += (GetLineSpace(intTextHeight) * 2)
            End If

            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPrice) '"Imposed selling price" 
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX = L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

            strX = Format(dblImposedSellingPriceByServing * dblYieldQty, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += GetLineSpace(intTextHeight)

            intNewX = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.ImposedSellingPricebyServing) '"Imposed selling price by serving"
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX = L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3) + L_lngCol(4)

            strX = Format(dblImposedSellingPriceByServing, G_strPriceFormat)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += (GetLineSpace(intTextHeight) * 2)

            intNewX = 0
            intNewX = L_lngCol(0) + L_lngNameW + L_lngCol(2) + L_lngCol(3)

            'Profit
            strX = Trim(cLang.GetString(clsEGSLanguage.CodeType.Profit) & " %")
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(4), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewX += L_lngCol(4)

            strX = Format(fctConvertCoeff(dblCoefficient, 1), G_FormatOneDecimal)
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, L_lngCol(5), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})
            intNewY += (GetLineSpace(intTextHeight) * 2)

            '---- Note ----
            intNewX = 0
            Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))
            Dim sNote As String = row("Note").ToString
            Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)

            If nCodeTemplate = 0 Then
                sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
                sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
                If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

                If Not IsNothing(sNote) Then intNewY += 10
                SplitNote(sNote, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
            Else
                Dim sNotes() As String = sNote.Split(CChar("¤"))
                Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

                For i As Integer = 0 To UBound(sNotesHeader)
                    If Not sNotes(i) = "" Then
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        intNewY += intTextHeight

                        sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
                        sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
                        If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

                        If IsNothing(sNotes(i)) Then intNewY += 10
                        SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
                        intNewY += GetLineSpace(intTextHeight)
                    End If
                Next
            End If



            '---- Nutrients ----
            If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
                Dim intCount As Integer
                Dim flagWithGDA As Boolean

                fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row), 0, strCnn) 'VRP 08.01.2009
                For i As Integer = 1 To 34 '15
                    L_Nutrient(i).Format = G_Nutrient(i).Format
                    L_Nutrient(i).Heading = G_Nutrient(i).Heading
                    L_Nutrient(i).Name = G_Nutrient(i).Name
                    L_Nutrient(i).Unit = G_Nutrient(i).Unit
                    L_Nutrient(i).GDA = G_Nutrient(i).GDA 'DLS Aug112007
                    L_Nutrient(i).FormatKCAL = G_Nutrient(i).FormatKCAL  'DLS Aug112007
                    L_Nutrient(i).Value = -1
                    L_Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
                    If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
                    If L_Nutrient(i).GDA > 0 Then flagWithGDA = True
                Next

                Dim strFieldname As String = Nothing
                Dim strFieldnameForPercent As String = Nothing
                For i As Integer = 1 To 34 ' 15
                    strFieldname = "N" & i.ToString
                    'If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
                    strFieldnameForPercent = "N" & i.ToString & "ImposePercent"
                    If Not IsDBNull(row(strFieldname)) And
                       Not IsDBNull(row(strFieldnameForPercent)) Then
                        If row(strFieldname) = 0 Or row(strFieldname) = -1 Then
                            L_Nutrient(i).Value = CType(row(strFieldnameForPercent), Double)
                            G_Nutrient(i).Unit = "%"
                            L_Nutrient(i).Unit = G_Nutrient(i).Unit
                        Else
                            L_Nutrient(i).Value = CType(row(strFieldname), Double)
                            L_Nutrient(i).Unit = G_Nutrient(i).Unit
                        End If
                    End If
                Next
                dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)

                If G_ReportOptions.blnIncludeNutrients Then
                    Dim strNutrient As String
                    Dim strPerServings As String
                    Dim intFirstRow As Integer
                    Dim intTotalValue As Integer

                    strX = cLang.GetString(clsEGSLanguage.CodeType.Nutrients) 'Nutrients
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                    sf = New StringFormat(StringFormatFlags.DirectionVertical)
                    G_intMaxRecipeDetailsWidth = 0
                    For i As Integer = 1 To intCount
                        If Trim(L_Nutrient(i).Name) <> "" Then
                            If i = 1 Then
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                strNutrient = L_Nutrient(i).Name & " kcal"
                            Else
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                            End If
                            'Get Widest 
                            G_intMaxRecipeDetailsWidth = fctGetWidest(strNutrient, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
                        End If
                        intTotalValue += L_Nutrient(i).Value
                    Next

                    If intTotalValue > 0 Then
                        Dim strNA As String = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"  
                        Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

                        intNewY += 20
                        intNewX += G_intMaxRecipeDetailsWidth
                        strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName)  'per %Y at 100%
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += intRemainingColumn
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)  '"per 100g or 100ml at 100%"
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


                        dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
                        For i As Integer = 1 To intCount   '12
                            If Trim(L_Nutrient(i).Name) <> "" Then
                                intNewY += intTextHeight
                                intNewX = 0
                                If i = 1 Then
                                    intFirstRow = intNewY
                                    strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    intNewY += intTextHeight
                                    strNutrient = L_Nutrient(i).Name & " kcal"
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                Else
                                    'intNewY += intTextHeight
                                    strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                End If

                                If L_Nutrient(i).Value <> -1 Then
                                    If i = 1 Then
                                        'per servings at 100%
                                        intNewY = intFirstRow
                                        strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        strPerServings = Format(L_Nutrient(i).Value / ENERGYFACTOR, L_Nutrient(i).FormatKCAL)
                                        intNewY += GetLineSpace(intTextHeight)
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        'per 100g or 100ml at 100%
                                        intNewY = intFirstRow
                                        If dblNutrientFactor > 0 Then
                                            strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                            strNA = Format(L_Nutrient(i).Value / ENERGYFACTOR / dblNutrientFactor, L_Nutrient(i).FormatKCAL)
                                            intNewY += GetLineSpace(intTextHeight)
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                        Else
                                            intNewY = intFirstRow
                                            strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                            intNewY += GetLineSpace(intTextHeight)
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                        End If
                                    Else
                                        strPerServings = Format(L_Nutrient(i).Value, L_Nutrient(i).Format)
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                        If dblNutrientFactor > 0 Then
                                            strNA = Format(L_Nutrient(i).Value / dblNutrientFactor, L_Nutrient(i).Format)
                                        Else
                                            strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)
                                        End If
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    End If  'i=1
                                End If
                            End If
                        Next
                    End If
                End If

                'GDA 'DLS Aug112007
                intNewX = 0
                If G_ReportOptions.blnIncludeGDA Then
                    intNewY += 30
                    Dim strNutrient As String
                    Dim strPerServings As String
                    Dim intTotalValue As Integer
                    Dim dblValue As Double

                    strX = cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts) 'Guideline Daily Amounts
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                    sf = New StringFormat(StringFormatFlags.DirectionVertical)
                    G_intMaxRecipeDetailsWidth = 0
                    For i As Integer = 1 To intCount
                        If Trim(L_Nutrient(i).GDA) > 0 Then
                            strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                            'Get Widest 
                            G_intMaxRecipeDetailsWidth = fctGetWidest(strNutrient, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)
                        End If
                        intTotalValue += L_Nutrient(i).Value
                    Next

                    If intTotalValue > 0 Then
                        Dim strNA As String = cLang.GetString(clsEGSLanguage.CodeType.NA)  '"N/A"  
                        Dim intRemainingColumn As Integer = (intAvailableWidth - G_intMaxRecipeDetailsWidth) / 2

                        intNewY += 20
                        intNewX += G_intMaxRecipeDetailsWidth
                        strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldName)  'per %Y at 100%
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        intNewX += intRemainingColumn

                        If dblNutrientFactor > 0 Then
                            strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)  '"per 100g or 100ml at 100%"
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        End If



                        dblNutrientFactor = fctGetMenuNutrientFactor(False, CType(row("SrWeight"), Double))
                        For i As Integer = 1 To intCount   '12
                            If Trim(L_Nutrient(i).GDA) > 0 Then
                                intNewY += intTextHeight
                                intNewX = 0

                                'intNewY += intTextHeight
                                strNutrient = L_Nutrient(i).Name & " " & L_Nutrient(i).Unit
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrient, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})


                                If L_Nutrient(i).Value <> -1 Then

                                    dblValue = (L_Nutrient(i).Value / L_Nutrient(i).GDA) * 100
                                    If dblValue < 1 And dblValue <> 0 Then
                                        strPerServings = "< 1%"
                                    Else
                                        strPerServings = FormatNumber(dblValue, 0) & "%"
                                    End If
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerServings, fntRegular, intNewX + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                                    If dblNutrientFactor > 0 Then
                                        dblValue = ((L_Nutrient(i).Value / dblNutrientFactor) / L_Nutrient(i).GDA) * 100
                                        If dblValue < 1 And dblValue <> 0 Then
                                            strNA = "< 1%"
                                        Else
                                            strNA = FormatNumber(dblValue, 0) & "%"
                                        End If
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNA, fntRegular, intNewX + intRemainingColumn + G_intMaxRecipeDetailsWidth, intNewY, intRemainingColumn, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                                    End If

                                End If
                            End If

                        Next
                    End If
                End If
            End If

            '---- Keyword ----
            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then
                intNewY += 30

                strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Keywords))    'Keywords
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

                Dim strKeyword As String
                Dim intPrevious As Integer
                intPrevious = -1

                For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)
                    intNewY += GetLineSpace(intTextHeight)
                    strKeyword = CType(foundKeywords(rowK)("Name"), String)

                    If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
                        If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
                            If CType(foundKeywords(rowK)("derived"), Boolean) Then
                                fntFont = fntItalic
                            Else
                                fntFont = fntRegular
                            End If
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                        End If
                    Else
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                    End If

                Next
                intNewY += GetLineSpace(intTextHeight)
            End If

            '---- Allergens ---- MCM 03.03.06
            If G_ReportOptions.blnIncludeAllergens Then
                subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, "003")
            End If

            '---- Pictures ----
            Dim dblMaxHeightPicture As Double
            Dim dblMaxWidthPicture As Double
            Dim strPictureAll As String
            'AGL 2012.10.03 - CWM-1324 - added checking for non-existent column (DefaultPicture)
            'Dim intDPic As Integer = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
            Dim intDPic As Integer
            If row.Table.Columns.Contains("DefaultPicture") Then
                intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
            Else
                intDPic = 1
            End If

            If Not IsDBNull(row("Pix")) Then strPictureAll = CType(row("Pix"), String)
            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))

            intNewX = 0
            If G_ReportOptions.blnPicturesAll = True Then
                G_ReportOptions.blnWithPicture = False
                dblMaxHeightPicture = 250
                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            Else
                dblMaxHeightPicture = 250
                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
                dblMaxHeightPicture = 350
                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
            End If

            Dim strFileName As String = Nothing
            If G_ReportOptions.blnPicturesAll = True Then
                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then

                    For intPixCount As Integer = 0 To UBound(arrPicture)
                        If UrlFileExists(G_strPhotoPath & arrPicture(intPixCount)) And arrPicture(intPixCount) <> "" Then
                            strFileName = G_strPhotoPath & arrPicture(intPixCount)
                            .Detail.Controls.AddRange(New XRControl() {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += CInt(G_dblMaxWidthPicture) + 5
                        End If
                    Next
                    If strFileName <> "" Then
                        intNewY += CInt(G_dblMaxHeightPicture) + 10
                        intNewX = 0
                    End If
                End If
            Else
                If G_ReportOptions.blnWithPicture = True Then
                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
                        If UrlFileExists(G_strPhotoPath & arrPicture(intDPic - 1)) Then
                            strFileName = G_strPhotoPath & arrPicture(intDPic - 1)
                            .Detail.Controls.AddRange(New XRControl() {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                            intNewX += CInt(G_dblMaxWidthPicture) + 5
                        Else
                            For intPixCount As Integer = 0 To UBound(arrPicture)
                                If UrlFileExists(G_strPhotoPath & arrPicture(intPixCount)) And arrPicture(intPixCount) <> "" Then
                                    strFileName = G_strPhotoPath & arrPicture(intPixCount)
                                    .Detail.Controls.AddRange(New XRControl() {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
                                    intNewX += G_dblMaxWidthPicture + 20
                                    Exit For
                                End If
                            Next
                        End If
                    End If
                End If
            End If
            '------
        End With
        '============= PAGE DETAIL =====================


    End Function

    '-----------------------------------------------------------------------
    'Report for Menu - Standard,Modern, Two Columns & Layout Style
    'MCM 10.01.05 
    '-----------------------------------------------------------------------
    'Function fctPrintMenuDetailEgs(ByVal foundDetails() As DataRow, _
    '                               ByVal foundKeywords() As DataRow, _
    '                               ByVal foundAllergens() As DataRow, _
    '                               ByVal strStyle As String, _
    '                               Optional ByVal flagSubRecipeAsterisk As Boolean = False, _
    '                               Optional ByVal flagSubRecipeNormalFont As Boolean = False, _
    '                               Optional ByVal strCnn As String = "", _
    '                               Optional ByVal flagmenudetails As Integer = -1, Optional ByVal dtIngredients As DataTable = Nothing) As XtraReport


    '    'Select Case flagmenudetails
    '    '    Case 2 'ADF 'VRP 02.06.2008
    '    '        Return fctPrintRecipeDetailsADF(foundDetails, dtIngredients, strCnn, strStyle)
    '    'End Select

    '    Dim dblMaxHeightPicture As Double
    '    Dim dblMaxWidthPicture As Double
    '    Dim KiloCode As Long
    '    Dim LiterCode As Long
    '    Dim intDictionary As Integer
    '    Dim intCount As Integer
    '    Dim lngSpace As Long
    '    Dim blflagPixOK As Boolean
    '    Dim flagQtyFirst As Boolean


    '    Dim strMenuName As String = Nothing
    '    Dim dblPortionValue As Double
    '    'Dim strPicture(0 To 2) As String
    '    'Dim str3Pictures As String
    '    Dim strPictureAll As String = "" 'VRP 07.11.2007
    '    Dim strNA As String
    '    Dim intNewXIngredient As Integer = 0 'DLS 05/25/2007


    '    fctPrintMenuDetailEgs = Nothing

    '    If foundDetails.Length <= 0 Then
    '        Exit Function
    '    End If

    '    flagQtyFirst = True

    '    Try
    '        'fntRegular = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Regular)
    '        'fntBold = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Bold)
    '        'fntItalic = New Font(G_ReportOptions.strFontName, G_ReportOptions.sgFontSize, FontStyle.Italic)
    '        'fntReportTitle = New Font(G_ReportOptions.strFontName, 16, FontStyle.Bold)
    '        fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
    '        fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
    '        fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
    '        If G_ReportOptions.blnPictureOneRight Then
    '            fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
    '        Else
    '            fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold) 'VRP 07.11.2007
    '        End If
    '    Catch ex As Exception
    '        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '        Return Me
    '    End Try

    '    G_Options.RemoveTrailingZero = True

    '    Dim row As DataRow = foundDetails(0)
    '    If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '        'fctGetNutrientDetails()
    '        fctGetNutrientDetails(CType(row("CodeTrans"), Integer), CodeSiteCO(row)) 'VRP 08.01.2009
    '    End If

    '    With Me
    '        'Papersize
    '        '------------
    '        .PaperKind = Printing.PaperKind.Custom
    '        .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

    '        'Margins
    '        '------------
    '        .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
    '        .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
    '        .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
    '        .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

    '        'Orientation
    '        '-----------
    '        If G_ReportOptions.blLandscape Then
    '            .Landscape = True
    '            intAvailableWidth = .PageHeight
    '        Else
    '            .Landscape = False
    '            intAvailableWidth = .PageWidth
    '        End If

    '        intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin)

    '        KiloCode = fctGetUnitCodeFromType(100)
    '        LiterCode = fctGetUnitCodeFromType(200)

    '        intCount = 0
    '        For i As Integer = 1 To 15
    '            L_Nutrient(i).Format = G_Nutrient(i).Format
    '            L_Nutrient(i).Heading = G_Nutrient(i).Heading
    '            L_Nutrient(i).Name = G_Nutrient(i).Name
    '            L_Nutrient(i).Unit = G_Nutrient(i).Unit
    '            L_Nutrient(i).Value = -1
    '            If Trim(L_Nutrient(i).Name) <> "" Then intCount = intCount + 1
    '        Next

    '        'If Not IsDBNull(row("N1")) Then L_Nutrient(1).Value = CType(row("N1"), Double)
    '        'If Not IsDBNull(row("N2")) Then L_Nutrient(2).Value = CType(row("N2"), Double)
    '        'If Not IsDBNull(row("N3")) Then L_Nutrient(3).Value = CType(row("N3"), Double)
    '        'If Not IsDBNull(row("N4")) Then L_Nutrient(4).Value = CType(row("N4"), Double)
    '        'If Not IsDBNull(row("N5")) Then L_Nutrient(5).Value = CType(row("N5"), Double)
    '        'If Not IsDBNull(row("N6")) Then L_Nutrient(6).Value = CType(row("N6"), Double)
    '        'If Not IsDBNull(row("N7")) Then L_Nutrient(7).Value = CType(row("N7"), Double)
    '        'If Not IsDBNull(row("N8")) Then L_Nutrient(8).Value = CType(row("N8"), Double)
    '        'If Not IsDBNull(row("N9")) Then L_Nutrient(9).Value = CType(row("N9"), Double)
    '        'If Not IsDBNull(row("N10")) Then L_Nutrient(10).Value = CType(row("N10"), Double)
    '        'If Not IsDBNull(row("N11")) Then L_Nutrient(11).Value = CType(row("N11"), Double)
    '        'If Not IsDBNull(row("N12")) Then L_Nutrient(12).Value = CType(row("N12"), Double)
    '        'If Not IsDBNull(row("N13")) Then L_Nutrient(13).Value = CType(row("N13"), Double)
    '        'If Not IsDBNull(row("N14")) Then L_Nutrient(14).Value = CType(row("N14"), Double)
    '        'If Not IsDBNull(row("N15")) Then L_Nutrient(15).Value = CType(row("N15"), Double)


    '        Dim strFieldname As String = Nothing
    '        For i As Integer = 1 To 15
    '            strFieldname = "N" & i.ToString
    '            If Not IsDBNull(row(strFieldname)) Then L_Nutrient(i).Value = CType(row(strFieldname), Double)
    '        Next

    '        intDictionary = G_Language

    '        If G_ReportOptions.intTranslation > 0 Then
    '            If IsDBNull(CType(row("COdeDictionary"), Integer)) Then
    '                intDictionary = G_Language
    '            Else
    '                intDictionary = CType(row("COdeDictionary"), Integer)
    '            End If
    '        End If
    '        G_Language = intDictionary

    '        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA) '"N/A" 

    '        sf = New StringFormat(StringFormatFlags.NoClip)
    '        intNewX = 0
    '        intNewY = G_ReportOptions.dblTopMargin
    '        '-----------------------------------------------------------------------------
    '        'Menu Name
    '        '-----------------------------------------------------------------------------
    '        strMenuName = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)
    '        intTextHeight = ReportingTextUtils.MeasureText(strMenuName, fntReportTitle, intAvailableWidth, sf, Me.Padding).Height
    '        Select Case strStyle
    '            Case "002" 'Modern  with backColor
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strMenuName, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True, , G_ReportOptions.strTitleColor)})
    '            Case "003"
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strMenuName, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Bottom, , , , G_ReportOptions.strTitleColor)})
    '            Case Else
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strMenuName, fntReportTitle, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , , , , , G_ReportOptions.strTitleColor)})
    '        End Select
    '        intNewY += intTextHeight
    '        '-----------------------------------------------------------------------------
    '        intTextHeight = ReportingTextUtils.MeasureText("Menu", fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        intNewY += intTextHeight

    '        intNewX = 0
    '        intNewY = 0

    '        'If strStyle = "003" Then    'Two Columns
    '        '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '        '    intNewY += intTextHeight
    '        'End If

    '        '---------------------------------------------------------------------------
    '        'Add Picture
    '        '---------------------------------------------------------------------------
    '        Dim intY As Integer

    '        'Picture Size
    '        Select Case strStyle
    '            Case "001", "002"
    '                Select Case G_ReportOptions.strSubStyle
    '                    Case "01" : dblMaxHeightPicture = 180
    '                    Case "02" : dblMaxHeightPicture = 180 : flagQtyFirst = False
    '                    Case "11" : dblMaxHeightPicture = 250
    '                    Case "12" : dblMaxHeightPicture = 250 : flagQtyFirst = False
    '                    Case "21" : dblMaxHeightPicture = 350
    '                    Case "22" : dblMaxHeightPicture = 350 : flagQtyFirst = False
    '                End Select
    '                If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
    '                dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

    '            Case "003" 'Two Columns
    '                dblMaxWidthPicture = (intAvailableWidth / 2) - 50
    '                dblMaxHeightPicture = dblMaxWidthPicture + 100

    '        End Select

    '        If G_ReportOptions.blnPictureOneRight = True Then
    '            G_ReportOptions.blnWithPicture = True
    '            G_ReportOptions.blnPicturesAll = False
    '        End If

    '        Dim strFileName As String = Nothing
    '        If strStyle = "001" Or strStyle = "002" Then
    '            'If G_ReportOptions.blnWithPicture = True Then
    '            'str3Pictures = ""
    '            'If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

    '            'For j As Integer = 0 To 2
    '            '    strPicture(j) = ""
    '            '    strPicture(j) = fctGetPictureName(str3Pictures, j)
    '            'Next

    '            'If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '            '    For j As Integer = 0 To 2
    '            '        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
    '            '            strFileName = G_strPhotoPath & strPicture(j)

    '            '            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '            '                intNewX = (intAvailableWidth - dblMaxWidthPicture)
    '            '            End If

    '            '            .Detail.Controls.AddRange(New XRControl() _
    '            '                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '            '            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '            '                intNewX = 0
    '            '            Else
    '            '                intNewX += G_dblMaxWidthPicture + 20
    '            '            End If
    '            '            blflagPixOK = True
    '            '            intY = intNewY
    '            '            Exit For
    '            '        End If
    '            '    Next
    '            'End If
    '            'End If
    '            '--- VRP 07.11.2007
    '            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString
    '            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
    '            If G_ReportOptions.blnPicturesAll = True Then
    '                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                    For j As Integer = 0 To UBound(arrPicture)
    '                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                            strFileName = G_strPhotoPath & arrPicture(j)

    '                            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '                                intNewX = (intAvailableWidth - dblMaxWidthPicture)
    '                            End If

    '                            .Detail.Controls.AddRange(New XRControl() _
    '                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})
    '                            intNewX += CInt(G_dblMaxWidthPicture) + 5
    '                            strFileName &= arrPicture(j)
    '                        End If
    '                    Next
    '                    If strFileName <> "" Then
    '                        intNewX = 0
    '                        If G_ReportOptions.blnPictureOneRight = False Then 'DLS Aug292007
    '                            intNewY += CInt(G_dblMaxHeightPicture) + 10
    '                            intNewY += intTextHeight
    '                        End If
    '                    End If
    '                End If
    '                '----------
    '            Else
    '                If G_ReportOptions.blnWithPicture = True Then
    '                    If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                        For j As Integer = 0 To UBound(arrPicture)
    '                            If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                                strFileName = G_strPhotoPath & arrPicture(j)

    '                                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '                                    intNewX = (intAvailableWidth - dblMaxWidthPicture)
    '                                End If

    '                                .Detail.Controls.AddRange(New XRControl() _
    '                                    {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                                If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '                                    intNewX = 0
    '                                Else
    '                                    intNewX += G_dblMaxWidthPicture + 20
    '                                End If
    '                                blflagPixOK = True
    '                                intY = intNewY
    '                                Exit For
    '                            End If
    '                        Next
    '                    End If
    '                End If
    '                '-----
    '            End If
    '        End If
    '        '---------------------------------------------------------------------------

    '        lngSpace = 0
    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)                 '"Menu #" 
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Category)                'Category
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Source)                  'Source
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)                   'Date
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)             'Cost of Goods
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)                  'Remark
    '        lngSpace = fctGetWidest(strX, intTextHeight, lngSpace, fntRegular)
    '        lngSpace = lngSpace * 1.5

    '        L_lngCol(0) = intAvailableWidth - lngSpace - INTCOLUMNSPACE - intNewX

    '        Dim strPortionUnit As String
    '        strPortionUnit = fctGetTranslatedText(row, "YieldName", "YieldNameTrans", G_ReportOptions.intTranslation)


    '        If G_ReportOptions.blnIncludeNumber Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)  '"Menu #" 
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctSqlReady(row("Number").ToString)
    '            strX = Replace(strX, Chr(1), "")
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeCategory Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Category)    'Category
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeSource Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Source)      'Source
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "Chef", "ChefTrans", G_ReportOptions.intTranslation)
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeDate Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)       'Date
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctConvertDate(row("Dates") & "")
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeCostOfGoods Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)     'Cost of Goods
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = Trim(fctNullToString(row("Currency"))) & " " & Format(fctNullToZero(row("calcprice")), G_strPriceFormat) & " /" & strPortionUnit
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If G_ReportOptions.blnIncludeRemark Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)      'Remark
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngSpace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})

    '            strX = fctGetTranslatedText(row, "Remark", "Remark1Trans", G_ReportOptions.intTranslation) 'Trim(rsX!Remark)               
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, (intNewX + lngSpace), intNewY, L_lngCol(0), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            intNewY += GetLineSpace(intTextHeight)
    '        End If

    '        If blflagPixOK Then
    '            intNewY = intY + CInt(G_dblMaxHeightPicture) + 10
    '        Else
    '            intNewY += 10
    '        End If

    '        intNewX = 0

    '        If strStyle = "003" Then            'For Two Columns Style
    '            If G_ReportOptions.blnWithPicture = True Then
    '                'str3Pictures = ""
    '                'If Not IsDBNull(row("Pix").ToString) Then str3Pictures = row("Pix").ToString

    '                'For j As Integer = 0 To 2
    '                '    strPicture(j) = ""
    '                '    strPicture(j) = fctGetPictureName(str3Pictures, j)
    '                'Next

    '                'If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
    '                '    strPicture(1) = ""
    '                '    strPicture(2) = ""
    '                '    dblMaxHeightPicture = dblMaxHeightPicture * 2
    '                '    dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '                'End If

    '                'If str3Pictures <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                '    For j As Integer = 0 To 2
    '                '        If UrlFileExists(G_strPhotoPath & strPicture(j)) And strPicture(j) <> "" Then
    '                '            strFileName = G_strPhotoPath & strPicture(j)


    '                '            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '                '                intNewX = (intAvailableWidth - dblMaxWidthPicture)
    '                '            End If

    '                '            .Detail.Controls.AddRange(New XRControl() _
    '                '                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                '            intNewX += G_dblMaxWidthPicture + 20
    '                '            blflagPixOK = True
    '                '            intY = intNewY
    '                '            Exit For
    '                '        End If
    '                '    Next
    '                'End If

    '                '--- VRP 07.11.2007
    '                If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString
    '                Dim arrPicture() As String = strPictureAll.Split(CChar(";"))

    '                If G_ReportOptions.blnPictureOneRight Then 'DLS 28.08.2007
    '                    arrPicture(1) = ""
    '                    arrPicture(2) = ""
    '                    arrPicture(3) = ""
    '                    arrPicture(4) = ""
    '                    dblMaxHeightPicture = dblMaxHeightPicture * 2
    '                    dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)
    '                End If

    '                If strPictureAll <> "" And G_ReportOptions.blnPicturePathAccessible Then
    '                    For j As Integer = 0 To UBound(arrPicture)
    '                        If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
    '                            strFileName = G_strPhotoPath & arrPicture(j)


    '                            If G_ReportOptions.blnPictureOneRight Then 'DLS August282007
    '                                intNewX = (intAvailableWidth - dblMaxWidthPicture)
    '                            End If

    '                            .Detail.Controls.AddRange(New XRControl() _
    '                                {fctMakePictureBox(strFileName, intNewX, intNewY, CInt(dblMaxWidthPicture), CInt(dblMaxHeightPicture))})

    '                            intNewX += G_dblMaxWidthPicture + 20
    '                            blflagPixOK = True
    '                            intY = intNewY
    '                            Exit For
    '                        End If
    '                    Next
    '                End If
    '                '-----

    '            End If

    '        End If

    '        '---------------------------------------------------------------------------
    '        'Servings
    '        '---------------------------------------------------------------------------
    '        Dim strYieldFormat As String
    '        Dim strNumberOfServings As String
    '        Dim intOrigWidth As Integer = intAvailableWidth

    '        If strStyle = "003" Then
    '            If blflagPixOK Then
    '                intAvailableWidth /= 2
    '                intNewX = intAvailableWidth
    '            End If
    '        End If

    '        strYieldFormat = row("YieldFormat").ToString
    '        'If G_ReportOptions.dblYield = -1 Then
    '        dblPortionValue = row("Yield").ToString
    '        'Else
    '        'dblPortionValue = dblYield
    '        'End If

    '        Dim strPortionUnit2 As String = strPortionUnit
    '        If dblPortionValue > 1 Then
    '            strPortionUnit2 = fctPluralPortionText(strPortionUnit2)
    '        End If

    '        '-- VRP 20.01.2009
    '        Dim dblYieldQtyOrig As Double = CType(row("YieldOriginalFactor"), Double)
    '        Dim strYieldUnitNameOrig As String = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 
    '        Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)
    '        Dim intYieldUnitOriginal As Integer = CType(row("YieldUnitOriginalCode"), Integer)
    '        '---

    '        If G_Options.QtyType = 0 Then
    '            'strNumberOfServings = fctFormatNumericQuantity(dblPortionValue, strYieldFormat, G_Options.RemoveTrailingZero) & " " & Trim(strPortionUnit2)
    '            If (dblPortionValue <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
    '                strNumberOfServings = fctFormatNumericQuantity(dblPortionValue, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strPortionUnit2
    '                strNumberOfServings &= "/" & fctFormatNumericQuantity(dblYieldQtyOrig, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
    '            Else
    '                strNumberOfServings = fctFormatNumericQuantity(dblPortionValue, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strPortionUnit2
    '            End If
    '        Else
    '            'strNumberOfServings = fctConvertToFraction(dblPortionValue) & " " & Trim(UCase(strPortionUnit2))
    '            If (dblPortionValue <> dblYieldQtyOrig) Or (strPortionUnit2 <> strYieldUnitNameOrig) Then 'VRP 15.01.2009
    '                strNumberOfServings = fctConvertToFraction(dblPortionValue) & " " & Trim(UCase(strPortionUnit2))
    '                strNumberOfServings &= "/" & fctConvertToFraction(dblYieldQtyOrig) & " " & strYieldUnitNameOrig
    '            Else
    '                strNumberOfServings = fctConvertToFraction(dblPortionValue) & " " & Trim(UCase(strPortionUnit2))
    '            End If
    '        End If

    '        strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.ItemsForyNetQuantity), "%y", strNumberOfServings)   '"Items for " & strNumberOfServings & " (Net Quantity)" '

    '        Select Case strStyle
    '            Case "002" 'Modern  with backColor
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
    '            Case "003" 'Two Columns
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            Case Else
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '                intNewY += 10
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '                '---------------------------------------------------------------------------
    '        End Select
    '        intNewY += intTextHeight * 2


    '        '/////// PRINT MENU ITEMS /////////
    '        'VRP 18.02.2009

    '        Dim fntFont As Font
    '        Dim strItemName As String
    '        Dim strItemNumber As String
    '        Dim dblQuantityNet As Double
    '        Dim dblPercentage As Double
    '        Dim strUnit As String
    '        'Dim strUnitFormat As String
    '        Dim strIngPreparation As String 'FOR SUBRECIPE ONLY
    '        Dim strComplement As String
    '        Dim lngSpaceName As Long = 0
    '        Dim lngSpaceQty As Long = 0
    '        Dim lngSpaceUnit As Long = 0
    '        Dim lngSpacePrep As Long = 0
    '        Dim lngSpaceNum As Long = 0
    '        Dim lngSpaceHeight As Long = 0
    '        Dim itemType As Integer

    '        'Measure Menu Items
    '        Dim intCodeMain As Integer = CIntDB(row("Code"))
    '        For Each rowIng As DataRow In dtIngredients.Rows
    '            If intCodeMain = rowIng("CodeMain") Then
    '                strItemNumber = ""
    '                strItemName = ""
    '                dblQuantityNet = 0
    '                strUnit = ""
    '                strIngPreparation = ""
    '                strComplement = ""
    '                itemType = CIntDB(rowIng("ItemType"))

    '                fntFont = fntRegular
    '                If itemType = ID_Recipe Then
    '                    fntFont = fntItalic
    '                    If flagSubRecipeAsterisk Or flagSubRecipeNormalFont Then fntFont = fntRegular 'DLS 09.08.2007
    '                End If
    '                If itemType = ID_Text Then fntFont = fntBold


    '                'Name
    '                If itemType = 0 Then strItemName = CStrDB(rowIng("tmpName")) Else strItemName = CStrDB(rowIng("ItemName"))
    '                If flagSubRecipeAsterisk Then 'DLS 09.08.2007
    '                    strItemName = "*" & strItemName
    '                End If
    '                lngSpaceName = fctGetWidest(fctFirstCap(strItemName), intTextHeight, lngSpaceName, fntFont)

    '                'Qty
    '                If itemType = 0 Then
    '                    dblQuantityNet = CDblDB(IIf(rowIng("tmpQty") = "", 0, rowIng("tmpQty")))
    '                Else
    '                    If Not IsDBNull(rowIng("ItemQty")) Then dblQuantityNet = rowIng("ItemQty")
    '                End If

    '                If Not G_Options.QtyType = 0 Then
    '                    dblQuantityNet = fctConvertToFraction(dblQuantityNet)
    '                End If
    '                lngSpaceQty = fctGetWidest(dblQuantityNet, intTextHeight, lngSpaceQty, fntFont)

    '                'Unit
    '                If itemType = 0 Then strUnit = CStrDB(rowIng("tmpUnit")) Else strUnit = CStrDB(rowIng("ItemUnit"))
    '                lngSpaceUnit = fctGetWidest(strUnit, intTextHeight, lngSpaceUnit, fntFont)


    '                'Preparation : FOR SUBRECIPE ONLY
    '                If G_ReportOptions.blnIncludeIngrPreparation Then
    '                    If itemType = 0 Then
    '                        strIngPreparation = CStrDB(rowIng("tmpPreparation"))
    '                    Else
    '                        strIngPreparation = CStrDB(rowIng("Preparation"))
    '                    End If

    '                    lngSpacePrep = fctGetWidest(strIngPreparation, intTextHeight, lngSpacePrep, fntFont)
    '                End If

    '                'ItemNumber 
    '                If G_ReportOptions.blnIncludeIngrNumber Then
    '                    strItemNumber = fctSqlReady(rowIng("ItemNumber").ToString)
    '                    strItemNumber = Replace(strItemNumber, Chr(1), "")
    '                    lngSpaceNum = fctGetWidest(strItemNumber, intTextHeight, lngSpaceNum, fntFont)
    '                End If
    '            End If
    '        Next


    '        lngSpaceQty += INTCOLUMNSPACE + 10
    '        lngSpaceUnit += INTCOLUMNSPACE + 10
    '        lngSpaceNum += INTCOLUMNSPACE + 10
    '        lngSpaceName = 150
    '        lngSpacePrep = Math.Abs(intAvailableWidth - lngSpaceQty - lngSpaceUnit - lngSpaceName - lngSpaceNum - 20)

    '        If strIngPreparation = "" Then
    '            lngSpaceName = Math.Abs(intAvailableWidth - lngSpaceQty - lngSpaceUnit - lngSpaceNum - 20)
    '            lngSpacePrep = 0
    '        End If

    '        'Print Menu Item
    '        For Each rowIng As DataRow In dtIngredients.Rows
    '            If intCodeMain = rowIng("CodeMain") Then
    '                strItemNumber = ""
    '                strItemName = ""
    '                dblQuantityNet = 0
    '                strUnit = ""
    '                strIngPreparation = ""
    '                itemType = CIntDB(rowIng("ItemType"))
    '                lngSpaceHeight = 0

    '                'Item Number
    '                If G_ReportOptions.blnIncludeIngrNumber Then
    '                    If Not IsDBNull(rowIng("ItemNumber")) Then strItemNumber = fctNumber2Text(rowIng("ItemNumber"))
    '                    strItemNumber = Replace(strItemNumber, Chr(1), "")
    '                End If

    '                'Item Name
    '                If itemType = 0 Then strItemName = CStrDB(rowIng("tmpName")) Else strItemName = CStrDB(rowIng("ItemName"))
    '                If flagSubRecipeAsterisk Then 'DLS 09.08.2007
    '                    strItemName = "*" & strItemName
    '                End If

    '                'Qty
    '                If itemType = 0 Then
    '                    dblQuantityNet = CDblDB(IIf(rowIng("tmpQty") = "", 0, rowIng("tmpQty")))
    '                Else
    '                    If Not IsDBNull(rowIng("ItemQty")) Then dblQuantityNet = rowIng("ItemQty")
    '                End If

    '                'Unit
    '                If itemType = 0 Then strUnit = CStrDB(rowIng("tmpUnit")) Else strUnit = CStrDB(rowIng("ItemUnit"))

    '                'Preparation
    '                If itemType = 0 Then strIngPreparation = CStrDB(rowIng("tmpPreparation")) Else strIngPreparation = CStrDB(rowIng("Preparation"))

    '                If itemType = ID_Text Or itemType = ID_Dash Then
    '                    dblQuantityNet = 0
    '                    strUnit = ""
    '                    fntFont = fntBold
    '                Else
    '                    If Not G_Options.QtyType = 0 Then
    '                        dblQuantityNet = fctConvertToFraction(dblQuantityNet)
    '                    End If

    '                    If itemType = ID_Recipe Then
    '                        fntFont = fntItalic
    '                        If flagSubRecipeAsterisk Or flagSubRecipeNormalFont Then fntFont = fntRegular
    '                    Else
    '                        fntFont = fntRegular
    '                    End If

    '                    intNewX = 20 'reset to 20 for ingredeints
    '                    sf = New StringFormat(StringFormatFlags.NoClip)
    '                    intTextHeight = ReportingTextUtils.MeasureText(fctFirstCap(strItemName), fntFont, lngSpaceName, sf, Me.Padding).Height
    '                    If strStyle = "003" Then If blflagPixOK Then intNewX = intAvailableWidth

    '                    'Measure height
    '                    If G_ReportOptions.blnIncludeIngrNumber Then
    '                        intTextHeight = ReportingTextUtils.MeasureText(strItemNumber, fntFont, lngSpaceNum, sf, Padding).Height
    '                        If lngSpaceHeight < intTextHeight Then lngSpaceHeight = intTextHeight
    '                    End If

    '                    intTextHeight = ReportingTextUtils.MeasureText(strItemName, fntFont, lngSpaceName, sf, Padding).Height
    '                    If lngSpaceHeight < intTextHeight Then lngSpaceHeight = intTextHeight
    '                    intTextHeight = ReportingTextUtils.MeasureText(dblQuantityNet, fntFont, lngSpaceQty, sf, Padding).Height
    '                    If lngSpaceHeight < intTextHeight Then lngSpaceHeight = intTextHeight
    '                    intTextHeight = ReportingTextUtils.MeasureText(strUnit, fntFont, lngSpaceUnit, sf, Padding).Height
    '                    If lngSpaceHeight < intTextHeight Then lngSpaceHeight = intTextHeight

    '                    If G_ReportOptions.blnIncludeIngrPreparation Then
    '                        intTextHeight = ReportingTextUtils.MeasureText(strIngPreparation, fntFont, lngSpacePrep, sf, Padding).Height
    '                        If lngSpaceHeight < intTextHeight Then lngSpaceHeight = intTextHeight
    '                    End If

    '                    If flagQtyFirst Then
    '                        'Qty
    '                        If dblQuantityNet > 0 Then .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(dblQuantityNet, fntFont, intNewX, intNewY, lngSpaceQty, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                        intNewX += lngSpaceQty

    '                        'Unit
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strUnit, fntFont, intNewX, intNewY, lngSpaceUnit, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceUnit

    '                        'Item Number
    '                        If G_ReportOptions.blnIncludeIngrNumber Then .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strItemNumber, fntFont, intNewX, intNewY, lngSpaceNum, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceNum

    '                        'Item Name
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(fctFirstCap(strItemName), fntFont, intNewX, intNewY, lngSpaceName, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceName

    '                        'Preparation : FOR SUBRECIPE ONLY
    '                        If G_ReportOptions.blnIncludeIngrPreparation Then
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngPreparation, fntFont, intNewX, intNewY, lngSpacePrep, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                    Else

    '                        'Item Number
    '                        If G_ReportOptions.blnIncludeIngrNumber Then .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strItemNumber, fntFont, intNewX, intNewY, lngSpaceNum, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceNum

    '                        'Item Name
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(fctFirstCap(strItemName), fntFont, intNewX, intNewY, lngSpaceName, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceName

    '                        'Qty
    '                        If dblQuantityNet > 0 Then .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(dblQuantityNet, fntFont, intNewX, intNewY, lngSpaceQty, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                        intNewX += lngSpaceQty

    '                        'Unit
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strUnit, fntFont, intNewX, intNewY, lngSpaceUnit, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewX += lngSpaceUnit

    '                        'Preparation : FOR SUBRECIPE ONLY
    '                        If G_ReportOptions.blnIncludeIngrPreparation Then
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strIngPreparation, fntFont, intNewX, intNewY, lngSpacePrep, lngSpaceHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                    End If

    '                    intNewY += lngSpaceHeight
    '                End If
    '            End If
    '        Next

    '        '///////////////////////////////////////////////////


    '        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, lngSpace, sf, Me.Padding).Height
    '        intNewY += GetLineSpace(intTextHeight)
    '        intNewX = 0
    '        If strStyle = "003" Then
    '            intAvailableWidth = intOrigWidth
    '            If blflagPixOK Then
    '                intY += CInt(G_dblMaxHeightPicture)
    '                If intY > intNewY Then intNewY = intY + 10
    '            End If
    '            'MCM 03.02.06
    '            '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '            intNewY += 10
    '        End If

    '        '----------------------------------------------------------------------------
    '        'Note
    '        '----------------------------------------------------------------------------
    '        'Dim intNoteHeight As Integer
    '        sf = New StringFormat(StringFormatFlags.NoClip)
    '        ''strX = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation) 'Trim(rsX!Note)
    '        ''intNoteHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        ''If strX <> "" Then
    '        ''    Select Case strStyle
    '        ''        Case "002" 'Modern  with backColor
    '        ''            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("", fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
    '        ''            intNewY += intTextHeight * 2
    '        ''    End Select

    '        ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, , True)})
    '        ''    intNewY += GetLineSpace(intTextHeight)

    '        ''    'If strStyle = "003" Then
    '        ''    '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '        ''    '    intNewY += 10
    '        ''    'Else
    '        ''    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("", fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, True, , True)})
    '        ''    intNewY += GetLineSpace(intTextHeight)
    '        ''    'End If
    '        ''End If

    '        ' ''--- VRP 23.06.2008
    '        ''If Not strCnn = "" Then
    '        ''    Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
    '        ''    Dim dt As DataTable = cListe.fctGetProcedureTemplateD(G_ReportOptions.intTranslation, row("TemplateCode"))
    '        ''    If Not dt Is Nothing Then
    '        ''        Dim sNote() As String = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation).ToString.Split(CChar("¤"))
    '        ''        Dim i As Integer = 0
    '        ''        strX += ""
    '        ''        For Each rw As DataRow In dt.Rows
    '        ''            If Not sNote(i).Trim = "" Then
    '        ''                strX = rw("Name")
    '        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        ''                intNewY += GetLineSpace(intTextHeight)

    '        ''                strX = sNote(i)
    '        ''                intTextHeight = ReportingTextUtils.MeasureText(sNote(i), fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        ''                intNewY += GetLineSpace(intTextHeight)
    '        ''                intNewY += GetLineSpace(intTextHeight)
    '        ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
    '        ''            End If
    '        ''            i += 1
    '        ''        Next
    '        ''    Else
    '        ''        strX = fctGetTranslatedText(row, "Note", "NoteTrans", G_ReportOptions.intTranslation)
    '        ''        strX = Trim(Replace(strX, vbCrLf & "#", vbCrLf))
    '        ''        strX = Trim(Replace(strX, Chr(1), vbCrLf))

    '        ''        If Mid(strX, 1, 1) = "#" Then strX = Mid(strX, 2)

    '        ''        If Not IsNothing(strX) Then intNewY += 10
    '        ''        SplitNote(strX, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopLeft)
    '        ''    End If '----
    '        ''End If

    '        '--- VRP 26.06.2008
    '        Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))
    '        Dim sNote As String = row("Note")
    '        Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)

    '        If nCodeTemplate = 0 Then
    '            sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
    '            sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
    '            If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

    '            If Not IsNothing(sNote) Then intNewY += 10
    '            SplitNote(sNote, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
    '        Else
    '            Dim sNotes() As String = sNote.Split(CChar("¤"))
    '            Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

    '            For i As Integer = 0 To UBound(sNotesHeader)
    '                If Not sNotes(i) = "" Then
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    intNewY += intTextHeight

    '                    sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
    '                    sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
    '                    If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

    '                    If IsNothing(sNotes(i)) Then intNewY += 10
    '                    SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
    '                    intNewY += GetLineSpace(intTextHeight)
    '                End If
    '            Next
    '        End If '--------
    '        '----------------------------------------------------------------------------

    '        If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
    '            dblNutrientFactor = GetNutrientFactor(CInt(row("Code")))
    '        End If

    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeNutrients Then
    '            If strStyle = "003" Then     'For Two Columns
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '                intNewY += 10
    '            End If

    '            subDisplayNutrients(strPortionUnit, dblNutrientFactor, L_Nutrient, strStyle)
    '        End If
    '        'If strStyle = "003" Then
    '        '    intNewY += intTextHeight
    '        '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '        'End If

    '        'GDA 'DLS Aug112007
    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeGDA Then
    '            If strStyle = "003" Then     'For Two Columns
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '                intNewY += 10
    '            End If
    '            subDisplayNutrientsGDA(strPortionUnit, dblNutrientFactor, L_Nutrient, strStyle)
    '        End If



    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeKeyword Then
    '            If strStyle = "003" Then     'For Two Columns
    '                intNewY += intTextHeight
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
    '                intNewY += 10
    '            End If

    '            subDisplayKeywords(foundKeywords, strStyle)

    '            'intNewY += intTextHeight

    '            'strX = UCase(cLang.GetString(clsEGSLanguage.CodeType.Keywords))    'Keywords
    '            'Select Case strStyle
    '            '    Case "002" 'Modern
    '            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
    '            '    Case "003"  'Two Columns
    '            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
    '            '    Case Else
    '            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            'End Select

    '            'intNewY += intTextHeight

    '            'Dim strKeyword As String
    '            'Dim intPrevious As Integer
    '            'intPrevious = -1

    '            'For rowK As Integer = 0 To foundKeywords.GetUpperBound(0)

    '            '    intNewY += intTextHeight
    '            '    strKeyword = CType(foundKeywords(rowK)("Name"), String)

    '            '    If CType(foundKeywords(rowK)("Type"), Integer) = ID_Recipe Then
    '            '        If intPrevious <> CType(foundKeywords(rowK)("CodeKey"), Integer) Then
    '            '            If CType(foundKeywords(rowK)("derived"), Boolean) Then
    '            '                fntFont = fntItalic
    '            '            Else
    '            '                fntFont = fntRegular
    '            '            End If
    '            '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            '        End If
    '            '    Else
    '            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
    '            '    End If

    '            'Next
    '        End If

    '        'Allergens MCM 03.03.06
    '        '----------------------
    '        intNewX = 0
    '        If G_ReportOptions.blnIncludeAllergens Then
    '            If strStyle = "003" Then
    '                strStyle = "003Menu"
    '            Else
    '                intNewY -= 10
    '            End If

    '            subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, strStyle)
    '        End If
    '        'End of Allergens

    '    End With
    '    Return Me
    'End Function
    Function fctPrintMenuDetailEgs(ByVal foundDetails() As DataRow, ByVal foundKeywords() As DataRow, ByVal foundAllergens() As DataRow, ByVal strStyle As String,
                                 Optional ByVal flagSubRecipeAsterisk As Boolean = False,
                                 Optional ByVal flagSubRecipeNormalFont As Boolean = False,
                                 Optional ByVal strCnn As String = "", Optional ByVal flagmenudetails As Integer = -1,
                                 Optional ByVal dtIngredients As DataTable = Nothing, Optional ByVal dtListePreparation() As DataRow = Nothing) As XtraReport

        Log.Info("fctPrintMenuDetailEgs")
        Dim row As DataRow = foundDetails(0)
        Dim intRecipeCode As Integer
        Dim IntRecipeParentCode As Integer

        intRecipeCode = row("Code") ' RDC 03.14.2013 - Filter
        IntRecipeParentCode = IIf(IsDBNull(row("CodeListeParent")), 0, row("CodeListeParent"))   'MKAM 2015.07.02

        fctPrintMenuDetailEgs = Nothing
        If foundDetails.Length <= 0 Then Exit Function

        'Select Case flagmenudetails '14.12.2007
        '    Case 0 'Manor
        '        Return fctPrintRecipeDetailsManor(foundDetails, foundAllergens, dtListePreparation)
        'End Select

        '--- SETTINGS ---
        Try
            fntRegular = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            fntBold = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            fntItalic = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)

            If G_ReportOptions.blnPictureOneRight Then
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, 14, FontStyle.Bold)
            Else
                fntReportTitle = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold) 'VRP 07.11.2007
            End If
        Catch ex As Exception
            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Return Me
        End Try

        With Me
            .PaperKind = Printing.PaperKind.Custom
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)

            .Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            .Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            .Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            .Margins.Right = CInt(G_ReportOptions.dblRightMargin)

            If G_ReportOptions.blLandscape Then
                .Landscape = True
                intAvailableWidth = .PageHeight
            Else
                .Landscape = False
                intAvailableWidth = .PageWidth
            End If
            intAvailableWidth = intAvailableWidth - CInt(G_ReportOptions.dblLeftMargin) - CInt(G_ReportOptions.dblRightMargin)
        End With

        '--- PAGE HEADER ---
        With Me
            sf = New StringFormat(StringFormatFlags.NoClip)
            intNewX = 0
            intNewY = G_ReportOptions.dblTopMargin

            '---------------------------------------------------------------------------
            'Menu Name
            '---------------------------------------------------------------------------

            Dim strMenuName As String = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)
            Dim xrMenuHeaderTbl As New XRTable
            Dim xrMenuHeaderRow As New XRTableRow
            Dim xrMenuHeaderCell As New XRTableCell

            xrMenuHeaderTbl.Width = intAvailableWidth
            xrMenuHeaderTbl.Location = New Point(intNewX, intNewY)
            xrMenuHeaderRow.Height = G_ReportOptions.sgFontTitleSize

            If G_ReportOptions.blnIncludeHighlightSection Then
                xrMenuHeaderTbl.BackColor = Color.LightGray
                xrMenuHeaderTbl.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xrMenuHeaderTbl.BorderWidth = 1
            Else
                xrMenuHeaderTbl.BackColor = Color.White
                xrMenuHeaderTbl.Borders = DevExpress.XtraPrinting.BorderSide.None
                xrMenuHeaderTbl.BorderWidth = 0
            End If
            xrMenuHeaderCell.Font = New Font(G_ReportOptions.strFontTitleName, G_ReportOptions.sgFontTitleSize, FontStyle.Bold)
            xrMenuHeaderCell.Text = strMenuName
            xrMenuHeaderCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            xrMenuHeaderRow.Cells.Add(xrMenuHeaderCell)
            xrMenuHeaderTbl.Rows.Add(xrMenuHeaderRow)
            .PageHeader.Controls.Add(xrMenuHeaderTbl)
            intNewY += (xrMenuHeaderTbl.Height + 20)

        End With
        '--- PAGE HEADER ---

        '--- PAGE DETAILS ---
        With Me
            sf = New StringFormat(StringFormatFlags.NoClip)
            intNewX = 0
            intNewY = 20     ' RDC 07.18.2013 : Changed from 0 to 20

            '---------------------------------------------------------------------------
            'Picture
            '---------------------------------------------------------------------------
            Dim dblMaxHeightPicture As Double
            Dim dblMaxWidthPicture As Double
            Dim flagQtyFirst As Boolean = True
            Dim strFileName As String = Nothing
            Dim strPictureAll As String = ""
            Dim blflagPixOK As Boolean
            Dim intY As Integer


            Select Case strStyle
                Case "001", "002", "003"                                                ' RDC 07.18.2013 : Changed from Case "001", "002" to Case "001", "002","003" 
                    Select Case G_ReportOptions.strSubStyle
                        Case "01" : dblMaxHeightPicture = 150                           ' RDC 07.18.2013 : Changed from 180 to 150
                        Case "02" : dblMaxHeightPicture = 150 : flagQtyFirst = False    ' RDC 07.18.2013 : Changed from 180 to 150
                        Case "11" : dblMaxHeightPicture = 200                           ' RDC 07.18.2013 : Changed from 250 to 200
                        Case "12" : dblMaxHeightPicture = 200 : flagQtyFirst = False    ' RDC 07.18.2013 : Changed from 250 to 200
                        Case "21" : dblMaxHeightPicture = 250                           ' RDC 07.18.2013 : Changed from 350 to 250
                        Case "22" : dblMaxHeightPicture = 250 : flagQtyFirst = False    ' RDC 07.18.2013 : Changed from 350 to 250
                    End Select
                    ' RDC 07.18.2013 : Removed due to change format
                    'If dblMaxHeightPicture = 0 Then dblMaxHeightPicture = 350
                    'dblMaxWidthPicture = (dblMaxHeightPicture / 1.4)

                    'Case "003" 'Two Columns
                    '    dblMaxWidthPicture = (intAvailableWidth / 2) - 50
                    '    dblMaxHeightPicture = dblMaxWidthPicture + 100
            End Select


            ' RDC 07.18.2013 : Menu Picture
            Dim intDPic As Integer, intPicWidth As Integer = CInt(dblMaxHeightPicture), intPicHeight As Integer = CInt(dblMaxHeightPicture)
            If row.Table.Columns.Contains("DefaultPicture") Then
                intDPic = IIf(CIntDB(row("DefaultPicture")) = 0, 1, CIntDB(row("DefaultPicture")))
            Else
                intDPic = 1
            End If

            Dim xrPicTable As New XRTable
            Dim xrPicRow As New XRTableRow
            Dim xrPicCell1 As New XRTableCell, xrPicCell2 As New XRTableCell

            If Not IsDBNull(row("Pix").ToString) Then strPictureAll = row("Pix").ToString
            Dim arrPicture() As String = strPictureAll.Split(CChar(";"))
            Dim strPicPath() As String = {"", "", "", "", "", ""}

            xrPicTable.Width = intAvailableWidth
            xrPicRow = New XRTableRow

            If G_ReportOptions.blnPicturesAll Then              ' All
                xrPicTable.Location = New Point(0, intNewY)
                ' Rearrange images
                For iPicPos As Integer = 0 To arrPicture.GetUpperBound(0) Step 1
                    If Not arrPicture(iPicPos).ToString = "" And UrlFileExists(G_strPhotoPath & arrPicture(iPicPos)) Then
                        strPicPath(iPicPos + 1) = G_strPhotoPath & arrPicture(iPicPos).ToString
                    End If
                Next

                ' Display images
                For iPicPos As Integer = 1 To 5 Step 1
                    xrPicCell1 = New XRTableCell
                    xrPicCell2 = New XRTableCell
                    Dim xrPicBox As New XRPictureBox

                    With xrPicCell1
                        .Size = New System.Drawing.Size(intPicWidth, intPicHeight)

                        If Not strPicPath(iPicPos) = "" Then
                            .Borders = DevExpress.XtraPrinting.BorderSide.All
                            .BorderWidth = 1

                            xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 50), CInt(intPicHeight - 50))
                            xrPicBox.Location = New Point(5, 4)
                            xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrPicBox.Image = LoadImageFromUrl(strPicPath(iPicPos)) 'Image.FromFile(strPicPath(iPicPos))
                            xrPicBox.Sizing = ImageSizeMode.ZoomImage
                            xrPicBox.Parent = xrPicCell1
                            xrPicCell1.Controls.Add(xrPicBox)
                        Else
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                        End If
                    End With
                    If iPicPos <= 4 Then
                        With xrPicCell2
                            .Size = New System.Drawing.Size(10, intPicHeight)
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                        End With
                    End If

                    xrPicRow.Cells.AddRange({xrPicCell1, xrPicCell2})
                Next
                xrPicTable.Rows.Add(xrPicRow)
                .Detail.Controls.Add(xrPicTable)
                intNewY += (xrPicTable.Height + 20)

            ElseIf G_ReportOptions.blnPictureOneRight Then      ' Right
                xrPicTable = New XRTable
                xrPicRow = New XRTableRow
                Dim recipeImg As String = G_strPhotoPath & arrPicture(intDPic - 1).ToString

                xrPicTable.Location = New Point(CInt(intAvailableWidth - (intPicWidth + 10)), intNewY)
                xrPicTable.Width = CInt(intPicWidth)
                xrPicTable.Height = CInt(intPicHeight)

                xrPicCell1 = New XRTableCell

                Dim xrPicBox As New XRPictureBox
                xrPicRow.Width = CInt(intPicWidth)
                With xrPicCell1
                    '.Size = New System.Drawing.Size(CInt(intPicWidth), CInt(intPicHeight))
                    .Width = CInt(intPicWidth)
                    If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                        .Borders = DevExpress.XtraPrinting.BorderSide.All
                        .BorderWidth = 1
                        xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 10), CInt(intPicHeight - 10))
                        xrPicBox.Location = New Point(5, 4)
                        xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                        xrPicBox.Sizing = ImageSizeMode.ZoomImage
                        xrPicCell1.Controls.Add(xrPicBox)
                    Else
                        .Borders = DevExpress.XtraPrinting.BorderSide.None
                        .BorderWidth = 0
                    End If
                End With
                xrPicRow.Cells.Add(xrPicCell1)
                xrPicTable.Rows.Add(xrPicRow)
                .Detail.Controls.Add(xrPicTable)

            Else                                                ' Default : Left

                xrPicTable = New XRTable
                xrPicRow = New XRTableRow
                Dim recipeImg As String = G_strPhotoPath & arrPicture(intDPic - 1).ToString

                xrPicTable.Location = New Point(0, intNewY)
                xrPicTable.Width = CInt(intPicWidth)

                xrPicCell1 = New XRTableCell

                Dim xrPicBox As New XRPictureBox
                xrPicRow.Width = CInt(intPicWidth)
                With xrPicCell1
                    '.Size = New System.Drawing.Size(CInt(intPicWidth), CInt(intPicHeight))
                    .Width = CInt(intPicWidth)
                    If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                        .Borders = DevExpress.XtraPrinting.BorderSide.All
                        .BorderWidth = 1
                        xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 10), CInt(intPicHeight - 10))
                        xrPicBox.Location = New Point(5, 4)
                        xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                        xrPicBox.Sizing = ImageSizeMode.ZoomImage
                        xrPicCell1.Controls.Add(xrPicBox)
                    Else
                        .Borders = DevExpress.XtraPrinting.BorderSide.None
                        .BorderWidth = 0
                    End If
                End With
                xrPicRow.Cells.Add(xrPicCell1)
                xrPicTable.Rows.Add(xrPicRow)
                .Detail.Controls.Add(xrPicTable)
            End If

            '---------------------------------------------------------------------------
            'Menu Info
            '---------------------------------------------------------------------------

            Dim xrMenuInfoTbl As New XRTable
            Dim xrMenuInfoRow As New XRTableRow
            Dim xrMenuInfoCell1 As New XRTableCell
            Dim xrMenuInfoCell2 As New XRTableCell
            Dim strPortionUnit As String = fctGetTranslatedText(row, "YieldName", "YieldNameTrans", G_ReportOptions.intTranslation)

            xrMenuInfoTbl.Width = CInt(intAvailableWidth - CInt(xrPicTable.Width + 10))

            If G_ReportOptions.blnPicturesAll Then
                xrMenuInfoTbl.Location = New Point(0, intNewY)
            ElseIf G_ReportOptions.blnPictureOneRight Then
                xrMenuInfoTbl.Location = New Point(0, intNewY)
                xrMenuInfoTbl.Width = CInt(intAvailableWidth - (xrPicTable.Width + 10))
            Else
                xrMenuInfoTbl.Location = New Point(intNewX + CInt(xrPicTable.Width + 10), intNewY)
            End If

            ' Menu Number
            If G_ReportOptions.blnIncludeNumber Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                strX = cLang.GetString(clsEGSLanguage.CodeType.Menu_No)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With
                strX = fctSqlReady(row("Number").ToString)
                strX = Replace(strX, Chr(1), "")
                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)
            End If

            ' Menu Category
            If G_ReportOptions.blnIncludeCategory Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                strX = cLang.GetString(clsEGSLanguage.CodeType.Category)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With
                strX = fctGetTranslatedText(row, "CategoryName", "CategoryNameTrans", G_ReportOptions.intTranslation)
                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            End If

            ' RDC 08.08.2013 : Hide Source information for menu
            'Source
            'If G_ReportOptions.blnIncludeSource Then
            '    xrMenuInfoRow = New XRTableRow
            '    xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
            '    xrMenuInfoCell1 = New XRTableCell
            '    xrMenuInfoCell2 = New XRTableCell

            '    strX = cLang.GetString(clsEGSLanguage.CodeType.Source)
            '    With xrMenuInfoCell1
            '        .Width = CInt(100)
            '        .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            '        .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '        .Text = strX
            '    End With
            '    strX = fctGetTranslatedText(row, "Chef", "ChefTrans", G_ReportOptions.intTranslation)
            '    With xrMenuInfoCell2
            '        .Width = CInt(xrMenuInfoTbl.Width - 100)
            '        .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            '        .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
            '        .Text = ": " & strX
            '    End With
            '    xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
            '    xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            'End If

            'Date
            If G_ReportOptions.blnIncludeDate Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                strX = cLang.GetString(clsEGSLanguage.CodeType.Date_)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With
                'strX = fctConvertDate(row("Dates") & "")
                strX = DirectCast(row("Dates"), DateTime).ToShortDateString
                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            End If

            'Cost Of Goods
            If G_ReportOptions.blnIncludeCostOfGoods Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                Dim strPriceFormat As String = CType(row("curFormat"), String)

                strX = cLang.GetString(clsEGSLanguage.CodeType.CostOfGoods)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With

                Dim dblCalcPrice As Double = 0
                dblCalcPrice = (CType(row("calcprice"), Double) / CType(row("originalyield"), Double)) * CType(row("Yield"), Double)
                'strX = Trim(fctNullToString(row("Currency"))) & " " & Format(fctNullToZero(row("calcprice")), G_strPriceFormat) & " /" & strPortionUnit
                strX = Trim(fctNullToString(row("Currency"))) & " " & Format(dblCalcPrice, strPriceFormat) & " /" & CType(row("Yield"), Double) & " " & strPortionUnit

                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            End If

            'Remark
            If G_ReportOptions.blnIncludeRemark Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                strX = cLang.GetString(clsEGSLanguage.CodeType.Remark)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With
                strX = fctGetTranslatedText(row, "Remark", "Remark1Trans", G_ReportOptions.intTranslation)
                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            End If

            ' Description
            If G_ReportOptions.blnIncludeDescription Then
                xrMenuInfoRow = New XRTableRow
                xrMenuInfoRow.Height = G_ReportOptions.sgFontSize2
                xrMenuInfoCell1 = New XRTableCell
                xrMenuInfoCell2 = New XRTableCell

                strX = cLang.GetString(clsEGSLanguage.CodeType.Description)
                With xrMenuInfoCell1
                    .Width = CInt(100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = strX
                End With
                strX = row("Description").ToString
                With xrMenuInfoCell2
                    .Width = CInt(xrMenuInfoTbl.Width - 100)
                    .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    .Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                    .Text = ": " & strX
                End With
                xrMenuInfoRow.Cells.AddRange({xrMenuInfoCell1, xrMenuInfoCell2})
                xrMenuInfoTbl.Rows.Add(xrMenuInfoRow)

            End If

            .Detail.Controls.Add(xrMenuInfoTbl)
            intNewY += (xrMenuInfoTbl.Height + 20)

            '---------------------------------------------------------------------------
            'Menu Items Servings
            '---------------------------------------------------------------------------
            G_Options.RemoveTrailingZero = True
            If strStyle = "003" Then
                If blflagPixOK Then
                    intAvailableWidth /= 2
                    intNewX = intAvailableWidth
                End If
            End If

            Dim strYieldFormat As String = row("YieldFormat").ToString
            Dim dblPortionValue As Double = row("Yield").ToString

            Dim strPortionUnit2 As String = strPortionUnit
            If dblPortionValue > 1 Then
                strPortionUnit2 = fctPluralPortionText(strPortionUnit2)
            End If

            Dim dblYieldQtyOrig As Double = CType(row("YieldOriginalFactor"), Double)
            Dim strYieldUnitNameOrig As String = fctGetTranslatedText(row, "YieldUnitOriginalName", "YieldUnitOriginalNameTrans", G_ReportOptions.intTranslation) 'CType(row("YieldUnitOriginalName"), String) 
            Dim intYieldUnit As Integer = CType(row("YieldUnit1"), Integer)
            Dim intYieldUnitOriginal As Integer = CType(row("YieldUnitOriginalCode"), Integer)

            Dim strNumberOfServings As String
            If G_Options.QtyType = 0 Then
                If (dblPortionValue <> dblYieldQtyOrig) Or (intYieldUnit <> intYieldUnitOriginal) Then 'VRP 15.01.2009
                    strNumberOfServings = fctFormatNumericQuantity(dblPortionValue, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strPortionUnit2
                    strNumberOfServings &= "/" & fctFormatNumericQuantity(dblYieldQtyOrig, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strYieldUnitNameOrig
                Else
                    strNumberOfServings = fctFormatNumericQuantity(dblPortionValue, strYieldFormat, G_Options.RemoveTrailingZero) & " " & strPortionUnit2
                End If
            Else
                If (dblPortionValue <> dblYieldQtyOrig) Or (strPortionUnit2 <> strYieldUnitNameOrig) Then 'VRP 15.01.2009
                    strNumberOfServings = fctConvertToFraction(dblPortionValue) & " " & Trim(UCase(strPortionUnit2))
                    strNumberOfServings &= "/" & fctConvertToFraction(dblYieldQtyOrig) & " " & strYieldUnitNameOrig
                Else
                    strNumberOfServings = fctConvertToFraction(dblPortionValue) & " " & Trim(UCase(strPortionUnit2))

                End If
            End If

            strX = Replace(cLang.GetString(clsEGSLanguage.CodeType.ItemsForyNetQuantity), "%y", strNumberOfServings)   '"Items for " & strNumberOfServings & " (Net Quantity)" '
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height

            Dim xrServingTbl As New XRTable
            xrServingTbl.Location = New Point(intNewX, intNewY)
            xrServingTbl.Width = intAvailableWidth
            xrServingTbl = fctMakeSectionHeader(strX, intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
            .Detail.Controls.Add(xrServingTbl)
            intNewY += (xrServingTbl.Height + 10)

            '---------------------------------------------------------------------------
            'Menu Items
            '---------------------------------------------------------------------------

            Dim IngrFontStyle As FontStyle
            Dim xrIngrTable As New XRTable
            Dim xrIngrRow As New XRTableRow
            Dim xrIngCell_ItemNo As New XRTableCell
            Dim xrIngCell_ItemName As New XRTableCell
            Dim xrIngCell_ItemQty As New XRTableCell
            Dim xrIngCell_ItemUnit As New XRTableCell
            Dim xrIngCell_ItemPrep As New XRTableCell

            xrIngrTable.Location = New Point(intNewX, intNewY)
            xrIngrTable.Width = intAvailableWidth


            Dim xrIngTable As New XRTable
            Dim xrIngTableNew As New XRTable
            Dim xrIngRow As New XRTableRow
            Dim xrIngCell As New XRTableCell
            Dim xrIngCellNew As New XRTableCell
            Dim xrIngRowHeader As New XRTableRow
            Dim xrIngRow1 As New XRTableRow
            Dim xrIngCell1 As New XRTableCell
            Dim strYieldName As String

            xrIngTable = New XRTable
            xrIngTable.Location = New Point(intNewX, intNewY - 50) 'LLG 05.16.2016 for lepause issue
            If strStyle = "003" Then
                xrIngTable.Width = intAvailableWidth - (dblMaxHeightPicture - 150)
            Else
                xrIngTable.Width = intAvailableWidth
            End If
            ' Ingredient Header 
            'anm 1-4-2016
            If G_ReportOptions.blnIncludeHighlightSection Then
                xrIngTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xrIngTable.BorderWidth = 1
                xrIngTable.BorderColor = Color.Black
                xrIngTable.BackColor = Color.LightGray
            Else
                xrIngTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                xrIngTable.BorderWidth = 1
                xrIngTable.BorderColor = Color.Black
                xrIngTable.BackColor = Color.White
            End If

            ' RDC 07.30.2013 : Added condition for useMakes support
            Dim dblYldQty As Double = CDbl(row("Yield"))
            'Dim strRecipeYield As String = Format(dblYldQty, "###0.0#") & " " & strYieldName.Trim
            Dim strServingHeader As String = ""





            xrIngTable = New XRTable
            xrIngTable.Location = New Point(intNewX, intNewY)
            If Not strStyle = "003" Then xrIngTable.Width = intAvailableWidth Else xrIngTable.Width = CInt(intAvailableWidth - CInt((dblMaxHeightPicture - 150) + 30))
            xrIngTable.BorderWidth = 1

            'AGL 2013.05.16
            xrIngTable.CanShrink = True
            xrIngTable.CanGrow = True

            Dim dvIng As New DataView(dtIngredients)
            dvIng.Sort = "step asc"
            'dvIng.RowFilter = "CodeMain=" & intRecipeCode
            dvIng.RowFilter = "CodeMain=" & intRecipeCode & IIf(IntRecipeParentCode = 0, " AND CodeListeParent IS NULL", " AND CodeListeParent=" & IntRecipeParentCode) 'MKAM 2015.07.02



            'AGL 2013.05.17
            Dim strUnit As String = ""

            ' RDC 11.28.2013 : Column resizing 
            Dim intExcessSpace As Integer = intAvailableWidth
            Dim intQtyWidth As Integer = 30
            Dim intUnitWidth As Integer = 20
            Dim intItemWidth As Integer = 0
            Dim intItemNumWidth As Integer = 45
            Dim intWastageWidth As Integer = 30

            ' Dim xlic1 As New EgswKey.clsLicense

            Dim xrIngAutoGrillCell = New XRTableCell  'KMQDC 8.3.2015 This is for adjusting column on print details


            If G_ReportOptions.blnUseMetricImperial Then
                Dim intFieldsToDisplay As Integer = 0

                With G_ReportOptions
                    If .blnIncludeMetricQtyNet Then intFieldsToDisplay += 1
                    If .blnIncludeMetricQtyGross Then intFieldsToDisplay += 1
                    If .blnIncludeImperialQtyNet Then intFieldsToDisplay += 1
                    If .blnIncludeImperialQtyGross Then intFieldsToDisplay += 1
                End With

                Select Case intFieldsToDisplay
                    Case 1
                        intUnitWidth = 180
                    Case 2
                        intUnitWidth = 150
                    Case 3
                        intUnitWidth = 80
                    Case 4
                        intUnitWidth = 60
                    Case Else
                        intUnitWidth = 40
                End Select

                If G_ReportOptions.blnIncludeIngrNumber Then
                    intExcessSpace -= intItemNumWidth
                End If

                If G_ReportOptions.blnIncludeWastage Then
                    intExcessSpace -= intWastageWidth
                End If

                intExcessSpace -= ((intQtyWidth + intUnitWidth) * intFieldsToDisplay)

            Else
                Dim intFieldsToDisplay As Integer = 0
                With G_ReportOptions
                    If .blnIncludeGrossQty Then intFieldsToDisplay += 1
                    If .blnIncludeNetQty Then intFieldsToDisplay += 1
                End With

                Select Case intFieldsToDisplay
                    Case 1
                        intUnitWidth = 70 '180 'SM 20150706 changed the value of unit width
                    Case 2
                        intUnitWidth = 150
                    Case 0

                End Select

                If G_ReportOptions.blnIncludeIngrNumber Then
                    intExcessSpace -= intItemNumWidth
                End If

                If G_ReportOptions.blnIncludeWastage Then
                    intExcessSpace -= intWastageWidth
                End If

                intExcessSpace -= ((intQtyWidth + intUnitWidth) * intFieldsToDisplay)

            End If

            ' RDC 08.16.2013 : Only ingredient have to be in bold style fonts
            'Dim xlic As New EgswKey.clsLicense

            Dim first As Integer = 0


            Dim newdvIng As New DataView(dtIngredients)

            newdvIng.Sort = "step asc"
            newdvIng.RowFilter = "CodeMain=" & intRecipeCode & IIf(IntRecipeParentCode = 0, " AND CodeListeParent IS NULL", " AND CodeListeParent=" & IntRecipeParentCode) 'MKAM 2015.07.02


            Dim NewDtTable As New DataTable
            NewDtTable = newdvIng.ToTable()
            Dim Temp As New DataTable
            If NewDtTable IsNot Nothing AndAlso NewDtTable.Rows.Count > 0 Then
                'some code
                Temp = NewDtTable.AsEnumerable().Take(1).CopyToDataTable()
                Temp.Merge(NewDtTable)
            Else
                'some code

            End If

            Dim newdvIng2 As New DataView(Temp)
            For Each RwVw As DataRowView In newdvIng2

                first += 1
                xrIngRow = New XRTableRow
                xrIngRow.Height = G_ReportOptions.sgFontSize2
                xrIngAutoGrillCell = New XRTableCell  'KMQDC 8.3.2015 This is for adjusting column on print details
                intQtyWidth = 40 'KMQDC 8.3.2015
                intUnitWidth = 20 'KMQDC 8.3.2015
                intItemNumWidth = 45 'KMQDC 8.3.2015

                If RwVw("itemType") = 75 And RwVw("itemqty") = 0 Then
                    xrIngRow = fctMakeDataRow({RwVw("itemName").ToString.Trim, RwVw("Procedure").ToString.Trim}, {60, CInt(intAvailableWidth) - 60}, {TextAlignment.TopLeft, TextAlignment.TopLeft}, , FontStyle.Bold)
                    xrIngRow.Height += 5
                Else

                    ' RDC 01.10.2014 : Display unvalidated quantities
                    Dim strImpUnvalidatedQty As String = "", strImpUnvalidatedUnit As String = ""
                    Dim strMetUnvalidatedQty As String = "", strMetUnvalidatedUnit As String = ""
                    Dim dtUnvalidated As New DataTable

                    If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                        dtUnvalidated = getUnavalidatedQuantity(RwVw("tmpqty"), RwVw("tmpunit").ToString, CIntDB(CodeSiteCO(row)), CIntDB(row("Codetrans")))
                        If Not dtUnvalidated Is Nothing Or Not dtUnvalidated.Rows.Count = 0 Then
                            For Each dr As DataRow In dtUnvalidated.Rows
                                strImpUnvalidatedQty = dr("QtyImperial")
                                strImpUnvalidatedUnit = dr("UnitImperial")
                                strMetUnvalidatedQty = dr("QtyMetric")
                                strMetUnvalidatedUnit = dr("UnitMetric")
                            Next
                        End If
                    End If


                    If G_ReportOptions.blnUseMetricImperial Then
                        ' Metric Gross/Net and Imperial Gross/Net

                        If G_ReportOptions.blnIncludeImperialQtyNet Then
                            ' Imperial Quantity Net
                            Dim strImpNetQty As String = ""
                            'Dim dblImpNetQty As Double = CDbl(RwVw("netquantity"))
                            Dim dblImpNetQty As Double = CDbl(RwVw("itemImperialqty"))

                            ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                            If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then ''AMTLA 2014.06.19 change "or" to "and" CWM-14648
                                If Not strImpUnvalidatedQty Is Nothing And Not strImpUnvalidatedQty = "" Then
                                    strImpNetQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                End If
                                strUnit = strImpUnvalidatedUnit
                            Else
                                'strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                    strImpNetQty = fctFormatNumericQuantity(dblImpNetQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strImpNetQty = fctConvertToFraction(CDbl(strImpNetQty))
                                    Else
                                        strImpNetQty = CDbl(strImpNetQty)
                                    End If

                                    strUnit = RwVw("itemimperialunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strImpNetQty = ""
                                    Else
                                        strImpNetQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If
                            End If



                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intQtyWidth

                            ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                            'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                            'If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Or strUnit.Trim = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                            If strImpNetQty Is Nothing Or strImpNetQty = "0" Or strUnit.Trim = "" Or strUnit.Trim Is Nothing Then xrIngCell.Text = "" Else xrIngCell.Text = strImpNetQty
                            xrIngRow.Cells.Add(xrIngCell)

                            ' Imperial Unit
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intUnitWidth
                            ' RDC 05.23.2013 - Fix for Bug CWM-6115
                            If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strImpNetQty Is Nothing Or strImpNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                            xrIngRow.Cells.Add(xrIngCell)

                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 110
                        End If

                        If G_ReportOptions.blnIncludeImperialQtyGross Then
                            Dim strImpGrossQty As String = ""

                            'Dim dblImpGrossQty As Double = CDbl(RwVw("grossquantity"))
                            Dim dblImpGrossQty As Double = CDbl(RwVw("grossImperialQuantity"))

                            ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                            If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                If Not strImpUnvalidatedQty Is Nothing Or Not strImpUnvalidatedQty = "" Then
                                    strImpGrossQty = fctConvertToFraction(CDbl(strImpUnvalidatedQty))
                                End If
                                strUnit = strImpUnvalidatedUnit
                            Else
                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                If RwVw("itemcode").ToString > 0 And RwVw("itemimperialunit").ToString.Trim <> "" Then
                                    strImpGrossQty = fctFormatNumericQuantity(dblImpGrossQty, RwVw("itemImperialFormat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    If G_ReportOptions.blnUseFractions Then
                                        strImpGrossQty = fctConvertToFraction(CDbl(strImpGrossQty))
                                    Else
                                        strImpGrossQty = CDbl(strImpGrossQty)
                                    End If

                                    strUnit = RwVw("itemimperialunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strImpGrossQty = ""
                                    Else
                                        strImpGrossQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If
                            End If



                            ' Imperial Quantity Gross
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intQtyWidth
                            ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                            'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                            'If strImpGrossQty Is Nothing Or strImpGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpGrossQty
                            If strImpGrossQty Is Nothing Or strImpGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strImpGrossQty
                            xrIngRow.Cells.Add(xrIngCell)

                            ' Imperial Unit
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intUnitWidth
                            ' RDC 05.23.2013 - Fix for Bug CWM-6115
                            If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim.ToUpper = "[_]" Or strImpGrossQty Is Nothing Or strImpGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                            xrIngRow.Cells.Add(xrIngCell)
                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 110
                        End If

                        If G_ReportOptions.blnIncludeMetricQtyNet Then
                            ' Metric Quantity Net
                            Dim strMetNetQty As String = ""
                            'Dim dblMetNetQty As Double = CDbl(RwVw("netquantity"))     ' RDC 09.03.2013 : Removed wrong output rendered
                            Dim dblMetNetQty As Double = CDbl(RwVw("ItemMetricQty"))    ' RDC 09.03.2013 : Correction

                            ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                            If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                    strMetNetQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                End If
                                strUnit = strMetUnvalidatedUnit
                            Else
                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                    strMetNetQty = fctFormatNumericQuantity(dblMetNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    ' RDC 01.07.2014 :Bug CWM-10704 : The Metric Quantity should NOT be converted into Fraction format
                                    ' RDC 01.07.2014 : (Revert) If G_ReportOptions.blnUseFractions Or xlic.l_App = EgswKey.clsLicense.enumApp.RB Then to If G_ReportOptions.blnUseFractions Then
                                    ' RDC 01.07.2014 : Quantity convertion to fraction is not applicable to Metric Quantities as per QA
                                    'If G_ReportOptions.blnUseFractions Then
                                    '    strMetNetQty = fctConvertToFraction(CDbl(strMetNetQty))
                                    'Else
                                    '    strMetNetQty = CDbl(strMetNetQty)
                                    'End If

                                    strMetNetQty = CDbl(strMetNetQty)

                                    strUnit = RwVw("itemmetricunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strMetNetQty = ""
                                    Else
                                        strMetNetQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If
                            End If

                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intQtyWidth
                            ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                            'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                            'If strMetNetQty Is Nothing Or strMetNetQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = "" Else xrIngCell.Text = strMetNetQty
                            If strMetNetQty Is Nothing Or strMetNetQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = "" Else xrIngCell.Text = strMetNetQty
                            xrIngRow.Cells.Add(xrIngCell)
                            ' Metric Unit
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intUnitWidth

                            ' RDC 05.23.2013 - Fix for Bug CWM-6115
                            If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetNetQty Is Nothing Or strMetNetQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                            xrIngRow.Cells.Add(xrIngCell)
                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 110
                        End If

                        If G_ReportOptions.blnIncludeMetricQtyGross Then
                            ' Metric Quantity Gross
                            Dim strMetGrossQty As String = ""
                            Dim dblMetGrossQty As Double = CDbl(RwVw("grossMetricQuantity"))     ' RDC 09.03.2013 : Wrong output rendered.
                            'Dim dblMetGrossQty As Double = CDblDB(RwVw("itemMetricQty"))

                            ' RDC 01.10.2014 : Added condition for displaying unvalidated quantity/ies
                            If CIntDB(RwVw("ItemCode")) = 0 And CIntDB(RwVw("ItemType")) = 0 Then
                                If Not strMetUnvalidatedQty Is Nothing Or Not strMetUnvalidatedQty = "" Then
                                    strMetGrossQty = Format(CDblDB(strMetUnvalidatedQty), "##0.0#")
                                End If
                                strUnit = strMetUnvalidatedUnit
                            Else
                                'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                                If RwVw("itemcode").ToString > 0 And RwVw("itemmetricunit").ToString.Trim <> "" Then
                                    strMetGrossQty = fctFormatNumericQuantity(dblMetGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    ' RDC 01.07.2014 :Bug CWM-10704 : The Metric Quantity should NOT be converted into Fraction format
                                    ' RDC 01.07.2014 : (Revert) If G_ReportOptions.blnUseFractions Or xlic.l_App = EgswKey.clsLicense.enumApp.RB Then to If G_ReportOptions.blnUseFractions Then
                                    ' RDC 01.07.2014 : Quantity convertion to fraction is not applicable to Metric Quantities as per QA
                                    'If G_ReportOptions.blnUseFractions Then
                                    '    strMetGrossQty = fctConvertToFraction(CDbl(strMetGrossQty))
                                    'Else
                                    '    strMetGrossQty = CDbl(strMetGrossQty)
                                    'End If

                                    strMetGrossQty = CDbl(strMetGrossQty)

                                    strUnit = RwVw("itemmetricunit").ToString.Trim
                                Else
                                    If RwVw("tmpqty").ToString <= "0" Then
                                        strMetGrossQty = ""
                                    Else
                                        strMetGrossQty = RwVw("tmpqty").ToString
                                    End If
                                    strUnit = RwVw("tmpunit").ToString.Trim
                                End If
                            End If

                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intQtyWidth
                            ' RDC 09.03.2013 : Do not display if quantity is equal to zero (0)
                            'JTOC 07.25.2014 Removed Or strUnit.Trim = "[_]" as per Sir Rommel's Email
                            'If strMetGrossQty Is Nothing Or strMetGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "[_]" Then xrIngCell.Text = " " Else xrIngCell.Text = strMetGrossQty
                            If strMetGrossQty Is Nothing Or strMetGrossQty = "0" Or strUnit.Trim Is Nothing Or strUnit.Trim = "" Then xrIngCell.Text = " " Else xrIngCell.Text = strMetGrossQty
                            xrIngRow.Cells.Add(xrIngCell)
                            ' Metric Unit
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intUnitWidth
                            ' RDC 05.23.2013 - Fix for Bug CWM-6115
                            If strUnit.Trim Is Nothing Or strUnit.Trim = "" Or strUnit.Trim.ToUpper = "N/A" Or strUnit.Trim = "[_]" Or strMetGrossQty Is Nothing Or strMetGrossQty = "0" Then xrIngCell.Text = "" Else xrIngCell.Text = strUnit.Trim
                            xrIngRow.Cells.Add(xrIngCell)
                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 110
                        End If

                    Else
                        'anm  

                        If G_ReportOptions.blnIncludeGrossQty Then
                            'Gross Qty

                            Dim strGrossQty As String = ""
                            Dim dblGrossQty As Double = CDbl(RwVw("grossquantity"))

                            'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode

                            If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                strGrossQty = fctFormatNumericQuantity(dblGrossQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                If G_ReportOptions.blnUseFractions Then
                                    strGrossQty = fctConvertToFraction(CDbl(strGrossQty))
                                Else
                                    strGrossQty = CDbl(strGrossQty)
                                End If
                                strUnit = RwVw("itemunit").ToString.Trim
                            Else
                                If RwVw("tmpqty").ToString <= "0" Then
                                    strGrossQty = ""
                                Else
                                    strGrossQty = RwVw("tmpqty").ToString
                                End If
                                strUnit = RwVw("tmpunit").ToString.Trim
                            End If

                            If CDblDB(strGrossQty) = 0 Then
                                strGrossQty = ""
                            End If



                            If first = 1 Then

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth + 25
                                xrIngCell.Text = cLang.GetString(132736) 'gross
                                xrIngRow.Cells.Add(xrIngCell)
                                'xrIngRow1.Cells.Add(xrIngCell1)

                            Else
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth + 25
                                xrIngCell.Text = strGrossQty + " " + strUnit
                                xrIngRow.Cells.Add(xrIngCell)
                            End If

                            ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                            'intExcessSpace -= 110
                        End If

                        If G_ReportOptions.blnIncludeNetQty Then
                            'Net Qty
                            Dim strNetQty As String = ""
                            Dim dblNetQty As Double = CDbl(RwVw("itemqty"))


                            'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode

                            If RwVw("itemcode").ToString > 0 And RwVw("itemunit").ToString.Trim <> "" Then
                                strNetQty = fctFormatNumericQuantity(dblNetQty, RwVw("itemformat").ToString, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                If G_ReportOptions.blnUseFractions Then
                                    strNetQty = fctConvertToFraction(CDbl(strNetQty))
                                Else
                                    strNetQty = CDbl(strNetQty) 'IIf(xlic.l_App = EgswKey.clsLicense.enumApp.Autogrill, strNetQty, CDbl(strNetQty)) 'SM 20150706 should depend on the unit format for autogrill
                                End If

                                strUnit = RwVw("itemunit").ToString.Trim
                            Else
                                If RwVw("tmpqty").ToString <= "0" Then
                                    strNetQty = ""
                                Else
                                    strNetQty = RwVw("tmpqty").ToString
                                End If
                                strUnit = RwVw("tmpunit").ToString.Trim
                            End If

                            If CDblDB(strNetQty) = 0 Then
                                strNetQty = ""
                            End If

                            If first = 1 Then

                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth + 20
                                xrIngCell.Text = cLang.GetString(132614) '"Net Qty"
                                xrIngRow.Cells.Add(xrIngCell)
                            Else
                                xrIngCell = New XRTableCell
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                xrIngCell.Width = intQtyWidth + 20
                                xrIngCell.Text = strNetQty + " " + strUnit
                                xrIngRow.Cells.Add(xrIngCell)
                            End If
                        End If
                    End If

                    ' Wastage
                    If G_ReportOptions.blnIncludeWastage Then
                        'AGL 2013.05.17 - display blank for qty for ingredients with no itemcode
                        Dim strWastage As String = ""
                        If RwVw("itemcode").ToString > 0 And Not RwVw("itemtype") = 4 Then
                            strWastage = RwVw("totalwastage").ToString & "%"
                        Else
                            strWastage = ""
                        End If

                        If first = 1 Then
                            'xrIngCellNew = New XRTableCell


                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intWastageWidth + 40
                            xrIngCell.Text = cLang.GetString(132974) + "%" '"waste"
                            xrIngRow.Cells.Add(xrIngCell)
                        Else

                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intWastageWidth + 40
                            xrIngCell.Text = strWastage 'RwVw("totalwastage").ToString & "%"
                            xrIngRow.Cells.Add(xrIngCell)
                        End If


                        'RDC 08.30.2013 : computing excess space that will add to Ingredient description
                        'intExcessSpace -= 30
                    End If

                    ' Ingredient Number
                    If G_ReportOptions.blnIncludeIngrNumber Then


                        If first = 1 Then

                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth + 15
                            xrIngCell.Text = cLang.GetString(5500) '"number"
                            xrIngRow.Cells.Add(xrIngCell)
                        Else
                            xrIngCell = New XRTableCell
                            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                            xrIngCell.Width = intItemNumWidth + 15
                            xrIngCell.Text = RwVw("itemnumber").ToString
                            xrIngRow.Cells.Add(xrIngCell)
                        End If
                        ' RDC 08.30.2013 : computing excess space that will add to Ingredient description
                        'intExcessSpace -= 63
                    End If


                    If first = 1 Then

                        'xrIngRowHeader.Cells.Add(xrIngCellNew)
                        xrIngCell = New XRTableCell
                        xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                        xrIngCell.Width = intItemNumWidth - 22
                        xrIngRow.Cells.Add(xrIngCell)

                    Else
                        xrIngCell = New XRTableCell
                        xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                        xrIngCell.Width = intItemNumWidth - 22
                        xrIngRow.Cells.Add(xrIngCell)
                    End If

                    ' Ingredient Name & Complement & Preparation & Alternative Ingredient
                    Dim strAltIngredient As String = RwVw("altIngredient").ToString.Trim
                    Dim strComple As String = RwVw("Complement").ToString.Trim
                    Dim strPrep As String = RwVw("Preparation").ToString.Trim
                    Dim strIngr As String = "" 'RwVw("itemname").ToString


                    'PLGL 09/23/2016 - COMPLEMENT POSITION
                    Dim cConfig As New clsConfig(enumAppType.WebApp, strCnn)
                    Dim intCodeSite = CType(row("CodeSite"), Integer)
                    Dim complementAfterIngredient = CBool(cConfig.GetConfig(intCodeSite, clsConfig.enumNumeros.ComplementAfterIngredient, -3, False))

                    'CIntDB(CodeSiteCO(row))

                    If complementAfterIngredient = True Then
                        Dim x As New RichTextBox
                        Dim a As New XRRichText
                        Dim b As New XRRichText

                        x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strAltIngredient
                        If CBool(RwVw("isBrandedIngredient")) Then
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        Else
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        End If
                        x.SelectedText = " " + RwVw("itemname").ToString 'Ingredients Name
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strPrep
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strComple
                        a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        a.Width = intExcessSpace - 5
                        a.Rtf = x.Rtf
                        b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        b.Width = intExcessSpace - 5
                        b.Rtf = x.Rtf
                        If first = 1 Then
                            xrIngCell = New XRTableCell
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            b.Text = cLang.GetString(5590) 'Ingredients
                            b.Width = intExcessSpace + 20 'LLG2016
                            b.Borders = DevExpress.XtraPrinting.BorderSide.None
                            'xrIngCellNew.Controls.Add(b)
                            'xrIngRowHeader.Cells.Add(xrIngCellNew)
                            xrIngCell.Width = intExcessSpace - 5
                            xrIngCell.Controls.Add(b)
                            xrIngRow.Cells.Add(xrIngCell)
                        Else
                            ' RDC 08.14.2013 : Remove comma in complement.
                            If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                            If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = ", " & strPrep.Trim Else strPrep = ""
                            'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLang.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = ""
                            'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLangTrans.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = "" 'MKAM 2015.04.16
                            strIngr = RwVw("itemname").ToString & strAltIngredient & strPrep & " " & strComple
                            a.Text = strIngr
                            xrIngCell = New XRTableCell
                            xrIngAutoGrillCell = New XRTableCell
                            If RwVw("itemType") = 8 Then
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                            Else
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                            End If
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intExcessSpace - 5

                            ' End If
                            xrIngCell.Controls.Add(a)
                            xrIngRow.Cells.Add(xrIngCell)
                        End If
                        ' End If
                    Else
                        Dim x As New RichTextBox
                        x.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strComple
                        If CBool(RwVw("isBrandedIngredient")) Then
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        Else
                            x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        End If
                        x.SelectedText = RwVw("itemname").ToString 'Ingredients Name
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strAltIngredient
                        x.SelectionFont = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        x.SelectedText = strPrep

                        Dim a As New XRRichText
                        a.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        a.Width = intExcessSpace - 5
                        a.Rtf = x.Rtf

                        Dim b As New XRRichText
                        b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                        b.Width = intExcessSpace - 5
                        b.Rtf = x.Rtf

                        'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                        '    'xrIngAutoGrillCell.Controls.Add(a)
                        '    'xrIngRow.Cells.Add(xrIngAutoGrillCell)
                        '    If first = 1 Then
                        '        xrIngCellNew = New XRTableCell
                        '        b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        '        b.Text = " " + cLang.GetString(5590) 'Ingredients
                        '        b.Borders = DevExpress.XtraPrinting.BorderSide.None
                        '        'xrIngCellNew.Controls.Add(b)
                        '        'xrIngRowHeader.Cells.Add(xrIngCellNew)
                        '        xrIngCell.Width = intExcessSpace - 5
                        '        xrIngAutoGrillCell.Controls.Add(b)
                        '        xrIngRow.Cells.Add(xrIngAutoGrillCell)
                        '    Else
                        '        ' RDC 08.14.2013 : Remove comma in complement.
                        '        If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                        '        If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = ", " & strPrep.Trim Else strPrep = ""
                        '        'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLang.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = ""
                        '        'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLangTrans.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = "" 'MKAM 2015.04.16
                        '        strIngr = RwVw("itemname").ToString & strAltIngredient & strPrep & " " & strComple

                        '        xrIngCell = New XRTableCell
                        '        xrIngAutoGrillCell = New XRTableCell
                        '        If RwVw("itemType") = 8 Then
                        '            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                        '            xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                        '        Else
                        '            xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                        '            xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                        '        End If
                        '        ' RDC 07.29.2013 : Make ingredient font to bold when ingredient is a branded ingredient.
                        '        'If CBool(RwVw("isBrandedIngredient")) Then xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        '        If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                        '            xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        '            xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                        '            If G_ReportOptions.blnIncludeIngrNumber Then
                        '                xrIngAutoGrillCell.Width = 210
                        '            Else
                        '                xrIngAutoGrillCell.Width = 300
                        '            End If

                        '        Else
                        '            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                        '            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                        '            xrIngCell.Width = intExcessSpace - 5

                        '        End If
                        '        xrIngAutoGrillCell.Controls.Add(a)
                        '        xrIngRow.Cells.Add(xrIngAutoGrillCell)
                        '    End If
                        'Else
                        'xrIngCell.Controls.Add(a)
                        'xrIngRow.Cells.Add(xrIngCell)
                        If first = 1 Then
                            xrIngCell = New XRTableCell
                            b.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            b.Text = cLang.GetString(5590) 'Ingredients
                            b.Width = intExcessSpace + 20 'LLG2016
                            b.Borders = DevExpress.XtraPrinting.BorderSide.None
                            'xrIngCellNew.Controls.Add(b)
                            'xrIngRowHeader.Cells.Add(xrIngCellNew)]
                            xrIngCell.Width = intExcessSpace - 5
                            xrIngCell.Controls.Add(b)
                            xrIngRow.Cells.Add(xrIngCell)
                        Else
                            ' RDC 08.14.2013 : Remove comma in complement.
                            If G_ReportOptions.blnIncludeIngredientComplement And strComple.Trim.Length > 0 Then strComple = strComple.Trim & " " Else strComple = ""
                            If G_ReportOptions.blnIncludeIngredientPreparation And strPrep.Trim.Length > 0 Then strPrep = ", " & strPrep.Trim Else strPrep = ""
                            'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLang.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = ""
                            'If G_ReportOptions.blnIncludeAlternativeIngredient And strAltIngredient.Trim.Length > 0 Then strAltIngredient = " [" & cLangTrans.GetString(clsEGSLanguage.CodeType._Or) & " " & strAltIngredient.Trim & "]" Else strAltIngredient = "" 'MKAM 2015.04.16
                            strIngr = RwVw("itemname").ToString & strAltIngredient & strPrep & " " & strComple

                            xrIngCell = New XRTableCell
                            xrIngAutoGrillCell = New XRTableCell
                            If RwVw("itemType") = 8 Then
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                                ' xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                            Else
                                xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrIngAutoGrillCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Italic)
                            End If
                            ' RDC 07.29.2013 : Make ingredient font to bold when ingredient is a branded ingredient.
                            'If CBool(RwVw("isBrandedIngredient")) Then xrIngCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                            'If xlic1.l_App = EgswKey.clsLicense.enumApp.Autogrill Then
                            '    xrIngAutoGrillCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            '    xrIngAutoGrillCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            '    If G_ReportOptions.blnIncludeIngrNumber Then
                            '        xrIngAutoGrillCell.Width = 210
                            '    Else
                            '        xrIngAutoGrillCell.Width = 300
                            '    End If

                            'Else
                            xrIngCell.Borders = DevExpress.XtraPrinting.BorderSide.None
                            xrIngCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                            xrIngCell.Width = intExcessSpace - 5

                            'End If
                            xrIngCell.Controls.Add(a)
                            xrIngRow.Cells.Add(xrIngCell)
                            'End If
                        End If
                    End If

                End If
                If first = 1 Then
                    xrIngrTable.Rows.Add(xrIngRow)
                    'xrIngTable.Rows.Add(xrIngRow)
                Else
                    xrIngrTable.Rows.Add(xrIngRow)
                End If

            Next
            .Detail.Controls.Add(xrIngrTable)
            intNewY += (xrIngrTable.Height + 20)


            Dim xrStepTable As New XRTable
            Dim xrStepRow As New XRTableRow
            Dim xrStepCell As New XRTableCell
            Dim xrStepCellB As New XRTableCell

            xrStepTable.Location = New Point(intNewX, intNewY)
            xrStepTable.Width = intAvailableWidth
            xrStepTable.Borders = DevExpress.XtraPrinting.BorderSide.None
            If IsNothing(dtListePreparation) Then
            Else


                For Each drStep As DataRow In dtListePreparation
                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    If Not G_ReportOptions.blnMode Then
                        If Not IsDBNull(drStep("Note").ToString) Then rtb.AppendText(drStep("Note").ToString) Else rtb.AppendText(Chr(32))
                    Else
                        If Not IsDBNull(drStep("CookMode").ToString) Then rtb.AppendText(drStep("CookMode").ToString) Else rtb.AppendText(Chr(32))
                    End If

                    xrt.Rtf = rtb.Rtf

                    xrStepRow = New XRTableRow
                    xrStepRow.Height = G_ReportOptions.sgFontSize2

                    If G_ReportOptions.blnIncludePreparation Then 'KMQDC 2016.10.17 Fix to hide/show preparation on standard printout
                        Select Case row("MethodFormat").ToString.Trim.ToLower
                            Case "x", "" ' Not bulleted / numbered
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth
                                rtb.Width = intAvailableWidth
                                xrt.Width = intAvailableWidth
                                'xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                'xrStepRow.Cells.Add(xrStepCell)
                                Dim onceCount As Integer = 0
                                'anm
                                ' Dim currentHeight As New Integer
                                '  currentHeight = intNewY
                                Dim x As Integer = rtb.Lines.Count
                                Dim countTo3 As Integer = 0
                                Dim addToName As Integer = 0
                                Dim curY = intNewY + 10
                                Dim newLoop As Boolean = False
                                Dim rtbNew As New RichTextBox

                                'Dim aslow As String = rtbNew.Rtf.ToString()
                                Dim xrts As New XRRichText
                                Dim xrNewStepTable As New XRTable
                                Dim textLeftCount As Integer = rtb.Lines.Count Mod 3
                                Dim lineCountLeft As Integer = rtb.Lines.Count - textLeftCount
                                Dim LineCounter As Integer
                                For Each Line As String In rtb.Lines
                                    countTo3 += 1
                                    LineCounter += 1
                                    Using rtbNew
                                        If Line = "" Then
                                            rtbNew.AppendText(Environment.NewLine)
                                        Else
                                            If countTo3 = 1 Then
                                                rtbNew.AppendText(Line)
                                            Else
                                                rtbNew.AppendText(Line + Environment.NewLine)
                                            End If
                                        End If
                                        xrts.Rtf = rtbNew.Rtf
                                    End Using

                                    If countTo3 = 1 Then
                                        countTo3 = 0
                                        xrts.Width = intAvailableWidth
                                        xrts.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                                        xrts.CanShrink = True
                                        xrts.Borders = DevExpress.XtraPrinting.BorderSide.None
                                        xrts.KeepTogether = True
                                        xrts.Location = New Point(intNewX, curY)
                                        .Detail.Controls.AddRange(New XRControl() {xrts})
                                        curY += (xrts.Height)
                                        rtbNew = New RichTextBox
                                        xrts = New XRRichText
                                        xrNewStepTable = New XRTable
                                    End If
                                Next
                                intNewY = curY

                            Case "n" ' Number bullet
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
                                If G_ReportOptions.blnIncludeProcSequenceNo Then
                                    xrStepCell.Text = drStep("Position") & "."
                                End If
                                xrStepRow.Cells.Add(xrStepCell)

                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopJustify
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                xrStepRow.Cells.Add(xrStepCell)
                                xrStepTable.Rows.Add(xrStepRow)
                                .Detail.Controls.Add(xrStepTable)
                                intNewY += (xrStepTable.Height + 20)
                            Case "b" ' Symbol bullet "•"
                                xrStepCell = New XRTableCell
                                xrStepCell.Width = 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                If G_ReportOptions.blnIncludeProcSequenceNo Then
                                    xrStepCell.Text = "•"
                                End If
                                xrStepRow.Cells.Add(xrStepCell)

                                xrStepCell = New XRTableCell
                                xrStepCell.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                rtb.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrt.Width = intAvailableWidth - 40 'AGL 2014.10.14 - changed to 40, from 15
                                xrStepCell.Controls.Add(xrt)
                                ' RDC 12.10.2013 : Removed and replaced with RichTexbox and XrRichText Control
                                'xrStepCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                'xrStepCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
                                'If Not G_ReportOptions.blnMode Then xrStepCell.Text = drStep("Note").ToString Else xrStepCell.Text = drStep("Cookmode").ToString
                                xrStepRow.Cells.Add(xrStepCell)
                                xrStepTable.Rows.Add(xrStepRow)
                                .Detail.Controls.Add(xrStepTable)
                                intNewY += (xrStepTable.Height + 20)
                        End Select
                        'xrStepTable.Rows.Add(xrStepRow) 'anm
                    End If
                Next

            End If
            intNewX = 0

            Dim strServeWithNotes As String = Nothing
            Dim strFootnote1 As String = Nothing
            Dim strFootnote2 As String = Nothing
            If IsNothing(G_ReportOptions.dtNotes) Then
                strServeWithNotes = ""
                strFootnote1 = ""
                strFootnote2 = ""
            Else
                For Each rwRecipeNotes As DataRow In G_ReportOptions.dtNotes.Select("Code=" & intRecipeCode)
                    strServeWithNotes = rwRecipeNotes("ServeWith").ToString.Trim
                    strFootnote1 = rwRecipeNotes("FootNote1").ToString.Trim
                    strFootnote2 = rwRecipeNotes("FootNote2").ToString.Trim
                Next
            End If


            Dim xrNotesTable As New XRTable
            Dim xrNotesRow As New XRTableRow
            Dim xrNotesCell As New XRTableCell

            If G_ReportOptions.blnIncludeServeWith Then
                ' Serve with
                If strServeWithNotes.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    'Using rtb
                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote2.Trim)
                    xrt.Rtf = rtb.Rtf
                    xrt.CanGrow = True
                    xrt.Height = CIntDB(rtb.Height) + CIntDB(50)
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.ServeWith).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)

                    xrNotesRow = New XRTableRow
                    xrNotesRow.CanGrow = True
                    'xrNotesRow = fctMakeDataRow({strServeWithNotes.Trim}, {intAvailableWidth}, {TextAlignment.TopJustify})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.CanGrow = True

                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)
                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                    'End Using
                End If
            End If

            If G_ReportOptions.blnIncludeNotes Then
                ' Notes
                If strFootnote1.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote1.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote1.Trim}, {intAvailableWidth}, {TextAlignment.TopLeft})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.CanGrow = True
                    xrNotes2Cell.WordWrap = True
                    xrNotes2Cell.CanShrink = True
                    xrNotes2Cell.Multiline = True
                    xrNotes2Cell.Size = New System.Drawing.Size(140.0F, 140.0F)
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)

                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                End If
            End If

            If G_ReportOptions.blnIncludeAddNotes Then
                ' Additional Notes
                If strFootnote2.Trim.Length > 0 Then

                    ' RDC 12.10.2013 : WYSIWYT (What You See Is What You Typed)
                    Dim rtb As New RichTextBox
                    rtb.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)

                    Dim xrt As New XRRichText
                    xrt.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2)
                    rtb.Width = intAvailableWidth
                    xrt.Width = intAvailableWidth
                    rtb.AppendText(strFootnote2.Trim)
                    xrt.Rtf = rtb.Rtf

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.AdditionalNotes).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    xrNotesTable = New XRTable
                    xrNotesTable.Width = intAvailableWidth
                    xrNotesTable.Location = New Point(intNewX, intNewY)
                    xrNotesRow = New XRTableRow
                    'xrNotesRow = fctMakeDataRow({strFootnote2.Trim.Replace(Chr(10), " ")}, {intAvailableWidth}, {TextAlignment.TopJustify})
                    Dim xrNotes2Cell As New XRTableCell
                    xrNotes2Cell.Width = xrNotesRow.Width
                    xrNotes2Cell.Height = 500
                    xrNotes2Cell.CanShrink = False
                    xrNotes2Cell.CanGrow = False
                    xrNotes2Cell.Controls.Add(xrt)
                    xrNotesRow.Cells.Add(xrNotes2Cell)
                    xrNotesTable.Rows.Add(xrNotesRow)
                    xrNotesTable.CanShrink = True
                    .Detail.Controls.Add(xrNotesTable)
                    intNewY += (xrNotesTable.Height + 20)
                End If
            End If
            '----------------------------------------------------------------------------
            'Nutrient
            '----------------------------------------------------------------------------

            If G_ReportOptions.blnIncludeNutrients Or G_ReportOptions.blnIncludeGDA Then
                dblNutrientFactor = GetNutrientFactor(CInt(row("Code")), strConnection:=G_strConnection)
            End If

            Dim intSelNutDisplay As NutrientDisplayOption = NutrientDisplayOption.Both
            Dim intSelCodeTrans As Integer = 0
            Dim intCodeSet As Integer = 0
            For Each drDispSet As DataRow In G_ReportOptions.dtProfile.Rows
                intSelNutDisplay = CInt(drDispSet("intNutrientDisplay"))
                intSelCodeTrans = CInt(drDispSet("codeTrans"))
                intCodeSet = CInt(drDispSet("CodeSet"))
            Next

            intNewY += 20

            ' RDC 08.14.2013 : Nutrients()
            If G_ReportOptions.blnIncludeNutrients Then
                ' Section Header
                Dim xrNutHeader As New XRTable
                xrNutHeader = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.NutritionalInfo), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)  'LLG 05.16.2016 for lepause issue
                .Detail.Controls.Add(xrNutHeader)

                intNewY += (xrNutHeader.Height + 10)

                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayNutrientComputation(CInt(row("Code")), strYieldName, intCodeSet, intSelCodeTrans, intSelNutDisplay, intCodeSetPrice, 1) ' CIntDB(row("RecipeVersion"))

                intNewY += 20  'LLG 05.16.2016 for lepause issue
            End If

            intNewX = 0
            If G_ReportOptions.blnIncludeGDA Then
                ' RDC 05.20.2013 - Remove due to not in use
                'If strStyle = "003" Then     'For Two Columns
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 10
                'End If
                'subDisplayNutrientsGDA(strYieldName, dblNutrientFactor, L_Nutrient, strStyle)
                Dim intCodeSetPrice As Integer = CIntDB(G_ReportOptions.dtProfile.Rows(0)("CodeSetPrice"))
                subDisplayGDAComputation(row("Code"), intCodeSet, intSelCodeTrans, intCodeSetPrice)
                intNewY = intNewY - 10
            End If
            'End
            '----------------------------------------------------------------------------
            'Note
            '----------------------------------------------------------------------------
            ' RDC 07.22.2013 : Add section header
            'If G_ReportOptions.blnIncludeNotes Then
            '    Dim xrNotesTbl As New XRTable
            '    xrNotesTbl = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Notes), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)
            '    .Detail.Controls.Add(xrNotesTbl)
            '    intNewY += (xrNotesTbl.Height + 10)



            '    'intNewY += 15
            '    intNewX = 0
            '    Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))

            '    If Not IsDBNull(row("noteTrans")) Then
            '        If row("noteTrans").ToString.Length <> 0 Then
            '            row("Note") = row("noteTrans").ToString
            '        End If
            '    End If
            '    Dim sNote As String = CStrDB(row("Note"))
            '    Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)

            '    If nCodeTemplate = 0 Then
            '        sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
            '        sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
            '        If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

            '        If Not IsNothing(sNote) Then intNewY += 10
            '        SplitNote(sNote, intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopLeft)
            '    Else
            '        Dim sNotes() As String = sNote.Split(CChar("¤"))
            '        Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

            '        For i As Integer = 0 To UBound(sNotesHeader)
            '            If Not sNotes(i) = "" Then
            '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
            '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                intNewY += intTextHeight

            '                sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
            '                sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
            '                If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

            '                If IsNothing(sNotes(i)) Then intNewY += 10
            '                SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
            '                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
            '                intNewY += GetLineSpace(intTextHeight)
            '            End If
            '        Next
            '    End If
            'End If



            intNewX = 0
            If G_ReportOptions.blnIncludeKeyword Then
                'If strStyle = "003" Then     'For Two Columns
                '    intNewY += intTextHeight
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                '    intNewY += 10
                'End If
                subDisplayKeywords(foundKeywords, strStyle)
            End If
            intNewX = 0

            If G_ReportOptions.blnIncludeComment And Not G_ReportOptions.dtComment Is Nothing Then
                If G_ReportOptions.dtComment.Select("Code=" & row("Recipecode")).Count > 0 Then
                    Dim xrCommentTable As New XRTable
                    Dim xrCommentRow As New XRTableRow

                    xrCommentTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Comment), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 10)

                    xrCommentTable = New XRTable
                    xrCommentTable.Width = intAvailableWidth
                    xrCommentTable.Location = New Point(intNewX, intNewY)

                    For Each drComment As DataRow In G_ReportOptions.dtComment.Select("Code=" & row("Recipecode"))
                        xrCommentRow = fctMakeDataRow({drComment("Comment").ToString.Trim & " ~" & drComment("CommentOwner").ToString.Trim}, {CInt(intAvailableWidth)}, {TextAlignment.MiddleLeft})
                        xrCommentTable.Rows.Add(xrCommentRow)
                    Next
                    .Detail.Controls.Add(xrCommentTable)

                    intNewY += (xrCommentTable.Height + 20)

                End If
            End If
            '----------------------------------------------------------------------------
            'Allergens
            '----------------------------------------------------------------------------
            intNewX = 0
            If G_ReportOptions.blnIncludeAllergens Then
                'If strStyle = "003" Then
                '    strStyle = "003Menu"
                'Else
                '    intNewY -= 10
                'End If

                'subDisplayAllegens(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, strStyle)
                Dim blnManor As Boolean = False
                If blnManor = False Then
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    With Me
                        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                        Select Case strStyle

                            Case "001", "002", "003"
                                Dim xrAllergensTable As New XRTable
                                Dim xrAllergensRow As New XRTableRow
                                Dim xrAllergensCell As New XRTableCell

                                xrAllergensTable.Width = intAvailableWidth
                                xrAllergensTable.Location = New Point(intNewX, intNewY)

                                If G_ReportOptions.blnIncludeHighlightSection Then
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.LightGray
                                    xrAllergensTable.BorderColor = Color.Black
                                Else
                                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                                    xrAllergensTable.BorderWidth = 1
                                    xrAllergensTable.BackColor = Color.White
                                    xrAllergensTable.BorderColor = Color.Black
                                End If

                                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                                xrAllergensCell.Text = strX.Trim
                                xrAllergensRow.Cells.Add(xrAllergensCell)
                                xrAllergensTable.Rows.Add(xrAllergensRow)

                                .Detail.Controls.Add(xrAllergensTable)

                                intNewX += (xrAllergensTable.Height + 10)

                                ' RDC 05.15.2013 - Removed.
                                'Case "002"  'Modern
                                '    intNewY += 10
                                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                                'Case "003"
                                '    intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                '  xrAllergensTable.Dispose()
                                '  xrAllergensRow.Dispose()
                                '  xrAllergensCell.Dispose()

                            Case "003Menu"
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                            Case "004" 'Merchandise Details
                                intNewY += 30

                                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
                            Case Else
                                intNewY += 10
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End Select


                        intNewY += intTextHeight + 10
                    End With
                Else
                    intNewY += GetLineSpace(intTextHeight)
                End If
                Dim CodeAllergenTranslation As Integer 'KMQDC 11.24.2015
                CodeAllergenTranslation = CType(row("CodeTrans"), Integer) '

                subDisplayAllegensTest(foundAllergens, intNewY, intTextHeight, fntBold, fntRegular, strStyle, False, True, strCnn, CodeAllergenTranslation)
            End If


        End With
        '--- PAGE DETAILS ---
        Log.Info("fctPrintMenuDetailsEgs END")
        Return Me
    End Function
    '-----------------------------------------------------------------------

    Private Sub SplitMenuPreparation(ByVal strNote As String, ByVal intAW As Integer, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment,
                         Optional ByRef intTextHeightCount As Integer = 0)
        Dim intY As Integer = intCY
        With Me
            strNote = strNote.Replace(Chr(10), "")
            Dim arr() As String = strNote.Split(vbCrLf)

            Dim i As Integer = 0
            While i < arr.Length
                If arr(i).Trim.Length > 0 Then
                    strNote = arr(i)
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNote, fntRegular, intCX, intCY, intAW, intTextHeight, align, True, , True)})
                End If
                If Not i + 1 = arr.Length Then
                    intCY += intTextHeight
                End If
                i += 1
            End While
        End With
        intCY = intY
    End Sub


#Region "ADF Menu Report"

    Function fctPrintMenuDetailsADF(ByVal foundDetails() As DataRow, ByVal dtIngr As DataTable, ByVal strCnn As String, Optional ByVal strstyle As String = "")

        'fctPrintMenuDetailsADF = Nothing
        If foundDetails.Length <= 0 Then Exit Function
        Dim row As DataRow = foundDetails(0)

        '--- SETTINGS ---
        Dim fntTitle As Font = New Font("Times New Roman", 12, FontStyle.Bold)
        fntBold = New Font("Times New Roman", 10, FontStyle.Bold)
        fntRegular = New Font("Times New Roman", 10, FontStyle.Bold)

        With Me 'paper , orientation, width
            '.PaperKind = Printing.PaperKind.A4
            .PaperKind = New System.Drawing.Printing.PaperKind
            .PaperKind = Printing.PaperKind.A4
            '.PageWidth = 827 : .PageHeight = 1169
            .PageWidth = CInt(G_ReportOptions.dblPageWidth) : .PageHeight = CInt(G_ReportOptions.dblPageHeight)
            '.Margins.Left = CInt(G_ReportOptions.dblLeftMargin)
            '.Margins.Top = CInt(G_ReportOptions.dblTopMargin)
            '.Margins.Bottom = CInt(G_ReportOptions.dblBottomMargin)
            '.Margins.Right = CInt(G_ReportOptions.dblRightMargin)
            'Margins = New System.Drawing.Printing.Margins(50, 50, 50, 50)
            'Margins = New System.Drawing.Printing.Margins(CInt(G_ReportOptions.dblLeftMargin), CInt(G_ReportOptions.dblRightMargin), CInt(G_ReportOptions.dblTopMargin), CInt(G_ReportOptions.dblBottomMargin))
            .Margins = New System.Drawing.Printing.Margins(50.0!, 50.0!, 50.0!, 50.0!)
            .Landscape = False
            intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
        End With

        '--- PAGE HEADER ---
        With Me
            intNewX = 0
            intNewY = .Margins.Top
            sf = New StringFormat(StringFormatFlags.NoClip)

            '>>Logo<<
            Dim dblLogoWidth As Double = 198
            Dim dblLogoHeight As Double = 98
            Dim cConfig As New clsConfig(enumAppType.WebApp, strCnn)

            If Not G_strLogoPath = Nothing Then
                Dim xPicture As XRPictureBox = fctMakePictureBox(G_strLogoPath, intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
                If File.Exists(G_strLogoPath) Then
                    .PageHeader.Controls.AddRange(New XRControl() {xPicture})
                End If
                intNewY += xPicture.Height
            Else
                intNewY += dblLogoHeight
            End If

            strX = CType(row("Yield"), Double).ToString & " " & fctGetTranslatedText(row, "PortionUnit", "PortionUnitTrans", G_ReportOptions.intPageLanguage).ToUpper
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, 0, intNewY, 198, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter, , , True)})
            intNewY += intTextHeight

            '>>Recipe title<<
            Dim strRecipeName As String = fctGetTranslatedText(row, "Name", "NameTrans", G_ReportOptions.intTranslation)

            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXRLabel(strRecipeName, fntTitle, 202, .Margins.Top, intAvailableWidth - 202, (intNewY - .Margins.Top), DevExpress.XtraPrinting.TextAlignment.MiddleCenter, True, , True)})

            .PageHeader.Controls.AddRange(New XRControl() {fctMakeLine(200, .Margins.Top, 1, 1, intNewY - .Margins.Top, LineDirection.Vertical, True)})
            .PageHeader.Controls.AddRange(New XRControl() {fctMakeLine(0, intNewY, intAvailableWidth, 1, 1, , True)})
            .PageHeader.Height = intNewY
        End With
        '--- PAGE HEADER ----

        '--- PAGE FOOTER ---
        With Me
            intNewY = 0
            intNewX = 0
            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height

            Dim xrPageNumber As New DevExpress.XtraReports.UI.XRPageInfo
            Dim xrLinePF1 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF2 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF3 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF4 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF5 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF6 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF7 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF8 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF9 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF10 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF11 As New DevExpress.XtraReports.UI.XRLine
            Dim xrLinePF12 As New DevExpress.XtraReports.UI.XRLine
            Dim xrRecipeNo As New DevExpress.XtraReports.UI.XRLabel
            Dim xrPIDate As New DevExpress.XtraReports.UI.XRLabel
            Dim xrLblNote As New DevExpress.XtraReports.UI.XRLabel


            xrPIPageNumber.Visible = False
            .PageFooter.Controls.AddRange(New DevExpress.XtraReports.UI.XRControl() {xrLblNote, xrPageNumber, xrLinePF1, xrLinePF2, xrLinePF3, xrLinePF4, xrLinePF5, xrLinePF6, xrLinePF7, xrLinePF10, xrLinePF11, xrLinePF12, xrRecipeNo, xrPIDate})
            .PageFooter.LockedInUserDesigner = True
            .PageFooter.Name = "PageFooter"
            .PageFooter.ParentStyleUsing.UseBorders = False

            xrLinePF1.Location = New System.Drawing.Point(intNewX, intNewY)
            xrLinePF1.Name = "xrLinePF1"
            xrLinePF1.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF1.LineWidth = 1
            xrLinePF1.Visible = True

            intNewY += 2

            xrLblNote.Font = New System.Drawing.Font("Times New Roman", 10.0!, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
            xrLblNote.KeepTogether = True
            xrLblNote.Location = New System.Drawing.Point(0, intNewY)
            xrLblNote.Name = "xrLblEGS"
            xrLblNote.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
            xrLblNote.ParentStyleUsing.UseBorders = False
            xrLblNote.ParentStyleUsing.UseFont = False
            xrLblNote.Size = New System.Drawing.Size(intAvailableWidth, intTextHeight)
            xrLblNote.Text = cLang.GetString(clsEGSLanguage.CodeType.Note) & ":"
            xrLblNote.Visible = True


            intNewY += intTextHeight + 2
            xrLinePF2.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF2.Name = "xrLinePF2"
            xrLinePF2.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF2.LineWidth = 1
            xrLinePF2.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF2.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF3.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF3.Name = "xrLinePF3"
            xrLinePF3.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF3.LineWidth = 1
            xrLinePF3.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF3.Visible = True


            intNewY += intTextHeight + 2
            xrLinePF4.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF4.Name = "xrLinePF4"
            xrLinePF4.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF4.LineWidth = 1
            xrLinePF4.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF4.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF5.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF5.Name = "xrLinePF5"
            xrLinePF5.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF5.LineWidth = 1
            xrLinePF5.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF5.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF6.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF6.Name = "xrLinePF6"
            xrLinePF6.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF6.LineWidth = 1
            xrLinePF6.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF6.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF7.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF7.Name = "xrLinePF7"
            xrLinePF7.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF7.LineWidth = 1
            xrLinePF7.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF7.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF10.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF10.Name = "xrLinePF10"
            xrLinePF10.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF10.LineWidth = 1
            xrLinePF10.LineStyle = Drawing2D.DashStyle.Dot
            xrLinePF10.Visible = True

            intNewY += intTextHeight + 2
            xrLinePF11.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF11.Name = "xrLinePF11"
            xrLinePF11.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF11.LineWidth = 1
            xrLinePF11.LineStyle = Drawing2D.DashStyle.Solid
            xrLinePF11.Visible = True


            intNewY += 2
            xrPIDate.Font = New System.Drawing.Font("Times New Roman", 10.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
            xrPIDate.Location = New System.Drawing.Point(0, intNewY)
            xrPIDate.Name = "xrPIDate"
            xrPIDate.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
            xrPIDate.ParentStyleUsing.UseBorderColor = False
            xrPIDate.ParentStyleUsing.UseBorders = False
            xrPIDate.ParentStyleUsing.UseFont = False
            xrPIDate.ParentStyleUsing.UseForeColor = False
            xrPIDate.Size = New System.Drawing.Size(200, intTextHeight)
            xrPIDate.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xrPIDate.Text = Format(CDate(foundDetails(0)("dates")), "dd/MM/yyyy")
            xrPIDate.Visible = True

            intNewX += 201
            xrRecipeNo.Font = New System.Drawing.Font("Times New Roman", 10.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
            xrRecipeNo.Location = New System.Drawing.Point(0, intNewY)
            xrRecipeNo.Name = "xrRecipeNo"
            xrRecipeNo.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
            xrRecipeNo.ParentStyleUsing.UseBorderColor = False
            xrRecipeNo.ParentStyleUsing.UseBorders = False
            xrRecipeNo.ParentStyleUsing.UseFont = False
            xrRecipeNo.ParentStyleUsing.UseForeColor = False
            xrRecipeNo.Size = New System.Drawing.Size((intAvailableWidth - 202) / 2, intTextHeight)
            xrRecipeNo.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopLeft
            xrRecipeNo.Text = fctSqlReady(row("Number").ToString) : strX = Replace(strX, Chr(1), "")
            xrRecipeNo.Visible = True


            intNewX += (intAvailableWidth - 202) / 2
            xrPageNumber.Font = New System.Drawing.Font("Times New Roman", 10.0!, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, CType(161, Byte))
            xrPageNumber.Format = cLang.GetString(clsEGSLanguage.CodeType.Page).ToUpper & " {0}/{1}"
            xrPageNumber.Location = New System.Drawing.Point(intNewX, intNewY)
            xrPageNumber.Name = "xrPIPageNumber"
            xrPageNumber.Padding = New DevExpress.XtraPrinting.PaddingInfo(2, 2, 0, 0, 100.0!)
            xrPageNumber.ParentStyleUsing.UseBorderColor = False
            xrPageNumber.ParentStyleUsing.UseBorders = False
            xrPageNumber.ParentStyleUsing.UseFont = False
            xrPageNumber.ParentStyleUsing.UseForeColor = False
            xrPageNumber.Size = New System.Drawing.Size((intAvailableWidth - 202) / 2, intTextHeight)
            xrPageNumber.TextAlignment = DevExpress.XtraPrinting.TextAlignment.TopRight
            xrPageNumber.Visible = True


            intNewY += intTextHeight + 2
            xrLinePF12.Location = New System.Drawing.Point(0, intNewY)
            xrLinePF12.Name = "xrLinePF10"
            xrLinePF12.Size = New System.Drawing.Size(intAvailableWidth, 1)
            xrLinePF12.LineWidth = 1
            xrLinePF12.LineStyle = Drawing2D.DashStyle.Solid
            xrLinePF12.Visible = True
        End With
        '--- PAGE FOOTER ---

        '--- DETAILS ----
        fntBold = New Font("Times New Roman", 10, FontStyle.Bold)
        fntRegular = New Font("Times New Roman", 10, FontStyle.Regular)
        fntItalic = New Font("Times New Roman", 10, FontStyle.Italic)

        Dim xrIngredientPanel As XRPanel
        Dim intIngredientHeight As Integer, intNoteHeight As Integer
        With Me '--preparation right side
            intNewX = 202
            intNewY = 0
            strX = cLang.GetString(clsEGSLanguage.CodeType.Preparation).ToUpper
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth - 202, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth - 201, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , True, , , , 2)})
            intNewY += intTextHeight
            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth - 202, 1, 1, , True)})
            intNewY += 10

            intNewX = 208
            Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
            Dim intCodeTemplate As Integer
            Dim strHeaderName As String
            Dim strProcedures() As String
            Dim strProcedure As String
            Dim intCodeListeMain As Integer
            sf = New StringFormat(StringFormatFlags.NoClip)

            If Not dtIngr Is Nothing Then
                For Each rowIngr As DataRow In dtIngr.Rows
                    intCodeListeMain = CIntDB(rowIngr("CodeMain"))
                    If intCodeListeMain = 0 Then intCodeListeMain = CIntDB(rowIngr("ItemCode"))

                    If intCodeListeMain = CIntDB(row("Code")) Then
                        If CIntDB(rowIngr("ItemType")) = 75 Then
                            intCodeTemplate = CIntDB(rowIngr("CodeTemplate"))
                            If intCodeTemplate = 0 Then
                                strProcedure = CStrDB(rowIngr("Procedure")).Trim
                                If strProcedure.Trim.Length > 0 Then
                                    strHeaderName = CStrDB(rowIngr("itemName")).Trim
                                    strHeaderName = strHeaderName.Substring(0, 1).ToUpper & strHeaderName.Substring(1, strHeaderName.Length - 1).ToLower
                                    intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intAvailableWidth - 208, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intAvailableWidth - 208, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopJustify, , , , True, , "white", , 1)})
                                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth - 208, sf, Me.Padding).Height

                                    intNewY += intTextHeight + (intTextHeight / 2)
                                    strProcedure = Trim(Replace(strProcedure, vbCrLf & "#", vbCrLf))
                                    strProcedure = Trim(Replace(strProcedure, Chr(1), vbCrLf))
                                    If Mid(strProcedure, 1, 1) = "#" Then strProcedure = Mid(strProcedure, 2)

                                    SplitNote2(strProcedure, intAvailableWidth - 208, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
                                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth - 208, sf, Me.Padding).Height
                                    intNewY += (intTextHeight / 2)
                                End If
                            Else
                                Dim dtTemp As DataTable = cListe.fctGetProcedureTemplateD(G_ReportOptions.intTranslation, CIntDB(rowIngr("CodeTemplate")))

                                strHeaderName = rowIngr("itemName").trim
                                strProcedures = rowIngr("Procedure").split(CChar("¤"))

                                Dim irow As Integer = 0
                                If strProcedures(irow).Length > 0 Then
                                    intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intAvailableWidth - 208, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intAvailableWidth - 208, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopJustify, , , , True, , , , 1)})
                                    intNewY += GetLineSpace(intTextHeight)

                                    For Each rowtemp As DataRow In dtTemp.Rows
                                        If strProcedures(irow).Trim.Length > 0 Then
                                            '--- procedure template headers
                                            strX = CStrDB(rowtemp("Name")).Trim
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntItalic, intAvailableWidth - 208, sf, Me.Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntItalic, intNewX, intNewY, intAvailableWidth - 208, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                            intNewY += GetLineSpace(intTextHeight)
                                            '--- 

                                            intTextHeight = ReportingTextUtils.MeasureText(strProcedures(irow).Trim, fntRegular, intAvailableWidth - 208, sf, Me.Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strProcedures(irow).Trim, fntRegular, intNewX, intNewY, intAvailableWidth - 208, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopJustify, True, , True)})
                                            intNewY += GetLineSpace(intTextHeight)
                                        End If
                                        irow += 1
                                    Next
                                End If
                            End If
                        End If
                    End If
                Next
            End If
            intNewY += GetLineSpace(intTextHeight)

            '--- VRP 04.07.2008
            Dim nCodeTemplate As Integer = CIntDB(row("templatecode"))
            Dim sNote As String = row("Note")
            Dim sNoteHeader As String = fctGetTranslatedText(row, "Noteheader", "NoteheaderTrans", G_ReportOptions.intTranslation)
            Dim strCodeStyle As String = CStrDB(row("CodeStyle"))

            If nCodeTemplate = 0 Then
                sNote = Trim(Replace(sNote, vbCrLf & "#", vbCrLf))
                sNote = Trim(Replace(sNote, Chr(1), vbCrLf))
                If Mid(sNote, 1, 1) = "#" Then sNote = Mid(sNote, 2)

                If Not IsNothing(sNote) Then intNewY += 10
                SplitNote(sNote, intAvailableWidth - intNewX, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
            Else
                Dim sNotes() As String = sNote.Split(CChar("¤"))
                Dim sNotesHeader() As String = sNoteHeader.Split(CChar("¤"))

                If Not strCodeStyle = "" Then
                    intNewX = 202
                    Dim strCodeStyles() As String = strCodeStyle.Split(CChar("¤"))

                    For i As Integer = 0 To UBound(sNotesHeader)
                        Dim dtStyle As DataTable = cListe.fctGetProcedureStyles(strCodeStyles(i))

                        If dtStyle.Rows.Count > 0 Then
                            Dim IsBold As Boolean = CBool(dtStyle.Rows(0)("IsBoldH"))
                            Dim IsItalic As Boolean = CBool(dtStyle.Rows(0)("IsItalicH"))
                            Dim IsUnderline As Boolean = CBool(dtStyle.Rows(0)("IsUnderlineH"))
                            Dim dblSpaceBeforeH As Double = dtStyle.Rows(0)("FontSBH")
                            Dim dblSpaceAfterH As Double = dtStyle.Rows(0)("FontSAH")
                            Dim dblSpaceBeforeD As Double = dtStyle.Rows(0)("FontSBD")
                            Dim dblSpaceAfterD As Double = dtStyle.Rows(0)("FontSAD")

                            Dim strFontNameH As String = dtStyle.Rows(0)("FontNameH")
                            Dim dblFontSizeH As String = dtStyle.Rows(0)("FontSizeH")

                            Dim fntHeader As Font
                            If IsBold And IsItalic And IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Bold Or FontStyle.Italic Or FontStyle.Underline)
                            ElseIf IsBold And Not IsItalic And Not IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Bold)
                            ElseIf Not IsBold And IsItalic And Not IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Italic)
                            ElseIf Not IsBold And Not IsItalic And IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Underline)

                            ElseIf IsBold And IsItalic And Not IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Bold Or FontStyle.Italic)
                            ElseIf IsBold And Not IsItalic And IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Bold Or FontStyle.Underline)
                            ElseIf Not IsBold And IsItalic And IsUnderline Then
                                fntHeader = New Font(CStr(strFontNameH), CInt(dblFontSizeH), FontStyle.Italic Or FontStyle.Underline)
                            End If


                            IsBold = CBool(dtStyle.Rows(0)("IsBoldD"))
                            IsItalic = CBool(dtStyle.Rows(0)("IsItalicD"))
                            IsUnderline = CBool(dtStyle.Rows(0)("IsUnderlineD"))
                            Dim strFontNameD As String = dtStyle.Rows(0)("FontNameD")
                            Dim dblFontSizeD As String = dtStyle.Rows(0)("FontSizeD")

                            Dim fntDetail As Font
                            If IsBold And IsItalic And IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Bold Or FontStyle.Italic Or FontStyle.Underline)
                            ElseIf IsBold And Not IsItalic And Not IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Bold)
                            ElseIf Not IsBold And IsItalic And Not IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Italic)
                            ElseIf Not IsBold And Not IsItalic And IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Underline)

                            ElseIf IsBold And IsItalic And Not IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Bold Or FontStyle.Italic)
                            ElseIf IsBold And Not IsItalic And IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Bold Or FontStyle.Underline)
                            ElseIf Not IsBold And IsItalic And IsUnderline Then
                                fntDetail = New Font(CStr(strFontNameD), CInt(dblFontSizeD), FontStyle.Italic Or FontStyle.Underline)
                            End If


                            Dim strTextColorH As String = CStr(dtStyle.Rows(0)("FontColorH"))
                            Dim strBGColorH As String = CStr(dtStyle.Rows(0)("BGColorH"))
                            Dim strTextColorD As String = CStr(dtStyle.Rows(0)("FontColorD"))
                            Dim strBGColorD As String = CStr(dtStyle.Rows(0)("BGColorD"))

                            If Not sNotes(i) = "" Then
                                'intNewX += dblSpaceBeforeH
                                intNewY += dblSpaceBeforeH
                                intTextHeight = ReportingTextUtils.MeasureText("A", fntHeader, intTextHeight, sf, Me.Padding).Height
                                '.Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(sNotesHeader(i), fntHeader, Color.FromName(strTextColorH), Color.FromName(strBGColorH), intNewX, intNewY, intAvailableWidth - intNewX - dblSpaceAfterH, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(sNotesHeader(i), fntHeader, Color.FromName(strTextColorH), Color.FromName(strBGColorH), intNewX, intNewY, intAvailableWidth - intNewX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewY += intTextHeight
                                intNewY += dblSpaceAfterH

                                sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
                                sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
                                If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

                                If IsNothing(sNotes(i)) Then intNewY += 10
                                'intNewX = 202 + dblSpaceBeforeD
                                intNewX = 202
                                'SplitNote3(sNotes(i), intAvailableWidth - intNewX - dblSpaceAfterD, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify, fntDetail, Color.FromName(strTextColorD), Color.FromName(strBGColorH))
                                SplitNote3(sNotes(i), intAvailableWidth - intNewX, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify, fntDetail, Color.FromName(strTextColorD), Color.FromName(strBGColorH))
                                intTextHeight = ReportingTextUtils.MeasureText("A", fntDetail, intTextHeight, sf, Me.Padding).Height
                                intNewY += GetLineSpace(intTextHeight)
                                intNewY += dblSpaceAfterD
                                intNewX = 202
                            End If

                        End If
                        'Dim strHeaderStyles() As String = CStr(cListe.fctGetProcedureStyles(strCodeStyles(i)).Rows(0)(3)).Split(CChar(";"))
                        'Dim strDetailStyles() As String = CStr(cListe.fctGetProcedureStyles(strCodeStyles(i)).Rows(0)(4)).Split(CChar(";"))

                        'Dim IsBold As Boolean = strHeaderStyles(2)
                        'Dim IsItalic As Boolean = strHeaderStyles(3)
                        'Dim IsUnderline As Boolean = strHeaderStyles(4)
                        'Dim intSpaceBeforeH As Integer = strHeaderStyles(7)
                        'Dim intSpaceAfterH As Integer = strHeaderStyles(8)
                        'Dim intSpaceBeforeD As Integer = strDetailStyles(7)
                        'Dim intSpaceAfterD As Integer = strDetailStyles(8)


                        'Dim fntHeader As Font
                        'If IsBold And IsItalic And IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Italic Or FontStyle.Underline)
                        'ElseIf IsBold And Not IsItalic And Not IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold)
                        'ElseIf Not IsBold And IsItalic And Not IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Italic)
                        'ElseIf Not IsBold And Not IsItalic And IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Underline)

                        'ElseIf IsBold And IsItalic And Not IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Italic)
                        'ElseIf IsBold And Not IsItalic And IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Underline)
                        'ElseIf Not IsBold And IsItalic And IsUnderline Then
                        '    fntHeader = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Italic Or FontStyle.Underline)
                        'End If


                        'IsBold = strDetailStyles(2)
                        'IsItalic = strDetailStyles(3)
                        'IsUnderline = strDetailStyles(4)

                        'Dim fntDetail As Font
                        'If IsBold And IsItalic And IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Italic Or FontStyle.Underline)
                        'ElseIf IsBold And Not IsItalic And Not IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold)
                        'ElseIf Not IsBold And IsItalic And Not IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Italic)
                        'ElseIf Not IsBold And Not IsItalic And IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Underline)

                        'ElseIf IsBold And IsItalic And Not IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Italic)
                        'ElseIf IsBold And Not IsItalic And IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Bold Or FontStyle.Underline)
                        'ElseIf Not IsBold And IsItalic And IsUnderline Then
                        '    fntDetail = New Font(CStr(strHeaderStyles(0)), CInt(strHeaderStyles(1)), FontStyle.Italic Or FontStyle.Underline)
                        'End If




                        'If Not sNotes(i) = "" Then
                        '    intNewX += intSpaceBeforeH
                        '    intTextHeight = ReportingTextUtils.MeasureText("A", fntHeader, intTextHeight, sf, Me.Padding).Height
                        '    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(sNotesHeader(i), fntHeader, Color.FromName(strHeaderStyles(5)), Color.FromName(strHeaderStyles(6)), intNewX, intNewY, intAvailableWidth - intNewX - intSpaceAfterH, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        '    intNewY += intTextHeight

                        '    sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
                        '    sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
                        '    If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

                        '    If IsNothing(sNotes(i)) Then intNewY += 10
                        '    intNewX = 202 + intSpaceBeforeD
                        '    SplitNote3(sNotes(i), intAvailableWidth - intNewX - intSpaceAfterD, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify, fntDetail, Color.FromName(strDetailStyles(5)), Color.FromName(strDetailStyles(6)))
                        '    intTextHeight = ReportingTextUtils.MeasureText("A", fntDetail, intTextHeight, sf, Me.Padding).Height
                        '    intNewY += GetLineSpace(intTextHeight)
                        '    intNewX = 202
                        'End If
                    Next
                Else
                    For i As Integer = 0 To UBound(sNotesHeader)
                        If Not sNotes(i) = "" Then
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intTextHeight, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(sNotesHeader(i), fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            intNewY += intTextHeight

                            sNotes(i) = Trim(Replace(sNotes(i), vbCrLf & "#", vbCrLf))
                            sNotes(i) = Trim(Replace(sNotes(i), Chr(1), vbCrLf))
                            If Mid(sNotes(i), 1, 1) = "#" Then sNotes(i) = Mid(sNotes(i), 2)

                            If IsNothing(sNotes(i)) Then intNewY += 10
                            SplitNote(sNotes(i), intAvailableWidth, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopJustify)
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intTextHeight, sf, Me.Padding).Height
                            intNewY += GetLineSpace(intTextHeight)
                        End If
                    Next
                End If
            End If
            intNoteHeight = intNewY
        End With

        With Me 'ingredients left side
            intNewX = 0
            intNewY = 0

            Dim strPictures As String = ""
            If Not IsDBNull(row("Pix").ToString) Then strPictures = row("Pix").ToString
            Dim arrPicture() As String = strPictures.Split(CChar(";"))
            Dim strFileName As String = Nothing
            Dim xrPicture As XRPictureBox
            For j As Integer = 0 To UBound(arrPicture)
                If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
                    strFileName &= arrPicture(j)
                    xrPicture = fctMakePictureBox(G_strPhotoPath & strFileName, intNewX + 10, intNewY, 180, 180)
                    .Detail.Controls.AddRange(New XRControl() {xrPicture})
                    intNewY += xrPicture.Height
                    .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, 198, 1, 1, , True)})
                    intNewY += 4
                    Exit For
                End If
            Next

            strX = cLang.GetString(clsEGSLanguage.CodeType.Products).ToUpper ' RBAJ-2012.10.08
            'strX = cLang.GetString(clsEGSLanguage.CodeType.Ingredients).ToUpper
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, 198, sf, Me.Padding).Height
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, 198, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            intNewY += intTextHeight

            Dim strIngredient As String = ""
            Dim strQuantityNet As String
            Dim strUnit As String = ""
            Dim intCodeListeMain As Integer

            sf = New StringFormat(StringFormatFlags.NoClip)
            If Not dtIngr Is Nothing Then
                For Each rowIng As DataRow In dtIngr.Rows
                    intCodeListeMain = CIntDB(rowIng("CodeMain"))
                    If intCodeListeMain = 0 Then intCodeListeMain = CIntDB(rowIng("ItemCode"))
                    If intCodeListeMain = CIntDB(row("Code")) Then
                        strIngredient = CStrDB(rowIng("itemName"))
                        If CIntDB(rowIng("ItemType")) = 75 Then
                            strIngredient = strIngredient.Substring(0, 1).ToUpper & strIngredient.Substring(1, strIngredient.Length - 1).ToLower
                            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, 198, 1, 1, , True)})
                            intNewY += 4

                            fntFont = New Font("Times New Roman", 8, FontStyle.Bold)
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntFont, intAvailableWidth, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("● " & strIngredient.Trim, fntFont, intNewX, intNewY, 198, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                            intNewY += intTextHeight
                        Else
                            strIngredient = IIf(CStrDB(rowIng("itemName")).ToUpper = "DUMMY", CStrDB(rowIng("tmpName")), CStrDB(rowIng("itemName")))
                            strIngredient = strIngredient.Substring(0, 1).ToUpper & strIngredient.Substring(1, strIngredient.Length - 1).ToLower
                            strQuantityNet = IIf(CStrDB(rowIng("itemName")).ToUpper = "DUMMY", IIf(CStrDB(rowIng("tmpqty")) = "", "0", CStrDB(Format(CIntDB(rowIng("tmpqty")), "#,##0"))), IIf(CStrDB(rowIng("netquantity")) = "", "0", CStrDB(Format(CIntDB(rowIng("netquantity")), "#,##0"))))
                            strUnit = IIf(CStrDB(rowIng("itemName")).ToUpper = "DUMMY", CStrDB(rowIng("tmpUnit")), CStrDB(rowIng("itemUnit")))

                            fntFont = New Font("Times New Roman", 8, FontStyle.Regular)
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntFont, intAvailableWidth, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("- ", fntFont, intNewX, intNewY, 198, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})

                            intNewX += 5
                            If Not strQuantityNet = CDbl(0) Then
                                strX = " " & strIngredient & " " & strQuantityNet & " " & strUnit
                            Else
                                strX = " " & strIngredient & " " & strUnit
                            End If
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntFont, intAvailableWidth, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX.Trim, fntFont, intNewX, intNewY, 192, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                            intNewY += GetLineSpace(intTextHeight)
                            intNewX = 0
                        End If
                    End If
                Next
            End If
            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, 198, 1, 1, , True)})
            intNewY += 2

            'Dim strPictures As String = ""
            'If Not IsDBNull(row("Pix").ToString) Then strPictures = row("Pix").ToString
            'Dim arrPicture() As String = strPictures.Split(CChar(";"))
            'Dim strFileName As String = Nothing
            'Dim xrPicture As XRPictureBox
            'For j As Integer = 0 To UBound(arrPicture)
            '    If UrlFileExists(G_strPhotoPath & arrPicture(j)) And arrPicture(j) <> "" Then
            '        strFileName &= arrPicture(j)
            '        xrPicture = fctMakePictureBox(G_strPhotoPath & strFileName, intNewX + 10, intNewY, 180, 180)
            '        .Detail.Controls.AddRange(New XRControl() {xrPicture})
            '        intNewY += xrPicture.Height
            '        Exit For
            '    End If
            'Next
            intIngredientHeight = intNewY
        End With


        'test
        With Me

            '--- test
            xrIngredientPanel = fctMakeXrPanel(0, 0, 201, "xrPanel", intNewY, True)
            xrIngredientPanel.Borders = DevExpress.XtraPrinting.BorderSide.Right
            xrIngredientPanel.BorderWidth = 1
            .Detail.Controls.AddRange(New XRControl() {xrIngredientPanel})

            Dim intDetailHeight As Integer = (.PageHeight - .Margins.Bottom - .PageHeader.Height - .PageFooter.Height)
            Dim intDetailHeightX As Integer = (.PageHeight - .Margins.Bottom - .PageHeader.Height - .PageFooter.Height)

            Dim x As Integer = 2
            If intIngredientHeight > intNoteHeight Then
                xrIngredientPanel.Height = intIngredientHeight
                While Not intDetailHeight > intIngredientHeight
                    intDetailHeight = (intDetailHeightX * x)
                    x += 1
                End While
            Else
                xrIngredientPanel.Height = intNoteHeight
                If intDetailHeight < intNoteHeight Then
                    While Not intDetailHeight > intNoteHeight
                        intDetailHeight = (intDetailHeightX * x)
                        x += 1
                    End While
                End If
            End If
            xrIngredientPanel.Height = intDetailHeight
        End With

        '--- DETAILS ----

        Return Me
    End Function
#End Region

#End Region

    '#Region " SV Menu Plan Report "
    '    Public Function fctPrintMenuPlanDetailSV_A4Hoch(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                                  Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo)

    '        If foundDetails.Length = 0 Then Return Me

    '        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
    '        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '        Dim dtList As DataTable = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code)

    '        With Me
    '            Try
    '                fntReportTitle = New Font("Arial Black", 13, FontStyle.Bold)
    '                fntBold = New Font("Arial Black", 9, FontStyle.Bold)
    '                fntRegular = New Font("Arial", 9, FontStyle.Regular)
    '                fntFont = New Font("Arial", 8, FontStyle.Regular)
    '            Catch ex As Exception
    '                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                Return Me
    '            End Try
    '        End With

    '        With Me 'paper , orientation, width
    '            .PaperKind = New System.Drawing.Printing.PaperKind
    '            .PaperKind = Printing.PaperKind.A4

    '            .Landscape = G_ReportOptions.blLandscape
    '            .Margins = New System.Drawing.Printing.Margins(50.0!, 50.0!, 50.0!, 50.0!)
    '            intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '        End With

    '        '--- PAGE HEADER ---
    '        With Me
    '            intNewX = 0
    '            intNewY = 0

    '            If enumMPPrintStyle = enumMPStyle.A4HWLogo Then
    '                'Measure Picture
    '                Dim dblLogoWidth As Double = 115
    '                Dim dblLogoHeight As Double = 52
    '                Dim xPicture As XRPictureBox
    '                If Not G_strLogoPath = Nothing Then
    '                    If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                        Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                        If dtLogo.Rows.Count > 0 Then
    '                            If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                                xPicture = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                intNewX = (intAvailableWidth - xPicture.Width)
    '                            End If
    '                        End If
    '                    End If
    '                End If

    '                'Print Picture
    '                If Not G_strLogoPath = Nothing Then
    '                    If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                        Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                        If dtLogo.Rows.Count > 0 Then
    '                            If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                                xPicture = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                .PageHeader.Controls.AddRange(New XRControl() {xPicture})
    '                                intNewY += xPicture.Height
    '                            End If
    '                        End If
    '                    End If
    '                Else
    '                    intNewY += dblLogoHeight
    '                End If
    '                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Padding).Height
    '                intNewY += intTextHeight
    '            End If

    '            Dim intPicHeight As Integer = intNewY
    '            sf = New StringFormat(StringFormatFlags.NoClip)

    '            '---
    '            'Measure Right Side
    '            Dim intTextWidth As Integer = 0
    '            Dim intSumWidth As Integer = 0
    '            Dim intSumWidth2 As Integer = 0

    '            Dim intCol1 As Integer = 0
    '            Dim intCol2 As Integer = 0
    '            Dim intCol3 As Integer = 0

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol1 += intTextWidth

    '            strX = CStrDB(foundDetails(0)("OpenDays")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol2 += intTextWidth

    '            strX = CStrDB(foundDetails(0)("CloseDays")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth

    '            strX = CStrDB(foundDetails(0)("OpenTime")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol3 += intTextWidth

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            If intCol3 < intTextWidth Then intCol3 = intTextWidth
    '            intSumWidth = intCol1 + intCol2 + intCol3

    '            'Print Left Side
    '            Dim intLeftSizeX As Integer = intAvailableWidth - intSumWidth
    '            Dim intRightSizeX As Integer = intSumWidth

    '            intNewX = 0
    '            strX = "Menuplan"
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewY += intTextHeight
    '            strX = strSelectedWeek
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            'Print Right Side
    '            intNewY = intPicHeight
    '            intNewX += intLeftSizeX

    '            If Not CStrDB(foundDetails(0)("OpenDays")).Trim = "" Or Not CStrDB(foundDetails(0)("OpenTime")).Trim = "" Then
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol1
    '                strX = CStrDB(foundDetails(0)("OpenDays")).Trim
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol2
    '                strX = CStrDB(foundDetails(0)("OpenTime")).Trim
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                intNewY += intTextHeight
    '            End If

    '            intNewX = intLeftSizeX + intCol1

    '            If Not CStrDB(foundDetails(0)("CloseDays")).Trim = "" Then
    '                strX = CStrDB(foundDetails(0)("CloseDays")).Trim
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol2
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                '---
    '                'intNewY += intTextHeight
    '            End If
    '            intNewY += 10
    '        End With
    '        '--- PAGE HEADER ---

    '        '--- DETAIL ---
    '        With Me
    '            Dim intColDayWidth As Integer = 0
    '            Dim intTextWidth As Integer = 0

    '            Dim intNo As Integer = CIntDB(foundDetails(0)("NoOfProposal"))
    '            If intNo = 5 Then intNo = intNo - 2
    '            If intNo = 4 Then intNo = intNo - 1

    '            'If intNo <= 3 Then
    '            '    Dim strDays() As String = CStrDB(foundDetails(0)("Days")).Split(CChar("-"))
    '            '    For i As Integer = strDays(0) To strDays(1)
    '            '        strX = fctGetDay(i, cLang)
    '            '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '            '        If intColDayWidth < intTextWidth Then
    '            '            intColDayWidth = intTextWidth
    '            '        End If
    '            '    Next
    '            '    intColDayWidth += 10
    '            'Else
    '            '    intColDayWidth = 25
    '            'End If
    '            intColDayWidth = 100
    '            Dim intColWidth As Integer = ((intAvailableWidth - intColDayWidth) / intNo)

    '            'Measure Title Height
    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColWidth, sf, Me.Padding).Height
    '            Dim intRowTitleHeight As Integer = intTextHeight
    '            Dim strProposals() As String = CStrDB(foundDetails(0)("ProposalName")).Split(CChar("¶"))
    '            Dim strProposal() As String

    '            For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '                If Not i + 1 > intNo Then
    '                    strProposal = strProposals(i).Split(CChar("¤"))
    '                    strX = strProposal(1)
    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Me.Padding).Height
    '                    If intRowTitleHeight < intTextHeight Then
    '                        intRowTitleHeight = intTextHeight
    '                    End If
    '                End If
    '            Next

    '            'Print Menu Plan Column Titles
    '            intNewX = intColDayWidth
    '            intNewY = 0

    '            For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '                If Not i + 1 > intNo Then
    '                    If i + 1 <= 3 Then
    '                        strProposal = strProposals(i).Split(CChar("¤"))
    '                        strX = strProposal(1)
    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Me.Padding).Height
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        If Not i = UBound(strProposals) - 1 Then
    '                            intNewX += intColWidth
    '                        End If
    '                    End If
    '                End If
    '            Next
    '            intNewY += intRowTitleHeight

    '            'Row Details
    '            Dim intRowDetailsHeight As Integer = 0
    '            Dim intGuideY As Integer = intNewY

    '            Dim dtListeTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code)
    '            'Dim dtConfig As DataTable = cPlan.fctGetPlanConfigList(strSelectedWeek, udtUser.Site.Code)
    '            Dim dtConfig As DataTable = cPlan.GetPlanConfig(strSelectedWeek, udtUser.Site.Code, )
    '            Dim intCodeDay As Integer
    '            If dtConfig.Rows.Count > 0 Then
    '                Dim strCodeDay() As String = CStr(dtConfig.Rows(0)("Days")).Split("-")
    '                intCodeDay = strCodeDay(1)

    '                For i As Integer = 0 To intCodeDay - 1
    '                    'Measure Row Height 
    '                    dtList = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code)
    '                    If dtList.Rows.Count > 0 Then
    '                        Dim foundRowPlan() As DataRow
    '                        foundRowPlan = dtList.Select("CodeDay=" & i + 1, "CodeDay ASC, ProposalNo ASC")
    '                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                        intRowDetailsHeight = ((intTextHeight - 3) * 6)
    '                        'intRowDetailsHeight = 115
    '                        If foundRowPlan.Length > 0 Then
    '                            ''For iRow As Integer = 0 To foundRowPlan.Length - 1 'nNo-1'foundRowPlan.GetUpperBound(0)
    '                            ''    If iRow + 1 <= 3 Then
    '                            ''        Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans)
    '                            ''        '                                    Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                            ''        Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                            ''        Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                            ''        Dim intCX As Integer = 0, intCY As Integer = 0

    '                            ''        For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                            ''            strX = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Trim
    '                            ''            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                            ''            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            ''            intCY += intTextHeight - 3
    '                            ''        Next

    '                            ''        If intRowDetailsHeight < intCY Then intRowDetailsHeight = intCY
    '                            ''    End If
    '                            ''Next

    '                            'Print Detail Rows
    '                            intNewX = 0 'line
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1, 4, , True)})
    '                            intNewY += 5
    '                            intGuideY = intNewY

    '                            '1St Col
    '                            intNewX = 0
    '                            strX = fctGetDay(i + 1, cLang)
    '                            If intNo <= 3 Then
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColDayWidth, sf, Me.Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColDayWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            Else
    '                                Dim dblLogoWidth As Double = 23
    '                                Dim dblLogoHeight As Double = 113
    '                                Dim xPicture As XRPictureBox
    '                                If Not G_strLogoPath = Nothing Then
    '                                    If File.Exists(G_strPhotoPath & strX & ".jpg") Then
    '                                        xPicture = fctMakePictureBox(G_strPhotoPath & strX & ".jpg", intNewX + 5, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                        .Detail.Controls.AddRange(New XRControl() {xPicture})
    '                                    End If
    '                                End If
    '                            End If

    '                            '2nd Col
    '                            For iRow As Integer = 0 To foundRowPlan.Length - 1 'intNo - 1 'foundRowPlan.GetUpperBound(0)
    '                                If iRow + 1 <= 3 Then
    '                                    If foundRowPlan(iRow)("CodeDay") = i + 1 Then
    '                                        intNewY = intGuideY
    '                                        If iRow = 0 Then
    '                                            intNewX += intColDayWidth
    '                                        Else
    '                                            intNewX += intColWidth
    '                                        End If

    '                                        '============= TEST =======================
    '                                        ''Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans)
    '                                        ' ''Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                                        ''Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                                        ''Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                        ''Dim intCX As Integer = 0, intCY As Integer = 0

    '                                        ''Dim strItemName() As String
    '                                        ''Dim itemcount As Integer = 0
    '                                        ''For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                                        ''    strItemName = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Split(vbCrLf)
    '                                        ''    For x As Integer = 0 To UBound(strItemName)
    '                                        ''        strX = strItemName(x).Trim
    '                                        ''        If Not strX = "" Then
    '                                        ''            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                        ''            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                        ''            intCY += intTextHeight
    '                                        ''            itemcount += 1
    '                                        ''            If itemcount >= 6 Then Exit For
    '                                        ''        End If
    '                                        ''    Next
    '                                        ''    If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                        ''    .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                        ''    If itemcount >= 6 Then Exit For
    '                                        ''Next

    '                                        Dim dtPlanTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code)
    '                                        Dim foundRowPlanTrans() As DataRow = dtPlanTrans.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo") & " AND CodeTrans=" & G_ReportOptions.intCodeTrans, "CodeDay ASC, ProposalNo ASC")

    '                                        Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                        Dim intCX As Integer = 0, intCY As Integer = 0

    '                                        Dim strItemName() As String
    '                                        For iRowT As Integer = 0 To foundRowPlanTrans.GetUpperBound(0)
    '                                            strItemName = CStrDB(foundRowPlanTrans(iRowT)("ItemName2")).Split(vbCrLf)
    '                                            For x As Integer = 0 To UBound(strItemName)
    '                                                strX = strItemName(x).Trim
    '                                                If Not strX = "" Then
    '                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                                                    xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                                    intCY += intTextHeight - 3
    '                                                End If
    '                                            Next
    '                                            If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                            .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                        Next


    '                                        '============= TEST =======================

    '                                        intNewY += intRowDetailsHeight
    '                                        intNewY += 5

    '                                        'Price
    '                                        Dim strPrice() As String = CStrDB(foundDetails(0)("Price")).Split(CChar(";"))
    '                                        strX = ""
    '                                        For iPrice As Integer = 0 To UBound(strPrice)
    '                                            If Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "" And Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "0" Then
    '                                                strX += fctGetPrice(IIf(strPrice(iPrice) = "", 0, strPrice(iPrice))) & " "
    '                                                strX += IIf(CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)) = "", "", CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1))) & " "
    '                                            End If
    '                                        Next

    '                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntFont, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                        intNewY += intTextHeight
    '                                    End If
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If

    '        End With
    '        '--- DETAIL ---

    '        '--- PAGE FOOTER ---
    '        With Me
    '            .xrPIPageNumber.Visible = False
    '            .xrLinePF.Visible = False
    '            .xrLblEGS2.Visible = False
    '            .xrLblEGS.Visible = False

    '            .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 150
    '            intNewX = 0
    '            intNewY = 0


    '            'EMBASSY
    '            fntBold = New Font("Arial", 9, FontStyle.Bold)
    '            Dim dtEmbassy As DataTable = G_ReportOptions.dtPlan2

    '            'MEASURE
    '            Dim intTextWidth As Integer = 0
    '            Dim intTitleWidth As Integer = 0
    '            For Each rowEm As DataRow In dtEmbassy.Rows
    '                Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '                For i As Integer = 0 To UBound(strTitles) - 1
    '                    Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                    If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                        strX = strTitle(1)
    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                        If intTitleWidth < intTextWidth Then intTitleWidth = intTextWidth
    '                        Exit For
    '                    End If
    '                Next
    '            Next

    '            For Each rowEm As DataRow In dtEmbassy.Rows
    '                Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '                Dim strTexts() As String = CStrDB(rowEm("Text")).Split(CChar("¤"))


    '                For i As Integer = 0 To UBound(strTitles) - 1
    '                    Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                    Dim strText() As String = strTexts(i).Split(CChar("¶"))


    '                    If strText(0) = foundDetails(0)("CodeTrans") Then
    '                        If Not strText(1) = "" Then
    '                            If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                                strX = strTitle(1)
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width + 50
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTitleWidth + 15, sf, Padding).Height
    '                                .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                intNewX += intTitleWidth + 30
    '                            End If

    '                            strX = strText(1)
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '                            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth - (intTitleWidth + 30), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewY += intTextHeight
    '                        End If
    '                    End If
    '                    intNewX = 0
    '                Next
    '            Next

    '            'ADDRESS
    '            intNewY = 0
    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth - (intTitleWidth + 30), sf, Padding).Height
    '            intNewY += (intTextHeight * 3)
    '            intNewY += 20
    '            intNewX = 0
    '            fntRegular = New Font("Arial", 8.0!, FontStyle.Regular)
    '            fntBold = New Font("Arial", 8.0!, FontStyle.Bold)

    '            If foundDetails.Length > 0 Then
    '                strX = "SV (Schweiz) AG"
    '                If Not CStrDB(foundDetails(0)("BusinessName")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessName")).Trim
    '                'If Not CStrDB(foundDetails(0)("BusinessNumber")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessNumber")).Trim
    '                If Not CStrDB(foundDetails(0)("Street")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Street")).Trim
    '                If Not CStrDB(foundDetails(0)("Zip")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Zip")).Trim
    '                If Not CStrDB(foundDetails(0)("City")).Trim = "" Then strX += " " & CStrDB(foundDetails(0)("City")).Trim
    '                If Not CStrDB(foundDetails(0)("Phone")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Phone")).Trim
    '                If Not CStrDB(foundDetails(0)("Email")).Trim = "" Then
    '                    strX += ", " & cLang.GetString(clsEGSLanguage.CodeType.Email) & " " & CStrDB(foundDetails(0)("Email")).Trim
    '                End If

    '                intTextHeight = ReportingTextUtils.MeasureText(strX.Trim, fntRegular, intAvailableWidth, sf, Padding).Height
    '                .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                intNewY += intTextHeight
    '            End If

    '            intNewY += 10
    '            strX = "Preise in CHF inkl. MWST"
    '            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '        End With
    '        '--- PAGE FOOTER ---

    '        Return Me
    '    End Function

    '    Public Function fctPrintMenuPlanDetailSV_A4Quer(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                                   Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo)

    '        If foundDetails.Length = 0 Then Return Me

    '        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
    '        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '        Dim dtMPTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code)
    '        Dim dtMPConfig As DataTable = cPlan.fctGetPlanConfigList(strSelectedWeek, udtUser.Site.Code)
    '        Dim dtMPList As DataTable = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code)
    '        Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans)

    '        With Me
    '            Try
    '                fntReportTitle = New Font("Arial Black", 15, FontStyle.Bold)
    '                fntBold = New Font("Arial Black", 8, FontStyle.Bold)
    '                fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                fntFont = New Font("Arial", 6, FontStyle.Regular)
    '            Catch ex As Exception
    '                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                Return Me
    '            End Try
    '        End With

    '        With Me 'paper , orientation, width
    '            .PaperKind = New System.Drawing.Printing.PaperKind
    '            .PaperKind = Printing.PaperKind.A4

    '            .Landscape = G_ReportOptions.blLandscape
    '            .Margins = New System.Drawing.Printing.Margins(50.0!, 50.0!, 50.0!, 50.0!)
    '            intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '        End With

    '        '--- PAGE HEADER ---
    '        With Me
    '            intNewX = 0
    '            intNewY = 0

    '            Dim intTextWidth As Integer = 0

    '            'Measure Left Side
    '            Dim intLeftWidthX As Integer = 0

    '            strX = strSelectedWeek
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Me.Padding).Width
    '            If intLeftWidthX < intTextWidth Then intLeftWidthX = intTextWidth

    '            intLeftWidthX += 10

    '            'Measure Center
    '            Dim intCenterWidthX As Integer = 0
    '            Dim intCol1 As Integer = 0
    '            Dim intCol2 As Integer = 0
    '            Dim intCol3 As Integer = 0

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol1 += intTextWidth

    '            strX = CStrDB(foundDetails(0)("OpenDays"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol2 += intTextWidth

    '            strX = CStrDB(foundDetails(0)("CloseDays"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth

    '            strX = CStrDB(foundDetails(0)("OpenTime"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            intCol3 += intTextWidth

    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextWidth += 5
    '            If intCol3 < intTextWidth Then intCol3 = intTextWidth

    '            intCenterWidthX = intCol1 + intCol2 + intCol3 + 10


    '            'Measure Right Side
    '            Dim intRightWidthX As Integer = intAvailableWidth - intLeftWidthX - intCenterWidthX
    '            Dim intPicWidth As Integer = 0

    '            Dim xPic As XRPictureBox
    '            Dim dblLogoWidth As Double = 115
    '            Dim dblLogoHeight As Double = 52

    '            If enumMPPrintStyle = enumMPStyle.A4CWLogo Then
    '                If Not G_strLogoPath = Nothing Then
    '                    If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                        Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                        If dtLogo.Rows.Count > 0 Then
    '                            If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                                xPic = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                intPicWidth = xPic.Width
    '                            End If
    '                        End If
    '                    End If
    '                End If
    '            End If

    '            intCenterWidthX += (intAvailableWidth - (intLeftWidthX + intCenterWidthX + intPicWidth))

    '            'Print Left Side
    '            intNewX = 0
    '            intNewY = 0

    '            strX = "Menuplan"
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Me.Padding).Width
    '            If intLeftWidthX < intTextWidth Then intLeftWidthX = intTextWidth
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewY += intTextHeight
    '            strX = strSelectedWeek
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intLeftWidthX
    '            intNewY = 0

    '            'Print Center
    '            If Not CStrDB(foundDetails(0)("OpenDays")).Trim = "" Or Not CStrDB(foundDetails(0)("OpenTime")).Trim = "" Then
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol1
    '                strX = CStrDB(foundDetails(0)("OpenDays"))
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol2
    '                strX = CStrDB(foundDetails(0)("OpenTime"))
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewY += intTextHeight
    '                intNewX = intLeftWidthX + intCol1
    '            End If

    '            If Not CStrDB(foundDetails(0)("CloseDays")).Trim = "" Then
    '                strX = CStrDB(foundDetails(0)("CloseDays"))
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                intNewX += intCol2
    '                strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '                .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '            End If

    '            intNewX = intLeftWidthX + intCenterWidthX
    '            intNewY = 0

    '            'Print Right Side
    '            If enumMPPrintStyle = enumMPStyle.A4CWLogo Then
    '                If Not G_strLogoPath = Nothing Then
    '                    If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                        Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                        If dtLogo.Rows.Count > 0 Then
    '                            If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                                xPic = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                .PageHeader.Controls.AddRange(New XRControl() {xPic})
    '                            End If
    '                        End If
    '                    End If
    '                End If
    '            End If
    '        End With
    '        '--- PAGE HEADER ---

    '        '--- DETAIL ---
    '        With Me
    '            fntBold = New Font("Arial Black", 9, FontStyle.Bold)
    '            fntRegular = New Font("Arial", 9, FontStyle.Regular)
    '            fntFont = New Font("Arial", 8, FontStyle.Regular)

    '            intNewX = 0
    '            intNewY = 0
    '            'Dim intColDayWidth As Integer = 0
    '            Dim intTextWidth As Integer = 0

    '            'MEASURE LEFT SIDE - PROPOSAL
    '            Dim intNo As Integer = CIntDB(foundDetails(0)("NoOfProposal"))

    '            Dim intCol1 As Integer = 0

    '            Dim strProposals() As String = CStrDB(foundDetails(0)("ProposalName")).Split(CChar("¶"))
    '            Dim strProposal() As String

    '            'For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '            '    If Not i + 1 > intNo Then
    '            '        strProposal = strProposals(i).Split(CChar("¤"))
    '            '        strX = strProposal(1)
    '            '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '            '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '            '    End If
    '            'Next
    '            'intCol1 += 10
    '            intCol1 = 110

    '            'MEASURE TITLE HEIGHT - DAYS
    '            Dim intRowTitleHeight As Integer = 0
    '            Dim strDays() As String = CStrDB(foundDetails(0)("Days")).Split(CChar("-"))
    '            Dim intColWidth As Integer = ((intAvailableWidth - intCol1) / strDays(1))
    '            For i As Integer = strDays(0) To strDays(1)
    '                strX = fctGetDay(i, cLang)
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Padding).Height
    '                If intRowTitleHeight < intTextHeight Then intRowTitleHeight = intTextHeight
    '            Next
    '            intRowTitleHeight = intRowTitleHeight - 3

    '            'PRINT TITLE - DAYS
    '            intNewX = intCol1
    '            'intNewY = 15

    '            For i As Integer = strDays(0) To strDays(1)
    '                strX = fctGetDay(i, cLang)
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth - 5, sf, Padding).Height
    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                If Not i = strDays(1) Then intNewX += intColWidth
    '            Next

    '            intNewY += intRowTitleHeight

    '            'ROW DETAILS
    '            Dim foundRowPlan() As DataRow
    '            Dim foundRowPlanDetail() As DataRow
    '            Dim intRowDetailsHeight As Integer = 0
    '            Dim intGuideY As Integer = intNewY

    '            If dtMPConfig.Rows.Count > 0 Then

    '                For iPro As Integer = 0 To intNo - 1
    '                    'MEASURE ROW HEIGHT 
    '                    If dtMPList.Rows.Count > 0 Then
    '                        foundRowPlan = dtMPList.Select("ProposalNo=" & iPro + 1, "CodeDay ASC, ProposalNo ASC")
    '                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                        intRowDetailsHeight = ((intTextHeight - 3) * 6)

    '                        If foundRowPlan.Length > 0 Then
    '                            'PRINT LINE
    '                            intNewX = 0
    '                            'intNewY += intRowTitleHeight
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeLine(0, intNewY, intAvailableWidth, 1, 4, , True)})
    '                            intNewY += 5
    '                            intGuideY = intNewY

    '                            'PRINT FIRST COLUMN - PROPOSAL
    '                            intNewX = 0
    '                            strProposal = strProposals(iPro).Split(CChar("¤"))
    '                            strX = strProposal(1)
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol1, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                            'PRINT SECOND COLUMN - DETAILS
    '                            For iRow As Integer = 0 To foundRowPlan.Length - 1 'strDays(1) - 1
    '                                If foundRowPlan(iRow)("ProposalNo") = iPro + 1 Then
    '                                    intNewY = intGuideY
    '                                    If iRow = 0 Then
    '                                        intNewX += intCol1
    '                                    Else
    '                                        If Not iRow = strDays(1) Then intNewX += intColWidth
    '                                    End If

    '                                    '================ TEST ========================
    '                                    'foundRowPlanDetail = dtPlanDetail.Select("ProposalNo=" & iPro + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                                    'foundRowPlanDetail = dtPlanDetail.Select("CodeDay=" & iRow + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                                    'Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                    'Dim intCX As Integer = 0, intCY As Integer = 0

    '                                    'Dim itemcount As Integer = 0
    '                                    'Dim strItemName() As String
    '                                    'For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                                    '    strItemName = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Split(vbCrLf)
    '                                    '    For x As Integer = 0 To UBound(strItemName)
    '                                    '        strX = strItemName(x).Trim
    '                                    '        If Not strX = "" Then
    '                                    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                    '            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    '            intCY += (intTextHeight - 3)
    '                                    '            itemcount += 1
    '                                    '            If itemcount >= 6 Then Exit For
    '                                    '        End If
    '                                    '    Next
    '                                    '    If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                    '    .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                    '    If itemcount >= 6 Then Exit For
    '                                    'Next
    '                                    Dim dtPlanTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code)
    '                                    Dim foundRowPlanTrans() As DataRow = dtPlanTrans.Select("CodeDay=" & iRow + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo") & " AND CodeTrans=" & G_ReportOptions.intCodeTrans, "CodeDay ASC, ProposalNo ASC")

    '                                    Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                    Dim intCX As Integer = 0, intCY As Integer = 0

    '                                    Dim strItemName() As String
    '                                    For iRowT As Integer = 0 To foundRowPlanTrans.GetUpperBound(0)
    '                                        strItemName = CStrDB(foundRowPlanTrans(iRowT)("ItemName2")).Split(vbCrLf)
    '                                        For x As Integer = 0 To UBound(strItemName)
    '                                            strX = strItemName(x).Trim
    '                                            If Not strX = "" Then
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                                                xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                                intCY += intTextHeight - 3
    '                                            End If
    '                                        Next
    '                                        If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                        .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                    Next

    '                                    '============= TEST ===========================

    '                                    intNewY += intRowDetailsHeight
    '                                    intNewY += 5

    '                                    'PRICE
    '                                    Dim strPrice() As String = CStrDB(foundDetails(0)("Price")).Split(CChar(";"))
    '                                    strX = ""
    '                                    For iPrice As Integer = 0 To UBound(strPrice)
    '                                        If Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "" And Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "0" Then
    '                                            strX += fctGetPrice(IIf(strPrice(iPrice) = "", 0, strPrice(iPrice))) & " "
    '                                            strX += IIf(CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)) = "", "", CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1))) & " "
    '                                        End If
    '                                    Next

    '                                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntFont, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += (intTextHeight - 4)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If


    '        End With
    '        '--- DETAIL ---

    '        '--- PAGE FOOTER ---
    '        With Me
    '            intNewX = 0
    '            intNewY = 5
    '            .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 60

    '            'EMBASSY
    '            fntBold = New Font("Arial", 8, FontStyle.Bold)
    '            fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '            Dim dtEmbassy As DataTable = G_ReportOptions.dtPlan2

    '            'MEASURE
    '            Dim intTextWidth As Integer = 0
    '            Dim intTitleWidth As Integer = 0
    '            For Each rowEm As DataRow In dtEmbassy.Rows
    '                Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '                For i As Integer = 0 To UBound(strTitles) - 1
    '                    Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                    If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                        strX = strTitle(1)
    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                        If intTitleWidth < intTextWidth Then intTitleWidth = intTextWidth
    '                        Exit For
    '                    End If
    '                Next
    '            Next

    '            For Each rowEm As DataRow In dtEmbassy.Rows
    '                Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '                Dim strTexts() As String = CStrDB(rowEm("Text")).Split(CChar("¤"))


    '                For i As Integer = 0 To UBound(strTitles) - 1
    '                    Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                    Dim strText() As String = strTexts(i).Split(CChar("¶"))


    '                    If strText(0) = foundDetails(0)("CodeTrans") Then
    '                        If Not strText(1) = "" Then
    '                            If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                                strX = strTitle(1)
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width + 50
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTitleWidth + 15, sf, Padding).Height
    '                                .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                intNewX += intTitleWidth + 30
    '                            End If

    '                            strX = strText(1)
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '                            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth - (intTitleWidth + 30), intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewY += (intTextHeight - 3)
    '                        End If
    '                    End If
    '                    intNewX = 0
    '                Next
    '            Next
    '            intNewY = 0

    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '            intNewY += ((intTextHeight - 3) * 3)
    '            intNewY += 10

    '            'ADDRESS
    '            intNewX = 0
    '            fntRegular = New Font("Arial", 7.0!, FontStyle.Regular)
    '            fntBold = New Font("Arial Black", 7.0!, FontStyle.Bold)

    '            strX = "Preise in CHF inkl. MWST"
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '            intNewX += intTextWidth + 100

    '            If foundDetails.Length > 0 Then
    '                strX = "SV (Schweiz) AG"
    '                If Not CStrDB(foundDetails(0)("BusinessName")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessName")).Trim
    '                If Not CStrDB(foundDetails(0)("Street")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Street")).Trim
    '                If Not CStrDB(foundDetails(0)("Zip")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Zip")).Trim
    '                If Not CStrDB(foundDetails(0)("City")).Trim = "" Then strX += " " & CStrDB(foundDetails(0)("City")).Trim
    '                If Not CStrDB(foundDetails(0)("Phone")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Phone")).Trim
    '                If Not CStrDB(foundDetails(0)("Email")).Trim = "" Then
    '                    strX += ", " & cLang.GetString(clsEGSLanguage.CodeType.Email) & " " & CStrDB(foundDetails(0)("Email")).Trim
    '                End If

    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '            End If
    '        End With
    '        '--- PAGE FOOTER ---

    '        Return Me
    '    End Function

    '    Public Function fctPrintMenuPlanDetailSV_A4ShinweisKennzei(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                                 Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo)

    '        If foundDetails.Length = 0 Then Return Me
    '        Dim strNo As String = CStr(foundDetails(0)("ProposalNo"))
    '        Dim strCodeTrans As String = CStr(foundDetails(0)("CodeTrans"))
    '        Dim strCodeDay As String = CStr(foundDetails(0)("CodeDay"))
    '        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '        Select Case enumMPPrintStyle
    '            Case enumMPStyle.AngebotshinweisA4H, enumMPStyle.AngebotshinweisA4H_auf
    '                With Me 'PAGE PROPERTIES
    '                    Try
    '                        fntReportTitle = New Font("Arial Black", 35, FontStyle.Bold)
    '                        fntBold = New Font("Arial Black", 25, FontStyle.Bold)
    '                        fntRegular = New Font("Arial", 25, FontStyle.Regular)
    '                    Catch ex As Exception
    '                        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                        Return Me
    '                    End Try

    '                    .PaperKind = New System.Drawing.Printing.PaperKind
    '                    .PaperKind = Printing.PaperKind.A4
    '                    .Landscape = G_ReportOptions.blLandscape

    '                    If enumMPPrintStyle = enumMPStyle.AngebotshinweisA4H Then
    '                        .Margins = New System.Drawing.Printing.Margins(150.0!, 50.0!, 200.0!, 150.0!)
    '                    ElseIf enumMPPrintStyle = enumMPStyle.AngebotshinweisA4H_auf Then
    '                        .Margins = New System.Drawing.Printing.Margins(250.0!, 20.0!, 200.0!, 50.0!)
    '                    End If

    '                    intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '                    'intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '                End With

    '                Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '                Dim dtName As DataTable = G_ReportOptions.dtPlan
    '                Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
    '                Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

    '                With Me 'DETAILS
    '                    intNewX = 0
    '                    intNewY = 0

    '                    Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
    '                    Dim intItemHeight As Integer = ((.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height - 11) * 8)
    '                    Dim fntBoldPrice As Font = New Font("Arial Black", 19, FontStyle.Bold)
    '                    Dim fntRegularCoName As Font = New Font("Arial", 13, FontStyle.Bold)
    '                    Dim intPriceHeight As Integer = (.MeasureText("A", fntBoldPrice, intAvailableWidth, sf, Padding).Height - 10) * 3
    '                    Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intAvailableWidth, sf, Padding).Height

    '                    'TITLE AND ITEMS
    '                    Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
    '                    If foundProName.Length > 0 Then
    '                        strX = CStrDB(foundProName(0)("ProposalName"))
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    End If
    '                    intNewY += intTitleHeight + 25


    '                    Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    Dim strItemName() As String
    '                    If foundItemName.Length > 0 Then
    '                        For i As Integer = 0 To foundItemName.GetUpperBound(0)
    '                            strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To UBound(strItemName)
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += (intTextHeight - 12)
    '                                End If
    '                            Next
    '                        Next
    '                    End If


    '                    'PRICE
    '                    intNewY = (intTitleHeight + 25 + intItemHeight)
    '                    fntBold = New Font("Arial Black", 19, FontStyle.Bold)
    '                    fntRegular = New Font("Arial", 20, FontStyle.Regular)

    '                    Dim intColPrice1 As Integer = 0
    '                    Dim intColPrice2 As Integer = 0

    '                    Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
    '                    Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

    '                    If foundRowPrice.Length > 0 Then
    '                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
    '                        For i As Integer = 0 To UBound(strPrice)
    '                            strX = fctGetPrice(strPrice(i))
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth
    '                        Next
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                                strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                            End If
    '                        Next

    '                        'Print
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                                For i As Integer = 0 To UBound(strPrice)
    '                                    If (iP + 1) = (i + 1) Then
    '                                        strX = fctGetPrice(strPrice(i)).Trim
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

    '                                        intNewX += intColPrice1 + 15

    '                                        strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                        intNewX += intColPrice2 + 15
    '                                        If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
    '                                            strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                        End If

    '                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                                        intNewY += (intTextHeight - 10)
    '                                        intNewX = 0
    '                                        Exit For
    '                                    End If
    '                                Next
    '                            End If
    '                        Next

    '                        intNewY = (intTitleHeight + 25 + intItemHeight + intPriceHeight)
    '                        fntBold = New Font("Arial", 13, FontStyle.Bold)
    '                        Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                        If foundCoName.Length > 0 Then
    '                            strX = CStrDB(foundCoName(0)("CoName")).Trim
    '                            If Not strX = "" Then
    '                                strX = "*" & strX
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                        End If
    '                    End If

    '                    'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '                    'Dim dtName As DataTable = G_ReportOptions.dtPlan
    '                    'Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
    '                    'Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

    '                    'Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
    '                    'If foundProName.Length > 0 Then
    '                    '    strX = CStrDB(foundProName(0)("ProposalName"))
    '                    '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Padding).Height
    '                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight - 11, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    'End If
    '                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height

    '                    'intNewY += intTextHeight
    '                    'intNewY += 30

    '                    'Dim foundIngr() As DataRow = dtIngr.Select("CodeDay=" & strCodeDay & " AND ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans)
    '                    'Dim currentY As Integer = intNewY
    '                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    'Dim intItemHeight As Integer

    '                    'intItemHeight = ((intTextHeight - 11) * 8)

    '                    ''PRINT
    '                    ''Dim itemcount As Integer = 0
    '                    ''Dim strItemName() As String
    '                    ''If foundIngr.Length > 0 Then
    '                    ''    For i As Integer = 0 To foundIngr.GetUpperBound(0)
    '                    ''        strItemName = CStr(foundIngr(i)("Name")).Split(vbCrLf)
    '                    ''        For x As Integer = 0 To UBound(strItemName)
    '                    ''            strX = strItemName(x).Trim
    '                    ''            If Not strX = "" Then
    '                    ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    ''                intNewY += (intTextHeight - 12)
    '                    ''                itemcount += 1
    '                    ''                If itemcount >= 6 Then Exit For
    '                    ''            End If
    '                    ''        Next
    '                    ''        If itemcount > 6 Then Exit For
    '                    ''    Next
    '                    ''End If
    '                    'Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    'Dim strItemName() As String
    '                    'If foundItemName.Length > 0 Then
    '                    '    For i As Integer = 0 To foundItemName.GetUpperBound(0)
    '                    '        strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
    '                    '        For x As Integer = 0 To UBound(strItemName)
    '                    '            strX = strItemName(x).Trim
    '                    '            If Not strX = "" Then
    '                    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    '                intNewY += (intTextHeight - 12)
    '                    '            End If
    '                    '        Next
    '                    '    Next
    '                    'End If
    '                    ''============TEST=====================

    '                    'intNewY = currentY
    '                    'intNewY += intItemHeight

    '                    'fntBold = New Font("Arial Black", 19, FontStyle.Bold)
    '                    'fntRegular = New Font("Arial", 20, FontStyle.Regular)

    '                    ''Measure Price
    '                    'Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
    '                    'Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

    '                    'If foundRowPrice.Length > 0 Then
    '                    '    Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
    '                    '    Dim intTextWidth As Integer = 0
    '                    '    Dim intCol1 As Integer = 0
    '                    '    Dim intCol2 As Integer = 0

    '                    '    For i As Integer = 0 To UBound(strPrice)
    '                    '        strX = fctGetPrice(strPrice(i))
    '                    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                    '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '                    '    Next
    '                    '    For iP As Integer = 0 To 2
    '                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                    '            strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth
    '                    '        End If
    '                    '    Next
    '                    '    intCol2 += 10

    '                    '    intNewX = 0
    '                    '    For iP As Integer = 0 To 2
    '                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                    '            For i As Integer = 0 To UBound(strPrice)
    '                    '                If (iP + 1) = (i + 1) Then
    '                    '                    strX = fctGetPrice(strPrice(i)).Trim
    '                    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

    '                    '                    intNewX += intCol1 + 15

    '                    '                    strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
    '                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                    '                    intNewX += intCol2 + 15
    '                    '                    If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
    '                    '                        strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
    '                    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                    '                    End If

    '                    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    '                    intNewY += (intTextHeight - 10)
    '                    '                    intNewX = 0
    '                    '                    Exit For
    '                    '                End If
    '                    '            Next
    '                    '        End If
    '                    '    Next
    '                    'End If
    '                    'intNewY += 3
    '                    'intNewX = 0
    '                    'fntBold = New Font("Arial", 13, FontStyle.Bold)
    '                    'Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    'If foundCoName.Length > 0 Then
    '                    '    If Not CStrDB(foundCoName(0)("CoName")).Trim = "" Then
    '                    '        strX = "*" & CStrDB(foundCoName(0)("CoName")).Trim
    '                    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    '    End If
    '                    'End If
    '                End With


    '                With Me 'PAGE FOOTER
    '                    intNewX = 0
    '                    intNewY = 0
    '                    fntRegular = New Font("Arial", 12, FontStyle.Regular)
    '                    .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 100

    '                    Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
    '                    If Not dtConfig Is Nothing Then
    '                        Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))

    '                        If blnShowNut Then
    '                            'MEASURE WIDTH
    '                            'Get Nutrient Header
    '                            Dim arrNutrientName As New ArrayList
    '                            Dim arrNutrientFormat As New ArrayList
    '                            Dim arrNutrientUnit As New ArrayList

    '                            subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit, 0)

    '                            'Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
    '                            'Dim dt As DataTable = cNutrient.GetList().Tables(0)
    '                            'Dim dtNutTrans As DataTable = cNutrient.fctGetNutrientTrans
    '                            'Dim dvNutTrans As New DataView(dtNutTrans)
    '                            'dvNutTrans.RowFilter = "CodeTrans=" & G_ReportOptions.intTranslation
    '                            'dtNutTrans = dvNutTrans.ToTable

    '                            'If Not dt Is Nothing Then
    '                            '    For Each row As DataRow In dt.Rows
    '                            '        For Each rowTrans As DataRow In dtNutTrans.Rows
    '                            '            If rowTrans("CodeMain") = row("Nutr_No") Then
    '                            '                arrNutrientName.Add(rowTrans("Name"))
    '                            '                Exit For
    '                            '            End If
    '                            '        Next
    '                            '        arrNutrientFormat.Add(row("Format"))
    '                            '        arrNutrientUnit.Add(row("Units"))
    '                            '    Next
    '                            'End If

    '                            Dim intTextWidth As Integer
    '                            Dim intCol1 As Integer = 0
    '                            Dim intCol2 As Integer = 0
    '                            Dim intCol3 As Integer = 0
    '                            Dim intColSpace As Integer = 3

    '                            Select Case G_ReportOptions.intPageLanguage
    '                                Case 3 'FRENCH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                Case 2 'GERMAN
    '                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                Case 1 'ENGLISH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                            End Select

    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Exit For
    '                                End If
    '                            Next
    '                            intNewY += (intTextHeight)

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '                                End If
    '                            Next

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), "##0")
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                    intNewX += intCol1 + intColSpace

    '                                    If iNut = 0 Then
    '                                        strX = arrNutrientUnit(iNut)
    '                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Else
    '                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    End If
    '                                    intNewX = 0
    '                                    intNewY += (intTextHeight)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                End With
    '            Case enumMPStyle.KennzeichnungA4C, enumMPStyle.KennzeichnungA4C_auf
    '                With Me 'PAGE PROPERTIES
    '                    Try
    '                        fntReportTitle = New Font("Arial Black", 45, FontStyle.Bold)
    '                        fntBold = New Font("Arial Black", 25, FontStyle.Bold)
    '                        fntRegular = New Font("Arial", 25, FontStyle.Regular)
    '                    Catch ex As Exception
    '                        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                        Return Me
    '                    End Try

    '                    .PaperKind = New System.Drawing.Printing.PaperKind
    '                    .PaperKind = Printing.PaperKind.A4
    '                    .Landscape = G_ReportOptions.blLandscape

    '                    If enumMPPrintStyle = enumMPStyle.KennzeichnungA4C Then
    '                        .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 50.0!, 50.0!)
    '                    ElseIf enumMPPrintStyle = enumMPStyle.KennzeichnungA4C_auf Then
    '                        .Margins = New System.Drawing.Printing.Margins(257.0!, 50.0!, 150.0!, 50.0!)
    '                    End If

    '                    intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right) - 20
    '                    intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom) - 10
    '                End With

    '                Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '                Dim dtName As DataTable = G_ReportOptions.dtPlan
    '                Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
    '                Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

    '                With Me 'DETAILS
    '                    intNewX = 0
    '                    intNewY = 0

    '                    Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
    '                    Dim intItemHeight As Integer = ((.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height - 12) * 6) + 20
    '                    Dim fntBoldPrice As Font = New Font("Arial Black", 19, FontStyle.Bold)
    '                    Dim fntRegularCoName As Font = New Font("Arial", 12, FontStyle.Bold)
    '                    Dim intPriceHeight As Integer = (.MeasureText("A", fntBoldPrice, intAvailableWidth, sf, Padding).Height - 10) * 3
    '                    Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intAvailableWidth, sf, Padding).Height

    '                    'TITLE AND ITEMS
    '                    Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
    '                    If foundProName.Length > 0 Then
    '                        strX = CStrDB(foundProName(0)("ProposalName"))
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    End If
    '                    intNewY += intTitleHeight + 25


    '                    Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    Dim strItemName() As String
    '                    If foundItemName.Length > 0 Then
    '                        For i As Integer = 0 To foundItemName.GetUpperBound(0)
    '                            strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To UBound(strItemName)
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += (intTextHeight - 12)
    '                                End If
    '                            Next
    '                        Next
    '                    End If


    '                    'PRICE
    '                    intNewY = (intTitleHeight + 25 + intItemHeight)
    '                    fntBold = New Font("Arial Black", 19, FontStyle.Bold)
    '                    fntRegular = New Font("Arial", 20, FontStyle.Regular)

    '                    Dim intColPrice1 As Integer = 0
    '                    Dim intColPrice2 As Integer = 0

    '                    Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
    '                    Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

    '                    If foundRowPrice.Length > 0 Then
    '                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
    '                        For i As Integer = 0 To UBound(strPrice)
    '                            strX = fctGetPrice(strPrice(i))
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth
    '                        Next
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                                strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                            End If
    '                        Next

    '                        'Print
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                                For i As Integer = 0 To UBound(strPrice)
    '                                    If (iP + 1) = (i + 1) Then
    '                                        strX = fctGetPrice(strPrice(i)).Trim
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

    '                                        intNewX += intColPrice1 + 15

    '                                        strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                        intNewX += intColPrice2 + 15
    '                                        If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
    '                                            strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                        End If

    '                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                                        intNewY += (intTextHeight - 10)
    '                                        intNewX = 0
    '                                        Exit For
    '                                    End If
    '                                Next
    '                            End If
    '                        Next

    '                        intNewY = (intTitleHeight + 25 + intItemHeight + intPriceHeight)
    '                        fntBold = New Font("Arial", 12, FontStyle.Bold)
    '                        Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                        If foundCoName.Length > 0 Then
    '                            strX = CStrDB(foundCoName(0)("CoName")).Trim
    '                            If Not strX = "" Then
    '                                strX = "*" & strX
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                        End If
    '                    End If


    '                    'intNewX = 0
    '                    'intNewY = 0

    '                    'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '                    'Dim dtName As DataTable = G_ReportOptions.dtPlan
    '                    'Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
    '                    'Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

    '                    'Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
    '                    'If foundProName.Length > 0 Then
    '                    '    strX = CStrDB(foundProName(0)("ProposalName"))
    '                    '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Padding).Height
    '                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight - 11, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    'End If

    '                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
    '                    'intNewY += (intTextHeight - 12)
    '                    'intNewY += 10

    '                    ''============TEST===================
    '                    ''Dim foundIngr() As DataRow = dtIngr.Select("CodeDay=" & strCodeDay & " AND ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans)
    '                    ''Dim currentY As Integer = intNewY
    '                    ''intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    ''Dim intItemHeight As Integer = ((intTextHeight - 12) * 6) + 20


    '                    ' ''PRINT
    '                    ''Dim itemcount As Integer = 0
    '                    ''Dim strItemName() As String
    '                    ''If foundIngr.Length > 0 Then
    '                    ''    For i As Integer = 0 To foundIngr.GetUpperBound(0)
    '                    ''        strItemName = CStr(foundIngr(i)("Name")).Split(vbCrLf)
    '                    ''        For x As Integer = 0 To UBound(strItemName)
    '                    ''            strX = strItemName(x).Trim
    '                    ''            If Not strX = "" Then
    '                    ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    ''                intNewY += (intTextHeight - 12)
    '                    ''                itemcount += 1
    '                    ''                If itemcount >= 6 Then Exit For
    '                    ''            End If
    '                    ''        Next
    '                    ''        If itemcount > 6 Then Exit For
    '                    ''    Next
    '                    ''End If

    '                    'Dim currentY As Integer = intNewY
    '                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    'Dim intItemHeight As Integer = ((intTextHeight - 12) * 6) + 20

    '                    'Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    'Dim strItemName() As String

    '                    'If foundItemName.Length > 0 Then
    '                    '    For i As Integer = 0 To foundItemName.GetUpperBound(0)
    '                    '        strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
    '                    '        For x As Integer = 0 To UBound(strItemName)
    '                    '            strX = strItemName(x).Trim
    '                    '            If Not strX = "" Then
    '                    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    '                intNewY += (intTextHeight - 12)
    '                    '            End If
    '                    '        Next
    '                    '    Next
    '                    'End If
    '                    ''============TEST=====================


    '                    'intNewY = currentY
    '                    'intNewY += intItemHeight

    '                    'fntBold = New Font("Arial Black", 19, FontStyle.Bold)
    '                    'fntRegular = New Font("Arial", 20, FontStyle.Regular)

    '                    ''Measure Price
    '                    'Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
    '                    'Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
    '                    'If foundRowPrice.Length > 0 Then
    '                    '    Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
    '                    '    Dim intTextWidth As Integer = 0
    '                    '    Dim intCol1 As Integer = 0
    '                    '    Dim intCol2 As Integer = 0

    '                    '    For i As Integer = 0 To UBound(strPrice)
    '                    '        strX = fctGetPrice(strPrice(i))
    '                    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                    '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '                    '    Next
    '                    '    For iP As Integer = 0 To 2
    '                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                    '            strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth
    '                    '        End If
    '                    '    Next
    '                    '    intCol2 += 10

    '                    '    intNewX = 0
    '                    '    For iP As Integer = 0 To 2
    '                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
    '                    '            For i As Integer = 0 To UBound(strPrice)
    '                    '                If (iP + 1) = (i + 1) Then
    '                    '                    strX = fctGetPrice(strPrice(i)).Trim
    '                    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

    '                    '                    intNewX += intCol1 + 15

    '                    '                    strX = CStrDB(foundDetails(0)("Price" & iP + 1))
    '                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
    '                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                    '                    intNewX += intCol2 + 15
    '                    '                    If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
    '                    '                        strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
    '                    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                    '                    End If

    '                    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
    '                    '                    intNewY += (intTextHeight - 12)
    '                    '                    intNewX = 0
    '                    '                    Exit For
    '                    '                End If
    '                    '            Next
    '                    '        End If
    '                    '    Next
    '                    'End If
    '                    'intNewY += 3
    '                    'intNewX = 0
    '                    'fntBold = New Font("Arial", 12, FontStyle.Bold)
    '                    'Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
    '                    'If foundCoName.Length > 0 Then
    '                    '    If Not CStrDB(foundCoName(0)("CoName")).Trim = "" Then
    '                    '        strX = "*" & CStrDB(foundCoName(0)("CoName")).Trim
    '                    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
    '                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    '    End If
    '                    'End If
    '                End With

    '                With Me 'PAGE FOOTER
    '                    intNewX = 0
    '                    intNewY = 3
    '                    fntRegular = New Font("Arial", 9, FontStyle.Regular)

    '                    If enumMPPrintStyle = enumMPStyle.KennzeichnungA4C_auf Then
    '                        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 50
    '                    Else
    '                        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 100
    '                    End If


    '                    Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
    '                    If Not dtConfig Is Nothing Then
    '                        Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))

    '                        If blnShowNut Then
    '                            'MEASURE WIDTH
    '                            'Get Nutrient Header
    '                            Dim arrNutrientName As New ArrayList
    '                            Dim arrNutrientFormat As New ArrayList
    '                            Dim arrNutrientUnit As New ArrayList
    '                            subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit, 0)

    '                            'Dim arrNutrientName As New ArrayList
    '                            'Dim arrNutrientFormat As New ArrayList
    '                            'Dim arrNutrientUnit As New ArrayList
    '                            'Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
    '                            'Dim dt As DataTable = cNutrient.GetList().Tables(0)
    '                            'If Not dt Is Nothing Then
    '                            '    For Each row As DataRow In dt.Rows
    '                            '        arrNutrientName.Add(row("Name"))
    '                            '        arrNutrientFormat.Add(row("Format"))
    '                            '        arrNutrientUnit.Add(row("Units"))
    '                            '    Next
    '                            'End If

    '                            Dim intTextWidth As Integer
    '                            Dim intCol1 As Integer = 0
    '                            Dim intCol2 As Integer = 0
    '                            Dim intCol3 As Integer = 0
    '                            Dim intColSpace As Integer = 3

    '                            Select Case G_ReportOptions.intPageLanguage
    '                                Case 3 'FRENCH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                Case 2 'GERMAN
    '                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                Case 1 'ENGLISH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                            End Select

    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Exit For
    '                                End If
    '                            Next
    '                            intNewY += (intTextHeight - 3)

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '                                End If
    '                            Next

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundDetails(0)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), "##0")
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                    intNewX += intCol1 + intColSpace

    '                                    If iNut = 0 Then
    '                                        strX = arrNutrientUnit(iNut)
    '                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Else
    '                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    End If
    '                                    intNewX = 0
    '                                    intNewY += (intTextHeight - 4)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                End With
    '        End Select
    '        Return Me
    '    End Function

    '    Public Function fctPrintMenuPlanDetailSV_A5Einlageblaitter(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                                    Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo)

    '        If foundDetails.Length = 0 Then Return Me
    '        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '        '--- PAGE PROPERTIES ---'
    '        With Me
    '            Try
    '                fntReportTitle = New Font("Arial Black", 27, FontStyle.Bold)
    '                fntBold = New Font("Arial Black", 18, FontStyle.Bold)
    '                fntRegular = New Font("Arial", 18, FontStyle.Regular)
    '            Catch ex As Exception
    '                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                Return Me
    '            End Try

    '            .PaperKind = New System.Drawing.Printing.PaperKind
    '            .PaperKind = Printing.PaperKind.A4
    '            .Landscape = G_ReportOptions.blLandscape

    '            Select Case enumMPPrintStyle
    '                Case enumMPStyle.EinlageblätterA5H
    '                    .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 130.0!, 50.0!)
    '                Case enumMPStyle.EinlageblätterA5H_auf
    '                    .Margins = New System.Drawing.Printing.Margins(150.0!, 50.0!, 130.0!, 50.0!)
    '            End Select

    '            intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '        End With
    '        '--- PAGE PROPERTIES ---'

    '        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '        Dim dtPlan As DataTable = G_ReportOptions.dtPlan
    '        Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig 'ProposalName, Price header
    '        Dim dtDetails As DataTable = G_ReportOptions.dtMPIngr
    '        Dim dtProposal As DataTable = cPlan.fctGetPlanInfo(strSelectedWeek, udtUser.Site.Code)
    '        Dim intCode As Integer = (CInt(foundDetails(0)("Code")))


    '        '--- DETAILS ---
    '        With Me
    '            Dim intLeftX As Integer = 0
    '            Dim intRightX As Integer = (.PageWidth / 2)
    '            Dim intColWidth As Integer = (.PageWidth / 2) - .Margins.Left - .Margins.Right

    '            Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intColWidth, sf, Padding).Height
    '            Dim intItemHeight As Integer = (.MeasureText("A", fntBold, intColWidth, sf, Padding).Height - 11) * 8

    '            Dim fntBoldPrice As Font = New Font("Arial Black", 16, FontStyle.Bold)
    '            Dim fntRegularCoName As Font = New Font("Arial", 10, FontStyle.Regular)
    '            Dim intPriceHeight As Integer = ((.MeasureText("A", fntBoldPrice, intColWidth, sf, Padding).Height - 10) * 3)
    '            Dim intCoNameHeight As Integer = (.MeasureText("A", fntRegularCoName, intColWidth, sf, Padding).Height - 3)

    '            'TITLE AND ITEMS
    '            Dim intNo As Integer
    '            Dim intCodeTrans As Integer
    '            Dim intCodeDay As Integer
    '            Dim foundProName() As DataRow


    '            Dim intSide As Integer = 0 'LeftSide = 0 ; RightSide = 1
    '            Dim foundRowPlan() As DataRow = dtPlan.Select("CodeDay=" & CInt(foundDetails(0)("CodeDay")) & " AND CodeTrans = " & G_ReportOptions.intCodeTrans & "AND (ProposalNO=" & CInt(foundDetails(0)("Code")) & " OR ProposalNo=" & (CInt(foundDetails(0)("Code")) + 1) & ")")

    '            If Not foundRowPlan.Length = 0 Then
    '                For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                    intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
    '                    intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
    '                    intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
    '                    foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

    '                    If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
    '                        intNewX = intLeftX
    '                        intNewY = 0

    '                        If foundProName.Length > 0 Then
    '                            strX = CStrDB(foundProName(0)("ProposalName"))
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                        intNewY += intTitleHeight + 10

    '                        Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                        For x As Integer = 0 To strItemName.Length - 1
    '                            strX = strItemName(x).Trim
    '                            If Not strX = "" Then
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                intNewY += intTextHeight - 11
    '                            End If
    '                        Next
    '                        intNewY = 0
    '                    ElseIf intSide + 1 = (iPlan + 1) Then 'RIGHT SIDE
    '                        intNewX = intRightX
    '                        intNewY = 0

    '                        If foundProName.Length > 0 Then
    '                            strX = CStrDB(foundProName(0)("ProposalName"))
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                        intNewY += intTitleHeight + 10

    '                        Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                        For x As Integer = 0 To strItemName.Length - 1
    '                            strX = strItemName(x).Trim
    '                            If Not strX = "" Then
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                intNewY += intTextHeight - 11
    '                            End If
    '                        Next
    '                        intNewY = 0
    '                        Exit For
    '                    End If
    '                    intSide += 1
    '                Next
    '            End If

    '            'PRICE
    '            intSide = 0

    '            Dim intColPrice1 As Integer = 0
    '            Dim intColPrice2 As Integer = 0
    '            For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
    '                intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
    '                intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
    '                Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
    '                Dim strPrice() As String

    '                If foundRowPrice.Length > 0 Then
    '                    fntBold = New Font("Arial Black", 16, FontStyle.Bold)
    '                    fntRegular = New Font("Arial", 17, FontStyle.Regular)

    '                    strPrice = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
    '                    If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
    '                        intNewX = intLeftX
    '                        intNewY = (intTitleHeight + 10 + intItemHeight)

    '                        'Measure Left Price Width
    '                        For iP As Integer = 0 To UBound(strPrice)
    '                            strX = fctGetPrice(strPrice(iP))
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                            End If
    '                        Next

    '                        'Print Price
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)) <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                For iP2 As Integer = 0 To UBound(strPrice)
    '                                    If (iP + 1) = (iP2 + 1) Then
    '                                        strX = fctGetPrice(strPrice(iP2)).Trim
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                        intNewX += intColPrice1 + 15

    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                        intNewX += intColPrice2 + 15

    '                                        If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                            strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                        End If

    '                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColPrice2, sf, Padding).Height
    '                                        intNewY += intTextHeight - 10
    '                                        intNewX = intLeftX
    '                                        Exit For
    '                                    End If
    '                                Next
    '                            End If
    '                        Next

    '                        fntRegular = New Font("Arial", 10, FontStyle.Regular)
    '                        intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight)
    '                        If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                            strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                    ElseIf intSide + 1 = ((iPlan + 1)) Then 'RIGHT SIDE
    '                        intNewX = intRightX
    '                        intNewY = (intTitleHeight + 10 + intItemHeight)
    '                        fntBold = New Font("Arial Black", 16, FontStyle.Bold)
    '                        fntRegular = New Font("Arial", 17, FontStyle.Regular)

    '                        'Measure Right Price Width
    '                        For iP As Integer = 0 To UBound(strPrice)
    '                            strX = fctGetPrice(strPrice(iP))
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                            End If
    '                        Next

    '                        'Print Price
    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)) <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                For iP2 As Integer = 0 To UBound(strPrice)
    '                                    If (iP + 1) = (iP2 + 1) Then
    '                                        strX = fctGetPrice(strPrice(iP2)).Trim
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                        intNewX += intColPrice1 + 15

    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                        intNewX += intColPrice2 + 15

    '                                        If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                            strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                        End If

    '                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColPrice2, sf, Padding).Height
    '                                        intNewY += intTextHeight - 10
    '                                        intNewX = intRightX
    '                                        Exit For
    '                                    End If
    '                                Next
    '                            End If
    '                        Next

    '                        fntRegular = New Font("Arial", 10, FontStyle.Regular)
    '                        intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight)
    '                        If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                            strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        End If
    '                    End If
    '                End If
    '                intNewY = 0
    '                intSide += 1
    '            Next

    '            'NUTRIENT
    '            intSide = 0
    '            Dim intColNut1 As Integer = 0
    '            Dim intColSpace As Integer = 3
    '            fntRegular = New Font("Arial", 9, FontStyle.Regular)
    '            If Not dtConfig Is Nothing Then
    '                Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))
    '                If blnShowNut Then
    '                    Dim arrNutrientName As New ArrayList
    '                    Dim arrNutrientFormat As New ArrayList
    '                    Dim arrNutrientUnit As New ArrayList
    '                    subGetNutrient(strConnection, G_ReportOptions.intCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit, 0)

    '                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                        If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
    '                            intNewX = intLeftX
    '                            intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight + intCoNameHeight + 40)

    '                            'Print Nutrient
    '                            Select Case G_ReportOptions.intPageLanguage
    '                                Case 3 'FRENCH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                Case 2 'GERMAN
    '                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                Case 1 'ENGLISH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                            End Select
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Exit For
    '                                End If
    '                            Next
    '                            intNewY += (intTextHeight)

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                End If
    '                            Next

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                    intNewX += intColNut1 + intColSpace

    '                                    If iNut = 0 Then
    '                                        strX = arrNutrientUnit(iNut)
    '                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Else
    '                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    End If
    '                                    intNewX = intLeftX
    '                                    intNewY += (intTextHeight)
    '                                End If
    '                            Next
    '                            intNewY = 0
    '                        ElseIf intSide + 1 = ((iPlan + 1)) Then 'RIGHT SIDE
    '                            intNewX = intRightX
    '                            intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight + intCoNameHeight + 40)

    '                            'Print Nutrient
    '                            Select Case G_ReportOptions.intPageLanguage
    '                                Case 3 'FRENCH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                Case 2 'GERMAN
    '                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                Case 1 'ENGLISH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                            End Select
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Exit For
    '                                End If
    '                            Next
    '                            intNewY += (intTextHeight)

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                End If
    '                            Next

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                    intNewX += intColNut1 + intColSpace

    '                                    If iNut = 0 Then
    '                                        strX = arrNutrientUnit(iNut)
    '                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                        Dim dblKcal As Double = ConvertKjtoKcal(CDbl(foundDetails(0)("N" & iNut + 1)))
    '                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Else
    '                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    End If
    '                                    intNewX = intRightX
    '                                    intNewY += (intTextHeight)
    '                                End If
    '                            Next
    '                            intNewY = 0
    '                        End If
    '                        intSide += 1
    '                    Next
    '                End If
    '            End If
    '        End With
    '        '--- DETAILS ---

    '        Return Me
    '    End Function

    '    Public Function fctPrintMenuPlanDetailSV_A6Einlageblaitter(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                                   Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo)

    '        If foundDetails.Length = 0 Then Return Me
    '        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)

    '        '--- PAGE PROPERTIES ---
    '        With Me
    '            Try
    '                fntReportTitle = New Font("Arial Black", 18, FontStyle.Bold)
    '                fntBold = New Font("Arial Black", 12, FontStyle.Bold)
    '                fntRegular = New Font("Arial", 12, FontStyle.Regular)
    '            Catch ex As Exception
    '                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '                Return Me
    '            End Try

    '            .PaperKind = New System.Drawing.Printing.PaperKind
    '            .PaperKind = Printing.PaperKind.A4
    '            .Landscape = G_ReportOptions.blLandscape

    '            Select Case enumMPPrintStyle
    '                Case enumMPStyle.EinlageblätterA6H
    '                    .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 100.0!, 50.0!)
    '                Case enumMPStyle.EinlageblätterA6H_auf
    '                    .Margins = New System.Drawing.Printing.Margins(125.0!, 0.0!, 118.0!, 25.0!)
    '            End Select

    '            'intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '        End With
    '        '--- PAGE PROPERTIES ---


    '        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '        Dim dtPlan As DataTable = G_ReportOptions.dtPlan
    '        Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
    '        Dim dtDetails As DataTable = G_ReportOptions.dtMPIngr
    '        Dim dtProposal As DataTable = cPlan.fctGetPlanInfo(strSelectedWeek, udtUser.Site.Code)


    '        '--- DETAILS ---
    '        With Me
    '            Dim intLeftX As Integer = 0
    '            Dim intRightX As Integer = (.PageWidth / 2)
    '            Dim intTopY As Integer = 0
    '            Dim intBottomY As Integer = (.PageHeight / 2) '+ (.Margins.Top / 2)
    '            Dim intColWidth As Integer = (.PageWidth / 2) - .Margins.Left - .Margins.Right

    '            Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intColWidth, sf, Padding).height
    '            Dim intItemHeight As Integer = ((.MeasureText("A", fntBold, intColWidth, sf, Padding).Height - 10) * 7)

    '            Dim fntRegularCoName As Font = New Font("Arial", 8, FontStyle.Regular)
    '            Dim fntBoldPrice As Font = New Font("Arial Black", 10, FontStyle.Bold)
    '            Dim intPriceHeight As Integer = (.MeasureText("A", fntBoldPrice, intColWidth, sf, Padding).Height - 3) * 3
    '            Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intColWidth, sf, Padding).Height
    '            Dim intSide As Integer = 0

    '            Dim intNo As Integer
    '            Dim intCodeTrans As Integer
    '            Dim intCodeDay As Integer
    '            Dim foundProName() As DataRow
    '            Dim foundRowPlan() As DataRow = dtPlan.Select("CodeDay=" & CInt(foundDetails(0)("CodeDay")) & " AND CodeTrans = " & G_ReportOptions.intCodeTrans)

    '            If Not foundRowPlan.Length = 0 Then
    '                If Not foundDetails(0)("Code") = 5 Then

    '                    'TITLE AND ITEM
    '                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                        intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
    '                        intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
    '                        intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
    '                        foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

    '                        If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
    '                            intNewX = intLeftX
    '                            intNewY = intTopY

    '                            If foundProName.Length > 0 Then
    '                                strX = CStrDB(foundProName(0)("ProposalName"))
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                            intNewY += intTitleHeight + 10

    '                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To strItemName.Length - 1
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight - 10
    '                                End If
    '                            Next
    '                        ElseIf (intSide + 1) = 2 Then 'UPPER RIGHT
    '                            intNewX = intRightX
    '                            intNewY = intTopY

    '                            If foundProName.Length > 0 Then
    '                                strX = CStrDB(foundProName(0)("ProposalName"))
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                            intNewY += intTitleHeight + 10

    '                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To strItemName.Length - 1
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight - 10
    '                                End If
    '                            Next
    '                        ElseIf (intSide + 1) = 3 Then 'LOWER LEFT
    '                            intNewX = intLeftX
    '                            intNewY = intBottomY

    '                            If foundProName.Length > 0 Then
    '                                strX = CStrDB(foundProName(0)("ProposalName"))
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                            intNewY += intTitleHeight + 10

    '                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To strItemName.Length - 1
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight - 10
    '                                End If
    '                            Next
    '                        ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT
    '                            intNewX = intRightX
    '                            intNewY = intBottomY

    '                            If foundProName.Length > 0 Then
    '                                strX = CStrDB(foundProName(0)("ProposalName"))
    '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            End If
    '                            intNewY += intTitleHeight + 10

    '                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
    '                            For x As Integer = 0 To strItemName.Length - 1
    '                                strX = strItemName(x).Trim
    '                                If Not strX = "" Then
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight - 10
    '                                End If
    '                            Next
    '                            Exit For
    '                        End If
    '                        intSide += 1
    '                    Next

    '                    'PRICE
    '                    intSide = 0
    '                    Dim intColPrice1 As Integer = 0
    '                    Dim intColPrice2 As Integer = 0

    '                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                        intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
    '                        intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
    '                        intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))

    '                        Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
    '                        If foundRowPrice.Length > 0 Then
    '                            Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))

    '                            If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
    '                                intNewX = intLeftX
    '                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
    '                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
    '                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

    '                                For iP As Integer = 0 To UBound(strPrice)
    '                                    strX = fctGetPrice(strPrice(iP))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                                    End If
    '                                Next

    '                                For iP As Integer = 0 To 2
    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        For iP2 As Integer = 0 To UBound(strPrice)
    '                                            If (iP + 1) = (iP2 + 1) Then
    '                                                strX = fctGetPrice(strPrice(iP2)).Trim
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                                intNewX += intColPrice1 + 15

    '                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                                intNewX += intColPrice2 + 15

    '                                                If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                                    strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                                End If

    '                                                intNewY += (intTextHeight - 3)
    '                                                intNewX = intLeftX
    '                                                Exit For
    '                                            End If
    '                                        Next
    '                                    End If
    '                                Next

    '                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

    '                                If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                                    strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight
    '                                End If
    '                            ElseIf (intSide + 1) = 2 Then 'UPPER RIGHT
    '                                intNewX = intRightX
    '                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
    '                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
    '                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

    '                                For iP As Integer = 0 To UBound(strPrice)
    '                                    strX = fctGetPrice(strPrice(iP))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                                    End If
    '                                Next

    '                                For iP As Integer = 0 To 2
    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        For iP2 As Integer = 0 To UBound(strPrice)
    '                                            If (iP + 1) = (iP2 + 1) Then
    '                                                strX = fctGetPrice(strPrice(iP2)).Trim
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                                intNewX += intColPrice1 + 15

    '                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                                intNewX += intColPrice2 + 15

    '                                                If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                                    strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                                End If

    '                                                intNewY += (intTextHeight - 3)
    '                                                intNewX = intRightX
    '                                                Exit For
    '                                            End If
    '                                        Next
    '                                    End If
    '                                Next

    '                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

    '                                If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                                    strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight
    '                                End If
    '                            ElseIf (intSide + 1) = 3 Then 'LOWER LEFT
    '                                intNewX = intLeftX
    '                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10)
    '                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
    '                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

    '                                For iP As Integer = 0 To UBound(strPrice)
    '                                    strX = fctGetPrice(strPrice(iP))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                                    End If
    '                                Next

    '                                For iP As Integer = 0 To 2
    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        For iP2 As Integer = 0 To UBound(strPrice)
    '                                            If (iP + 1) = (iP2 + 1) Then
    '                                                strX = fctGetPrice(strPrice(iP2)).Trim
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                                intNewX += intColPrice1 + 15

    '                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                                intNewX += intColPrice2 + 15

    '                                                If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                                    strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                                End If

    '                                                intNewY += (intTextHeight - 3)
    '                                                intNewX = intLeftX
    '                                                Exit For
    '                                            End If
    '                                        Next
    '                                    End If
    '                                Next

    '                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

    '                                If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                                    strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight
    '                                End If
    '                            ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT
    '                                intNewX = intRightX
    '                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10)
    '                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
    '                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

    '                                For iP As Integer = 0 To UBound(strPrice)
    '                                    strX = fctGetPrice(strPrice(iP))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                                    End If
    '                                Next

    '                                For iP As Integer = 0 To 2
    '                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
    '                                        For iP2 As Integer = 0 To UBound(strPrice)
    '                                            If (iP + 1) = (iP2 + 1) Then
    '                                                strX = fctGetPrice(strPrice(iP2)).Trim
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                                intNewX += intColPrice1 + 15

    '                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                                intNewX += intColPrice2 + 15

    '                                                If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                                    strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
    '                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                                End If

    '                                                intNewY += (intTextHeight - 3)
    '                                                intNewX = intRightX
    '                                                Exit For
    '                                            End If
    '                                        Next
    '                                    End If
    '                                Next

    '                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

    '                                If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
    '                                    strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight
    '                                End If
    '                            End If
    '                            Exit For
    '                        End If
    '                        intSide += 1
    '                    Next

    '                    'NUTRIENT
    '                    intSide = 0
    '                    Dim intColNut1 As Integer = 0
    '                    Dim intColSpace As Integer = 3
    '                    If Not dtConfig Is Nothing Then
    '                        Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))

    '                        If blnShowNut Then
    '                            fntRegular = New Font("Arial", 9, FontStyle.Regular)

    '                            Dim arrNutrientName As New ArrayList
    '                            Dim arrNutrientFormat As New ArrayList
    '                            Dim arrNutrientUnit As New ArrayList
    '                            subGetNutrient(strConnection, G_ReportOptions.intCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit, 0)

    '                            For iPlan As Integer = 0 To foundRowPlan.Length - 1
    '                                If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
    '                                    intNewX = intLeftX
    '                                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

    '                                    Select Case G_ReportOptions.intPageLanguage
    '                                        Case 3 'FRENCH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                        Case 2 'GERMAN
    '                                            strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                        Case 1 'ENGLISH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                    End Select
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Exit For
    '                                        End If
    '                                    Next
    '                                    intNewY += intTextHeight

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                            If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                        End If
    '                                    Next

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                            intNewX += intColNut1 + intColSpace

    '                                            If iNut = 0 Then
    '                                                strX = arrNutrientUnit(iNut)
    '                                                If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                                Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                                strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Else
    '                                                strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            End If
    '                                            intNewX = intLeftX
    '                                            intNewY += intTextHeight
    '                                        End If
    '                                    Next
    '                                ElseIf (intSide + 1) = 2 Then 'UPPER LEFT SIDE
    '                                    intNewX = intRightX
    '                                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

    '                                    Select Case G_ReportOptions.intPageLanguage
    '                                        Case 3 'FRENCH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                        Case 2 'GERMAN
    '                                            strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                        Case 1 'ENGLISH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                    End Select
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Exit For
    '                                        End If
    '                                    Next
    '                                    intNewY += intTextHeight

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                            If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                        End If
    '                                    Next

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                            intNewX += intColNut1 + intColSpace

    '                                            If iNut = 0 Then
    '                                                strX = arrNutrientUnit(iNut)
    '                                                If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                                Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                                strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Else
    '                                                strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            End If
    '                                            intNewX = intRightX
    '                                            intNewY += intTextHeight
    '                                        End If
    '                                    Next

    '                                ElseIf (intSide + 1) = 3 Then 'LOWER LEFT SIDE
    '                                    intNewX = intLeftX
    '                                    intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

    '                                    Select Case G_ReportOptions.intPageLanguage
    '                                        Case 3 'FRENCH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                        Case 2 'GERMAN
    '                                            strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                        Case 1 'ENGLISH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                    End Select
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Exit For
    '                                        End If
    '                                    Next
    '                                    intNewY += intTextHeight

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                            If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                        End If
    '                                    Next

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                            intNewX += intColNut1 + intColSpace

    '                                            If iNut = 0 Then
    '                                                strX = arrNutrientUnit(iNut)
    '                                                If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                                Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                                strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Else
    '                                                strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            End If
    '                                            intNewX = intLeftX
    '                                            intNewY += intTextHeight
    '                                        End If
    '                                    Next

    '                                ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT SIDE
    '                                    intNewX = intRightX
    '                                    intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

    '                                    Select Case G_ReportOptions.intPageLanguage
    '                                        Case 3 'FRENCH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                        Case 2 'GERMAN
    '                                            strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                        Case 1 'ENGLISH
    '                                            strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                    End Select
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Exit For
    '                                        End If
    '                                    Next
    '                                    intNewY += intTextHeight

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                            If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                        End If
    '                                    Next

    '                                    For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                        If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
    '                                            strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                            intNewX += intColNut1 + intColSpace

    '                                            If iNut = 0 Then
    '                                                strX = arrNutrientUnit(iNut)
    '                                                If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                                Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
    '                                                strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            Else
    '                                                strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            End If
    '                                            intNewX = intRightX
    '                                            intNewY += intTextHeight
    '                                        End If
    '                                    Next
    '                                    Exit For
    '                                End If
    '                                intSide += 1
    '                            Next

    '                        End If
    '                    End If
    '                Else
    '                    intCodeDay = CIntDB(foundRowPlan(4)("CodeDay"))
    '                    intNo = CIntDB(foundRowPlan(4)("ProposalNo"))
    '                    intCodeTrans = CIntDB(foundRowPlan(4)("CodeTrans"))
    '                    foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

    '                    intNewX = intLeftX
    '                    intNewY = intTopY

    '                    If foundProName.Length > 0 Then
    '                        strX = CStrDB(foundProName(0)("ProposalName"))
    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    End If
    '                    intNewY += intTitleHeight + 10

    '                    Dim strItemName() As String = CStrDB(foundRowPlan(4)("ItemName2")).Split(vbCrLf)
    '                    For x As Integer = 0 To strItemName.Length - 1
    '                        strX = strItemName(x).Trim
    '                        If Not strX = "" Then
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewY += intTextHeight - 10
    '                        End If
    '                    Next

    '                    'PRICE
    '                    intNewX = intLeftX
    '                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
    '                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
    '                    fntRegular = New Font("Arial", 11, FontStyle.Regular)

    '                    Dim intColPrice1 As Integer = 0
    '                    Dim intColPrice2 As Integer = 0

    '                    Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
    '                    If foundRowPrice.Length > 0 Then
    '                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))

    '                        For iP As Integer = 0 To UBound(strPrice)
    '                            strX = fctGetPrice(strPrice(iP))
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

    '                            If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
    '                                strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
    '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
    '                            End If
    '                        Next

    '                        For iP As Integer = 0 To 2
    '                            If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
    '                                For iP2 As Integer = 0 To UBound(strPrice)
    '                                    If (iP + 1) = (iP2 + 1) Then
    '                                        strX = fctGetPrice(strPrice(iP2)).Trim
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                                        intNewX += intColPrice1 + 15

    '                                        strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                        intNewX += intColPrice2 + 15

    '                                        If CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "0" Then
    '                                            strX = CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)) & "*"
    '                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '                                        End If

    '                                        intNewY += (intTextHeight - 3)
    '                                        intNewX = intLeftX
    '                                        Exit For
    '                                    End If
    '                                Next
    '                            End If
    '                        Next

    '                        fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '                        intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

    '                        If Not CStrDB(foundRowPlan(4)("CoName")).Trim = "" Then
    '                            strX = "*" & CStrDB(foundRowPlan(4)("CoName")).Trim
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewY += intTextHeight
    '                        End If
    '                    End If


    '                    'NUTRIENT
    '                    Dim intColNut1 As Integer = 0
    '                    Dim intColSpace As Integer = 3
    '                    If Not dtConfig Is Nothing Then
    '                        Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))

    '                        If blnShowNut Then
    '                            fntRegular = New Font("Arial", 9, FontStyle.Regular)

    '                            Dim arrNutrientName As New ArrayList
    '                            Dim arrNutrientFormat As New ArrayList
    '                            Dim arrNutrientUnit As New ArrayList
    '                            subGetNutrient(strConnection, G_ReportOptions.intCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit, 0)

    '                            intNewX = intLeftX
    '                            intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

    '                            Select Case G_ReportOptions.intPageLanguage
    '                                Case 3 'FRENCH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                                Case 2 'GERMAN
    '                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
    '                                Case 1 'ENGLISH
    '                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
    '                            End Select
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Exit For
    '                                End If
    '                            Next
    '                            intNewY += intTextHeight

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(4)("N" & iNut + 1)), arrNutrientFormat(iNut))
    '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                    If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
    '                                End If
    '                            Next

    '                            For iNut As Integer = 0 To arrNutrientName.Count - 1
    '                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
    '                                    strX = Format(CDbl(foundRowPlan(4)("N" & iNut + 1)), "##0")
    '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '                                    intNewX += intColNut1 + intColSpace

    '                                    If iNut = 0 Then
    '                                        strX = arrNutrientUnit(iNut)
    '                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
    '                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundRowPlan(4)("N" & iNut + 1)))
    '                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    Else
    '                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
    '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    End If
    '                                    intNewX = intLeftX
    '                                    intNewY += intTextHeight
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                End If
    '            End If

    '        End With
    '        '--- DETAILS ---

    '        Return Me
    '    End Function

    '    Private Sub subGetNutrient(ByVal strConnection As String, ByVal intCodeTrans As Integer, ByRef arrNutrientName As ArrayList, _
    '                                    ByRef arrNutrientFormat As ArrayList, ByRef arrNutrientUnit As ArrayList, ByVal intCodeSite As Integer)

    '        Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
    '        Dim dt As DataTable = cNutrient.GetList(intCodeTrans, intCodeSite).Tables(0)
    '        'Dim dtNutTrans As DataTable = cNutrient.fctGetNutrientTrans
    '        'Dim dvNutTrans As New DataView(dtNutTrans)
    '        'dvNutTrans.RowFilter = "CodeTrans=" & intCodeTrans
    '        'dtNutTrans = dvNutTrans.ToTable

    '        If Not dt Is Nothing Then
    '            For Each row As DataRow In dt.Rows
    '                arrNutrientName.Add(row("Name"))
    '                'For Each rowTrans As DataRow In dtNutTrans.Rows
    '                '    If rowTrans("CodeMain") = row("Nutr_No") Then
    '                '        arrNutrientName.Add(rowTrans("Name"))
    '                '        Exit For
    '                '    End If
    '                'Next
    '                arrNutrientFormat.Add(row("Format"))
    '                arrNutrientUnit.Add(row("Units"))
    '            Next
    '        End If
    '    End Sub

    '    Private Function fctGetDay(ByVal intCodeDay As Integer, ByVal cLang As clsEGSLanguage) As String 'intCodetrans
    '        Select Case intCodeDay
    '            Case 1 : Return cLang.GetString(clsEGSLanguage.CodeType.Monday)
    '            Case 2 : Return cLang.GetString(clsEGSLanguage.CodeType.Tuesday)
    '            Case 3 : Return cLang.GetString(clsEGSLanguage.CodeType.Wednesday)
    '            Case 4 : Return cLang.GetString(clsEGSLanguage.CodeType.Thursday)
    '            Case 5 : Return cLang.GetString(clsEGSLanguage.CodeType.Friday)
    '            Case 6 : Return cLang.GetString(clsEGSLanguage.CodeType.Saturday)
    '            Case 7 : Return cLang.GetString(clsEGSLanguage.CodeType.Sunday)
    '        End Select
    '    End Function

    '    Private Function fctGetPrice(ByVal intCodePrice As String) As String 'TEMPORARY
    '        Select Case intCodePrice
    '            Case 1 : Return "INT"
    '            Case 2 : Return "EXT"
    '            Case 3 : Return "STUD"
    '            Case 4 : Return "DOZ"
    '            Case 5 : Return "LEHR"
    '            Case 6 : Return "SCHU"
    '            Case 7 : Return "CHF"
    '            Case 8 : Return "€"
    '            Case 9 : Return "CS"
    '            Case 10 : Return "IBM"
    '            Case 11 : Return "AXA"
    '            Case Else : Return ""
    '        End Select
    '    End Function

    '    Private Sub SplitPanelText(ByVal xrPanel As XRPanel, ByVal strX As String, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment)
    '        With Me
    '            strX = strX.Replace(Chr(10), "")
    '            Dim arr() As String = strX.Split(vbCrLf)

    '            Dim i As Integer = 0
    '            While i < arr.Length
    '                If arr(i).Trim.Length > 0 Then
    '                    strX = arr(i)
    '                    sf = New StringFormat(StringFormatFlags.NoClip)
    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, XRPanel.Width, sf, Me.Padding).Height

    '                    XRPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, XRPanel.Width, intTextHeight, align, True, True, True)})
    '                    intCY += intTextHeight
    '                End If
    '                i += 1
    '            End While
    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, XRPanel.Width, sf, Me.Padding).Height
    '            intCY += intTextHeight
    '        End With
    '    End Sub

    '    Function fctMakeXrPanel(ByVal intX As Integer, ByVal intY As Integer, ByVal intWidth As Integer, ByVal strName As String, _
    '                            ByVal BackColor As Color, Optional ByVal intHeight As Integer = 1) 'VRP 05.06.2008
    '        Dim xrPanel As New XRPanel
    '        With XRPanel
    '            .KeepTogether = True
    '            .Location = New System.Drawing.Point(intX, intY)
    '            .Width = intWidth
    '            .Height = intHeight
    '            .Name = strName
    '            .CanGrow = True
    '            .BackColor = BackColor
    '        End With
    '        Return XRPanel
    '    End Function
    '#End Region

#Region " SV Menu Plan Report "
    'Public Function fctPrintMenuPlanDetailSV_A4Hoch(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                              Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo, _
    '                              Optional ByVal intCodeUser As Integer = 0)

    '    If foundDetails.Length = 0 Then Return Me

    '    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
    '    Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '    Dim dtList As DataTable = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code, intCodeUser)

    '    With Me
    '        Try
    '            fntReportTitle = New Font("Arial Black", 13, FontStyle.Bold)
    '            fntBold = New Font("Arial Black", 9, FontStyle.Bold)
    '            fntRegular = New Font("Arial", 9, FontStyle.Regular)
    '            fntFont = New Font("Arial", 8, FontStyle.Regular)
    '        Catch ex As Exception
    '            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '            Return Me
    '        End Try
    '    End With

    '    With Me 'paper , orientation, width
    '        .PaperKind = New System.Drawing.Printing.PaperKind
    '        .PaperKind = Printing.PaperKind.A4

    '        .Landscape = G_ReportOptions.blLandscape
    '        .Margins = New System.Drawing.Printing.Margins(50.0!, 50.0!, 50.0!, 50.0!)
    '        intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '        intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '    End With

    '    '--- PAGE HEADER ---
    '    With Me
    '        intNewX = 0
    '        intNewY = 0

    '        If enumMPPrintStyle = enumMPStyle.A4HWLogo Then
    '            'Measure Picture
    '            Dim dblLogoWidth As Double = 115
    '            Dim dblLogoHeight As Double = 52
    '            Dim xPicture As XRPictureBox
    '            If Not G_strLogoPath = Nothing Then
    '                If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                    Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                    If dtLogo.Rows.Count > 0 Then
    '                        If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                            xPicture = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                            intNewX = (intAvailableWidth - xPicture.Width)
    '                        End If
    '                    End If
    '                End If
    '            End If

    '            'Print Picture
    '            If Not G_strLogoPath = Nothing Then
    '                If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                    Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                    If dtLogo.Rows.Count > 0 Then
    '                        If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                            xPicture = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                            .PageHeader.Controls.AddRange(New XRControl() {xPicture})
    '                            intNewY += xPicture.Height
    '                        End If
    '                    End If
    '                End If
    '            Else
    '                intNewY += dblLogoHeight
    '            End If
    '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Padding).Height
    '            intNewY += intTextHeight
    '        End If

    '        Dim intPicHeight As Integer = intNewY
    '        sf = New StringFormat(StringFormatFlags.NoClip)

    '        '---
    '        'Measure Right Side
    '        Dim intTextWidth As Integer = 0
    '        Dim intSumWidth As Integer = 0
    '        Dim intSumWidth2 As Integer = 0

    '        Dim intCol1 As Integer = 0
    '        Dim intCol2 As Integer = 0
    '        Dim intCol3 As Integer = 0

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol1 += intTextWidth

    '        strX = CStrDB(foundDetails(0)("OpenDays")).Trim
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol2 += intTextWidth

    '        strX = CStrDB(foundDetails(0)("CloseDays")).Trim
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        If intCol2 < intTextWidth Then intCol2 = intTextWidth

    '        strX = CStrDB(foundDetails(0)("OpenTime")).Trim
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol3 += intTextWidth

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        If intCol3 < intTextWidth Then intCol3 = intTextWidth
    '        intSumWidth = intCol1 + intCol2 + intCol3

    '        'Print Left Side
    '        Dim intLeftSizeX As Integer = intAvailableWidth - intSumWidth
    '        Dim intRightSizeX As Integer = intSumWidth

    '        intNewX = 0
    '        strX = "Menuplan"
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '        intNewY += intTextHeight
    '        strX = strSelectedWeek
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '        'Print Right Side
    '        intNewY = intPicHeight
    '        intNewX += intLeftSizeX

    '        If Not CStrDB(foundDetails(0)("OpenDays")).Trim = "" Or Not CStrDB(foundDetails(0)("OpenTime")).Trim = "" Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol1
    '            strX = CStrDB(foundDetails(0)("OpenDays")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol2
    '            strX = CStrDB(foundDetails(0)("OpenTime")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

    '            intNewY += intTextHeight
    '        End If

    '        intNewX = intLeftSizeX + intCol1

    '        If Not CStrDB(foundDetails(0)("CloseDays")).Trim = "" Then
    '            strX = CStrDB(foundDetails(0)("CloseDays")).Trim
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol2
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
    '            '---
    '            'intNewY += intTextHeight
    '        End If
    '        intNewY += 10
    '    End With
    '    '--- PAGE HEADER ---

    '    '--- DETAIL ---
    '    With Me
    '        Dim intColDayWidth As Integer = 0
    '        Dim intTextWidth As Integer = 0

    '        Dim intNo As Integer = CIntDB(foundDetails(0)("NoOfProposal"))
    '        If intNo = 5 Then intNo = intNo - 2
    '        If intNo = 4 Then intNo = intNo - 1

    '        'If intNo <= 3 Then
    '        '    Dim strDays() As String = CStrDB(foundDetails(0)("Days")).Split(CChar("-"))
    '        '    For i As Integer = strDays(0) To strDays(1)
    '        '        strX = fctGetDay(i, cLang)
    '        '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '        '        If intColDayWidth < intTextWidth Then
    '        '            intColDayWidth = intTextWidth
    '        '        End If
    '        '    Next
    '        '    intColDayWidth += 10
    '        'Else
    '        '    intColDayWidth = 25
    '        'End If
    '        intColDayWidth = 100
    '        Dim intColWidth As Integer = ((intAvailableWidth - intColDayWidth) / intNo)

    '        'Measure Title Height
    '        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColWidth, sf, Me.Padding).Height
    '        Dim intRowTitleHeight As Integer = intTextHeight
    '        Dim strProposals() As String = CStrDB(foundDetails(0)("ProposalName")).Split(CChar("¶"))
    '        Dim strProposal() As String

    '        For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '            If Not i + 1 > intNo Then
    '                strProposal = strProposals(i).Split(CChar("¤"))
    '                strX = strProposal(1)
    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Me.Padding).Height
    '                If intRowTitleHeight < intTextHeight Then
    '                    intRowTitleHeight = intTextHeight
    '                End If
    '            End If
    '        Next

    '        'Print Menu Plan Column Titles
    '        intNewX = intColDayWidth
    '        intNewY = 0

    '        For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '            If Not i + 1 > intNo Then
    '                If i + 1 <= 3 Then
    '                    strProposal = strProposals(i).Split(CChar("¤"))
    '                    strX = strProposal(1)
    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Me.Padding).Height
    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                    If Not i = UBound(strProposals) - 1 Then
    '                        intNewX += intColWidth
    '                    End If
    '                End If
    '            End If
    '        Next
    '        intNewY += intRowTitleHeight

    '        'Row Details
    '        Dim intRowDetailsHeight As Integer = 0
    '        Dim intGuideY As Integer = intNewY

    '        Dim dtListeTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '        'Dim dtConfig As DataTable = cPlan.fctGetPlanConfigList(strSelectedWeek, udtUser.Site.Code)
    '        Dim dtConfig As DataTable = cPlan.GetPlanConfig(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '        Dim intCodeDay As Integer
    '        If dtConfig.Rows.Count > 0 Then
    '            Dim strCodeDay() As String = CStr(dtConfig.Rows(0)("Days")).Split("-")
    '            intCodeDay = strCodeDay(1)

    '            For i As Integer = 0 To intCodeDay - 1
    '                'Measure Row Height 
    '                dtList = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '                If dtList.Rows.Count > 0 Then
    '                    Dim foundRowPlan() As DataRow
    '                    foundRowPlan = dtList.Select("CodeDay=" & i + 1, "CodeDay ASC, ProposalNo ASC")
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                    intRowDetailsHeight = ((intTextHeight - 3) * 6)
    '                    'intRowDetailsHeight = 115
    '                    If foundRowPlan.Length > 0 Then
    '                        ''For iRow As Integer = 0 To foundRowPlan.Length - 1 'nNo-1'foundRowPlan.GetUpperBound(0)
    '                        ''    If iRow + 1 <= 3 Then
    '                        ''        Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans)
    '                        ''        '                                    Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                        ''        Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                        ''        Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                        ''        Dim intCX As Integer = 0, intCY As Integer = 0

    '                        ''        For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                        ''            strX = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Trim
    '                        ''            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                        ''            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        ''            intCY += intTextHeight - 3
    '                        ''        Next

    '                        ''        If intRowDetailsHeight < intCY Then intRowDetailsHeight = intCY
    '                        ''    End If
    '                        ''Next

    '                        'Print Detail Rows
    '                        intNewX = 0 'line
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1, 4, , True)})
    '                        intNewY += 5
    '                        intGuideY = intNewY

    '                        '1St Col
    '                        intNewX = 0
    '                        strX = fctGetDay(i + 1, cLang)
    '                        If intNo <= 3 Then
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColDayWidth, sf, Me.Padding).Height
    '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColDayWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        Else
    '                            Dim dblLogoWidth As Double = 23
    '                            Dim dblLogoHeight As Double = 113
    '                            Dim xPicture As XRPictureBox
    '                            If Not G_strLogoPath = Nothing Then
    '                                If File.Exists(G_strPhotoPath & strX & ".jpg") Then
    '                                    xPicture = fctMakePictureBox(G_strPhotoPath & strX & ".jpg", intNewX + 5, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                                    .Detail.Controls.AddRange(New XRControl() {xPicture})
    '                                End If
    '                            End If
    '                        End If

    '                        '2nd Col
    '                        For iRow As Integer = 0 To foundRowPlan.Length - 1 'intNo - 1 'foundRowPlan.GetUpperBound(0)
    '                            If iRow + 1 <= 3 Then
    '                                If foundRowPlan(iRow)("CodeDay") = i + 1 Then
    '                                    intNewY = intGuideY
    '                                    If iRow = 0 Then
    '                                        intNewX += intColDayWidth
    '                                    Else
    '                                        intNewX += intColWidth
    '                                    End If

    '                                    '============= TEST =======================
    '                                    ''Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans)
    '                                    ' ''Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                                    ''Dim foundRowPlanDetail() As DataRow = dtPlanDetail.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                                    ''Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                    ''Dim intCX As Integer = 0, intCY As Integer = 0

    '                                    ''Dim strItemName() As String
    '                                    ''Dim itemcount As Integer = 0
    '                                    ''For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                                    ''    strItemName = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Split(vbCrLf)
    '                                    ''    For x As Integer = 0 To UBound(strItemName)
    '                                    ''        strX = strItemName(x).Trim
    '                                    ''        If Not strX = "" Then
    '                                    ''            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                    ''            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    ''            intCY += intTextHeight
    '                                    ''            itemcount += 1
    '                                    ''            If itemcount >= 6 Then Exit For
    '                                    ''        End If
    '                                    ''    Next
    '                                    ''    If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                    ''    .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                    ''    If itemcount >= 6 Then Exit For
    '                                    ''Next

    '                                    Dim dtPlanTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '                                    Dim foundRowPlanTrans() As DataRow = dtPlanTrans.Select("CodeDay=" & i + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo") & " AND CodeTrans=" & G_ReportOptions.intCodeTrans, "CodeDay ASC, ProposalNo ASC")

    '                                    Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                    Dim intCX As Integer = 0, intCY As Integer = 0

    '                                    Dim strItemName() As String
    '                                    For iRowT As Integer = 0 To foundRowPlanTrans.GetUpperBound(0)
    '                                        strItemName = CStrDB(foundRowPlanTrans(iRowT)("ItemName2")).Split(vbCrLf)
    '                                        For x As Integer = 0 To UBound(strItemName)
    '                                            strX = strItemName(x).Trim
    '                                            If Not strX = "" Then
    '                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                                                xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                                intCY += intTextHeight - 3
    '                                            End If
    '                                        Next
    '                                        If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                        .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                    Next


    '                                    '============= TEST =======================

    '                                    intNewY += intRowDetailsHeight
    '                                    intNewY += 5

    '                                    'Price
    '                                    Dim strPrice() As String = CStrDB(foundDetails(0)("Price")).Split(CChar(";"))
    '                                    strX = ""
    '                                    For iPrice As Integer = 0 To UBound(strPrice)
    '                                        If Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "" And Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "0" Then
    '                                            strX += fctGetPrice(IIf(strPrice(iPrice) = "", 0, strPrice(iPrice))) & " "
    '                                            strX += IIf(CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)) = "", "", CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1))) & " "
    '                                        End If
    '                                    Next

    '                                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntFont, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                    intNewY += intTextHeight
    '                                End If
    '                            End If
    '                        Next
    '                    End If
    '                End If
    '            Next
    '        End If

    '    End With
    '    '--- DETAIL ---

    '    '--- PAGE FOOTER ---
    '    With Me
    '        .xrPIPageNumber.Visible = False
    '        .xrLinePF.Visible = False
    '        .xrLblEGS2.Visible = False
    '        .xrLblEGS.Visible = False

    '        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 150
    '        intNewX = 0
    '        intNewY = 0


    '        'EMBASSY
    '        fntBold = New Font("Arial", 9, FontStyle.Bold)
    '        Dim dtEmbassy As DataTable = G_ReportOptions.dtPlan2

    '        'MEASURE
    '        Dim intTextWidth As Integer = 0
    '        Dim intTitleWidth As Integer = 0
    '        For Each rowEm As DataRow In dtEmbassy.Rows
    '            Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '            For i As Integer = 0 To UBound(strTitles) - 1
    '                Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                    strX = strTitle(1)
    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    If intTitleWidth < intTextWidth Then intTitleWidth = intTextWidth
    '                    Exit For
    '                End If
    '            Next
    '        Next

    '        For Each rowEm As DataRow In dtEmbassy.Rows
    '            Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '            Dim strTexts() As String = CStrDB(rowEm("Text")).Split(CChar("¤"))


    '            For i As Integer = 0 To UBound(strTitles) - 1
    '                Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                Dim strText() As String = strTexts(i).Split(CChar("¶"))


    '                If strText(0) = foundDetails(0)("CodeTrans") Then
    '                    If Not strText(1) = "" Then
    '                        If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                            strX = strTitle(1)
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width + 50
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTitleWidth + 15, sf, Padding).Height
    '                            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewX += intTitleWidth + 30
    '                        End If

    '                        strX = strText(1)
    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth - (intTitleWidth + 30), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewY += intTextHeight
    '                    End If
    '                End If
    '                intNewX = 0
    '            Next
    '        Next

    '        'ADDRESS
    '        intNewY = 0
    '        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth - (intTitleWidth + 30), sf, Padding).Height
    '        intNewY += (intTextHeight * 3)
    '        intNewY += 20
    '        intNewX = 0
    '        fntRegular = New Font("Arial", 8.0!, FontStyle.Regular)
    '        fntBold = New Font("Arial", 8.0!, FontStyle.Bold)

    '        If foundDetails.Length > 0 Then
    '            strX = "SV (Schweiz) AG"
    '            If Not CStrDB(foundDetails(0)("BusinessName")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessName")).Trim
    '            'If Not CStrDB(foundDetails(0)("BusinessNumber")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessNumber")).Trim
    '            If Not CStrDB(foundDetails(0)("Street")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Street")).Trim
    '            If Not CStrDB(foundDetails(0)("Zip")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Zip")).Trim
    '            If Not CStrDB(foundDetails(0)("City")).Trim = "" Then strX += " " & CStrDB(foundDetails(0)("City")).Trim
    '            If Not CStrDB(foundDetails(0)("Phone")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Phone")).Trim
    '            If Not CStrDB(foundDetails(0)("Email")).Trim = "" Then
    '                strX += ", " & cLang.GetString(clsEGSLanguage.CodeType.Email) & " " & CStrDB(foundDetails(0)("Email")).Trim
    '            End If

    '            intTextHeight = ReportingTextUtils.MeasureText(strX.Trim, fntRegular, intAvailableWidth, sf, Padding).Height
    '            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '            intNewY += intTextHeight
    '        End If

    '        intNewY += 10
    '        strX = "Preise in CHF inkl. MWST"
    '        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '    End With
    '    '--- PAGE FOOTER ---

    '    Return Me
    'End Function

    'Public Function fctPrintMenuPlanDetailSV_A4Quer(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "", _
    '                               Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo, _
    '                               Optional ByVal intCodeUser As Integer = 0)

    '    If foundDetails.Length = 0 Then Return Me

    '    Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
    '    Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
    '    Dim dtMPTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '    'Dim dtMPConfig As DataTable = cPlan.fctGetPlanConfigList(strSelectedWeek, udtUser.Site.Code)
    '    Dim dtMPConfig As DataTable = cPlan.GetPlanConfig(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '    Dim dtMPList As DataTable = cPlan.fctGetPlanList(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '    Dim dtPlanDetail As DataTable = cPlan.fctGetPlanDetails(strSelectedWeek, udtUser.Site.Code, udtUser.Site.Code, G_ReportOptions.intCodeTrans, intCodeUser)

    '    With Me
    '        Try
    '            fntReportTitle = New Font("Arial Black", 15, FontStyle.Bold)
    '            fntBold = New Font("Arial Black", 8, FontStyle.Bold)
    '            fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '            fntFont = New Font("Arial", 6, FontStyle.Regular)
    '        Catch ex As Exception
    '            Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
    '            Return Me
    '        End Try
    '    End With

    '    With Me 'paper , orientation, width
    '        .PaperKind = New System.Drawing.Printing.PaperKind
    '        .PaperKind = Printing.PaperKind.A4

    '        .Landscape = G_ReportOptions.blLandscape
    '        .Margins = New System.Drawing.Printing.Margins(50.0!, 50.0!, 50.0!, 50.0!)
    '        intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
    '        intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
    '    End With

    '    '--- PAGE HEADER ---
    '    With Me
    '        intNewX = 0
    '        intNewY = 0

    '        Dim intTextWidth As Integer = 0

    '        'Measure Left Side
    '        Dim intLeftWidthX As Integer = 0

    '        strX = strSelectedWeek
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Me.Padding).Width
    '        If intLeftWidthX < intTextWidth Then intLeftWidthX = intTextWidth

    '        intLeftWidthX += 10

    '        'Measure Center
    '        Dim intCenterWidthX As Integer = 0
    '        Dim intCol1 As Integer = 0
    '        Dim intCol2 As Integer = 0
    '        Dim intCol3 As Integer = 0

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol1 += intTextWidth

    '        strX = CStrDB(foundDetails(0)("OpenDays"))
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol2 += intTextWidth

    '        strX = CStrDB(foundDetails(0)("CloseDays"))
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        If intCol2 < intTextWidth Then intCol2 = intTextWidth

    '        strX = CStrDB(foundDetails(0)("OpenTime"))
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        intCol3 += intTextWidth

    '        strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '        intTextWidth += 5
    '        If intCol3 < intTextWidth Then intCol3 = intTextWidth

    '        intCenterWidthX = intCol1 + intCol2 + intCol3 + 10


    '        'Measure Right Side
    '        Dim intRightWidthX As Integer = intAvailableWidth - intLeftWidthX - intCenterWidthX
    '        Dim intPicWidth As Integer = 0

    '        Dim xPic As XRPictureBox
    '        Dim dblLogoWidth As Double = 115
    '        Dim dblLogoHeight As Double = 52

    '        If enumMPPrintStyle = enumMPStyle.A4CWLogo Then
    '            If Not G_strLogoPath = Nothing Then
    '                If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                    Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                    If dtLogo.Rows.Count > 0 Then
    '                        If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                            xPic = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                            intPicWidth = xPic.Width
    '                        End If
    '                    End If
    '                End If
    '            End If
    '        End If

    '        intCenterWidthX += (intAvailableWidth - (intLeftWidthX + intCenterWidthX + intPicWidth))

    '        'Print Left Side
    '        intNewX = 0
    '        intNewY = 0

    '        strX = "Menuplan"
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Me.Padding).Width
    '        If intLeftWidthX < intTextWidth Then intLeftWidthX = intTextWidth
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '        intNewY += intTextHeight
    '        strX = strSelectedWeek
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntReportTitle, 0, sf, Padding).Width
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intTextWidth, sf, Me.Padding).Height
    '        .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '        intNewX += intLeftWidthX
    '        intNewY = 0

    '        'Print Center
    '        If Not CStrDB(foundDetails(0)("OpenDays")).Trim = "" Or Not CStrDB(foundDetails(0)("OpenTime")).Trim = "" Then
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.OpeningTime)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol1
    '            strX = CStrDB(foundDetails(0)("OpenDays"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol2
    '            strX = CStrDB(foundDetails(0)("OpenTime"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewY += intTextHeight
    '            intNewX = intLeftWidthX + intCol1
    '        End If

    '        If Not CStrDB(foundDetails(0)("CloseDays")).Trim = "" Then
    '            strX = CStrDB(foundDetails(0)("CloseDays"))
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '            intNewX += intCol2
    '            strX = cLang.GetString(clsEGSLanguage.CodeType.Closed)
    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Me.Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Me.Padding).Height
    '            .PageHeader.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        End If

    '        intNewX = intLeftWidthX + intCenterWidthX
    '        intNewY = 0

    '        'Print Right Side
    '        If enumMPPrintStyle = enumMPStyle.A4CWLogo Then
    '            If Not G_strLogoPath = Nothing Then
    '                If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
    '                    Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
    '                    If dtLogo.Rows.Count > 0 Then
    '                        If File.Exists(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
    '                            xPic = fctMakePictureBox(G_strLogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
    '                            .PageHeader.Controls.AddRange(New XRControl() {xPic})
    '                        End If
    '                    End If
    '                End If
    '            End If
    '        End If
    '    End With
    '    '--- PAGE HEADER ---

    '    '--- DETAIL ---
    '    With Me
    '        fntBold = New Font("Arial Black", 9, FontStyle.Bold)
    '        fntRegular = New Font("Arial", 9, FontStyle.Regular)
    '        fntFont = New Font("Arial", 8, FontStyle.Regular)

    '        intNewX = 0
    '        intNewY = 0
    '        'Dim intColDayWidth As Integer = 0
    '        Dim intTextWidth As Integer = 0

    '        'MEASURE LEFT SIDE - PROPOSAL
    '        Dim intNo As Integer = CIntDB(foundDetails(0)("NoOfProposal"))

    '        Dim intCol1 As Integer = 0

    '        Dim strProposals() As String = CStrDB(foundDetails(0)("ProposalName")).Split(CChar("¶"))
    '        Dim strProposal() As String

    '        'For i As Integer = 0 To strProposals.GetUpperBound(0) - 1
    '        '    If Not i + 1 > intNo Then
    '        '        strProposal = strProposals(i).Split(CChar("¤"))
    '        '        strX = strProposal(1)
    '        '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '        '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
    '        '    End If
    '        'Next
    '        'intCol1 += 10
    '        intCol1 = 110

    '        'MEASURE TITLE HEIGHT - DAYS
    '        Dim intRowTitleHeight As Integer = 0
    '        Dim strDays() As String = CStrDB(foundDetails(0)("Days")).Split(CChar("-"))
    '        Dim intColWidth As Integer = ((intAvailableWidth - intCol1) / strDays(1))
    '        For i As Integer = strDays(0) To strDays(1)
    '            strX = fctGetDay(i, cLang)
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth, sf, Padding).Height
    '            If intRowTitleHeight < intTextHeight Then intRowTitleHeight = intTextHeight
    '        Next
    '        intRowTitleHeight = intRowTitleHeight - 3

    '        'PRINT TITLE - DAYS
    '        intNewX = intCol1
    '        'intNewY = 15

    '        For i As Integer = strDays(0) To strDays(1)
    '            strX = fctGetDay(i, cLang)
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColWidth - 5, sf, Padding).Height
    '            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '            If Not i = strDays(1) Then intNewX += intColWidth
    '        Next

    '        intNewY += intRowTitleHeight

    '        'ROW DETAILS
    '        Dim foundRowPlan() As DataRow
    '        Dim foundRowPlanDetail() As DataRow
    '        Dim intRowDetailsHeight As Integer = 0
    '        Dim intGuideY As Integer = intNewY

    '        If dtMPConfig.Rows.Count > 0 Then

    '            For iPro As Integer = 0 To intNo - 1
    '                'MEASURE ROW HEIGHT 
    '                If dtMPList.Rows.Count > 0 Then
    '                    foundRowPlan = dtMPList.Select("ProposalNo=" & iPro + 1, "CodeDay ASC, ProposalNo ASC")
    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                    intRowDetailsHeight = ((intTextHeight - 3) * 6)

    '                    If foundRowPlan.Length > 0 Then
    '                        'PRINT LINE
    '                        intNewX = 0
    '                        'intNewY += intRowTitleHeight
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeLine(0, intNewY, intAvailableWidth, 1, 4, , True)})
    '                        intNewY += 5
    '                        intGuideY = intNewY

    '                        'PRINT FIRST COLUMN - PROPOSAL
    '                        intNewX = 0
    '                        strProposal = strProposals(iPro).Split(CChar("¤"))
    '                        strX = strProposal(1)
    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol1, sf, Padding).Height
    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

    '                        'PRINT SECOND COLUMN - DETAILS
    '                        For iRow As Integer = 0 To foundRowPlan.Length - 1 'strDays(1) - 1
    '                            If foundRowPlan(iRow)("ProposalNo") = iPro + 1 Then
    '                                intNewY = intGuideY
    '                                If iRow = 0 Then
    '                                    intNewX += intCol1
    '                                Else
    '                                    If Not iRow = strDays(1) Then intNewX += intColWidth
    '                                End If

    '                                '================ TEST ========================
    '                                'foundRowPlanDetail = dtPlanDetail.Select("ProposalNo=" & iPro + 1 & " AND ItemCode=" & foundRowPlan(iRow)("Code"), "CodeDay ASC, ProposalNo ASC, Position ASC")
    '                                'foundRowPlanDetail = dtPlanDetail.Select("CodeDay=" & iRow + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo"), "CodeDay ASC, ProposalNo ASC, Position ASC")

    '                                'Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                'Dim intCX As Integer = 0, intCY As Integer = 0

    '                                'Dim itemcount As Integer = 0
    '                                'Dim strItemName() As String
    '                                'For iRowT As Integer = 0 To foundRowPlanDetail.GetUpperBound(0)
    '                                '    strItemName = CStrDB(foundRowPlanDetail(iRowT)("ItemName")).Split(vbCrLf)
    '                                '    For x As Integer = 0 To UBound(strItemName)
    '                                '        strX = strItemName(x).Trim
    '                                '        If Not strX = "" Then
    '                                '            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                '            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                '            intCY += (intTextHeight - 3)
    '                                '            itemcount += 1
    '                                '            If itemcount >= 6 Then Exit For
    '                                '        End If
    '                                '    Next
    '                                '    If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                '    .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                '    If itemcount >= 6 Then Exit For
    '                                'Next
    '                                Dim dtPlanTrans As DataTable = cPlan.fctGetPlanTrans(strSelectedWeek, udtUser.Site.Code, intCodeUser)
    '                                Dim foundRowPlanTrans() As DataRow = dtPlanTrans.Select("CodeDay=" & iRow + 1 & " AND ProposalNo=" & foundRowPlan(iRow)("ProposalNo") & " AND CodeTrans=" & G_ReportOptions.intCodeTrans, "CodeDay ASC, ProposalNo ASC")

    '                                Dim xrMenuPanel As XRPanel = fctMakeXrPanel(intNewX, intNewY, intColWidth - 5, "xrMenuPanel", Color.Transparent, intRowDetailsHeight)
    '                                Dim intCX As Integer = 0, intCY As Integer = 0

    '                                Dim strItemName() As String
    '                                For iRowT As Integer = 0 To foundRowPlanTrans.GetUpperBound(0)
    '                                    strItemName = CStrDB(foundRowPlanTrans(iRowT)("ItemName2")).Split(vbCrLf)
    '                                    For x As Integer = 0 To UBound(strItemName)
    '                                        strX = strItemName(x).Trim
    '                                        If Not strX = "" Then
    '                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColWidth - 5, sf, Padding).Height
    '                                            xrMenuPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, intColWidth - 5, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                            intCY += intTextHeight - 3
    '                                        End If
    '                                    Next
    '                                    If foundRowPlan(iRow)("ActionMenu") = "1" Then xrMenuPanel.BackColor = Color.LightGray Else xrMenuPanel.BackColor = Color.Transparent
    '                                    .Detail.Controls.AddRange(New XRControl() {xrMenuPanel})
    '                                Next

    '                                '============= TEST ===========================

    '                                intNewY += intRowDetailsHeight
    '                                intNewY += 5

    '                                'PRICE
    '                                Dim strPrice() As String = CStrDB(foundDetails(0)("Price")).Split(CChar(";"))
    '                                strX = ""
    '                                For iPrice As Integer = 0 To UBound(strPrice)
    '                                    If Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "" And Not CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)).Trim = "0" Then
    '                                        strX += fctGetPrice(IIf(strPrice(iPrice) = "", 0, strPrice(iPrice))) & " "
    '                                        strX += IIf(CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1)) = "", "", CStrDB(foundRowPlan(iRow)("Price" & iPrice + 1))) & " "
    '                                    End If
    '                                Next

    '                                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intColWidth - 5, sf, Padding).Height
    '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntFont, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth - 5, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                                intNewY += (intTextHeight - 4)
    '                            End If
    '                        Next
    '                    End If
    '                End If
    '            Next
    '        End If


    '    End With
    '    '--- DETAIL ---

    '    '--- PAGE FOOTER ---
    '    With Me
    '        intNewX = 0
    '        intNewY = 5
    '        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 60

    '        'EMBASSY
    '        fntBold = New Font("Arial", 8, FontStyle.Bold)
    '        fntRegular = New Font("Arial", 8, FontStyle.Regular)
    '        Dim dtEmbassy As DataTable = G_ReportOptions.dtPlan2

    '        'MEASURE
    '        Dim intTextWidth As Integer = 0
    '        Dim intTitleWidth As Integer = 0
    '        For Each rowEm As DataRow In dtEmbassy.Rows
    '            Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '            For i As Integer = 0 To UBound(strTitles) - 1
    '                Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                    strX = strTitle(1)
    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '                    If intTitleWidth < intTextWidth Then intTitleWidth = intTextWidth
    '                    Exit For
    '                End If
    '            Next
    '        Next

    '        For Each rowEm As DataRow In dtEmbassy.Rows
    '            Dim strTitles() As String = CStrDB(rowEm("Title")).Split(CChar("¤"))
    '            Dim strTexts() As String = CStrDB(rowEm("Text")).Split(CChar("¤"))


    '            For i As Integer = 0 To UBound(strTitles) - 1
    '                Dim strTitle() As String = strTitles(i).Split(CChar("¶"))
    '                Dim strText() As String = strTexts(i).Split(CChar("¶"))


    '                If strText(0) = foundDetails(0)("CodeTrans") Then
    '                    If Not strText(1) = "" Then
    '                        If strTitle(0) = foundDetails(0)("CodeTrans") Then
    '                            strX = strTitle(1)
    '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width + 50
    '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTitleWidth + 15, sf, Padding).Height
    '                            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                            intNewX += intTitleWidth + 30
    '                        End If

    '                        strX = strText(1)
    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth - (intTitleWidth + 30), intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '                        intNewY += (intTextHeight - 3)
    '                    End If
    '                End If
    '                intNewX = 0
    '            Next
    '        Next
    '        intNewY = 0

    '        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth - intTextWidth, sf, Padding).Height
    '        intNewY += ((intTextHeight - 3) * 3)
    '        intNewY += 10

    '        'ADDRESS
    '        intNewX = 0
    '        fntRegular = New Font("Arial", 7.0!, FontStyle.Regular)
    '        fntBold = New Font("Arial Black", 7.0!, FontStyle.Bold)

    '        strX = "Preise in CHF inkl. MWST"
    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
    '        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        intNewX += intTextWidth + 100

    '        If foundDetails.Length > 0 Then
    '            strX = "SV (Schweiz) AG"
    '            If Not CStrDB(foundDetails(0)("BusinessName")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("BusinessName")).Trim
    '            If Not CStrDB(foundDetails(0)("Street")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Street")).Trim
    '            If Not CStrDB(foundDetails(0)("Zip")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Zip")).Trim
    '            If Not CStrDB(foundDetails(0)("City")).Trim = "" Then strX += " " & CStrDB(foundDetails(0)("City")).Trim
    '            If Not CStrDB(foundDetails(0)("Phone")).Trim = "" Then strX += ", " & CStrDB(foundDetails(0)("Phone")).Trim
    '            If Not CStrDB(foundDetails(0)("Email")).Trim = "" Then
    '                strX += ", " & cLang.GetString(clsEGSLanguage.CodeType.Email) & " " & CStrDB(foundDetails(0)("Email")).Trim
    '            End If

    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
    '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
    '            .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
    '        End If
    '    End With
    '    '--- PAGE FOOTER ---

    '    Return Me
    'End Function

    Public Function fctPrintMenuPlanDetailSV_A4ShinweisKennzei(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "",
                                 Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo,
                                 Optional ByVal intCodeUser As Integer = 0)

        If foundDetails.Length = 0 Then Return Me
        Dim strNo As String = CStr(foundDetails(0)("ProposalNo"))
        Dim strCodeTrans As String = CStr(foundDetails(0)("CodeTrans"))
        Dim strCodeDay As String = CStr(foundDetails(0)("CodeDay"))
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim blnShowNut As Boolean = G_ReportOptions.bIncludeNutrients 'CBoolDB(dtplan.rows(0)("PrintNut"))
        Dim blnShowGDA As Boolean = G_ReportOptions.bIncludeGDAImage
        Dim arrNutrientName As New ArrayList
        Dim arrNutrientFormat As New ArrayList
        Dim arrNutrientUnit As New ArrayList

        Select Case enumMPPrintStyle
            Case enumMPStyle.AngebotshinweisA4H, enumMPStyle.AngebotshinweisA4H_auf
                With Me 'PAGE PROPERTIES
                    Try
                        fntReportTitle = New Font("Arial Black", 35, FontStyle.Bold)
                        fntBold = New Font("Arial Black", 25, FontStyle.Bold)
                        fntRegular = New Font("Arial", 25, FontStyle.Regular)
                    Catch ex As Exception
                        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                        Return Me
                    End Try

                    .PaperKind = New System.Drawing.Printing.PaperKind
                    .PaperKind = Printing.PaperKind.A4
                    .Landscape = G_ReportOptions.blLandscape

                    If enumMPPrintStyle = enumMPStyle.AngebotshinweisA4H Then
                        .Margins = New System.Drawing.Printing.Margins(150.0!, 50.0!, 200.0!, 150.0!)
                    ElseIf enumMPPrintStyle = enumMPStyle.AngebotshinweisA4H_auf Then
                        .Margins = New System.Drawing.Printing.Margins(250.0!, 20.0!, 200.0!, 50.0!)
                    End If

                    intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
                    'intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
                End With

                'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
                Dim dtName As DataTable = G_ReportOptions.dtPlan
                Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
                Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

                With Me 'DETAILS
                    intNewX = 0
                    intNewY = 0

                    Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
                    Dim intItemHeight As Integer = ((ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height - 11) * 8)
                    Dim fntBoldPrice As Font = New Font("Arial Black", 19, FontStyle.Bold)
                    Dim fntRegularCoName As Font = New Font("Arial", 13, FontStyle.Bold)
                    Dim intPriceHeight As Integer = (ReportingTextUtils.MeasureText("A", fntBoldPrice, intAvailableWidth, sf, Padding).Height - 10) * 3
                    Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intAvailableWidth, sf, Padding).Height

                    'TITLE AND ITEMS
                    Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
                    If foundProName.Length > 0 Then
                        strX = CStrDB(foundProName(0)("ProposalName"))
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    End If
                    intNewY += intTitleHeight + 25


                    Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    Dim strItemName() As String
                    If foundItemName.Length > 0 Then
                        For i As Integer = 0 To foundItemName.GetUpperBound(0)
                            strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
                            For x As Integer = 0 To UBound(strItemName)
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , True)})
                                    intNewY += (intTextHeight - 12)
                                End If
                            Next
                        Next
                    End If


                    'PRICE
                    intNewY = (intTitleHeight + 25 + intItemHeight)
                    fntBold = New Font("Arial Black", 19, FontStyle.Bold)
                    fntRegular = New Font("Arial", 20, FontStyle.Regular)

                    Dim intColPrice1 As Integer = 0
                    Dim intColPrice2 As Integer = 0

                    Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
                    Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

                    If foundRowPrice.Length > 0 Then
                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
                        For i As Integer = 0 To UBound(strPrice)
                            strX = fctGetPrice(strPrice(i))
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth
                        Next
                        For iP As Integer = 0 To 2
                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                                strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                                strX = Format(CDblDB(strX), "0.00")
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                            End If
                        Next

                        'Print
                        For iP As Integer = 0 To 2
                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                                For i As Integer = 0 To UBound(strPrice)
                                    If (iP + 1) = (i + 1) Then
                                        strX = fctGetPrice(strPrice(i)).Trim
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

                                        intNewX += intColPrice1 + 15

                                        strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColPrice2 + 15
                                        If CBoolDB(foundDetails(0)("Co")) Then
                                            If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
                                                strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00") & "*"
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                            End If
                                        End If

                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                                        intNewY += (intTextHeight - 10)
                                        intNewX = 0
                                        Exit For
                                    End If
                                Next
                            End If
                        Next

                        intNewY = (intTitleHeight + 25 + intItemHeight + intPriceHeight)
                        fntBold = New Font("Arial", 13, FontStyle.Bold)
                        Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                        If CBoolDB(foundCoName(0)("Co")) Then
                            If foundCoName.Length > 0 Then
                                strX = CStrDB(foundCoName(0)("CoName")).Trim
                                If Not strX = "" Then
                                    strX = "*" & strX
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                End If
                            End If
                        End If
                    End If

                    'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
                    'Dim dtName As DataTable = G_ReportOptions.dtPlan
                    'Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
                    'Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

                    'Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
                    'If foundProName.Length > 0 Then
                    '    strX = CStrDB(foundProName(0)("ProposalName"))
                    '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight - 11, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    'End If
                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height

                    'intNewY += intTextHeight
                    'intNewY += 30

                    'Dim foundIngr() As DataRow = dtIngr.Select("CodeDay=" & strCodeDay & " AND ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans)
                    'Dim currentY As Integer = intNewY
                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    'Dim intItemHeight As Integer

                    'intItemHeight = ((intTextHeight - 11) * 8)

                    ''PRINT
                    ''Dim itemcount As Integer = 0
                    ''Dim strItemName() As String
                    ''If foundIngr.Length > 0 Then
                    ''    For i As Integer = 0 To foundIngr.GetUpperBound(0)
                    ''        strItemName = CStr(foundIngr(i)("Name")).Split(vbCrLf)
                    ''        For x As Integer = 0 To UBound(strItemName)
                    ''            strX = strItemName(x).Trim
                    ''            If Not strX = "" Then
                    ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    ''                intNewY += (intTextHeight - 12)
                    ''                itemcount += 1
                    ''                If itemcount >= 6 Then Exit For
                    ''            End If
                    ''        Next
                    ''        If itemcount > 6 Then Exit For
                    ''    Next
                    ''End If
                    'Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    'Dim strItemName() As String
                    'If foundItemName.Length > 0 Then
                    '    For i As Integer = 0 To foundItemName.GetUpperBound(0)
                    '        strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
                    '        For x As Integer = 0 To UBound(strItemName)
                    '            strX = strItemName(x).Trim
                    '            If Not strX = "" Then
                    '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '                intNewY += (intTextHeight - 12)
                    '            End If
                    '        Next
                    '    Next
                    'End If
                    ''============TEST=====================

                    'intNewY = currentY
                    'intNewY += intItemHeight

                    'fntBold = New Font("Arial Black", 19, FontStyle.Bold)
                    'fntRegular = New Font("Arial", 20, FontStyle.Regular)

                    ''Measure Price
                    'Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
                    'Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

                    'If foundRowPrice.Length > 0 Then
                    '    Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
                    '    Dim intTextWidth As Integer = 0
                    '    Dim intCol1 As Integer = 0
                    '    Dim intCol2 As Integer = 0

                    '    For i As Integer = 0 To UBound(strPrice)
                    '        strX = fctGetPrice(strPrice(i))
                    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
                    '    Next
                    '    For iP As Integer = 0 To 2
                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                    '            strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth
                    '        End If
                    '    Next
                    '    intCol2 += 10

                    '    intNewX = 0
                    '    For iP As Integer = 0 To 2
                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                    '            For i As Integer = 0 To UBound(strPrice)
                    '                If (iP + 1) = (i + 1) Then
                    '                    strX = fctGetPrice(strPrice(i)).Trim
                    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

                    '                    intNewX += intCol1 + 15

                    '                    strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                    '                    intNewX += intCol2 + 15
                    '                    If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
                    '                        strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
                    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                    '                    End If

                    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    '                    intNewY += (intTextHeight - 10)
                    '                    intNewX = 0
                    '                    Exit For
                    '                End If
                    '            Next
                    '        End If
                    '    Next
                    'End If
                    'intNewY += 3
                    'intNewX = 0
                    'fntBold = New Font("Arial", 13, FontStyle.Bold)
                    'Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    'If foundCoName.Length > 0 Then
                    '    If Not CStrDB(foundCoName(0)("CoName")).Trim = "" Then
                    '        strX = "*" & CStrDB(foundCoName(0)("CoName")).Trim
                    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '    End If
                    'End If
                End With


                With Me 'PAGE FOOTER
                    intNewX = 0
                    intNewY = 0
                    fntRegular = New Font("Arial", 12, FontStyle.Regular)
                    .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 100

                    '--- JRN 20.05.2010
                    If CDblDB(foundDetails(0)("SVLiveeasy")) Then
                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                        If File.Exists(strImage1Path) Then
                            Dim xrImage1 As New XRPictureBox
                            With xrImage1
                                .Image = LoadImageFromUrl(strImage1Path) 'Image.FromFile(strImage1Path)
                                .Height = 100
                                .Width = 100
                                .Sizing = ImageSizeMode.StretchImage

                            End With
                            xrImage1.Location = New Point(intAvailableWidth - 100, 5)

                            .PageFooter.Controls.AddRange(New XRPictureBox() {xrImage1})
                            xrImage1.SendToBack()
                        End If

                    End If
                    '---

                    Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
                    If Not dtConfig Is Nothing Then

                        If blnShowNut And blnShowGDA = False Then
                            'MEASURE WIDTH
                            'Get Nutrient Header


                            'Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
                            'Dim dt As DataTable = cNutrient.GetList().Tables(0)
                            'Dim dtNutTrans As DataTable = cNutrient.fctGetNutrientTrans
                            'Dim dvNutTrans As New DataView(dtNutTrans)
                            'dvNutTrans.RowFilter = "CodeTrans=" & G_ReportOptions.intTranslation
                            'dtNutTrans = dvNutTrans.ToTable

                            'If Not dt Is Nothing Then
                            '    For Each row As DataRow In dt.Rows
                            '        For Each rowTrans As DataRow In dtNutTrans.Rows
                            '            If rowTrans("CodeMain") = row("Nutr_No") Then
                            '                arrNutrientName.Add(rowTrans("Name"))
                            '                Exit For
                            '            End If
                            '        Next
                            '        arrNutrientFormat.Add(row("Format"))
                            '        arrNutrientUnit.Add(row("Units"))
                            '    Next
                            'End If

                            Dim intTextWidth As Integer
                            Dim intCol1 As Integer = 0
                            Dim intCol2 As Integer = 0
                            Dim intCol3 As Integer = 0
                            Dim intColSpace As Integer = 3

                            Select Case G_ReportOptions.intPageLanguage
                                Case 3 'FRENCH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                Case 2 'GERMAN
                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                Case 1 'ENGLISH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                            End Select

                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Exit For
                                End If
                            Next
                            intNewY += (intTextHeight)

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intCol1 < intTextWidth Then intCol1 = intTextWidth
                                End If
                            Next

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), "##0")
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                    intNewX += intCol1 + intColSpace

                                    If iNut = 0 Then
                                        strX = arrNutrientUnit(iNut)
                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Else
                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    End If
                                    intNewX = 0
                                    intNewY += (intTextHeight)
                                End If
                            Next
                        End If

                        If blnShowGDA Then
                            subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit)
                            Dim intGDAPanelHeight = 100
                            Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                            Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                            Dim intGDAPanelWidth As Integer = intAvailableWidth - 200 '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                            fctGetNutrientDetails(CIntDB(strCodeTrans), udtUser.Site.Code, 0, G_strConnection)
                            For intR As Integer = 1 To 5
                                L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                            Next
                            .PageFooter.Controls.AddRange(New XRControl() {fctGetGDAPanel(0, intNewY, intGDAPanelWidth, intGDAPanelHeight + 20, arrNutrientName, strCodeTrans)})

                        End If
                    End If
                End With
            Case enumMPStyle.KennzeichnungA4C, enumMPStyle.KennzeichnungA4C_auf
                With Me 'PAGE PROPERTIES
                    Try
                        fntReportTitle = New Font("Arial Black", 45, FontStyle.Bold)
                        fntBold = New Font("Arial Black", 25, FontStyle.Bold)
                        fntRegular = New Font("Arial", 25, FontStyle.Regular)
                    Catch ex As Exception
                        Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                        Return Me
                    End Try

                    .PaperKind = New System.Drawing.Printing.PaperKind
                    .PaperKind = Printing.PaperKind.A4
                    .Landscape = G_ReportOptions.blLandscape

                    If enumMPPrintStyle = enumMPStyle.KennzeichnungA4C Then
                        .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 50.0!, 50.0!)
                    ElseIf enumMPPrintStyle = enumMPStyle.KennzeichnungA4C_auf Then
                        .Margins = New System.Drawing.Printing.Margins(257.0!, 50.0!, 150.0!, 50.0!)
                    End If

                    intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right) - 20
                    intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom) - 10
                End With

                'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
                Dim dtName As DataTable = G_ReportOptions.dtPlan
                Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
                Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

                With Me 'DETAILS
                    intNewX = 0
                    intNewY = 0

                    Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
                    Dim intItemHeight As Integer = ((ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height - 12) * 6) + 20
                    Dim fntBoldPrice As Font = New Font("Arial Black", 19, FontStyle.Bold)
                    Dim fntRegularCoName As Font = New Font("Arial", 12, FontStyle.Bold)
                    Dim intPriceHeight As Integer = (ReportingTextUtils.MeasureText("A", fntBoldPrice, intAvailableWidth, sf, Padding).Height - 10) * 3
                    Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intAvailableWidth, sf, Padding).Height

                    'TITLE AND ITEMS
                    Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
                    If foundProName.Length > 0 Then
                        strX = CStrDB(foundProName(0)("ProposalName"))
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    End If
                    intNewY += intTitleHeight + 25


                    Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    Dim strItemName() As String
                    If foundItemName.Length > 0 Then
                        For i As Integer = 0 To foundItemName.GetUpperBound(0)
                            strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
                            For x As Integer = 0 To UBound(strItemName)
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , True)})
                                    intNewY += (intTextHeight - 12)
                                End If
                            Next
                        Next
                    End If


                    'PRICE
                    intNewY = (intTitleHeight + 25 + intItemHeight)
                    fntBold = New Font("Arial Black", 19, FontStyle.Bold)
                    fntRegular = New Font("Arial", 20, FontStyle.Regular)

                    '--- JRN 20.05.2010
                    If CDblDB(foundDetails(0)("SVLiveeasy")) Then
                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                        If File.Exists(strImage1Path) Then
                            Dim xrImage1 As New XRPictureBox
                            With xrImage1
                                .Image = LoadImageFromUrl(strImage1Path) 'Image.FromFile(strImage1Path)
                                .Height = 100
                                .Width = 100
                                .Sizing = ImageSizeMode.StretchImage

                            End With
                            xrImage1.Location = New Point(intAvailableWidth - 100, 5)

                            .PageFooter.Controls.AddRange(New XRPictureBox() {xrImage1})
                            xrImage1.SendToBack()
                        End If

                    End If
                    '---

                    Dim intColPrice1 As Integer = 0
                    Dim intColPrice2 As Integer = 0

                    Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
                    Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)

                    If foundRowPrice.Length > 0 Then
                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
                        For i As Integer = 0 To UBound(strPrice)
                            strX = fctGetPrice(strPrice(i))
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth
                        Next
                        For iP As Integer = 0 To 2
                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                                strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                                strX = Format(CDblDB(strX), "0.00")
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                            End If
                        Next

                        'Print
                        For iP As Integer = 0 To 2
                            If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                                For i As Integer = 0 To UBound(strPrice)
                                    If (iP + 1) = (i + 1) Then
                                        strX = fctGetPrice(strPrice(i)).Trim
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

                                        intNewX += intColPrice1 + 15

                                        strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColPrice2 + 15
                                        If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
                                            strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1))
                                            strX = Format(CDblDB(strX), "0.00") & "*"
                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                        End If

                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                                        intNewY += (intTextHeight - 10)
                                        intNewX = 0
                                        Exit For
                                    End If
                                Next
                            End If
                        Next

                        intNewY = (intTitleHeight + 25 + intItemHeight + intPriceHeight)
                        fntBold = New Font("Arial", 12, FontStyle.Bold)
                        Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                        If foundCoName.Length > 0 Then
                            strX = CStrDB(foundCoName(0)("CoName")).Trim
                            If Not strX = "" Then
                                strX = "*" & strX
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                        End If
                    End If


                    'intNewX = 0
                    'intNewY = 0

                    'Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
                    'Dim dtName As DataTable = G_ReportOptions.dtPlan
                    'Dim dtProposal As DataTable = G_ReportOptions.dtMPConfig
                    'Dim dtIngr As DataTable = G_ReportOptions.dtMPIngr

                    'Dim foundProName() As DataRow = dtProposal.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
                    'If foundProName.Length > 0 Then
                    '    strX = CStrDB(foundProName(0)("ProposalName"))
                    '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intAvailableWidth, sf, Padding).Height
                    '    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight - 11, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    'End If

                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intAvailableWidth, sf, Padding).Height
                    'intNewY += (intTextHeight - 12)
                    'intNewY += 10

                    ''============TEST===================
                    ''Dim foundIngr() As DataRow = dtIngr.Select("CodeDay=" & strCodeDay & " AND ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans)
                    ''Dim currentY As Integer = intNewY
                    ''intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    ''Dim intItemHeight As Integer = ((intTextHeight - 12) * 6) + 20


                    ' ''PRINT
                    ''Dim itemcount As Integer = 0
                    ''Dim strItemName() As String
                    ''If foundIngr.Length > 0 Then
                    ''    For i As Integer = 0 To foundIngr.GetUpperBound(0)
                    ''        strItemName = CStr(foundIngr(i)("Name")).Split(vbCrLf)
                    ''        For x As Integer = 0 To UBound(strItemName)
                    ''            strX = strItemName(x).Trim
                    ''            If Not strX = "" Then
                    ''                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    ''                intNewY += (intTextHeight - 12)
                    ''                itemcount += 1
                    ''                If itemcount >= 6 Then Exit For
                    ''            End If
                    ''        Next
                    ''        If itemcount > 6 Then Exit For
                    ''    Next
                    ''End If

                    'Dim currentY As Integer = intNewY
                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    'Dim intItemHeight As Integer = ((intTextHeight - 12) * 6) + 20

                    'Dim foundItemName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    'Dim strItemName() As String

                    'If foundItemName.Length > 0 Then
                    '    For i As Integer = 0 To foundItemName.GetUpperBound(0)
                    '        strItemName = CStr(foundItemName(i)("ItemName2")).Split(vbCrLf)
                    '        For x As Integer = 0 To UBound(strItemName)
                    '            strX = strItemName(x).Trim
                    '            If Not strX = "" Then
                    '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '                intNewY += (intTextHeight - 12)
                    '            End If
                    '        Next
                    '    Next
                    'End If
                    ''============TEST=====================


                    'intNewY = currentY
                    'intNewY += intItemHeight

                    'fntBold = New Font("Arial Black", 19, FontStyle.Bold)
                    'fntRegular = New Font("Arial", 20, FontStyle.Regular)

                    ''Measure Price
                    'Dim dtPrice As DataTable = G_ReportOptions.dtMPConfig
                    'Dim foundRowPrice() As DataRow = dtPrice.Select("ProposalNo=" & strNo & " And CodeTrans=" & strCodeTrans)
                    'If foundRowPrice.Length > 0 Then
                    '    Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
                    '    Dim intTextWidth As Integer = 0
                    '    Dim intCol1 As Integer = 0
                    '    Dim intCol2 As Integer = 0

                    '    For i As Integer = 0 To UBound(strPrice)
                    '        strX = fctGetPrice(strPrice(i))
                    '        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    '        If intCol1 < intTextWidth Then intCol1 = intTextWidth
                    '    Next
                    '    For iP As Integer = 0 To 2
                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                    '            strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                    '            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                    '            If intCol2 < intTextWidth Then intCol2 = intTextWidth
                    '        End If
                    '    Next
                    '    intCol2 += 10

                    '    intNewX = 0
                    '    For iP As Integer = 0 To 2
                    '        If CStrDB(foundDetails(0)("Price" & iP + 1)) <> "" And CStrDB(foundDetails(0)("Price" & iP + 1)) <> "0" Then
                    '            For i As Integer = 0 To UBound(strPrice)
                    '                If (iP + 1) = (i + 1) Then
                    '                    strX = fctGetPrice(strPrice(i)).Trim
                    '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

                    '                    intNewX += intCol1 + 15

                    '                    strX = CStrDB(foundDetails(0)("Price" & iP + 1))
                    '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
                    '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                    '                    intNewX += intCol2 + 15
                    '                    If CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "" And CStrDB(foundDetails(0)("CoPrice" & iP + 1)) <> "0" Then
                    '                        strX = CStrDB(foundDetails(0)("CoPrice" & iP + 1)) & "*"
                    '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                    '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                    '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 8, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                    '                    End If

                    '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Padding).Height
                    '                    intNewY += (intTextHeight - 12)
                    '                    intNewX = 0
                    '                    Exit For
                    '                End If
                    '            Next
                    '        End If
                    '    Next
                    'End If
                    'intNewY += 3
                    'intNewX = 0
                    'fntBold = New Font("Arial", 12, FontStyle.Bold)
                    'Dim foundCoName() As DataRow = dtName.Select("ProposalNo=" & strNo & " AND CodeTrans=" & strCodeTrans & " AND CodeDay=" & strCodeDay)
                    'If foundCoName.Length > 0 Then
                    '    If Not CStrDB(foundCoName(0)("CoName")).Trim = "" Then
                    '        strX = "*" & CStrDB(foundCoName(0)("CoName")).Trim
                    '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Padding).Height
                    '        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    '    End If
                    'End If
                End With

                With Me 'PAGE FOOTER
                    intNewX = 0
                    intNewY = 3
                    fntRegular = New Font("Arial", 9, FontStyle.Regular)

                    If enumMPPrintStyle = enumMPStyle.KennzeichnungA4C_auf Then
                        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 50
                    Else
                        .Detail.Height = .PageHeight - .PageHeader.Height - .Margins.Top - .Margins.Bottom - 100
                    End If


                    Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
                    If Not dtConfig Is Nothing Then


                        If blnShowNut And blnShowGDA = False Then
                            'MEASURE WIDTH
                            'Get Nutrient Header


                            'Dim arrNutrientName As New ArrayList
                            'Dim arrNutrientFormat As New ArrayList
                            'Dim arrNutrientUnit As New ArrayList
                            'Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
                            'Dim dt As DataTable = cNutrient.GetList().Tables(0)
                            'If Not dt Is Nothing Then
                            '    For Each row As DataRow In dt.Rows
                            '        arrNutrientName.Add(row("Name"))
                            '        arrNutrientFormat.Add(row("Format"))
                            '        arrNutrientUnit.Add(row("Units"))
                            '    Next
                            'End If

                            Dim intTextWidth As Integer
                            Dim intCol1 As Integer = 0
                            Dim intCol2 As Integer = 0
                            Dim intCol3 As Integer = 0
                            Dim intColSpace As Integer = 3

                            Select Case G_ReportOptions.intPageLanguage
                                Case 3 'FRENCH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                Case 2 'GERMAN
                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                Case 1 'ENGLISH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                            End Select

                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Exit For
                                End If
                            Next
                            intNewY += (intTextHeight - 3)

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intCol1 < intTextWidth Then intCol1 = intTextWidth
                                End If
                            Next

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundDetails(0)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundDetails(0)("N" & iNut + 1)), "##0")
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                    .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                    intNewX += intCol1 + intColSpace

                                    If iNut = 0 Then
                                        strX = arrNutrientUnit(iNut)
                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Else
                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .PageFooter.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    End If
                                    intNewX = 0
                                    intNewY += (intTextHeight - 4)
                                End If
                            Next
                        End If

                        If blnShowGDA Then
                            Dim intGDAPanelHeight = 100
                            Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                            Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                            Dim intGDAPanelWidth As Integer = intAvailableWidth - 200 '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                            fctGetNutrientDetails(CIntDB(strCodeTrans), udtUser.Site.Code)
                            subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit)
                            For intR As Integer = 1 To 5
                                L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                            Next
                            .PageFooter.Controls.AddRange(New XRControl() {fctGetGDAPanel(0, intNewY, intGDAPanelWidth, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                        End If
                    End If
                End With
        End Select
        Return Me
    End Function

    Public Function fctPrintMenuPlanDetailSV_A5Einlageblaitter(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "",
                                    Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo,
                                    Optional ByVal intCodeUser As Integer = 0)

        If foundDetails.Length = 0 Then Return Me
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim blnShowNut As Boolean = G_ReportOptions.bIncludeNutrients 'CBoolDB(dtConfig.Rows(0)("PrintNut"))
        Dim blnShowGDA As Boolean = G_ReportOptions.bIncludeGDAImage 'CBoolDB(dtConfig.Rows(0)("PrintGDA"))
        Dim arrNutrientName As New ArrayList
        Dim arrNutrientFormat As New ArrayList
        Dim arrNutrientUnit As New ArrayList
        Dim strCodeTrans As String = CStr(foundDetails(0)("CodeTrans"))
        subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit)
        '--- PAGE PROPERTIES ---'
        With Me
            Try
                fntReportTitle = New Font("Arial Black", 27, FontStyle.Bold)
                fntBold = New Font("Arial Black", 18, FontStyle.Bold)
                fntRegular = New Font("Arial", 18, FontStyle.Regular)
            Catch ex As Exception
                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                Return Me
            End Try

            .PaperKind = New System.Drawing.Printing.PaperKind
            .PaperKind = Printing.PaperKind.A4
            .Landscape = G_ReportOptions.blLandscape

            Select Case enumMPPrintStyle
                Case enumMPStyle.EinlageblatterA5H
                    .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 130.0!, 0.0!)
                Case enumMPStyle.EinlageblatterA5H_auf
                    .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 130.0!, 0.0!)
            End Select

            intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
        End With
        '--- PAGE PROPERTIES ---'

        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
        Dim dtPlan As DataTable = G_ReportOptions.dtPlan
        Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig 'ProposalName, Price header
        Dim dtDetails As DataTable = G_ReportOptions.dtMPIngr
        Dim dtProposal As DataTable = cPlan.fctGetPlanInfo(strSelectedWeek, udtUser.Site.Code, intCodeUser)
        Dim intCode As Integer = (CInt(foundDetails(0)("Code")))


        '--- DETAILS ---
        With Me
            Dim intLeftX As Integer = 0
            Dim intRightX As Integer = (.PageWidth / 2)
            Dim intColWidth As Integer = (.PageWidth / 2) - .Margins.Left - .Margins.Right

            Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intColWidth, sf, Padding).Height
            Dim intItemHeight As Integer = (ReportingTextUtils.MeasureText("A", fntBold, intColWidth, sf, Padding).Height - 11) * 8

            Dim fntBoldPrice As Font = New Font("Arial Black", 16, FontStyle.Bold)
            Dim fntRegularCoName As Font = New Font("Arial", 10, FontStyle.Regular)
            Dim intPriceHeight As Integer = ((ReportingTextUtils.MeasureText("A", fntBoldPrice, intColWidth, sf, Padding).Height - 10) * 3)
            Dim intCoNameHeight As Integer = (ReportingTextUtils.MeasureText("A", fntRegularCoName, intColWidth, sf, Padding).Height - 3)

            'TITLE AND ITEMS
            Dim intNo As Integer
            Dim intCodeTrans As Integer
            Dim intCodeDay As Integer
            Dim foundProName() As DataRow


            Dim intSide As Integer = 0 'LeftSide = 0 ; RightSide = 1
            Dim foundRowPlan() As DataRow = dtPlan.Select("CodeDay=" & CInt(foundDetails(0)("CodeDay")) & " AND CodeTrans = " & G_ReportOptions.intCodeTrans & "AND (ProposalNO=" & CInt(foundDetails(0)("Code")) & " OR ProposalNo=" & (CInt(foundDetails(0)("Code")) + 1) & ")")

            If Not foundRowPlan.Length = 0 Then
                For iPlan As Integer = 0 To foundRowPlan.Length - 1
                    intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
                    intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
                    intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
                    foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

                    If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
                        intNewX = intLeftX
                        intNewY = 0

                        If foundProName.Length > 0 Then
                            strX = CStrDB(foundProName(0)("ProposalName"))
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End If
                        intNewY += intTitleHeight + 10

                        Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                        For x As Integer = 0 To strItemName.Length - 1
                            strX = strItemName(x).Trim
                            If Not strX = "" Then
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewY += intTextHeight - 11
                            End If
                        Next
                        intNewY = 0
                    ElseIf intSide + 1 = (iPlan + 1) Then 'RIGHT SIDE
                        intNewX = intRightX
                        intNewY = 0

                        If foundProName.Length > 0 Then
                            strX = CStrDB(foundProName(0)("ProposalName"))
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End If
                        intNewY += intTitleHeight + 10

                        Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                        For x As Integer = 0 To strItemName.Length - 1
                            strX = strItemName(x).Trim
                            If Not strX = "" Then
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewY += intTextHeight - 11
                            End If
                        Next
                        intNewY = 0
                        Exit For
                    End If
                    intSide += 1
                Next
            End If

            'PRICE
            intSide = 0

            Dim intColPrice1 As Integer = 0
            Dim intColPrice2 As Integer = 0
            For iPlan As Integer = 0 To foundRowPlan.Length - 1
                intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
                intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
                intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
                Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
                Dim strPrice() As String

                If foundRowPrice.Length > 0 Then
                    fntBold = New Font("Arial Black", 16, FontStyle.Bold)
                    fntRegular = New Font("Arial", 17, FontStyle.Regular)

                    strPrice = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
                    If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
                        intNewX = intLeftX
                        intNewY = (intTitleHeight + 10 + intItemHeight)




                        'Measure Left Price Width
                        For iP As Integer = 0 To UBound(strPrice)
                            strX = fctGetPrice(strPrice(iP))

                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                strX = Format(CDblDB(strX), "0.00")
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                            End If
                        Next

                        'Print Price
                        For iP As Integer = 0 To 2
                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)) <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                For iP2 As Integer = 0 To UBound(strPrice)
                                    If (iP + 1) = (iP2 + 1) Then
                                        strX = fctGetPrice(strPrice(iP2)).Trim

                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                        intNewX += intColPrice1 + 15

                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColPrice2 + 15

                                        If CBoolDB(foundRowPlan(0)("Co")) Then
                                            If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00") & "*"
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                            End If
                                        End If

                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColPrice2, sf, Padding).Height
                                        intNewY += intTextHeight - 10
                                        intNewX = intLeftX
                                        Exit For
                                    End If
                                Next
                            End If
                        Next

                        fntRegular = New Font("Arial", 10, FontStyle.Regular)
                        intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight)
                        If CBoolDB(foundRowPlan(0)("Co")) Then
                            If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                        End If

                        '--- JRN 20.05.2010
                        If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                            Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                            If File.Exists(strImage1Path) Then
                                Dim xrImage1 As New XRPictureBox
                                With xrImage1
                                    .Image = Image.FromFile(strImage1Path)
                                    .Height = 80
                                    .Width = 80
                                    .Sizing = ImageSizeMode.StretchImage

                                End With
                                xrImage1.Location = New Point(intColWidth - 80, intNewY + 50)

                                .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                xrImage1.SendToBack()
                            End If

                        End If
                        '---

                    ElseIf intSide + 1 = ((iPlan + 1)) Then 'RIGHT SIDE
                        intNewX = intRightX
                        intNewY = (intTitleHeight + 10 + intItemHeight)
                        fntBold = New Font("Arial Black", 16, FontStyle.Bold)
                        fntRegular = New Font("Arial", 17, FontStyle.Regular)




                        'Measure Right Price Width
                        For iP As Integer = 0 To UBound(strPrice)
                            strX = fctGetPrice(strPrice(iP))
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                strX = Format(CDblDB(strX), "0.00")
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                            End If
                        Next

                        'Print Price
                        For iP As Integer = 0 To 2
                            If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)) <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                For iP2 As Integer = 0 To UBound(strPrice)
                                    If (iP + 1) = (iP2 + 1) Then
                                        strX = fctGetPrice(strPrice(iP2)).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                        intNewX += intColPrice1 + 15

                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColPrice2 + 15

                                        If CBoolDB(foundRowPlan(0)("Co")) Then
                                            If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00") & "*"
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                            End If
                                        End If

                                        intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intColPrice2, sf, Padding).Height
                                        intNewY += intTextHeight - 10
                                        intNewX = intRightX
                                        Exit For
                                    End If
                                Next
                            End If
                        Next

                        fntRegular = New Font("Arial", 10, FontStyle.Regular)
                        intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight)
                        If CBoolDB(foundRowPlan(0)("Co")) Then
                            If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                        End If

                        '--- JRN 20.05.2010
                        If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                            Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                            If File.Exists(strImage1Path) Then
                                Dim xrImage1 As New XRPictureBox
                                With xrImage1
                                    .Image = Image.FromFile(strImage1Path)
                                    .Height = 80
                                    .Width = 80
                                    .Sizing = ImageSizeMode.StretchImage

                                End With
                                xrImage1.Location = New Point(.PageWidth - .Margins.Left - .Margins.Right - 80, intNewY + 50)

                                .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                xrImage1.SendToBack()
                            End If

                        End If
                        '---

                    End If
                End If
                intNewY = 0
                intSide += 1
            Next

            'NUTRIENT
            intSide = 0
            Dim intColNut1 As Integer = 0
            Dim intColSpace As Integer = 3
            fntRegular = New Font("Arial", 9, FontStyle.Regular)
            If Not dtConfig Is Nothing Then

                If blnShowNut Then
                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
                        If intSide + 1 = (((iPlan + 1) * 2) - 1) Then 'LEFT SIDE
                            intNewX = intLeftX
                            intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight + intCoNameHeight + 40)

                            If blnShowGDA = False Then
                                'Print Nutrient
                                Select Case G_ReportOptions.intPageLanguage
                                    Case 3 'FRENCH
                                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                    Case 2 'GERMAN
                                        strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                    Case 1 'ENGLISH
                                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                End Select
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        Exit For
                                    End If
                                Next
                                intNewY += (intTextHeight)

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                    End If
                                Next

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColNut1 + intColSpace

                                        If iNut = 0 Then
                                            strX = arrNutrientUnit(iNut)
                                            If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                            Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                            strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        Else
                                            strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        End If
                                        intNewX = intLeftX
                                        intNewY += (intTextHeight)
                                    End If
                                Next
                            End If

                            If blnShowGDA Then
                                Dim intGDAPanelHeight = 100
                                Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                For intR As Integer = 1 To 5
                                    L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                Next
                                .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY, intColWidth - 100, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                            End If
                            intNewY = 0
                        ElseIf intSide + 1 = ((iPlan + 1)) Then 'RIGHT SIDE
                            intNewX = intRightX
                            intNewY = (intTitleHeight + 10 + intItemHeight + intPriceHeight + intCoNameHeight + 40)

                            If blnShowGDA = False Then
                                'Print Nutrient
                                Select Case G_ReportOptions.intPageLanguage
                                    Case 3 'FRENCH
                                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                    Case 2 'GERMAN
                                        strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                    Case 1 'ENGLISH
                                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                End Select
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        Exit For
                                    End If
                                Next
                                intNewY += (intTextHeight)

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                    End If
                                Next

                                For iNut As Integer = 0 To arrNutrientName.Count - 1
                                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColNut1 + intColSpace

                                        If iNut = 0 Then
                                            strX = arrNutrientUnit(iNut)
                                            If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                            Dim dblKcal As Double = ConvertKjtoKcal(CDbl(foundDetails(0)("N" & iNut + 1)))
                                            strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        Else
                                            strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        End If
                                        intNewX = intRightX
                                        intNewY += (intTextHeight)
                                    End If
                                Next
                            End If

                            If blnShowGDA Then
                                Dim intGDAPanelHeight = 100
                                Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                Dim intGDAPanelWidth As Integer = intAvailableWidth - 150 '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                For intR As Integer = 1 To 5
                                    L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                Next
                                .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY, intColWidth - 100, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                            End If
                            intNewY = 0
                        End If
                        intSide += 1
                    Next
                End If
            End If
        End With
        '--- DETAILS ---

        Return Me
    End Function

    Public Function fctPrintMenuPlanDetailSV_A6Einlageblaitter(ByVal foundDetails() As DataRow, ByVal udtUser As structUser, Optional ByVal strConnection As String = "",
                                   Optional ByVal strSelectedWeek As String = "", Optional ByVal enumMPPrintStyle As enumMPStyle = enumMPStyle.A4HWLogo,
                                   Optional ByVal intCodeUser As Integer = 0)
        Dim blnShowNut As Boolean = G_ReportOptions.bIncludeNutrients 'CBoolDB(dtConfig.Rows(0)("PrintNut"))
        Dim blnShowGDA As Boolean = G_ReportOptions.bIncludeGDAImage 'CBoolDB(dtConfig.Rows(0)("PrintGDA"))
        If foundDetails.Length = 0 Then Return Me
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim arrNutrientName As New ArrayList
        Dim arrNutrientFormat As New ArrayList
        Dim arrNutrientUnit As New ArrayList
        Dim strCodeTrans As String = CStr(foundDetails(0)("CodeTrans"))
        subGetNutrient(strConnection, strCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit)
        '--- PAGE PROPERTIES ---
        With Me
            Try
                fntReportTitle = New Font("Arial Black", 18, FontStyle.Bold)
                fntBold = New Font("Arial Black", 12, FontStyle.Bold)
                fntRegular = New Font("Arial", 12, FontStyle.Regular)
            Catch ex As Exception
                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(cLang.GetString(clsEGSLanguage.CodeType.Error_Invalid) & " - " & G_ReportOptions.strFontName, New Font("Arial", 16, FontStyle.Bold), 10, 10, 500, 500, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                Return Me
            End Try

            .PaperKind = New System.Drawing.Printing.PaperKind
            .PaperKind = Printing.PaperKind.A4
            .Landscape = G_ReportOptions.blLandscape

            Select Case enumMPPrintStyle
                Case enumMPStyle.EinlageblatterA6H
                    .Margins = New System.Drawing.Printing.Margins(100.0!, 50.0!, 100.0!, 25.0!)
                Case enumMPStyle.EinlageblatterA6H_auf
                    .Margins = New System.Drawing.Printing.Margins(100.0!, 25.0!, 100.0!, 25.0!)
            End Select

            'intAvailableWidth = (.PageWidth - .Margins.Left - .Margins.Right)
            intAvailableHeight = (.PageHeight - .Margins.Top - .Margins.Bottom)
        End With
        '--- PAGE PROPERTIES ---


        Dim cPlan As New clsMenuplan(enumAppType.WebApp, strConnection)
        Dim dtPlan As DataTable = G_ReportOptions.dtPlan
        Dim dtConfig As DataTable = G_ReportOptions.dtMPConfig
        Dim dtDetails As DataTable = G_ReportOptions.dtMPIngr
        Dim dtProposal As DataTable = cPlan.fctGetPlanInfo(strSelectedWeek, udtUser.Site.Code, intCodeUser)


        '--- DETAILS ---
        With Me
            Dim intLeftX As Integer = 0
            Dim intRightX As Integer = (.PageWidth / 2)
            Dim intTopY As Integer = 0
            Dim intBottomY As Integer = ((.PageHeight - .Margins.Top) / 2) + (.Margins.Top / 2)
            Dim intColWidth As Integer = (.PageWidth / 2) - .Margins.Left - .Margins.Right
            Dim intColHeight As Integer = (.PageHeight / 2) - .Margins.Top - .Margins.Bottom

            Dim intTitleHeight As Integer = ReportingTextUtils.MeasureText("A", fntReportTitle, intColWidth, sf, Padding).Height
            Dim intItemHeight As Integer = ((ReportingTextUtils.MeasureText("A", fntBold, intColWidth, sf, Padding).Height - 10) * 7)

            Dim fntRegularCoName As Font = New Font("Arial", 8, FontStyle.Regular)
            Dim fntBoldPrice As Font = New Font("Arial Black", 10, FontStyle.Bold)
            Dim intPriceHeight As Integer = (ReportingTextUtils.MeasureText("A", fntBoldPrice, intColWidth, sf, Padding).Height - 3) * 3
            Dim intCoNameHeight As Integer = ReportingTextUtils.MeasureText("A", fntRegularCoName, intColWidth, sf, Padding).Height
            Dim intSide As Integer = 0

            Dim intNo As Integer
            Dim intCodeTrans As Integer
            Dim intCodeDay As Integer
            Dim foundProName() As DataRow
            Dim foundRowPlan() As DataRow = dtPlan.Select("CodeDay=" & CInt(foundDetails(0)("CodeDay")) & " AND CodeTrans = " & G_ReportOptions.intCodeTrans)

            If Not foundRowPlan.Length = 0 Then
                If Not foundDetails(0)("Code") = 5 Then

                    'TITLE AND ITEM
                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
                        intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
                        intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
                        intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
                        foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

                        If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
                            intNewX = intLeftX
                            intNewY = intTopY

                            If foundProName.Length > 0 Then
                                strX = CStrDB(foundProName(0)("ProposalName"))
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                            intNewY += intTitleHeight + 10

                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                            '---Insert SV Logo
                            If strItemName.Length > 0 Then
                                Dim dblLogoWidth As Double = 115
                                Dim dblLogoHeight As Double = 52
                                'If Not LogoPath = Nothing Then
                                '    If Not CIntDB(foundDetails(0)("CodeLogo")) = -1 Then
                                '        Dim dtLogo As DataTable = cPlan.fctGetPlanLogoList(CIntDB(foundDetails(0)("CodeLogo")))
                                '        If dtLogo.Rows.Count > 0 Then
                                '            If File.Exists(LogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension")) Then
                                '                xPicture = fctMakePictureBox(LogoPath & dtLogo.Rows(0)("FileName") & dtLogo.Rows(0)("FileExtension"), intNewX, intNewY, CInt(dblLogoWidth), CInt(dblLogoHeight))
                                '                intNewX = (intAvailableWidth - xPicture.Width)
                                '            End If
                                '        End If
                                '    End If
                                'End If
                                If File.Exists(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg") Then
                                    Dim xPicture As New XRPictureBox
                                    xPicture = fctMakePictureBox(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg", intNewX + 170, intNewY - 52, CInt(dblLogoWidth), CInt(dblLogoHeight))
                                    .Detail.Controls.AddRange(New XRControl() {xPicture})
                                    'intNewY += xPicture.Height
                                End If
                            End If
                            '---
                            For x As Integer = 0 To strItemName.Length - 1
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += intTextHeight - 10
                                End If
                            Next
                        ElseIf (intSide + 1) = 2 Then 'UPPER RIGHT
                            intNewX = intRightX
                            intNewY = intTopY

                            If foundProName.Length > 0 Then
                                strX = CStrDB(foundProName(0)("ProposalName"))
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                            intNewY += intTitleHeight + 10


                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                            If strItemName.Length > 0 Then
                                '---Insert SV Logo
                                Dim dblLogoWidth As Double = 115
                                Dim dblLogoHeight As Double = 52
                                If File.Exists(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg") Then
                                    Dim xPicture As New XRPictureBox
                                    xPicture = fctMakePictureBox(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg", intNewX + 170, intNewY - 52, CInt(dblLogoWidth), CInt(dblLogoHeight))
                                    .Detail.Controls.AddRange(New XRControl() {xPicture})
                                    'intNewY += xPicture.Height
                                End If
                                '---
                            End If
                            For x As Integer = 0 To strItemName.Length - 1
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += intTextHeight - 10
                                End If
                            Next
                        ElseIf (intSide + 1) = 3 Then 'LOWER LEFT
                            intNewX = intLeftX
                            intNewY = intBottomY

                            If foundProName.Length > 0 Then
                                strX = CStrDB(foundProName(0)("ProposalName"))
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                            intNewY += intTitleHeight + 10

                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                            If strItemName.Length > 0 Then
                                '---Insert SV Logo
                                Dim dblLogoWidth As Double = 115
                                Dim dblLogoHeight As Double = 52
                                If File.Exists(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg") Then
                                    Dim xPicture As New XRPictureBox
                                    xPicture = fctMakePictureBox(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg", intNewX + 170, intNewY - 52, CInt(dblLogoWidth), CInt(dblLogoHeight))
                                    .Detail.Controls.AddRange(New XRControl() {xPicture})
                                    'intNewY += xPicture.Height
                                End If
                                '---
                            End If
                            For x As Integer = 0 To strItemName.Length - 1
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += intTextHeight - 10
                                End If
                            Next
                        ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT
                            intNewX = intRightX
                            intNewY = intBottomY

                            If foundProName.Length > 0 Then
                                strX = CStrDB(foundProName(0)("ProposalName"))
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            End If
                            intNewY += intTitleHeight + 10


                            Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
                            If strItemName.Length > 0 Then
                                '---Insert SV Logo
                                Dim dblLogoWidth As Double = 115
                                Dim dblLogoHeight As Double = 52
                                If File.Exists(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg") Then
                                    Dim xPicture As New XRPictureBox
                                    xPicture = fctMakePictureBox(AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLogo-new-cropped.jpg", intNewX + 170, intNewY - 52, CInt(dblLogoWidth), CInt(dblLogoHeight))
                                    .Detail.Controls.AddRange(New XRControl() {xPicture})
                                    'intNewY += xPicture.Height
                                End If
                                '---
                            End If
                            For x As Integer = 0 To strItemName.Length - 1
                                strX = strItemName(x).Trim
                                If Not strX = "" Then
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += intTextHeight - 10
                                End If
                            Next
                            Exit For
                        End If
                        intSide += 1
                    Next

                    'PRICE
                    intSide = 0
                    Dim intColPrice1 As Integer = 0
                    Dim intColPrice2 As Integer = 0

                    For iPlan As Integer = 0 To foundRowPlan.Length - 1
                        intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
                        intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
                        intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))

                        Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
                        If foundRowPrice.Length > 0 Then
                            Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))

                            If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
                                intNewX = intLeftX
                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

                                For iP As Integer = 0 To UBound(strPrice)
                                    strX = fctGetPrice(strPrice(iP))

                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                                    End If
                                Next

                                For iP As Integer = 0 To 2
                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        For iP2 As Integer = 0 To UBound(strPrice)
                                            If (iP + 1) = (iP2 + 1) Then
                                                strX = fctGetPrice(strPrice(iP2)).Trim

                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                                intNewX += intColPrice1 + 15

                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColPrice2 + 15

                                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1))
                                                        strX = Format(CDblDB(strX), "0.00") & "*"
                                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                                    End If
                                                End If

                                                intNewY += (intTextHeight - 3)
                                                intNewX = intLeftX
                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next

                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                        strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        intNewY += intTextHeight
                                    End If
                                End If

                            ElseIf (intSide + 1) = 2 Then 'UPPER RIGHT
                                intNewX = intRightX
                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

                                For iP As Integer = 0 To UBound(strPrice)
                                    strX = fctGetPrice(strPrice(iP))

                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                                    End If
                                Next

                                For iP As Integer = 0 To 2
                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        For iP2 As Integer = 0 To UBound(strPrice)
                                            If (iP + 1) = (iP2 + 1) Then
                                                strX = fctGetPrice(strPrice(iP2)).Trim

                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                                intNewX += intColPrice1 + 15

                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColPrice2 + 15

                                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1))
                                                        strX = Format(CDblDB(strX), "0.00") & "*"
                                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                                    End If
                                                End If

                                                intNewY += (intTextHeight - 3)
                                                intNewX = intRightX
                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next

                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
                                intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        intNewY += intTextHeight
                                    End If
                                End If
                            ElseIf (intSide + 1) = 3 Then 'LOWER LEFT
                                intNewX = intLeftX
                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10)
                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

                                For iP As Integer = 0 To UBound(strPrice)
                                    strX = fctGetPrice(strPrice(iP))

                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                                    End If
                                Next

                                For iP As Integer = 0 To 2
                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        For iP2 As Integer = 0 To UBound(strPrice)
                                            If (iP + 1) = (iP2 + 1) Then
                                                strX = fctGetPrice(strPrice(iP2)).Trim

                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                                intNewX += intColPrice1 + 15

                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColPrice2 + 15

                                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1))
                                                        strX = Format(CDblDB(strX), "0.00") & "*"
                                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                                    End If
                                                End If

                                                intNewY += (intTextHeight - 3)
                                                intNewX = intLeftX
                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next

                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        intNewY += intTextHeight
                                    End If
                                End If
                            ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT
                                intNewX = intRightX
                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10)
                                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
                                fntRegular = New Font("Arial", 11, FontStyle.Regular)

                                For iP As Integer = 0 To UBound(strPrice)
                                    strX = fctGetPrice(strPrice(iP))

                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                        If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                                    End If
                                Next

                                For iP As Integer = 0 To 2
                                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
                                        For iP2 As Integer = 0 To UBound(strPrice)
                                            If (iP + 1) = (iP2 + 1) Then
                                                strX = fctGetPrice(strPrice(iP2)).Trim

                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                                intNewX += intColPrice1 + 15

                                                strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColPrice2 + 15

                                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
                                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                                    End If
                                                End If

                                                intNewY += (intTextHeight - 3)
                                                intNewX = intRightX
                                                Exit For
                                            End If
                                        Next
                                    End If
                                Next

                                fntRegular = New Font("Arial", 8, FontStyle.Regular)
                                intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

                                If CBoolDB(foundRowPlan(iPlan)("Co")) Then
                                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
                                        strX = CStrDB(foundRowPlan(iPlan)("CoName")).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                        intNewY += intTextHeight
                                    End If
                                End If
                            End If
                            Exit For
                        End If
                        intSide += 1
                    Next

                    'NUTRIENT
                    intSide = 0
                    Dim intColNut1 As Integer = 0
                    Dim intColSpace As Integer = 3
                    If Not dtConfig Is Nothing Then

                        If blnShowNut Then
                            fntRegular = New Font("Arial", 9, FontStyle.Regular)

                            For iPlan As Integer = 0 To foundRowPlan.Length - 1
                                If (intSide + 1) = 1 Or (intSide + 1) = 5 Then 'UPPER LEFT
                                    intNewX = intLeftX
                                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)
                                    Dim intGDAY As Integer = intNewY
                                    '--- JRN 20.05.2010
                                    If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                                        If File.Exists(strImage1Path) Then
                                            Dim xrImage1 As New XRPictureBox
                                            With xrImage1
                                                .Image = Image.FromFile(strImage1Path)
                                                .Height = 55
                                                .Width = 55
                                                .Sizing = ImageSizeMode.StretchImage

                                            End With
                                            xrImage1.Location = New Point(intNewX + 210, intNewY)

                                            .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                            xrImage1.SendToBack()
                                        End If

                                    End If
                                    '---
                                    If blnShowGDA = False Then
                                        Select Case G_ReportOptions.intPageLanguage
                                            Case 3 'FRENCH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                            Case 2 'GERMAN
                                                strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                            Case 1 'ENGLISH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                        End Select
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Exit For
                                            End If
                                        Next
                                        intNewY += intTextHeight

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                            End If
                                        Next

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColNut1 + intColSpace

                                                If iNut = 0 Then
                                                    strX = arrNutrientUnit(iNut)
                                                    If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                                    Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                                    strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Else
                                                    strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                End If
                                                intNewX = intLeftX
                                                intNewY += intTextHeight
                                            End If
                                        Next
                                    End If

                                    If blnShowGDA Then
                                        Dim intGDAPanelHeight = 70
                                        Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                        Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                        Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                        fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                        For intR As Integer = 1 To 5
                                            L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                        Next
                                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY + 60, intNewX + 265, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                                    End If
                                ElseIf (intSide + 1) = 2 Then 'UPPER RIGHT SIDE
                                    intNewX = intRightX
                                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)
                                    Dim intGDAY As Integer = intNewY
                                    '--- JRN 20.05.2010
                                    If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                                        If File.Exists(strImage1Path) Then
                                            Dim xrImage1 As New XRPictureBox
                                            With xrImage1
                                                .Image = Image.FromFile(strImage1Path)
                                                .Height = 55
                                                .Width = 55
                                                .Sizing = ImageSizeMode.StretchImage

                                            End With
                                            xrImage1.Location = New Point(intNewX + 210, intNewY)

                                            .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                            xrImage1.SendToBack()
                                        End If

                                    End If
                                    '---
                                    If blnShowGDA = False Then
                                        Select Case G_ReportOptions.intPageLanguage
                                            Case 3 'FRENCH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                            Case 2 'GERMAN
                                                strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                            Case 1 'ENGLISH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                        End Select
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Exit For
                                            End If
                                        Next
                                        intNewY += intTextHeight

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                            End If
                                        Next

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColNut1 + intColSpace

                                                If iNut = 0 Then
                                                    strX = arrNutrientUnit(iNut)
                                                    If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                                    Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                                    strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Else
                                                    strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                End If
                                                intNewX = intRightX
                                                intNewY += intTextHeight
                                            End If
                                        Next
                                    End If

                                    If blnShowGDA Then
                                        Dim intGDAPanelHeight = 70
                                        Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                        Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                        Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                        fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                        For intR As Integer = 1 To 5
                                            L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                        Next
                                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY + 60, 265, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                                    End If
                                ElseIf (intSide + 1) = 3 Then 'LOWER LEFT SIDE
                                    intNewX = intLeftX
                                    intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

                                    Dim intGDAY As Integer = intNewY
                                    '--- JRN 20.05.2010
                                    If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                                        If File.Exists(strImage1Path) Then
                                            Dim xrImage1 As New XRPictureBox
                                            With xrImage1
                                                .Image = Image.FromFile(strImage1Path)
                                                .Height = 55
                                                .Width = 55
                                                .Sizing = ImageSizeMode.StretchImage

                                            End With
                                            xrImage1.Location = New Point(intNewX + 210, intNewY)

                                            .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                            xrImage1.SendToBack()
                                        End If

                                    End If
                                    '---

                                    If blnShowGDA = False Then
                                        Select Case G_ReportOptions.intPageLanguage
                                            Case 3 'FRENCH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                            Case 2 'GERMAN
                                                strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                            Case 1 'ENGLISH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                        End Select
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Exit For
                                            End If
                                        Next
                                        intNewY += intTextHeight

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                            End If
                                        Next

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColNut1 + intColSpace

                                                If iNut = 0 Then
                                                    strX = arrNutrientUnit(iNut)
                                                    If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                                    Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                                    strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Else
                                                    strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                End If
                                                intNewX = intLeftX
                                                intNewY += intTextHeight
                                            End If
                                        Next
                                    End If

                                    If blnShowGDA Then
                                        Dim intGDAPanelHeight = 70
                                        Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                        Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                        Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                        fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                        For intR As Integer = 1 To 5
                                            L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                        Next
                                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY + 60, intNewX + 265, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                                    End If
                                ElseIf (intSide + 1) = 4 Then 'LOWER RIGHT SIDE
                                    intNewX = intRightX
                                    intNewY = intBottomY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)
                                    Dim intGDAY As Integer = intNewY
                                    '--- JRN 20.05.2010
                                    If CDblDB(foundRowPlan(iPlan)("SVLiveeasy")) Then
                                        Dim strImage1Path As String = AppDomain.CurrentDomain.BaseDirectory & "\logo\SVLiveEasy1.jpg"

                                        If File.Exists(strImage1Path) Then
                                            Dim xrImage1 As New XRPictureBox
                                            With xrImage1
                                                .Image = Image.FromFile(strImage1Path)
                                                .Height = 55
                                                .Width = 55
                                                .Sizing = ImageSizeMode.StretchImage

                                            End With
                                            xrImage1.Location = New Point(intNewX + 210, intNewY)

                                            .Detail.Controls.AddRange(New XRPictureBox() {xrImage1})
                                            xrImage1.SendToBack()
                                        End If

                                    End If
                                    '---
                                    If blnShowGDA = False Then
                                        Select Case G_ReportOptions.intPageLanguage
                                            Case 3 'FRENCH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                            Case 2 'GERMAN
                                                strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                            Case 1 'ENGLISH
                                                strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                        End Select
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Exit For
                                            End If
                                        Next
                                        intNewY += intTextHeight

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                            End If
                                        Next

                                        For iNut As Integer = 0 To arrNutrientName.Count - 1
                                            If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
                                                strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                                intNewX += intColNut1 + intColSpace

                                                If iNut = 0 Then
                                                    strX = arrNutrientUnit(iNut)
                                                    If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                                    Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundDetails(0)("N" & iNut + 1)))
                                                    strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                Else
                                                    strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                                End If
                                                intNewX = intRightX
                                                intNewY += intTextHeight
                                            End If
                                        Next
                                    End If

                                    If blnShowGDA Then
                                        Dim intGDAPanelHeight = 70
                                        Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                        Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                        Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                        fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                        For intR As Integer = 1 To 5
                                            L_Nutrient(intR).Value = foundDetails(0)("N" & intR)
                                        Next
                                        .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY + 60, 265, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                                    End If
                                    Exit For
                                End If
                                intSide += 1
                            Next

                        End If
                    End If
                Else
                    intCodeDay = CIntDB(foundRowPlan(4)("CodeDay"))
                    intNo = CIntDB(foundRowPlan(4)("ProposalNo"))
                    intCodeTrans = CIntDB(foundRowPlan(4)("CodeTrans"))
                    foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

                    intNewX = intLeftX
                    intNewY = intTopY

                    If foundProName.Length > 0 Then
                        strX = CStrDB(foundProName(0)("ProposalName"))
                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intColWidth, sf, Padding).Height
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    End If
                    intNewY += intTitleHeight + 10

                    Dim strItemName() As String = CStrDB(foundRowPlan(4)("ItemName2")).Split(vbCrLf)
                    For x As Integer = 0 To strItemName.Length - 1
                        strX = strItemName(x).Trim
                        If Not strX = "" Then
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            intNewY += intTextHeight - 10
                        End If
                    Next

                    'PRICE
                    intNewX = intLeftX
                    intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10)
                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
                    fntRegular = New Font("Arial", 11, FontStyle.Regular)

                    Dim intColPrice1 As Integer = 0
                    Dim intColPrice2 As Integer = 0

                    Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
                    If foundRowPrice.Length > 0 Then
                        Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))

                        For iP As Integer = 0 To UBound(strPrice)
                            strX = fctGetPrice(strPrice(iP))
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            If intColPrice1 < intTextWidth Then intColPrice1 = intTextWidth

                            If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
                                strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
                                strX = Format(CDblDB(strX), "0.00")
                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                If intColPrice2 < intTextWidth Then intColPrice2 = intTextWidth
                            End If
                        Next

                        For iP As Integer = 0 To 2
                            If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
                                For iP2 As Integer = 0 To UBound(strPrice)
                                    If (iP + 1) = (iP2 + 1) Then
                                        strX = fctGetPrice(strPrice(iP2)).Trim
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColPrice1, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                        intNewX += intColPrice1 + 15

                                        strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
                                        strX = Format(CDblDB(strX), "0.00")
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intColPrice2, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intColPrice2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                        intNewX += intColPrice2 + 15

                                        If CBoolDB(foundRowPlan(4)("Co")) Then
                                            If CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "0" Then
                                                strX = CStrDB(foundRowPlan(4)("CoPrice" & iP + 1))
                                                strX = Format(CDblDB(strX), "0.00") & "*"
                                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
                                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
                                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
                                            End If
                                        End If

                                        intNewY += (intTextHeight - 3)
                                        intNewX = intLeftX
                                        Exit For
                                    End If
                                Next
                            End If
                        Next

                        fntRegular = New Font("Arial", 8, FontStyle.Regular)
                        intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight)

                        If CBoolDB(foundRowPlan(4)("Co")) Then
                            If Not CStrDB(foundRowPlan(4)("CoName")).Trim = "" Then
                                strX = "*" & CStrDB(foundRowPlan(4)("CoName")).Trim
                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewY += intTextHeight
                            End If
                        End If
                    End If


                    'NUTRIENT
                    Dim intColNut1 As Integer = 0
                    Dim intColSpace As Integer = 3
                    If Not dtConfig Is Nothing Then

                        If blnShowNut Then
                            fntRegular = New Font("Arial", 9, FontStyle.Regular)

                            intNewX = intLeftX
                            intNewY = intTopY + (intTitleHeight + 10 + intItemHeight + 10 + intPriceHeight + intCoNameHeight + 20)

                            Select Case G_ReportOptions.intPageLanguage
                                Case 3 'FRENCH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                                Case 2 'GERMAN
                                    strX = "1 " & "Portion" & " " & "enthält ca." & ":"
                                Case 1 'ENGLISH
                                    strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
                            End Select
                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Exit For
                                End If
                            Next
                            intNewY += intTextHeight

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundRowPlan(4)("N" & iNut + 1)), arrNutrientFormat(iNut))
                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                    If intColNut1 < intTextWidth Then intColNut1 = intTextWidth
                                End If
                            Next

                            For iNut As Integer = 0 To arrNutrientName.Count - 1
                                If foundRowPlan(4)("N" & iNut + 1) > 0 Then
                                    strX = Format(CDbl(foundRowPlan(4)("N" & iNut + 1)), "##0")
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intColNut1, sf, Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intColNut1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

                                    intNewX += intColNut1 + intColSpace

                                    If iNut = 0 Then
                                        strX = arrNutrientUnit(iNut)
                                        If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
                                        Dim dblKcal As Double = ConvertKjtoKcal(CDblDB(foundRowPlan(4)("N" & iNut + 1)))
                                        strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    Else
                                        strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    End If
                                    intNewX = intLeftX
                                    intNewY += intTextHeight
                                End If
                            Next
                            If blnShowGDA Then
                                Dim intGDAPanelHeight = 70
                                Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
                                Dim intTitleHeight1 As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
                                Dim intGDAPanelWidth As Integer = intAvailableWidth '((((intGDAPanelHeight - (intTitleHeight * 2)) * 0.7) + 2) * 6) + 40
                                fctGetNutrientDetails(udtUser.CodeTrans, udtUser.Site.Code)
                                For intR As Integer = 1 To 5
                                    L_Nutrient(intR).Value = foundRowPlan(4)("N" & intR)
                                Next
                                .Detail.Controls.AddRange(New XRControl() {fctGetGDAPanel(intNewX, intNewY + 60, intNewX + 265, intGDAPanelHeight, arrNutrientName, strCodeTrans)})

                            End If
                        End If
                    End If
                End If
            End If





            'Dim intLeftSide As Integer = (.PageWidth / 2) - .Margins.Left - .Margins.Right  '(intAvailableWidth / 2) '- 50
            'Dim intRightSide As Integer = intLeftSide + .Margins.Right + .Margins.Left  '+ .Margins.Right
            'Dim intUpperSide As Integer = (.PageHeight / 2) - .Margins.Top - .Margins.Bottom  '(intAvailableHeight / 2)
            'Dim intLowerSide As Integer = intUpperSide + .Margins.Bottom + .Margins.Top '(intAvailableHeight - intUpperSide) + .Margins.Top
            'Dim intWidthX As Integer = (.PageWidth / 2) - .Margins.Left - (.Margins.Right / 2) 'intLeftSide - 10

            'intNewX = 0
            'intNewY = 0

            'Dim intNo As Integer
            'Dim intCodeTrans As Integer
            'Dim intCodeDay As Integer
            'Dim foundProName() As DataRow
            'Dim foundIngr() As DataRow

            'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            'intTextHeight += (.MeasureText("A", fntBold, intWidthX, sf, Padding).Height * 6)
            'Dim intRowHeight1 As Integer = intTextHeight
            'Dim intRowHeight2 As Integer = intLowerSide + intTextHeight

            'Dim i As Integer = 0
            'Dim foundRowPlan() As DataRow = dtPlan.Select("CodeDay=" & CInt(foundDetails(0)("CodeDay")) & " AND CodeTrans = " & G_ReportOptions.intCodeTrans)

            'If Not foundRowPlan.Length = 0 Then
            '    If Not foundDetails(0)("Code") = 5 Then
            '        'NAME, INGREDIENT
            '        For iPlan As Integer = 0 To foundRowPlan.Length - 1
            '            intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
            '            intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
            '            intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
            '            foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
            '            foundIngr = dtDetails.Select("CodeDay=" & intCodeDay & " AND ProposalNo=" & intNo & " AND CodeTrans=" & intCodeTrans)

            '            If (i + 1) = 1 Then 'UPPER LEFT
            '                intNewX = 0
            '                intNewY = 0

            '                If foundProName.Length > 0 Then
            '                    strX = CStrDB(foundProName(0)("ProposalName"))
            '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intWidthX, sf, Padding).Height
            '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '                    intNewY += intTextHeight
            '                    intNewY += 10

            '                    '===================== TEST ========================
            '                    'Dim strItemName() As String
            '                    'Dim itemcount As Integer = 0
            '                    'If foundIngr.Length > 0 Then
            '                    '    For iIngr As Integer = 0 To foundIngr.GetUpperBound(0)
            '                    '        strItemName = CStr(foundIngr(iIngr)("Name")).Split(vbCrLf)
            '                    '        For x As Integer = 0 To UBound(strItemName)
            '                    '            strX = strItemName(x).Trim
            '                    '            If Not strX = "" Then
            '                    '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intWidthX, sf, Padding).Height
            '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                    '                intNewY += (intTextHeight - 3)
            '                    '                itemcount += 1
            '                    '                If itemcount >= 6 Then Exit For
            '                    '            End If
            '                    '        Next
            '                    '        If itemcount >= 6 Then Exit For
            '                    '    Next
            '                    'End If
            '                    Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
            '                    For x As Integer = 0 To strItemName.Length - 1
            '                        strX = strItemName(x).Trim
            '                        If Not strX = "" Then
            '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                            intNewY += intTextHeight - 11
            '                        End If
            '                    Next
            '                    '===================== TEST ========================
            '                End If
            '                If intRowHeight1 < intNewY Then intRowHeight1 = intNewY
            '            ElseIf (i + 1) = 2 Then 'UPPER RIGHT
            '                intNewX = intRightSide
            '                intNewY = 0


            '                If foundProName.Length > 0 Then
            '                    strX = CStrDB(foundProName(0)("ProposalName"))
            '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intWidthX, sf, Padding).Height
            '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '                    intNewY += intTextHeight
            '                    intNewY += 10

            '                    '===================== TEST ========================
            '                    'Dim strItemName() As String
            '                    'Dim itemcount As Integer = 0
            '                    'If foundIngr.Length > 0 Then
            '                    '    For iIngr As Integer = 0 To foundIngr.GetUpperBound(0)
            '                    '        strItemName = CStr(foundIngr(iIngr)("Name")).Split(vbCrLf)
            '                    '        For x As Integer = 0 To UBound(strItemName)
            '                    '            strX = strItemName(x).Trim
            '                    '            If Not strX = "" Then
            '                    '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intWidthX, sf, Padding).Height
            '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                    '                intNewY += (intTextHeight - 3)
            '                    '                itemcount += 1
            '                    '                If itemcount >= 6 Then Exit For
            '                    '            End If
            '                    '        Next
            '                    '        If itemcount >= 6 Then Exit For
            '                    '    Next
            '                    'End If

            '                    Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
            '                    For x As Integer = 0 To strItemName.Length - 1
            '                        strX = strItemName(x).Trim
            '                        If Not strX = "" Then
            '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                            intNewY += intTextHeight - 11
            '                        End If
            '                    Next
            '                    '===================== TEST ========================
            '                End If
            '                If intRowHeight1 < intNewY Then intRowHeight1 = intNewY
            '            ElseIf (i + 1) = 3 Then 'LOWER LEFT
            '                intNewX = 0
            '                intNewY = intLowerSide

            '                If foundProName.Length > 0 Then
            '                    strX = CStrDB(foundProName(0)("ProposalName"))
            '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intWidthX, sf, Padding).Height
            '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '                    intNewY += intTextHeight
            '                    intNewY += 10

            '                    '===================== TEST ========================
            '                    'Dim strItemName() As String
            '                    'Dim itemcount As Integer = 0
            '                    'If foundIngr.Length > 0 Then
            '                    '    For iIngr As Integer = 0 To foundIngr.GetUpperBound(0)
            '                    '        strItemName = CStr(foundIngr(iIngr)("Name")).Split(vbCrLf)
            '                    '        For x As Integer = 0 To UBound(strItemName)
            '                    '            strX = strItemName(x).Trim
            '                    '            If Not strX = "" Then
            '                    '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intWidthX, sf, Padding).Height
            '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                    '                intNewY += (intTextHeight - 3)
            '                    '                itemcount += 1
            '                    '                If itemcount >= 6 Then Exit For
            '                    '            End If
            '                    '        Next
            '                    '        If itemcount >= 6 Then Exit For
            '                    '    Next
            '                    'End If

            '                    Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
            '                    For x As Integer = 0 To strItemName.Length - 1
            '                        strX = strItemName(x).Trim
            '                        If Not strX = "" Then
            '                            intWidthX = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intWidthX, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                            intNewY += intTextHeight - 11
            '                        End If
            '                    Next
            '                    '===================== TEST ========================
            '                End If
            '                If intRowHeight2 < intNewY Then intRowHeight2 = intNewY
            '            ElseIf (i + 1) = 4 Then 'LOWER RIGHT
            '                intNewX = intRightSide
            '                intNewY = intLowerSide

            '                If foundProName.Length > 0 Then
            '                    strX = CStrDB(foundProName(0)("ProposalName"))
            '                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intWidthX, sf, Padding).Height
            '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                    intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '                    intNewY += intTextHeight
            '                    intNewY += 10

            '                    '===================== TEST ========================
            '                    'Dim strItemName() As String
            '                    'Dim itemcount As Integer = 0
            '                    'If foundIngr.Length > 0 Then
            '                    '    For iIngr As Integer = 0 To foundIngr.GetUpperBound(0)
            '                    '        strItemName = CStr(foundIngr(iIngr)("Name")).Split(vbCrLf)
            '                    '        For x As Integer = 0 To UBound(strItemName)
            '                    '            strX = strItemName(x).Trim
            '                    '            If Not strX = "" Then
            '                    '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intWidthX, sf, Padding).Height
            '                    '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                    '                intNewY += (intTextHeight - 3)
            '                    '                itemcount += 1
            '                    '                If itemcount >= 6 Then Exit For
            '                    '            End If
            '                    '        Next
            '                    '        If itemcount >= 6 Then Exit For
            '                    '    Next
            '                    'End If

            '                    Dim strItemName() As String = CStrDB(foundRowPlan(iPlan)("ItemName2")).Split(vbCrLf)
            '                    For x As Integer = 0 To strItemName.Length - 1
            '                        strX = strItemName(x).Trim
            '                        If Not strX = "" Then
            '                            intWidthX = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intWidthX, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                            intNewY += intTextHeight - 11
            '                        End If
            '                    Next
            '                    '===================== TEST ========================
            '                End If
            '                If intRowHeight2 < intNewY Then intRowHeight2 = intNewY
            '                Exit For
            '            End If
            '            i += 1
            '        Next

            '        'PRICE
            '        i = 0
            '        intRowHeight1 += 10
            '        intRowHeight2 += 10
            '        For iPlan As Integer = 0 To foundRowPlan.Length - 1
            '            intCodeDay = CIntDB(foundRowPlan(iPlan)("CodeDay"))
            '            intNo = CIntDB(foundRowPlan(iPlan)("ProposalNo"))
            '            intCodeTrans = CIntDB(foundRowPlan(iPlan)("CodeTrans"))
            '            Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
            '            If foundRowPrice.Length > 0 Then
            '                Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
            '                Dim intTextWidth As Integer = 0
            '                Dim intCol1 As Integer = 0
            '                Dim intCol2 As Integer = 0

            '                For iP As Integer = 0 To UBound(strPrice)
            '                    strX = fctGetPrice(strPrice(iP))
            '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                    If intCol1 < intTextWidth Then intCol1 = intTextWidth

            '                    If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
            '                        strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
            '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                        If intCol2 < intTextWidth Then intCol2 = intTextWidth
            '                    End If
            '                Next

            '                If (i + 1) = 1 Then 'UPPER LEFT
            '                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '                    fntRegular = New Font("Arial", 11, FontStyle.Regular)
            '                    intNewX = 0
            '                    intNewY = intRowHeight1

            '                    For iP As Integer = 0 To 2
            '                        If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
            '                            For iP2 As Integer = 0 To UBound(strPrice)
            '                                If (iP + 1) = (iP2 + 1) Then
            '                                    strX = fctGetPrice(strPrice(iP2)).Trim
            '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                                    intNewX += intCol1 + 15

            '                                    strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                                    intNewX += intCol2 + 15

            '                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
            '                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
            '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
            '                                    End If

            '                                    intNewY += (intTextHeight - 3)
            '                                    intNewX = 0
            '                                    Exit For
            '                                End If
            '                            Next
            '                        End If
            '                    Next
            '                    fntRegular = New Font("Arial", 8, FontStyle.Regular)

            '                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
            '                        strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
            '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        intNewY += intTextHeight
            '                    End If
            '                ElseIf (i + 1) = 2 Then 'UPPER RIGHT
            '                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '                    fntRegular = New Font("Arial", 11, FontStyle.Regular)
            '                    intNewX = intRightSide
            '                    intNewY = intRowHeight1


            '                    For iP As Integer = 0 To 2
            '                        If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
            '                            For iP2 As Integer = 0 To UBound(strPrice)
            '                                If (iP + 1) = (iP2 + 1) Then
            '                                    strX = fctGetPrice(strPrice(iP2)).Trim
            '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

            '                                    intNewX += intCol1 + 15

            '                                    strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                                    intNewX += intCol2 + 15

            '                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
            '                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
            '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
            '                                    End If

            '                                    intNewY += (intTextHeight - 3)
            '                                    intNewX = intRightSide
            '                                    Exit For
            '                                End If
            '                            Next
            '                        End If
            '                    Next
            '                    fntRegular = New Font("Arial", 8, FontStyle.Regular)

            '                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
            '                        strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
            '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        intNewY += intTextHeight
            '                    End If

            '                ElseIf (i + 1) = 3 Then 'LOWER LEFT
            '                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '                    fntRegular = New Font("Arial", 11, FontStyle.Regular)
            '                    intNewX = 0
            '                    intNewY = intRowHeight2

            '                    For iP As Integer = 0 To 2
            '                        If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
            '                            For iP2 As Integer = 0 To UBound(strPrice)
            '                                If (iP + 1) = (iP2 + 1) Then
            '                                    strX = fctGetPrice(strPrice(iP2)).Trim
            '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

            '                                    intNewX += intCol1 + 15

            '                                    strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                                    intNewX += intCol2 + 15

            '                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
            '                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
            '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
            '                                    End If

            '                                    intNewY += (intTextHeight - 3)
            '                                    intNewX = 0
            '                                    Exit For
            '                                End If
            '                            Next
            '                        End If
            '                    Next
            '                    fntRegular = New Font("Arial", 8, FontStyle.Regular)

            '                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
            '                        strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
            '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        intNewY += intTextHeight
            '                    End If
            '                ElseIf (i + 1) = 4 Then 'LOWER RIGHT
            '                    fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '                    fntRegular = New Font("Arial", 11, FontStyle.Regular)
            '                    intNewX = intRightSide
            '                    intNewY = intRowHeight2

            '                    For iP As Integer = 0 To 2
            '                        If CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("Price" & iP + 1)).Trim <> "0" Then
            '                            For iP2 As Integer = 0 To UBound(strPrice)
            '                                If (iP + 1) = (iP2 + 1) Then
            '                                    strX = fctGetPrice(strPrice(iP2)).Trim
            '                                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

            '                                    intNewX += intCol1 + 15

            '                                    strX = CStrDB(foundRowPlan(iPlan)("Price" & iP + 1))
            '                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
            '                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                                    intNewX += intCol2 + 15

            '                                    If CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)).Trim <> "0" Then
            '                                        strX = CStrDB(foundRowPlan(iPlan)("CoPrice" & iP + 1)) & "*"
            '                                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopRight)})
            '                                    End If

            '                                    intNewY += (intTextHeight - 3)
            '                                    intNewX = intRightSide
            '                                    Exit For
            '                                End If
            '                            Next
            '                        End If
            '                    Next
            '                    fntRegular = New Font("Arial", 8, FontStyle.Regular)

            '                    If Not CStrDB(foundRowPlan(iPlan)("CoName")).Trim = "" Then
            '                        strX = "*" & CStrDB(foundRowPlan(iPlan)("CoName")).Trim
            '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        intNewY += intTextHeight
            '                    End If
            '                    Exit For
            '                End If
            '            End If
            '            i += 1
            '        Next
            '    Else
            '        'NAME, INGREDIENT
            '        intCodeDay = CIntDB(foundRowPlan(4)("CodeDay"))
            '        intNo = CIntDB(foundRowPlan(4)("ProposalNo"))
            '        intCodeTrans = CIntDB(foundRowPlan(4)("CodeTrans"))
            '        foundProName = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)
            '        foundIngr = dtDetails.Select("CodeDay=" & intCodeDay & " AND ProposalNo=" & intNo & " AND CodeTrans=" & intCodeTrans)


            '        intNewX = 0
            '        intNewY = 0

            '        If foundProName.Length > 0 Then
            '            strX = ""
            '            strX = CStrDB(foundProName(0)("ProposalName"))
            '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntReportTitle, intWidthX, sf, Padding).Height
            '            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntReportTitle, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '            intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '            intNewY += intTextHeight
            '            intNewY += 10

            '            Dim strItemName() As String
            '            If foundIngr.Length > 0 Then
            '                For iIngr As Integer = 0 To foundIngr.GetUpperBound(0)
            '                    strItemName = CStr(foundIngr(iIngr)("Name")).Split(vbCrLf)
            '                    For x As Integer = 0 To UBound(strItemName)
            '                        strX = strItemName(x).Trim
            '                        If Not strX = "" Then
            '                            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intWidthX, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight - 3, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                            intNewY += (intTextHeight - 3)
            '                        End If
            '                    Next
            '                Next
            '            End If
            '        End If
            '        If intRowHeight1 < intNewY Then intRowHeight1 = intNewY
            '        'intNutrientY += intRowHeight1

            '        'PRICE
            '        i = 0
            '        intRowHeight1 += 10

            '        intCodeDay = CIntDB(foundRowPlan(4)("CodeDay"))
            '        intNo = CIntDB(foundRowPlan(4)("ProposalNo"))
            '        intCodeTrans = CIntDB(foundRowPlan(4)("CodeTrans"))
            '        Dim foundRowPrice() As DataRow = dtConfig.Select("ProposalNo=" & intNo & " And CodeTrans=" & intCodeTrans)

            '        If foundRowPrice.Length > 0 Then
            '            Dim strPrice() As String = CStr(foundRowPrice(0)("Price")).Split(CChar(";"))
            '            Dim intTextWidth As Integer = 0
            '            Dim intCol1 As Integer = 0
            '            Dim intCol2 As Integer = 0

            '            For iP As Integer = 0 To UBound(strPrice)
            '                strX = fctGetPrice(strPrice(iP))
            '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                If intCol1 < intTextWidth Then intCol1 = intTextWidth

            '                If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
            '                    strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
            '                    intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                    If intCol2 < intTextWidth Then intCol2 = intTextWidth
            '                End If
            '            Next

            '            fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '            fntRegular = New Font("Arial", 11, FontStyle.Regular)
            '            intNewX = 0
            '            intNewY = intRowHeight1

            '            For iP As Integer = 0 To 2
            '                If CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("Price" & iP + 1)).Trim <> "0" Then
            '                    For iP2 As Integer = 0 To UBound(strPrice)
            '                        If (iP + 1) = (iP2 + 1) Then
            '                            strX = fctGetPrice(strPrice(iP2)).Trim
            '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.BottomLeft)})

            '                            intNewX += intCol1 + 15

            '                            strX = CStrDB(foundRowPlan(4)("Price" & iP + 1))
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intCol2, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Black, Color.Transparent, intNewX, intNewY, intCol2, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                            intNewX += intCol2 + 15

            '                            If CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "" And CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)).Trim <> "0" Then
            '                                strX = CStrDB(foundRowPlan(4)("CoPrice" & iP + 1)) & "*"
            '                                intTextWidth = ReportingTextUtils.MeasureText(strX, fntBold, 0, sf, Padding).Width
            '                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intTextWidth, sf, Padding).Height
            '                                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntBold, Color.Gray, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})
            '                            End If

            '                            intNewY += intTextHeight
            '                            intNewX = 0
            '                            Exit For
            '                        End If
            '                    Next
            '                End If
            '            Next
            '            fntRegular = New Font("Arial", 8, FontStyle.Regular)

            '            If Not CStrDB(foundRowPlan(4)("CoName")).Trim = "" Then
            '                strX = "*" & CStrDB(foundRowPlan(4)("CoName")).Trim
            '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Padding).Height
            '                .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Gray, Color.Transparent, intNewX, intNewY, intWidthX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                intNewY += intTextHeight
            '            End If
            '        End If
            '    End If

            '    'NUTRIENT
            '    If Not dtConfig Is Nothing Then
            '        Dim blnShowNut As Boolean = CBoolDB(dtConfig.Rows(0)("PrintNut"))

            '        If blnShowNut Then
            '            fntRegular = New Font("Arial", 9, FontStyle.Regular)

            '            Dim arrNutrientName As New ArrayList
            '            Dim arrNutrientFormat As New ArrayList
            '            Dim arrNutrientUnit As New ArrayList
            '            subGetNutrient(strConnection, G_ReportOptions.intCodeTrans, arrNutrientName, arrNutrientFormat, arrNutrientUnit)
            '            'Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
            '            'Dim dt As DataTable = cNutrient.GetList().Tables(0)
            '            'If Not dt Is Nothing Then
            '            '    For Each row As DataRow In dt.Rows
            '            '        arrNutrientName.Add(row("Name"))
            '            '        arrNutrientFormat.Add(row("Format"))
            '            '        arrNutrientUnit.Add(row("Units"))
            '            '    Next
            '            'End If

            '            Dim intTextWidth As Integer
            '            Dim intCol1 As Integer = 0
            '            Dim intCol2 As Integer = 0
            '            Dim intCol3 As Integer = 0
            '            Dim intColSpace As Integer = 3

            '            i = 0
            '            For iPlan As Integer = 0 To foundRowPlan.Length - 1
            '                Dim intNutrientY As Integer = 0
            '                'intTextHeight = ReportingTextUtils.MeasureText("A", fntReportTitle, intWidthX, sf, Padding).Height
            '                'intNutrientY += intTextHeight + 10

            '                fntBold = New Font("Arial Black", 10, FontStyle.Bold)
            '                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, 3, sf, Padding).Height
            '                intNutrientY += ((intTextHeight - 3) * 3)

            '                fntRegular = New Font("Arial", 8, FontStyle.Regular)
            '                intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Padding).Height
            '                intNutrientY += intTextHeight
            '                intNutrientY += 10

            '                If (i + 1) = 1 Then 'UPPER LEFT
            '                    intNewX = 0
            '                    intNutrientY += intRowHeight1
            '                    intNewY = intNutrientY
            '                ElseIf (i + 1) = 2 Then 'UPPER RIGHT
            '                    intNewX = intRightSide
            '                    intNutrientY += intRowHeight1
            '                    intNewY = intNutrientY
            '                ElseIf (i + 1) = 3 Then 'LOWER LEFT
            '                    intNewX = 0
            '                    intNutrientY += intRowHeight2
            '                    intNewY = intNutrientY
            '                ElseIf (i + 1) = 2 Then 'LOWER RIGHT
            '                    intNewX = intRightSide
            '                    intNutrientY += intRowHeight2
            '                    intNewY = intNutrientY
            '                Else
            '                    intNewX = 0
            '                    intNutrientY += intRowHeight1
            '                    intNewY = intNutrientY
            '                End If



            '                Select Case G_ReportOptions.intPageLanguage
            '                    Case 3 'FRENCH
            '                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
            '                    Case 2 'GERMAN
            '                        strX = "1 " & "Portion" & " " & "enthält ca." & ":"
            '                    Case 1 'ENGLISH
            '                        strX = "1 " & "Portion" & " " & cLang.GetString(clsEGSLanguage.CodeType.Contains).ToLower & ":"
            '                End Select

            '                intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height

            '                For iNut As Integer = 0 To arrNutrientName.Count - 1
            '                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        Exit For
            '                    End If
            '                Next
            '                intNewY += (intTextHeight)

            '                For iNut As Integer = 0 To arrNutrientName.Count - 1
            '                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
            '                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), arrNutrientFormat(iNut))
            '                        intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                        If intCol1 < intTextWidth Then intCol1 = intTextWidth
            '                    End If
            '                Next

            '                For iNut As Integer = 0 To arrNutrientName.Count - 1
            '                    If foundRowPlan(iPlan)("N" & iNut + 1) > 0 Then
            '                        strX = Format(CDbl(foundRowPlan(iPlan)("N" & iNut + 1)), "##0")
            '                        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intCol1, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopRight)})

            '                        intNewX += intCol1 + intColSpace

            '                        If iNut = 0 Then
            '                            strX = arrNutrientUnit(iNut)
            '                            If strX = "kj" Then strX = strX.Substring(0, 1) & strX.Substring(1, 1).ToUpper
            '                            Dim dblKcal As Double = ConvertKjtoKcal(CDbl(foundDetails(0)("N" & iNut + 1)))
            '                            strX += "/ " & CStr(Format(dblKcal, arrNutrientFormat(iNut))) & " kcal"
            '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        Else
            '                            strX = arrNutrientUnit(iNut) & " " & arrNutrientName(iNut)
            '                            intTextWidth = ReportingTextUtils.MeasureText(strX, fntRegular, 0, sf, Padding).Width
            '                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intTextWidth, sf, Padding).Height
            '                            .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intNewX, intNewY, intTextWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                        End If
            '                        If (i + 1) = 1 Or (i + 1) = 3 Then
            '                            intNewX = 0
            '                        ElseIf (i + 1) = 2 Or (i + 1) = 4 Then
            '                            intNewX = intRightSide
            '                        End If

            '                        intNewY += (intTextHeight)
            '                    End If
            '                Next
            '                i += 1
            '            Next
            '        End If
            '    End If
            'End If

        End With
        '--- DETAILS ---

        Return Me
    End Function

    Private Sub subGetNutrient(ByVal strConnection As String, ByVal intCodeTrans As Integer, ByRef arrNutrientName As ArrayList,
                                    ByRef arrNutrientFormat As ArrayList, ByRef arrNutrientUnit As ArrayList)

        Dim cNutrient As New clsNutrient(enumAppType.WebApp, strConnection)
        Dim dt As DataTable = cNutrient.GetList(intCodeTrans).Tables(0)
        'Dim dtNutTrans As DataTable = cNutrient.fctGetNutrientTrans
        'Dim dvNutTrans As New DataView(dtNutTrans)
        'dvNutTrans.RowFilter = "CodeTrans=" & intCodeTrans
        'dtNutTrans = dvNutTrans.ToTable


        If Not dt Is Nothing Then
            For Each row As DataRow In dt.Rows
                arrNutrientName.Add(row("Name"))
                'For Each rowTrans As DataRow In dtNutTrans.Rows
                '    If rowTrans("CodeMain") = row("Nutr_No") Then
                '        arrNutrientName.Add(rowTrans("Name"))
                '        Exit For
                '    End If
                'Next
                arrNutrientFormat.Add(row("Format"))
                arrNutrientUnit.Add(row("Units"))
            Next
        End If
    End Sub

    Private Function fctGetDay(ByVal intCodeDay As Integer, ByVal cLang As clsEGSLanguage) As String 'intCodetrans
        Select Case intCodeDay
            Case 1 : Return cLang.GetString(clsEGSLanguage.CodeType.Monday)
            Case 2 : Return cLang.GetString(clsEGSLanguage.CodeType.Tuesday)
            Case 3 : Return cLang.GetString(clsEGSLanguage.CodeType.Wednesday)
            Case 4 : Return cLang.GetString(clsEGSLanguage.CodeType.Thursday)
            Case 5 : Return cLang.GetString(clsEGSLanguage.CodeType.Friday)
            Case 6 : Return cLang.GetString(clsEGSLanguage.CodeType.Saturday)
            Case 7 : Return cLang.GetString(clsEGSLanguage.CodeType.Sunday)
        End Select
    End Function

    Private Function fctGetPrice(ByVal intCodePrice As String) As String 'TEMPORARY
        Select Case intCodePrice
            Case 1 : Return "INT"
            Case 2 : Return "EXT"
            Case 3 : Return "STUD"
            Case 4 : Return "DOZ"
            Case 5 : Return "LEHR"
            Case 6 : Return "SCHU"
            Case 7 : Return "CHF"
            Case 8 : Return "€"
            Case 9 : Return "CS"
            Case 10 : Return "IBM"
            Case 11 : Return "AXA"
            Case Else : Return ""
        End Select
    End Function

    Private Sub SplitPanelText(ByVal xrPanel As XRPanel, ByVal strX As String, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment)
        With Me
            strX = strX.Replace(Chr(10), "")
            Dim arr() As String = strX.Split(vbCrLf)

            Dim i As Integer = 0
            While i < arr.Length
                If arr(i).Trim.Length > 0 Then
                    strX = arr(i)
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, xrPanel.Width, sf, Me.Padding).Height

                    xrPanel.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strX, fntRegular, Color.Black, Color.Transparent, intCX, intCY, xrPanel.Width, intTextHeight, align, True, True, True)})
                    intCY += intTextHeight
                End If
                i += 1
            End While
            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, xrPanel.Width, sf, Me.Padding).Height
            intCY += intTextHeight
        End With
    End Sub

    Function fctMakeXrPanel(ByVal intX As Integer, ByVal intY As Integer, ByVal intWidth As Integer, ByVal strName As String,
                            ByVal BackColor As Color, Optional ByVal intHeight As Integer = 1) 'VRP 05.06.2008
        Dim xrPanel As New XRPanel
        With xrPanel
            .KeepTogether = True
            .Location = New System.Drawing.Point(intX, intY)
            .Width = intWidth
            .Height = intHeight
            .Name = strName
            .CanGrow = True
            .BackColor = BackColor
        End With
        Return xrPanel
    End Function
#End Region

#Region "SV KOLB's Report"
    'Public Function GenerateReportKolbs(ByVal ds As DataSet, ByVal intCodeLang As Integer, ByVal strFilepath As String, ByVal strPicPath As String, ByVal strPaperSize As String) As String
    '    Dim strMyMessage As String
    '    Dim strLabelText As String
    '    Dim ReportLeftMargin As Double
    '    Dim ReportRightMargin As Double
    '    Dim ReportTopMargin As Double
    '    Dim ReportBottomMargin As Double
    '    Dim TableWidth As Double
    '    Dim intPreviousForLocal As Integer = 0
    '    Dim strPreviousCountry As String = ""
    '    Dim strSpace As String = "   "
    '    Dim XrTable1 As New XRTable

    '    ReportTopMargin = 254
    '    ReportLeftMargin = 125
    '    ReportRightMargin = 125
    '    ReportBottomMargin = 125



    '    Dim fntPageInfo As Font = New Font("Arial Narrow", 6.25!, FontStyle.Regular)
    '    strLabelText = ""

    '    'strMyMessage = OpenConnection()

    '    Dim Report = New XtraReport
    '    With Report
    '        .ReportUnit = ReportUnit.TenthsOfAMillimeter
    '        'Papersize
    '        '------------------------------------------------------------------------------------
    '        If strPaperSize.ToLower = "a4" Then
    '            .PaperKind = Printing.PaperKind.A4
    '        ElseIf strPaperSize.ToLower = "let" Then
    '            .PaperKind = Printing.PaperKind.Letter
    '        Else
    '            .PaperKind = Printing.PaperKind.A4
    '        End If
    '        .Visible = True
    '        .Dpi = 254.0!

    '        TableWidth = .PageWidth - (ReportLeftMargin + ReportRightMargin) - 2
    '        '.PageWidth = DefaultPageWidth
    '        '.PageHeight = DefaultPageHeight
    '        '------------------------------------------------------------------------------------
    '        'Margins
    '        '------------------------------------------------------------------------------------
    '        .Margins.Left = ReportLeftMargin
    '        .Margins.Right = ReportRightMargin
    '        .Margins.Bottom = ReportBottomMargin
    '        .Margins.Top = ReportTopMargin

    '        '------------------------------------------------------------------------------------
    '        'Orientation
    '        '------------------------------------------------------------------------------------
    '        .Landscape = False

    '        '------------------------------------------------------------------------------------
    '        'ADD THE SECTION OF THE REPORT 
    '        '------------------------------------------------------------------------------------
    '        'BottomMargin      

    '        'Details
    '        Detail.Dpi = 254.0!
    '        Detail.Height = .PageHeight - (ReportTopMargin + ReportBottomMargin) '2664
    '        Detail.Name = "Detail"


    '        Dim intYPos As Integer = 0
    '        Dim intGlobalY As Integer = 0
    '        intGlobalX = .PageWidth - (ReportLeftMargin + ReportRightMargin)
    '        intGlobalMultiplier = .PageHeight - (ReportTopMargin + ReportBottomMargin)
    '        Dim intRowIndex As Integer = 0
    '        Dim xrAllTable As New XRTable
    '        With xrAllTable
    '            .Dpi = 254.0!
    '            .Width = TableWidth

    '        End With
    '        For Each dtRow As DataRow In ds.Tables(3).Rows
    '            Dim xrRow As New XRTableRow
    '            xrRow.Dpi = 254.0!
    '            Dim xrCell As New XRTableCell
    '            xrCell.Dpi = 254.0!
    '            Dim xrPanelRecipe As New XRPanel
    '            xrPanelRecipe = GetRecipePanel(TableWidth - 2, ds, intCodeLang, strPicPath, intGlobalY, intRowIndex)
    '            xrPanelRecipe.Dpi = 254.0!
    '            xrCell.Controls.AddRange(New XRPanel() {xrPanelRecipe})
    '            xrRow.Cells.AddRange(New XRTableCell() {xrCell})
    '            xrAllTable.Rows.AddRange(New XRTableRow() {xrRow})
    '            xrAllTable.Padding = New PaddingInfo(0, 0, 0, 0)
    '            'Detail.Controls.AddRange(New XRPanel() {GetRecipePanel(TableWidth - 2, ds, intCodeLang, intGlobalY, intRowIndex)})
    '            'Dim xrBreak As New XRPageBreak
    '            'Detail.Controls.AddRange(New XRPageBreak() {xrBreak})
    '            intRowIndex += 1
    '        Next

    '        Detail.Controls.AddRange(New XRTable() {xrAllTable})

    '        '--- final report -----
    '        .Bands.Add(Detail)          'DETAIL SECTION
    '        .CreatePdfDocument(strFilepath)
    '    End With

    '    strMyMessage = "" 'fctExportToPdfFormat(strFileNamePDF)
    '    Return strMyMessage
    'End Function

    'Private Function GetKolbsHeader(ByVal intCodeLang As Integer, ByVal strRecipeName As String, ByVal intPanelWidth As Integer, ByRef intYPos As Integer, Optional ByVal strPicturePath As String = "") As XRPanel
    '    Dim xrHeaderPanel As New XRPanel
    '    Dim cLang As New EgsData.clsEGSLanguage(intCodeLang)

    '    Dim intControlHeight As Integer = fctGetTextHeight(strRecipeName, intPanelWidth, fntHeading)
    '    Dim intControlHeight2 As Integer = fctGetTextHeight(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Preparation), intPanelWidth, fntHeading)


    '    xrHeaderPanel.Controls.AddRange(New XRLabel() {fctMakeXrLabel2(strRecipeName, fntHeading, Color.Black, Color.Transparent, 0, 0, intPanelWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter)})
    '    xrHeaderPanel.Width = intPanelWidth
    '    xrHeaderPanel.Dpi = 254.0!

    '    If strPicturePath <> "" Then
    '        Try
    '            Dim xrRecipePicture As New XRPictureBox
    '            xrRecipePicture.Dpi = 254.0!
    '            xrRecipePicture.Width = 375
    '            xrRecipePicture.Height = 500
    '            xrRecipePicture.ImageUrl = strPicturePath
    '            xrRecipePicture.Sizing = ImageSizeMode.StretchImage
    '            xrRecipePicture.Location = New System.Drawing.Point((intPanelWidth / 2) - 183, intControlHeight + 2)
    '            xrHeaderPanel.Controls.AddRange(New XRPictureBox() {xrRecipePicture})
    '            xrHeaderPanel.Controls.AddRange(New XRLabel() {fctMakeXrLabel2(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntHeading, Color.Black, Color.Transparent, 0, intControlHeight + 550, intPanelWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter)})
    '            xrHeaderPanel.Height = intControlHeight + 500 + intControlHeight2 + 50
    '            intYPos = intControlHeight + 500 + intControlHeight2 + 50 + 5
    '        Catch ex As Exception
    '            xrHeaderPanel.Controls.AddRange(New XRLabel() {fctMakeXrLabel2(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntHeading, Color.Black, Color.Transparent, 0, intControlHeight + 100, intPanelWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter)})
    '            xrHeaderPanel.Height = intControlHeight + 50 + intControlHeight2 + 50
    '            intYPos = intControlHeight + 50 + intControlHeight2 + 50 + 5
    '        End Try
    '    Else
    '        xrHeaderPanel.Controls.AddRange(New XRLabel() {fctMakeXrLabel2(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntHeading, Color.Black, Color.Transparent, 0, intControlHeight + 100, intPanelWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter)})
    '        xrHeaderPanel.Height = intControlHeight + 50 + intControlHeight2 + 50
    '        intYPos = intControlHeight + 50 + intControlHeight2 + 50 + 5
    '    End If

    '    Return xrHeaderPanel
    'End Function

    'Private Function GetRecipePanel(ByVal intPanelWidth As Integer, ByVal ds As DataSet, ByVal intCodeLang As Integer, ByVal strPicPath As String, ByRef intGlobalY As Integer, ByVal intRowIndex As Integer) As XRPanel
    '    Dim dtMain As DataTable = ds.Tables(3)
    '    Dim dtIngDetails As DataTable = ds.Tables(4)
    '    Dim dt2 As DataTable = ds.Tables(2)
    '    Dim dt3 As DataTable = ds.Tables(3)
    '    Dim dtRecipeDetail As DataTable = ds.Tables(1)

    '    Dim xrRecipePanel As New XRPanel
    '    Dim intYPos As Integer = 0
    '    intYPos = 0
    '    Dim TableWidth As Integer = intPanelWidth - 2
    '    Dim strImgPath As String = ""
    '    Dim intRecipeCode As Integer = dtMain.Rows(intRowIndex)("code")
    '    For Each dtrow As DataRow In dtRecipeDetail.Select("code=" & intRecipeCode)
    '        strImgPath = dtrow("pix").ToString.Replace(";", "").Trim
    '        Exit For
    '    Next
    '    If strImgPath <> "" Then strImgPath = strPicPath & strImgPath

    '    'intGlobalY = (intGlobalMultiplier - 500) * intRowIndex
    '    'If intGlobalY = (intGlobalMultiplier - 10) Then intGlobalY -= 900
    '    With xrRecipePanel
    '        .Dpi = 254.0!
    '        .Width = intPanelWidth
    '        .Location = New System.Drawing.Point(0, 0)
    '        '.Borders = DevExpress.XtraPrinting.BorderSide.All
    '        Dim xrTableAll As New XRTable
    '        Dim xrTableHeader As New XRTableRow
    '        Dim xrTableIngredients As New XRTableRow
    '        Dim xrTablePrep As New XRTableRow

    '        Dim xrTableHeaderCell As New XRTableCell
    '        Dim xrTableIngredientsCell As New XRTableCell
    '        Dim xrTablePrepCell As New XRTableCell

    '        'strImgPath = 

    '        xrTableHeaderCell.Controls.Add(GetKolbsHeader(intCodeLang, dtMain.Rows(intRowIndex)("name"), TableWidth, intYPos, strImgPath))
    '        xrTableIngredientsCell.Controls.Add(GetIngredientsPanel(intCodeLang, dtIngDetails, dtRecipeDetail, TableWidth, intYPos, intRecipeCode))
    '        xrTablePrepCell.Controls.Add(GetPreparationPanel(intCodeLang, dtRecipeDetail, TableWidth, intRecipeCode, intYPos))

    '        xrTableHeader.Cells.Add(xrTableHeaderCell)
    '        xrTableIngredients.Cells.Add(xrTableIngredientsCell)
    '        xrTablePrep.Cells.Add(xrTablePrepCell)

    '        xrTableAll.Dpi = 254.0!

    '        Dim e As Integer = xrTableAll.Height
    '        Dim s As Integer = xrTableHeader.Height
    '        Dim w As Integer = xrTableIngredients.Height
    '        Dim r As Integer = xrTablePrep.Height

    '        xrTableAll.Width = TableWidth
    '        xrTableAll.Rows.Add(xrTableHeader)
    '        xrTableAll.Rows.Add(xrTableIngredients)
    '        xrTableAll.Rows.Add(xrTablePrep)
    '        '.Controls.AddRange(New XRPanel() {GetKolbsHeader(intCodeLang, dtMain(intRowIndex)("name"), TableWidth, intYPos, strImgPath)})
    '        '.Controls.AddRange(New XRPanel() {GetIngredientsPanel(intCodeLang, dtDetails, TableWidth, intYPos, intRecipeCode)})
    '        'Dim intYPos1 As Integer
    '        ''intypos1 = 
    '        '.Controls.AddRange(New XRPanel() {GetPreparationPanel(intCodeLang, dtDetails, TableWidth, intRecipeCode, intYPos)})

    '        Dim intYPosTemp As Integer = intYPos * 0.8
    '        For ctr As Integer = 1 To 10
    '            If intYPosTemp < ctr * intGlobalMultiplier Then
    '                .Height = ctr * intGlobalMultiplier - intYPos - 300
    '                Exit For
    '            End If
    '        Next
    '        .Controls.Add(xrTableAll)
    '    End With


    '    Return xrRecipePanel
    'End Function

    'Private Function GetIngredientsPanel(ByVal intCodeLang As Integer, ByVal dtDetails As DataTable, ByVal dtRecipeDetails As DataTable, ByVal intTableWidth As Integer, ByRef intYPos As Integer, ByVal intRecipecode As Integer) As XRPanel
    '    Dim xrIngredientsPanel As New XRPanel
    '    Dim xrIngredientsTable As New XRTable
    '    Dim cLang As New EgsData.clsEGSLanguage(intCodeLang)
    '    Dim intHeading As Integer = 0
    '    Dim arrTableHeight As New ArrayList
    '    Dim blnShowSteps As Boolean = False
    '    Dim blnShowProcedure As Boolean = True
    '    Dim blnItalic As Boolean = False

    '    Dim strQty, strUnit, strIngredientName, strProcedure As String
    '    Dim intItemCode As Integer

    '    With xrIngredientsPanel
    '        .Width = intTableWidth - 2
    '        .Dpi = 254.0!
    '        .Location = New System.Drawing.Point(0, 0)
    '    End With
    '    Dim ctr As Integer = 0
    '    For Each dtStepRow As DataRow In dtDetails.Select("itemtype=75 AND codemain=" & intRecipecode)
    '        ctr += 1
    '    Next
    '    If ctr > 0 Then
    '        blnShowSteps = True
    '    End If

    '    Dim arrStepName(ctr - 1)() As String

    '    ctr = 0
    '    For Each dtStepRow As DataRow In dtDetails.Select("itemtype=75 AND codemain=" & intRecipecode)
    '        arrStepName(CInt(dtStepRow("step")) - 1) = New String() {dtStepRow("itemname"), dtStepRow("step"), 0}
    '    Next

    '    For Each dtProcRow As DataRow In dtRecipeDetails.Rows
    '        If dtProcRow("preparation") <> "" Then
    '            blnShowProcedure = True
    '            Exit For
    '        End If
    '    Next

    '    With xrIngredientsTable
    '        .Borders = DevExpress.XtraPrinting.BorderSide.All
    '        .BorderWidth = 1
    '        .Dpi = 254.0!
    '        '125 + 254 + 500 'intTableWidth - 4
    '        If blnShowSteps Then
    '            .Width = intGlobalX - 10 - 125
    '            .Location = New System.Drawing.Point(124, 0)
    '        Else
    '            .Width = intGlobalX - 10
    '            .Location = New System.Drawing.Point(0, 0)
    '        End If



    '        ctr = 1
    '        If blnShowSteps Then
    '            For Each strStep() As String In arrStepName
    '                Dim intTableHeight As Integer = 0
    '                For Each dtRow As DataRow In dtDetails.Select("codemain=" & intRecipecode & "AND step=" & strStep(1) & " AND itemcode<>75")
    '                    If intHeading = 0 Then
    '                        intHeading += 1
    '                        If blnShowProcedure Then
    '                            .Rows.AddRange(New XRTableRow() {GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, cLang.GetString(clsEGSLanguage.CodeType.Procedure), blnShowProcedure, blnShowSteps)})
    '                            intYPos += GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, cLang.GetString(clsEGSLanguage.CodeType.Procedure), blnShowProcedure, blnShowSteps).Height
    '                        Else
    '                            .Rows.AddRange(New XRTableRow() {GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, , blnShowProcedure, blnShowSteps)})
    '                            intYPos += GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, blnShowProcedure, , blnShowSteps).Height
    '                        End If

    '                    Else

    '                    End If
    '                    'If dtRow("itemCode").ToString <> "75" Then
    '                    intItemCode = dtRow("itemCode").ToString
    '                    strQty = ""
    '                    strUnit = ""
    '                    strIngredientName = ""
    '                    strProcedure = ""
    '                    blnItalic = False
    '                    For Each dtRow2 As DataRow In dtRecipeDetails.Select("itemcode=" & intItemCode)
    '                        strQty = dtRow2("quantity").ToString
    '                        strUnit = dtRow2("itemunit").ToString
    '                        strIngredientName = dtRow2("ingredient").ToString
    '                        strProcedure = dtRow2("preparation").ToString
    '                        Exit For
    '                    Next
    '                    If dtRow("itemType").ToString = "4" Then
    '                        strQty = ""
    '                        strUnit = ""
    '                    Else
    '                        Format(Val(strQty), dtRow("itemFormat").ToString)
    '                    End If
    '                    If dtRow("itemType").ToString = "8" Then
    '                        blnItalic = True
    '                    End If
    '                    If strQty <> "" Or strUnit <> "" Or strIngredientName <> "" Then
    '                        .Rows.AddRange(New XRTableRow() {GetIngredientRow(strQty, strUnit, strIngredientName, fntBody, strProcedure, blnShowProcedure, blnShowSteps, blnItalic)})
    '                        intTableHeight += GetIngredientRow(strQty, strUnit, strIngredientName, fntBody, strProcedure, blnShowProcedure, blnShowSteps).Height
    '                        intYPos += GetIngredientRow(strQty, strUnit, strIngredientName, fntBody, strProcedure, blnShowProcedure, blnShowSteps).Height
    '                    End If
    '                    'End If

    '                Next
    '                strStep(2) = intTableHeight
    '                If ctr < arrStepName.Length Then
    '                    Dim xrSpacerRow As New XRTableRow
    '                    Dim xrSpacerCell As New XRTableCell
    '                    With xrSpacerRow
    '                        .Dpi = 254.0!
    '                        .Width = xrIngredientsTable.Width
    '                        .Height = 30
    '                        .Borders = DevExpress.XtraPrinting.BorderSide.Right
    '                        With xrSpacerCell
    '                            .Dpi = 254.0!
    '                            .Width = xrIngredientsTable.Width
    '                            .Height = 30
    '                            Dim xrSpacerLabel As New XRLabel
    '                            xrSpacerLabel = fctMakeXrLabel3("", fntBody, Color.Transparent, Color.Transparent, 0, 0, 125, 30)
    '                            xrSpacerLabel.Borders = DevExpress.XtraPrinting.BorderSide.None
    '                            .Controls.AddRange(New XRControl() {xrSpacerLabel})
    '                        End With
    '                        .Cells.AddRange(New XRTableCell() {xrSpacerCell})
    '                    End With
    '                    .Rows.AddRange(New XRTableRow() {xrSpacerRow})
    '                End If
    '                ctr += 1
    '            Next
    '        Else
    '            Dim intTableHeight As Integer = 0
    '            For Each dtRow As DataRow In dtDetails.Select("codemain=" & intRecipecode)
    '                If intHeading = 0 Then
    '                    intHeading += 1
    '                    If blnShowProcedure Then
    '                        .Rows.AddRange(New XRTableRow() {GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, cLang.GetString(clsEGSLanguage.CodeType.Procedure), blnShowProcedure, blnShowSteps)})
    '                        intYPos += GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, cLang.GetString(clsEGSLanguage.CodeType.Procedure), blnShowProcedure, blnShowSteps).Height
    '                    Else
    '                        .Rows.AddRange(New XRTableRow() {GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, , blnShowProcedure, blnShowSteps)})
    '                        intYPos += GetIngredientRow(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Quantity), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Unit), cLang.GetString(EgsData.clsEGSLanguage.CodeType.Ingredients), fntBodyBold, , blnShowProcedure, blnShowSteps).Height
    '                    End If

    '                Else

    '                End If
    '                If dtRow("itemCode").ToString <> "75" Then
    '                    intItemCode = dtRow("itemCode").ToString
    '                    strQty = ""
    '                    strUnit = ""
    '                    strIngredientName = ""
    '                    strProcedure = ""
    '                    For Each dtRow2 As DataRow In dtRecipeDetails.Select("itemcode=" & intItemCode)
    '                        strQty = dtRow2("quantity").ToString
    '                        strUnit = dtRow2("itemunit").ToString
    '                        strIngredientName = dtRow2("ingredient").ToString
    '                        strProcedure = dtRow2("preparation").ToString
    '                        Exit For
    '                    Next
    '                    If dtRow("itemType").ToString = "4" Then
    '                        strQty = ""
    '                        strUnit = ""
    '                    Else
    '                        strQty = Format(Val(strQty), dtRow("itemFormat").ToString) 'strQty.Format(dtRow("itemFormat").ToString)
    '                    End If
    '                    If dtRow("itemType").ToString = "8" Then
    '                        blnItalic = True
    '                    End If
    '                    If strQty <> "" Or strUnit <> "" Or strIngredientName <> "" Then
    '                        .Rows.AddRange(New XRTableRow() {GetIngredientRow(strQty, strUnit, strIngredientName, fntBody, , blnShowProcedure, blnShowSteps, blnItalic)})
    '                        intTableHeight += GetIngredientRow(strQty, strUnit, strIngredientName, fntBody).Height
    '                        intYPos += GetIngredientRow(strQty, strUnit, strIngredientName, fntBody).Height
    '                    End If
    '                End If

    '            Next
    '        End If


    '        'arrTableHeight.Clear()
    '        'arrTableHeight.Add(intTableHeight)
    '        'xrStepLabel.Height = intTableHeight
    '        'xrStep.Height = intTableHeight
    '        'xrStepCell.Height = intTableHeight 
    '    End With



    '    Dim intX As Integer = 0
    '    Dim xrIngredientsStepTable As New XRTable
    '    If blnShowSteps Then

    '        With xrIngredientsStepTable
    '            .Dpi = 254.0!
    '            .Width = 125
    '            .Location = New System.Drawing.Point(0, 0)
    '            .Borders = DevExpress.XtraPrinting.BorderSide.All
    '            .BorderWidth = 1

    '            'If intHeading = 0 Then
    '            Dim xrStepHead As New XRTableRow
    '            With xrStepHead
    '                Dim xrStepHeadCell As New XRTableCell
    '                With xrStepHeadCell
    '                    .Dpi = 254.0!
    '                    .Width = 125
    '                    Dim intControlHeight As Double = MeasureText("Step", fntBodyBold, 125 / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '                    intControlHeight *= 2.7

    '                    .Controls.Add(fctMakeXrLabel2("Step", fntBodyBold, Color.Black, Color.Transparent, 0, 0, 125, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, True))
    '                End With
    '                .Cells.Add(xrStepHeadCell)

    '            End With

    '            .Rows.Add(xrStepHead)
    '            'End If
    '            ctr = 1
    '            For Each strStep() As String In arrStepName
    '                Dim xrStep As New XRTableRow
    '                With xrStep
    '                    Dim xrStepCell As New XRTableCell
    '                    With xrStepCell
    '                        .Dpi = 254.0!
    '                        .Width = 125
    '                        .Controls.Add(fctMakeXrLabel2(strStep(0), fntBody, Color.Black, Color.Transparent, 0, 0, 125, strStep(2), DevExpress.XtraPrinting.TextAlignment.MiddleCenter, True))
    '                    End With
    '                    .Cells.Add(xrStepCell)
    '                End With
    '                .Rows.Add(xrStep)
    '                If ctr < arrStepName.Length Then
    '                    Dim xrSpacerRow As New XRTableRow
    '                    Dim xrSpacerCell As New XRTableCell
    '                    With xrSpacerRow
    '                        .Dpi = 254.0!
    '                        .Width = intGlobalX - 10
    '                        .Height = 30
    '                        .Borders = DevExpress.XtraPrinting.BorderSide.Left
    '                        With xrSpacerCell
    '                            .Dpi = 254.0!
    '                            .Width = intGlobalX - 10
    '                            .Height = 30
    '                            .Controls.AddRange(New XRControl() {fctMakeXrLabel3("", fntBody, Color.Transparent, Color.Transparent, 0, 0, 125, 30)})
    '                        End With
    '                        .Cells.AddRange(New XRTableCell() {xrSpacerCell})
    '                    End With
    '                    .Rows.AddRange(New XRTableRow() {xrSpacerRow})
    '                End If
    '                ctr += 1
    '            Next

    '        End With
    '    End If


    '    'Dim xrProcedureTable As New XRTable
    '    'With xrProcedureTable
    '    '    .Dpi = 254.0!
    '    '    Dim intWidth As Integer = intGlobalX - (122 + 254 + 125 + 500) - 5
    '    '    .Width = intWidth
    '    '    .Location = New System.Drawing.Point((118 + 254 + 125 + 500), 0)
    '    '    .Borders = DevExpress.XtraPrinting.BorderSide.All
    '    '    .BorderWidth = 1

    '    '    'If intHeading = 0 Then
    '    '    Dim xrProcedureHead As New XRTableRow
    '    '    With xrProcedureHead
    '    '        Dim xrProcedureHeadCell As New XRTableCell
    '    '        With xrProcedureHeadCell
    '    '            .Width = intWidth
    '    '            Dim intControlHeight As Double = MeasureText(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Procedure), fntBodyBold, 254 / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    '            intControlHeight *= 2.7
    '    '            .Controls.Add(fctMakeXrLabel2(cLang.GetString(EgsData.clsEGSLanguage.CodeType.Procedure), fntBodyBold, Color.Black, Color.Transparent, 0, 0, intWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, True))
    '    '        End With
    '    '        .Cells.Add(xrProcedureHeadCell)
    '    '    End With

    '    '    .Rows.Add(xrProcedureHead)
    '    '    'End If

    '    '    Dim ctr As Integer = 0
    '    '    Dim xrProcedure As New XRTableRow
    '    '    With xrProcedure
    '    '        Dim xrProcedureCell As New XRTableCell
    '    '        With xrProcedureCell
    '    '            .Width = intGlobalX - (122 + 254 + 125 + 500)
    '    '            .Controls.Add(fctMakeXrLabel2("#", fntBody, Color.Black, Color.Transparent, 0, 0, intWidth, arrTableHeight(ctr), DevExpress.XtraPrinting.TextAlignment.TopCenter, True))
    '    '        End With
    '    '        .Cells.Add(xrProcedureCell)
    '    '    End With
    '    '    .Rows.Add(xrProcedure)
    '    'End With

    '    'Dim intTableHeight1 As Integer = 0
    '    'For Each intA As Integer In arrTableHeight
    '    '    intTableHeight1 += intA
    '    'Next

    '    intYPos += xrIngredientsTable.Height

    '    xrIngredientsPanel.Controls.Add(xrIngredientsTable)
    '    'xrIngredientsPanel.Controls.Add(xrProcedureTable)
    '    If blnShowSteps Then xrIngredientsPanel.Controls.Add(xrIngredientsStepTable)
    '    Return xrIngredientsPanel
    'End Function

    'Private Function GetPreparationPanel(ByVal intCodeLang As Integer, ByVal dtDetails As DataTable, ByVal intTableWidth As Integer, ByVal intRecipeCode As Integer, ByRef intYPos As Integer) As XRPanel
    '    Dim cLang As New EgsData.clsEGSLanguage(intCodeLang)
    '    Dim intControlHeight, intControlHeight1 As Integer
    '    Dim xrPrepPanel As New XRPanel
    '    Dim blnTemplate As Boolean = False


    '    With xrPrepPanel
    '        .Dpi = 254.0!
    '        .Width = intTableWidth
    '        .Location = New System.Drawing.Point(0, 50)
    '        '.Borders = DevExpress.XtraPrinting.BorderSide.All
    '        Dim strTitle() As String
    '        Dim strNotes() As String
    '        For Each dtRow As DataRow In dtDetails.Select("code=" & intRecipeCode)
    '            If Val(dtRow("templatecode").ToString) > 0 Then
    '                blnTemplate = True
    '                strTitle = dtRow("noteheader").ToString.Split("¤")
    '                strNotes = dtRow("note").ToString.Split("¤")
    '            End If
    '            Exit For
    '        Next
    '        If blnTemplate Then
    '            Dim intNewY As Integer = 0

    '            Dim ctr As Integer = 0
    '            For ctr = 0 To strTitle.Length - 1
    '                intControlHeight1 = MeasureText(strTitle(ctr), fntHeading, intTableWidth - 2, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '                .Controls.Add(fctMakeXrLabel2(strTitle(ctr), fntHeading, Color.Black, Color.Transparent, 0, intNewY, intTableWidth - 2, intControlHeight1, DevExpress.XtraPrinting.TextAlignment.TopCenter))
    '                intControlHeight = MeasureText(strNotes(ctr), fntBody, intTableWidth - 2, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '                .Controls.Add(fctMakeXrLabel2(strNotes(ctr), fntBody, Color.Black, Color.Transparent, 0, intControlHeight1 + intNewY, intTableWidth - 2, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, True, True))
    '                intNewY += intControlHeight + intControlHeight1 + 20
    '            Next
    '            intYPos += intNewY
    '        Else
    '            Dim strTitleHead As String = vbLf & cLang.GetString(EgsData.clsEGSLanguage.CodeType.Preparation)
    '            intControlHeight1 = MeasureText(strTitleHead, fntHeading, intTableWidth - 2, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '            .Controls.Add(fctMakeXrLabel2(strTitleHead, fntHeading, Color.Black, Color.Transparent, 0, 0, intTableWidth - 2, intControlHeight1, DevExpress.XtraPrinting.TextAlignment.TopCenter))
    '            For Each dtRow As DataRow In dtDetails.Select("code=" & intRecipeCode)
    '                Dim strNote As String = dtRow("note").ToString
    '                intControlHeight = MeasureText(strNote, fntBody, intTableWidth - 2, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '                .Controls.Add(fctMakeXrLabel2(strNote, fntBody, Color.Black, Color.Transparent, 0, intControlHeight1, intTableWidth - 2, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, True, True))
    '                Exit For
    '            Next
    '            intYPos += (intControlHeight + intControlHeight1)
    '        End If

    '    End With

    '    Return xrPrepPanel
    'End Function

    'Private Function GetIngredientRow(ByVal strQuantity As String, ByVal strUnit As String, ByVal strIngredientName As String, ByVal fntFont As Font, Optional ByVal strProcedure As String = "", Optional ByVal bShowProcedure As Boolean = False, Optional ByVal bShowStep As Boolean = False, Optional ByVal bItalic As Boolean = False) As XRTableRow
    '    Dim xrIngRow As New XRTableRow
    '    Dim intControlHeight As Integer
    '    Dim intProcedureWidth As Integer
    '    'bShowProcedure = False

    '    Dim intIngredientsCellWidth As Integer

    '    If bShowProcedure Then
    '        intIngredientsCellWidth = 500
    '        If bShowStep Then
    '            intProcedureWidth = intGlobalX - 500 - 254 - 125 - 125
    '        Else
    '            intProcedureWidth = intGlobalX - 500 - 254 - 125
    '        End If
    '    ElseIf bShowStep Then
    '        intIngredientsCellWidth = intGlobalX - 125 - 254 - 125
    '    Else
    '        intIngredientsCellWidth = intGlobalX - 125 - 254
    '    End If

    '    If intControlHeight = 60 Then intControlHeight += 5
    '    intControlHeight = MeasureText(strQuantity, fntFont, 254 / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    If MeasureText(strUnit, fntFont, 125 / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height > intControlHeight Then intControlHeight = MeasureText(strUnit, fntFont, 125 / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    If MeasureText(strIngredientName, fntFont, intIngredientsCellWidth / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height > intControlHeight Then intControlHeight = MeasureText(strIngredientName, fntFont, intIngredientsCellWidth / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    If MeasureText(strProcedure, fntFont, intProcedureWidth / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height > intControlHeight Then intControlHeight = MeasureText(strProcedure, fntFont, intProcedureWidth / 2.7, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    intControlHeight *= 2.7
    '    'intControlHeight = MeasureText(strQuantity, fntFont, 254, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    'If MeasureText(strUnit, fntFont, 125, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height > intControlHeight Then intControlHeight = MeasureText(strUnit, fntFont, 125, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height
    '    'If MeasureText(strIngredientName, fntFont, 500, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height > intControlHeight Then intControlHeight = MeasureText(strIngredientName, fntFont, 500, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height

    '    With xrIngRow
    '        .Dpi = 254.0!
    '        '.Borders = DevExpress.XtraPrinting.BorderSide.None
    '        Dim xrQuantityCell As New XRTableCell
    '        With xrQuantityCell
    '            .Width = 254
    '            '.Height = intControlHeight
    '            .Controls.Add(fctMakeXrLabel2(strQuantity, fntFont, Color.Black, Color.Transparent, 0, 0, 254, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, False, True, True))
    '        End With
    '        .Cells.Add(xrQuantityCell)
    '        Dim xrUnitCell As New XRTableCell
    '        With xrUnitCell
    '            .Width = 125
    '            '.Height = intControlHeight
    '            .Controls.Add(fctMakeXrLabel2(strUnit, fntFont, Color.Black, Color.Transparent, 0, 0, 125, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, False, True, True))
    '        End With
    '        .Cells.Add(xrUnitCell)
    '        Dim xrIngredientCell As New XRTableCell
    '        With xrIngredientCell
    '            .Width = intIngredientsCellWidth
    '            '.Height = intControlHeight
    '            If bItalic Then
    '                .Controls.Add(fctMakeXrLabel2(strIngredientName, fntBodyItalic, Color.Black, Color.Transparent, 0, 0, intIngredientsCellWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, False, True, True))
    '            Else
    '                .Controls.Add(fctMakeXrLabel2(strIngredientName, fntFont, Color.Black, Color.Transparent, 0, 0, intIngredientsCellWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, False, True, True))
    '            End If

    '        End With
    '        'If xrIngredientCell.Height > xrUnitCell.Height And xrIngredientCell.Height > xrQuantityCell.Height Then
    '        '    xrUnitCell.Height = xrIngredientCell.Height
    '        '    xrQuantityCell.Height = xrIngredientCell.Height
    '        'End If
    '        .Cells.Add(xrIngredientCell)
    '        If bShowProcedure Then
    '            Dim xrProcedureCell As New XRTableCell
    '            With xrProcedureCell
    '                .Width = intProcedureWidth
    '                '.Height = intControlHeight
    '                .Controls.Add(fctMakeXrLabel2(strProcedure, fntFont, Color.Black, Color.Transparent, 0, 0, intProcedureWidth, intControlHeight, DevExpress.XtraPrinting.TextAlignment.TopCenter, False, True, True))
    '            End With
    '            'If xrIngredientCell.Height > xrUnitCell.Height And xrIngredientCell.Height > xrQuantityCell.Height Then
    '            '    xrUnitCell.Height = xrIngredientCell.Height
    '            '    xrQuantityCell.Height = xrIngredientCell.Height
    '            'End If
    '            .Cells.Add(xrProcedureCell)
    '        End If
    '        .Height = intControlHeight
    '    End With

    '    Return xrIngRow
    'End Function

    'Public Function fctGetTextHeight(ByVal strX As String, ByVal dblTextInitialWidth As Double, ByVal fntText As Font) As Double
    '    Dim dblTextHeight As Double
    '    dblTextHeight = MeasureText(strX.ToString, fntText, dblTextInitialWidth, System.Drawing.StringFormat.GenericDefault, Me.Padding).Height()
    '    Dim arrStrX() As String
    '    arrStrX = Split(strX, vbLf)
    '    dblTextHeight = dblTextHeight * (arrStrX.Length + 1)
    '    Return dblTextHeight
    'End Function
#End Region

#Region " Display Functions "

    Sub subDisplayStandardCalculation(ByVal intForWhatYield As Integer, ByVal dblTaxValue As Double, ByVal dblCoeff As Double,
    ByVal dblMerchandiseCost As Double, ByVal dblImposedPrice As Double, ByVal dblYieldQty As Double, ByVal strYieldName As String, ByVal strPriceFormat As String, Optional ByVal dblFoodCost As Double = 0.00, Optional ByVal userLocale As String = "en-US")

        Dim lngY As Long
        Dim strPerX As String
        Dim strCSV As String
        Dim dblPriceTax As Double
        Dim dblImposedPriceTax As Double
        Dim dblImposedPriceNoTax As Double
        Dim dblImposedCoeff As Double
        Dim lngColWidth As Long
        Dim intNumberOfRows As Integer
        Dim i As Integer
        Dim ontCol As Integer
        Dim intCol As Integer
        Dim strX As String
        Dim intWidth As Integer
        Dim clang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim userCulture As CultureInfo = New CultureInfo(userLocale)

        If G_Options.QtyType = 0 Then
            Select Case intForWhatYield
                'Case 1 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & fctFormatNumericQuantity(dblYieldQty, G_FormatOneDecimal, G_Options.RemoveTrailingZero) & " " & Trim(strYieldName) 'per  
                Case 1 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & dblYieldQty.ToString(G_FormatOneDecimal, userCulture) & " " & Trim(strYieldName) 'per  
                Case 2 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & strYieldName          'per yieldunit 
                Case 3 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & strYieldName          'per subrecipe unit 
            End Select
        Else
            Select Case intForWhatYield
                Case 1 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & fctConvertToFraction(dblYieldQty) & " " & Trim(strYieldName)
                Case 2 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & strYieldName          'per yieldunit   
                Case 3 : strPerX = clang.GetString(clsEGSLanguage.CodeType.per_) & " " & strYieldName          'per subrecipe unit  
            End Select
        End If

        Select Case intForWhatYield
            Case 1
                intCol = 4
                intWidth = L_lngCol(2)
            Case 2
                intCol = 3
                intWidth = L_lngCol(1)
            Case 3 : intCol = 2
                intWidth = L_lngCol(3)
        End Select

        With Me


            lngColWidth = 0

            intNumberOfRows = 4
            If dblTaxValue <> 0 Then intNumberOfRows = 8

            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strPerX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
            intNewY += intTextHeight

            '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Format(dblMerchandiseCost, strPriceFormat), fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(dblMerchandiseCost.ToString(strPriceFormat, userCulture), fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
            intNewY += intTextHeight

            If Not G_ReportOptions.bFoodcostOnly Then

                'strX = Format(dblMerchandiseCost, strPriceFormat)
                If dblCoeff = 0 Then
                    dblCoeff = 1
                End If
                Dim SellingPrice As Double = dblMerchandiseCost / (dblFoodCost / 100.0) 'dblMerchandiseCost * dblCoeff 'SM for CMC
                'Dim SellingPrice As Double = dblMerchandiseCost * dblCoeff 'SM for CMC
                'strX = Format(SellingPrice, strPriceFormat)
                strX = SellingPrice.ToString(strPriceFormat, userCulture)
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                intNewY += intTextHeight

                If dblTaxValue <> 0 Then
                    ' RDC 09.11.2013
                    'dblPriceTax = (dblMerchandiseCost * dblCoeff * (dblTaxValue / 100) / dblYieldQty)
                    dblPriceTax = (dblTaxValue / 100) * SellingPrice
                    Dim formattedPriceTax As String = dblPriceTax.ToString(strPriceFormat, userCulture)

                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Format(dblPriceTax, strPriceFormat), fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(formattedPriceTax, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight

                    Dim formattedTotal As String = (SellingPrice + dblPriceTax).ToString(strPriceFormat, userCulture)
                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Format(SellingPrice + dblPriceTax, strPriceFormat), fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(formattedTotal, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight

                    dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                    dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                    If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                        dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                    Else
                        dblImposedCoeff = 0
                    End If

                    ' RDC 09.11.2013
                    ' strX = Format(dblImposedPriceNoTax / dblYieldQty, strPriceFormat)
                    'strX = Format(dblImposedPriceNoTax, strPriceFormat)
                    strX = dblImposedPriceNoTax.ToString(strPriceFormat, userCulture)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight

                    'strX = Format(dblImposedPriceTax / dblYieldQty, strPriceFormat)
                    'strX = Format(dblImposedPriceTax, strPriceFormat)
                    strX = dblImposedPriceTax.ToString(strPriceFormat, userCulture)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight

                    ' strX = Format(dblImposedPrice / dblYieldQty, strPriceFormat)
                    'strX = Format(dblImposedPrice, strPriceFormat)
                    strX = dblImposedPrice.ToString(strPriceFormat, userCulture)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight

                Else
                    dblImposedPriceTax = (dblImposedPrice / (100 + dblTaxValue)) * dblTaxValue
                    dblImposedPriceNoTax = dblImposedPrice - dblImposedPriceTax

                    If dblMerchandiseCost <> 0 And dblYieldQty <> 0 Then
                        dblImposedCoeff = dblImposedPriceNoTax / (dblMerchandiseCost)
                    Else
                        dblImposedCoeff = 0
                    End If

                    '  strX = Format(dblImposedPriceNoTax, G_strPriceFormat)
                    'strX = Format(dblImposedPrice, strPriceFormat)
                    strX = dblImposedPrice.ToString(strPriceFormat, userCulture)
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth - INTCOLUMNSPACE, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleRight)})  'per yieldunit
                    intNewY += intTextHeight
                End If
            End If


        End With
    End Sub

    '// DRR 03.09.2012
    Function fctSetVisibleNutrients(ByVal intCodeListe As Integer, Optional intCodeNutrientSet As Integer = 0, Optional strNutrientSetDesc As String = "") As DataTable

        Dim cmd As New SqlCommand
        Dim da As SqlDataAdapter
        Dim dtList As New DataTable
        Dim MySQLConn1 As SqlConnection = New SqlConnection(G_strConnection)

        Dim strSQL As String = ""

        If strNutrientSetDesc.Trim.Length = 0 Then

            strSQL = "SELECT N1Display,N2Display,N3Display,N4Display,N5Display,N6Display,N7Display,N8Display,N9Display, " & vbCrLf
            strSQL += "N10Display, N11Display, N12Display, N13Display, N14Display, N15Display, N16Display, N17Display, N18Display, " & vbCrLf
            strSQL += "N19Display, N20Display, N21Display, N22Display, N23Display, N24Display, N25Display, N26Display, N27Display, " & vbCrLf
            strSQL += "N28Display, N29Display, N30Display, N31Display, N32Display, N33Display, N34Display, DisplayNutrition " & vbCrLf
            strSQL += "FROM EgswNutrientVal " & vbCrLf
            strSQL += "WHERE Codeliste = @CodeListe and CodeSet = @CodeSet "

            With cmd
                .Connection = MySQLConn1
                .CommandType = CommandType.Text
                .CommandText = strSQL

                .Parameters.Clear()
                .Parameters.Add("@CodeListe", SqlDbType.Int).Value = intCodeListe
                .Parameters.Add("@CodeSet", SqlDbType.Int).Value = intCodeNutrientSet

            End With

        Else
            ' RDC 07.09.2013 - Added option if Nutrient set name is given instead of codeset
            strSQL = "SELECT a.N1Display, a.N2Display, a.N3Display, a.N4Display, a.N5Display, a.N6Display, a.N7Display, a.N8Display, a.N9Display, " & vbCrLf &
                            "a.N10Display, a.N11Display, a.N12Display, a.N13Display, a.N14Display, a.N15Display, a.N16Display, a.N17Display, a.N18Display, " & vbCrLf &
                            "a.N19Display, a.N20Display, a.N21Display, a.N22Display, a.N23Display, a.N24Display, a.N25Display, a.N26Display, a.N27Display, " & vbCrLf &
                            "a.N28Display, a.N29Display, a.N30Display, a.N31Display, a.N32Display, a.N33Display, a.N34Display, a.DisplayNutrition " & vbCrLf &
                     "FROM		   EgswNutrientVal As a " & vbCrLf &
                     "INNER JOIN EgswNutrientSet As b On a.CodeSet = b.Code And b.Name = @CodeSetName And a.Codeliste = @CodeListe "

            With cmd
                .Connection = MySQLConn1
                .CommandType = CommandType.Text
                .CommandText = strSQL

                .Parameters.Clear()
                .Parameters.Add("@CodeListe", SqlDbType.Int).Value = intCodeListe
                .Parameters.Add("@CodeSetName", SqlDbType.VarChar).Value = strNutrientSetDesc
            End With
        End If

        da = New SqlDataAdapter(cmd)

        With da
            dtList.BeginLoadData()
            .Fill(dtList)
            dtList.EndLoadData()
        End With

        Return dtList
    End Function

    Function GetImpoesedNutrientType(intCodeListe As Integer, intCodeLang As Integer) As String
        Dim cmd As New SqlCommand
        Dim da As SqlDataAdapter
        Dim dtList As New DataTable
        Dim MySQLConn1 As SqlConnection = New SqlConnection(G_strConnection)


        With cmd
            .Connection = MySQLConn1
            .CommandType = CommandType.StoredProcedure
            .CommandText = "GET_ImposedNutrientType"

            .Parameters.Clear()
            .Parameters.Add("@CodeListe", SqlDbType.Int).Value = intCodeListe
            .Parameters.Add("@CodeTrans", SqlDbType.Int).Value = intCodeLang
        End With

        da = New SqlDataAdapter(cmd)
        With da
            dtList.BeginLoadData()
            .Fill(dtList)
            dtList.EndLoadData()
        End With
        Dim strReturn As String = ""
        If IsNothing(dtList) = False Then
            If dtList.Rows.Count > 0 Then
                strReturn = dtList.Rows(0)("INType").ToString()
            End If
        End If
        Return strReturn
    End Function


    Sub subDisplayNutrients(ByVal strYieldUnit As String, ByVal dblNutrientFactor As Double, ByVal dblNutrient As Object, ByVal strStyle As String, Optional ByVal intCodeListe As Integer = -1, Optional intCodeSet As Integer = 0, Optional ByVal userLocale As String = "en-US")

        Dim lngspace As Long
        Dim i As Integer
        Dim strNA As String
        Dim intCount As Integer
        Dim Nutrient(0 To 34) As tNutrient '15
        Dim intCurrY As Integer
        Dim intTotalValue As Double
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim intWidth As Integer
        Dim dt As New DataTable ' DRR
        Dim IsNutrientVisibled As Boolean ' DRR

        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  'N/A

        Dim userCulture As CultureInfo = New CultureInfo(userLocale)

        intCount = 0
        For i = 1 To 34 ' 15
            Nutrient(i).Format = G_Nutrient(i).Format
            Nutrient(i).Heading = G_Nutrient(i).Heading
            Nutrient(i).Name = G_Nutrient(i).Name
            Nutrient(i).Unit = G_Nutrient(i).Unit
            Nutrient(i).Value = L_Nutrient(i).Value
            Nutrient(i).GDA = L_Nutrient(i).GDA 'DLS Aug112007
            Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
            If Trim(Nutrient(i).Name) <> "" Then intCount = intCount + 1
            '--JBB 03.26.2012
            If L_Nutrient(i).Value = 0 Then
                intTotalValue += 1
            Else
                intTotalValue += IIf(L_Nutrient(i).Value = -1, 0, L_Nutrient(i).Value)

            End If
            '--
            'intTotalValue += IIf(L_Nutrient(i).Value = -1, 0, L_Nutrient(i).Value)
            '--
            Nutrient(i).FormatKCAL = G_Nutrient(i).FormatKCAL  'DLS Aug172007
        Next

        '// DRR 03.09.2012
        Dim dctVisibleNutrient As New Dictionary(Of String, Boolean)
        Dim intCols As Integer = 0
        If Not intCodeListe = -1 Then
            dt = Me.fctSetVisibleNutrients(intCodeListe, intCodeSet)
            If Not dt.Rows.Count = Nothing Then
                intCols = dt.Columns.Count - 1
                'If CBoolDB(dt.Rows(0).Item("DisplayNutrition")) = False Then '-- JBB 03.16.2012
                '    For indx As Integer = 1 To intCols
                '        dctVisibleNutrient.Add("N" & indx & "Display", False)
                '    Next
                'Else
                '    For indx As Integer = 1 To intCols
                '        dctVisibleNutrient.Add("N" & indx & "Display", CBoolDB(dt.Rows(0).Item("N" & indx & "Display")))
                '    Next
                'End If
                'FOR CMC ALWAYS DISPLAY NUTRIENT INFO
                For indx As Integer = 1 To intCols
                    dctVisibleNutrient.Add("N" & indx & "Display", CBoolDB(dt.Rows(0).Item("N" & indx & "Display")))
                Next
            End If
        End If
        '//

        If dt.Rows.Count = 0 Then
            Exit Sub
        Else
            If CBoolDB(dt.Rows(0).Item("DisplayNutrition")) = False Then Exit Sub
        End If

        With Me
            intNewX = 0
            intNewY += 10

            sf = New StringFormat(StringFormatFlags.NoClip)
            strX = cLang.GetString(clsEGSLanguage.CodeType.NutrientSummary) 'JBB 03.14.2012 -- cLang.GetString(clsEGSLanguage.CodeType.Nutrients)       'Nutrients
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            Select Case strStyle
                Case "002"  'For Modern
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                Case Else  'For Standard/Two Columns
                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                    Dim xrNutrientTable As New XRTable
                    Dim xrNutrientRow As New XRTableRow
                    Dim xrNutrientCell As New XRTableCell

                    xrNutrientTable.Width = intAvailableWidth
                    xrNutrientTable.Location = New Point(intNewX, intNewY)

                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrNutrientTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrNutrientTable.BorderWidth = 1
                        xrNutrientTable.BackColor = Color.LightGray
                        xrNutrientTable.BorderColor = Color.Black
                    Else
                        xrNutrientTable.Borders = DevExpress.XtraPrinting.BorderSide.None
                        xrNutrientTable.BorderWidth = 0
                        xrNutrientTable.BackColor = Color.White
                        xrNutrientTable.BorderColor = Color.White
                    End If

                    xrNutrientRow.Height = G_ReportOptions.sgFontSize2
                    xrNutrientCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    xrNutrientCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    xrNutrientCell.Text = strX.Trim
                    xrNutrientRow.Cells.Add(xrNutrientCell)
                    xrNutrientTable.Rows.Add(xrNutrientRow)

                    .Detail.Controls.Add(xrNutrientTable)

                    intNewY += (xrNutrientTable.Height + 10)
            End Select
            'intNewY += GetLineSpace(intTextHeight) + 10

            If intTotalValue > 0 Then
                lngspace = 0
                lngspace = fctGetWidest(Nutrient(1).Name & " " & Nutrient(1).Unit & "/kcal", intTextHeight, lngspace, fntRegular)

                For i = 2 To 12
                    lngspace = fctGetWidest(Nutrient(i).Name & " " & Nutrient(i).Unit, intTextHeight, lngspace, fntRegular)
                Next

                ' lngspace *= 1.5
                intNewX += lngspace

                intWidth = Math.Abs(intAvailableWidth - lngspace) / 2
                sf = New StringFormat(StringFormatFlags.NoClip)
                '-- JBB 03.14.2012
                'strX = fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                '--
                strX = GetImpoesedNutrientType(intCodeListe, G_ReportOptions.intPageLanguage)
                If strX = "" Then
                    strX = strYieldUnit 'fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                End If
                '-- end
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                intNewX += intWidth
                'intNewX += Math.Abs(intAvailableWidth - lngspace) / 2

                strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)      'per 100g or 100ml at 100%
                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                '// DRR 06.22.2011
                If G_CLIENT = "USA" Then
                    'display nothing
                Else
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                End If
                intNewY += GetLineSpace(intTextHeight)
                'sf = New StringFormat(StringFormatFlags.DirectionVertical)

                intCurrY = intNewY
                For i = 1 To intCount
                    'intNewX = 0 DRR commented

                    '// DRR 03.09.2012
                    IsNutrientVisibled = False
                    If dctVisibleNutrient.ContainsKey("N" & i & "Display") Then
                        IsNutrientVisibled = dctVisibleNutrient.Item("N" & i & "Display")
                    End If

                    '--JBB 03.16.2012
                    If Nutrient(i).Value = -1.0 Then
                        IsNutrientVisibled = False
                    End If
                    '--

                    If IsNutrientVisibled Then intNewX = 0
                    '//

                    If Trim(Nutrient(i).Name) <> "" And IsNutrientVisibled Then
                        If i = 1 Then
                            strX = Nutrient(i).Name ''''& " " & Nutrient(i).Unit
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                            intNewY += GetLineSpace(intTextHeight)

                            strX = Nutrient(i).Name ''''& " kcal"
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                        Else
                            strX = Nutrient(i).Name '''& " " & Nutrient(i).Unit
                            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        End If

                        intNewX += lngspace
                        If Nutrient(i).Value <> -1 Then
                            If i = 1 Then
                                intNewY = intCurrY
                                'strX = Format(Nutrient(i).Value, Nutrient(i).Format)
                                'strX = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                strX = Nutrient(i).Value.ToString(Nutrient(i).Format, userCulture)
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewY += GetLineSpace(intTextHeight)

                                'Nutrient(i).Value = Format(Nutrient(i).Value, Nutrient(i).Format)
                                Nutrient(i).Value = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                'strX = Format(Nutrient(i).Value / ENERGYFACTOR, Nutrient(i).FormatKCAL)
                                'strX = fctFormatNumericQuantity(Nutrient(i).Value / ENERGYFACTOR, Nutrient(i).FormatKCAL, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                strX = (Nutrient(i).Value / ENERGYFACTOR).ToString(Nutrient(i).FormatKCAL, userCulture)
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " kcal", fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                intNewX += intWidth

                                If dblNutrientFactor > 0 Then
                                    intNewY = intCurrY
                                    'strX = Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format)
                                    'strX = fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    strX = (Nutrient(i).Value / dblNutrientFactor).ToString(Nutrient(i).Format, userCulture)
                                    '// DRR 06.22.2011
                                    If G_CLIENT = "USA" Then
                                        'display nothing
                                    Else
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    End If
                                    intNewY += GetLineSpace(intTextHeight)

                                    'strX = Format((Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format) / ENERGYFACTOR), Nutrient(i).FormatKCAL)
                                    strX = fctFormatNumericQuantity((fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros)) / ENERGYFACTOR, Nutrient(i).FormatKCAL, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                    '// DRR 06.22.2011
                                    If G_CLIENT = "USA" Then
                                        'display nothing
                                    Else
                                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    End If
                                Else
                                    intNewY = intCurrY
                                    strX = strNA        'N/A
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += GetLineSpace(intTextHeight)

                                    strX = strNA        'N/A
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                End If

                            Else
                                'strX = Format(Nutrient(i).Value, Nutrient(i).Format)
                                strX = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                intNewX += intWidth

                                If dblNutrientFactor > 0 Then
                                    'strX = Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format)
                                    strX = fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                                Else
                                    strX = strNA
                                End If
                                '// DRR 06.22.2011
                                If G_CLIENT = "USA" Then
                                    'display nothing
                                Else
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                End If
                            End If

                        End If
                    End If

                    'intNewY += GetLineSpace(intTextHeight) DRR commented
                    If IsNutrientVisibled Then intNewY += GetLineSpace(intTextHeight) ' DRR
                Next
            End If
        End With

    End Sub

    Sub subDisplayNutrientsRecipedia(ByVal strYieldUnit As String, ByVal dblNutrientFactor As Double, ByVal dblNutrient As Object, ByVal strStyle As String, Optional ByVal intCodeListe As Integer = -1, Optional intCodeSet As Integer = 0)

        Dim lngspace As Long
        Dim i As Integer
        Dim strNA As String
        Dim intCount As Integer
        Dim Nutrient(0 To 34) As tNutrient '15
        Dim intCurrY As Integer
        Dim dblTotalValue As Double
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim intWidth As Integer
        Dim dt As New DataTable ' DRR
        Dim IsNutrientVisibled As Boolean ' DRR

        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  'N/A

        intCount = 0
        For i = 1 To 34 ' 15
            Nutrient(i).Format = G_Nutrient(i).Format
            Nutrient(i).Heading = G_Nutrient(i).Heading
            Nutrient(i).Name = G_Nutrient(i).Name
            Nutrient(i).Unit = G_Nutrient(i).Unit
            Nutrient(i).Value = L_Nutrient(i).Value
            Nutrient(i).GDA = L_Nutrient(i).GDA 'DLS Aug112007
            Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
            Nutrient(i).DisplayPosition = G_Nutrient(i).DisplayPosition  ' -- JBB 07.02.2012
            If Trim(Nutrient(i).Name) <> "" Then intCount = intCount + 1
            '--JBB 03.26.2012
            If L_Nutrient(i).Value = 0 Then
                dblTotalValue += 1
            Else
                dblTotalValue += IIf(L_Nutrient(i).Value = -1, 0, L_Nutrient(i).Value)

            End If
            '--
            'intTotalValue += IIf(L_Nutrient(i).Value = -1, 0, L_Nutrient(i).Value)
            '--
            Nutrient(i).FormatKCAL = G_Nutrient(i).FormatKCAL  'DLS Aug172007
        Next

        '// DRR 03.09.2012
        Dim dctVisibleNutrient As New Dictionary(Of String, Boolean)
        Dim intCols As Integer = 0
        If Not intCodeListe = -1 Then
            dt = Me.fctSetVisibleNutrients(intCodeListe, intCodeSet)
            If Not dt.Rows.Count = Nothing Then
                intCols = dt.Columns.Count - 1
                If CBoolDB(dt.Rows(0).Item("DisplayNutrition")) = False Then '-- JBB 03.16.2012
                    For indx As Integer = 1 To intCols
                        dctVisibleNutrient.Add("N" & indx & "Display", False)
                    Next
                Else
                    For indx As Integer = 1 To intCols
                        dctVisibleNutrient.Add("N" & indx & "Display", CBoolDB(dt.Rows(0).Item("N" & indx & "Display")))
                    Next
                End If

            End If
        End If
        '//

        If dt.Rows.Count = 0 Then
            Exit Sub
        Else
            If CBoolDB(dt.Rows(0).Item("DisplayNutrition")) = False Then Exit Sub
        End If

        With Me
            intNewX = 0
            intNewY += 10

            sf = New StringFormat(StringFormatFlags.NoClip)
            'strX = "Nutritional Information" 'JBB 03.14.2012 -- cLang.GetString(clsEGSLanguage.CodeType.Nutrients)       'Nutrients
            'strX = GetImpoesedNutrientType(intCodeListe, G_ReportOptions.intPageLanguage)
            'If strX = "" Then
            '    strX = "Nutritional Information " + strYieldUnit 'fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
            'End If
            'intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            'Select Case strStyle
            '    Case "002"  'For Modern
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
            '    Case Else  'For Standard/Two Columns
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            'End Select
            'intNewY += GetLineSpace(intTextHeight) + 10
            If dblTotalValue > 0 Then
                'lngspace = 0
                'lngspace = fctGetWidest(Nutrient(1).Name & " " & Nutrient(1).Unit & "/kcal", intTextHeight, lngspace, fntRegular)

                'For i = 2 To 12
                '    lngspace = fctGetWidest(Nutrient(i).Name & " " & Nutrient(i).Unit, intTextHeight, lngspace, fntRegular)
                'Next

                ' lngspace *= 1.5
                'intNewX += lngspace

                'intWidth = Math.Abs(intAvailableWidth - lngspace) / 2
                sf = New StringFormat(StringFormatFlags.NoClip)
                '-- JBB 03.14.2012
                'strX = fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                '--
                'strX = GetImpoesedNutrientType(intCodeListe, G_ReportOptions.intPageLanguage)
                'If strX = "" Then
                '    strX = strYieldUnit 'fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                'End If
                '-- end
                'intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                'intNewX += intWidth
                'intNewX += Math.Abs(intAvailableWidth - lngspace) / 2

                'strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)      'per 100g or 100ml at 100%
                'intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                ''// DRR 06.22.2011
                'If G_CLIENT = "USA" Then
                '    'display nothing
                'Else
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                'End If
                'intNewY += GetLineSpace(intTextHeight)
                'sf = New StringFormat(StringFormatFlags.DirectionVertical)

                'intCurrY = intNewY
                ' RDC 02.25.2013
                sf = New StringFormat(StringFormatFlags.NoClip)
                If strYieldUnit = "" Then
                    strX = GetImpoesedNutrientType(intCodeListe, G_ReportOptions.intPageLanguage)
                Else
                    strX = strYieldUnit
                End If

                If strX = "" Then
                    strX = "Nutritional Information " + strYieldUnit 'fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                Else
                    strX = "Nutritional Information " + strX 'JBB 03.14.2012 -- cLang.GetString(clsEGSLanguage.CodeType.Nutrients)       'Nutrients
                End If

                With G_ReportOptions
                    Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(strX.Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                    Detail.Controls.Add(xrHeaderSectionTable)
                    intNewY += (xrHeaderSectionTable.Height + 10)
                End With

                ' RDC 05.14.2013 - Table reorg
                Dim xrNutTable As New XRTable
                Dim xrNutRow As New XRTableRow
                Dim xrNutCell As New XRTableCell

                'xrNutTable.Width = intAvailableWidth
                'xrNutTable.Location = New Point(intNewX, intNewY)

                ' RDC 05.21.2013 - Removed
                'If G_ReportOptions.blnIncludeHighlightSection Then
                '    xrNutTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                '    xrNutTable.BorderWidth = 1
                '    xrNutTable.BorderColor = Color.Black
                '    xrNutTable.BackColor = Color.LightGray
                'Else
                '    xrNutTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                '    xrNutTable.BorderWidth = 1
                '    xrNutTable.BorderColor = Color.Black
                '    xrNutTable.BackColor = Color.White
                'End If

                'xrNutRow.Height = G_ReportOptions.sgFontSize2
                'xrNutCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                'xrNutCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                'xrNutCell.Text = strX
                'xrNutRow.Cells.Add(xrNutCell)
                'xrNutTable.Rows.Add(xrNutRow)

                '.Detail.Controls.Add(xrNutTable)
                'intNewY += (xrNutTable.Height + 10)
                xrNutTable = New XRTable
                xrNutTable.Width = intAvailableWidth
                xrNutTable.Location = New Point(intNewX, intNewY)
                xrNutTable.BorderWidth = 0
                xrNutTable.Borders = DevExpress.XtraPrinting.BorderSide.None

                ' RDC 05.14.2013 - Removed Code
                'intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '' RDC 04.15.2013 - Added Line
                'intNewY += 10
                '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})
                'intNewY += GetLineSpace(intTextHeight)
                '' End
                G_intMaxRecipeDetailsWidth = 0  ' RDC 02.27.2013
                Dim strNutrintInformation As String = ""
                For intArrange As Integer = 1 To 34
                    For i = 1 To intCount
                        If Nutrient(i).DisplayPosition = intArrange Then
                            'intNewX = 0 DRR commented

                            '// DRR 03.09.2012
                            IsNutrientVisibled = False
                            If dctVisibleNutrient.ContainsKey("N" & i & "Display") Then
                                IsNutrientVisibled = dctVisibleNutrient.Item("N" & i & "Display")
                            End If

                            '--JBB 03.16.2012
                            If Nutrient(i).Value = -1.0 Then
                                IsNutrientVisibled = False
                            End If
                            '--

                            If IsNutrientVisibled Then intNewX = 0
                            If Trim(Nutrient(i).Name) <> "" And IsNutrientVisibled Then
                                strX = Nutrient(i).Name ''''& " " & Nutrient(i).Unit
                                If Nutrient(i).Value <> -1 Then
                                    ' RDC 02.26.2013 - Removed code 
                                    'If i = 1 Then
                                    'strX = Nutrient(i).Name & " " & fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros)
                                    'strX = strX & " " & Nutrient(i).Unit
                                    'Else
                                    ' End
                                    ' RDC 02.27.2013 - Nutrient display adjustment
                                    ' Sample : Nutrient label A  00.00g
                                    '          Nutrient label B  10.00%

                                    Dim strNutrientLabel As String = Nutrient(i).Name
                                    Dim strNutrientValue As String = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) & Nutrient(i).Unit

                                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrientLabel, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    '' RDC 03.25.2013 - Changed intAvailableWidth to intAvailableWidth - 50 to avoid producing blank page when exporting in pdf and html and 
                                    ''                  Changed intNewX + 100 to intNewX + 120 to add more spacing between nutrient label and value
                                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrientValue, fntRegular, intNewX + 120, intNewY, intAvailableWidth - 50, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    'intNewY += 15

                                    ' RDC 05.20.2013 - Placed data in a table cell
                                    xrNutRow = New XRTableRow
                                    xrNutRow = fctMakeDataRow({strNutrientLabel.Trim, strNutrientValue.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleLeft})
                                    xrNutTable.Rows.Add(xrNutRow)

                                    ' RDC 05.20.2013 - Removed, converted to a function based routine
                                    'xrNutRow = New XRTableRow
                                    'xrNutRow.Height = G_ReportOptions.sgFontSize2
                                    'xrNutRow.Width = intAvailableWidth
                                    'xrNutCell = New XRTableCell
                                    'xrNutCell.Width = 150
                                    'xrNutCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    'xrNutCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                    'xrNutCell.Text = strNutrientLabel.Trim
                                    'xrNutRow.Cells.Add(xrNutCell)

                                    'xrNutCell = New XRTableCell
                                    'xrNutCell.Width = intAvailableWidth - 150
                                    'xrNutCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Regular)
                                    'xrNutCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                                    'xrNutCell.Text = strNutrientValue.Trim
                                    'xrNutRow.Cells.Add(xrNutCell)

                                    'xrNutTable.Rows.Add(xrNutRow)


                                    'G_intMaxRecipeDetailsWidth = fctGetWidest(strNutrientLabel, intTextHeight, G_intMaxRecipeDetailsWidth, fntRegular)

                                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrientLabel, fntRegular, intNewX, intNewY, G_intMaxRecipeDetailsWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(" " & strNutrientValue, fntRegular, (intNewX + G_intMaxRecipeDetailsWidth), intNewY, CInt(intAvailableWidth - (intNewX + G_intMaxRecipeDetailsWidth)), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    'intNewY += GetLineSpace(intTextHeight)
                                    ' RDC 02.25.2013 Nutrient Information displayed as list
                                    'intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    'intNewY += GetLineSpace(intTextHeight)
                                    'intNewY += 10

                                    ' End

                                    ' RDC 02.25.2013 Removed display should be in list and not as concatenated string
                                    'If strNutrintInformation = "" Then
                                    '    strNutrintInformation = strX
                                    'Else
                                    '    strNutrintInformation = strNutrintInformation & ", " & strX
                                    'End If
                                    ' End
                                    'End If
                                End If
                            End If
                            Exit For
                            '//
                        End If
                        ''If Trim(Nutrient(i).Name) <> "" And IsNutrientVisibled Then
                        ''    If i = 1 Then
                        ''        strX = Nutrient(i).Name ''''& " " & Nutrient(i).Unit
                        ''        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                        ''        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''        intNewY += GetLineSpace(intTextHeight)

                        ''        strX = Nutrient(i).Name ''''& " kcal"
                        ''        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                        ''        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                        ''    Else
                        ''        strX = Nutrient(i).Name '''& " " & Nutrient(i).Unit
                        ''        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                        ''        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''    End If

                        ''    intNewX += lngspace
                        ''    If Nutrient(i).Value <> -1 Then
                        ''        If i = 1 Then
                        ''            intNewY = intCurrY
                        ''            'strX = Format(Nutrient(i).Value, Nutrient(i).Format)
                        ''            strX = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''            intNewY += GetLineSpace(intTextHeight)

                        ''            'Nutrient(i).Value = Format(Nutrient(i).Value, Nutrient(i).Format)
                        ''            Nutrient(i).Value = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''            'strX = Format(Nutrient(i).Value / ENERGYFACTOR, Nutrient(i).FormatKCAL)
                        ''            strX = fctFormatNumericQuantity(Nutrient(i).Value / ENERGYFACTOR, Nutrient(i).FormatKCAL, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " kcal", fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                        ''            intNewX += intWidth

                        ''            If dblNutrientFactor > 0 Then
                        ''                intNewY = intCurrY
                        ''                'strX = Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format)
                        ''                strX = fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''                '// DRR 06.22.2011
                        ''                If G_CLIENT = "USA" Then
                        ''                    'display nothing
                        ''                Else
                        ''                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''                End If
                        ''                intNewY += GetLineSpace(intTextHeight)

                        ''                'strX = Format((Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format) / ENERGYFACTOR), Nutrient(i).FormatKCAL)
                        ''                strX = fctFormatNumericQuantity((fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros)) / ENERGYFACTOR, Nutrient(i).FormatKCAL, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''                '// DRR 06.22.2011
                        ''                If G_CLIENT = "USA" Then
                        ''                    'display nothing
                        ''                Else
                        ''                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''                End If
                        ''            Else
                        ''                intNewY = intCurrY
                        ''                strX = strNA        'N/A
                        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''                intNewY += GetLineSpace(intTextHeight)

                        ''                strX = strNA        'N/A
                        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''            End If

                        ''        Else
                        ''            'strX = Format(Nutrient(i).Value, Nutrient(i).Format)
                        ''            strX = fctFormatNumericQuantity(Nutrient(i).Value, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''            intNewX += intWidth

                        ''            If dblNutrientFactor > 0 Then
                        ''                'strX = Format(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format)
                        ''                strX = fctFormatNumericQuantity(Nutrient(i).Value / dblNutrientFactor, Nutrient(i).Format, G_ReportOptions.blnRemoveTrailingZeros) '// DRR 03.08.2012
                        ''            Else
                        ''                strX = strNA
                        ''            End If
                        ''            '// DRR 06.22.2011
                        ''            If G_CLIENT = "USA" Then
                        ''                'display nothing
                        ''            Else
                        ''                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX & " " & Nutrient(i).Unit, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                        ''            End If
                        ''        End If

                        ''    End If
                        ''End If

                        ' ''intNewY += GetLineSpace(intTextHeight) DRR commented
                        ''If IsNutrientVisibled Then intNewY += GetLineSpace(intTextHeight) ' DRR
                    Next
                Next
                .Detail.Controls.Add(xrNutTable)
                intNewY += (xrNutTable.Height + 20)
                ' RDC 02.25.2013 Removed due to nutrient display must be as list.
                'If strNutrintInformation <> "" Then
                '    sf = New StringFormat(StringFormatFlags.NoClip)
                '    If strYieldUnit = "" Then
                '        strX = GetImpoesedNutrientType(intCodeListe, G_ReportOptions.intPageLanguage)
                '    Else
                '        strX = strYieldUnit
                '    End If

                '    If strX = "" Then
                '        strX = "Nutritional Information " + strYieldUnit 'fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                '    Else
                '        strX = "Nutritional Information " + strX 'JBB 03.14.2012 -- cLang.GetString(clsEGSLanguage.CodeType.Nutrients)       'Nutrients
                '    End If
                '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '    intNewY += GetLineSpace(intTextHeight)
                '    intTextHeight = ReportingTextUtils.MeasureText(strNutrintInformation, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNutrintInformation, fntRegular, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '    intNewY += GetLineSpace(intTextHeight)
                '    intNewY += 10
                'End If
                ' End
            End If
        End With

    End Sub


    Sub subDisplayNutrientsGDA(ByVal strYieldUnit As String,
            ByVal dblNutrientFactor As Double, ByVal dblNutrient As Object, ByVal strStyle As String)

        Dim lngspace As Long
        Dim i As Integer
        Dim strNA As String
        Dim intCount As Integer
        Dim Nutrient(0 To 34) As tNutrient '15
        Dim intCurrY As Integer
        Dim dblTotalValue As Double
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim intWidth As Integer
        Dim dblValue As Double
        Dim flagWithGDA As Boolean = True


        strNA = cLang.GetString(clsEGSLanguage.CodeType.NA)  'N/A

        intCount = 0
        For i = 1 To 34 '15
            Nutrient(i).Format = G_Nutrient(i).Format
            Nutrient(i).Heading = G_Nutrient(i).Heading
            Nutrient(i).Name = G_Nutrient(i).Name
            Nutrient(i).Unit = G_Nutrient(i).Unit
            Nutrient(i).Value = L_Nutrient(i).Value
            Nutrient(i).GDA = G_Nutrient(i).GDA 'DLS Aug112007
            Nutrient(i).Position = G_Nutrient(i).Position '// DRR 03.09.2012
            If Trim(Nutrient(i).Name) <> "" Then intCount = intCount + 1
            dblTotalValue += L_Nutrient(i).Value
            If L_Nutrient(i).GDA > 0 Then flagWithGDA = True
        Next

        If flagWithGDA = False Then Exit Sub

        With Me
            intNewX = 0
            intNewY += 10

            sf = New StringFormat(StringFormatFlags.NoClip)
            strX = cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts)       'Guideline Daily Amounts
            intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            Select Case strStyle
                Case "002"  'For Modern
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                Case Else  'For Standard/Two Columns
                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
                    '' RDC 04.15.2013 - Added Line
                    ''intNewY += 10
                    ''.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})

                    With G_ReportOptions
                        Dim xrHeaderSectionTable As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GuidelineDailyAmounts).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
                        Detail.Controls.Add(xrHeaderSectionTable)
                        intNewY += (xrHeaderSectionTable.Height + 10)
                    End With

                    Dim xrGDATable As New XRTable
                    Dim xrGDARow As New XRTableRow
                    Dim xrGDACell As New XRTableCell

                    xrGDATable.Width = intAvailableWidth
                    xrGDATable.Location = New Point(intNewX, intNewY)

                    If G_ReportOptions.blnIncludeHighlightSection Then
                        xrGDATable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                        xrGDATable.BorderWidth = 1
                        xrGDATable.BackColor = Color.LightGray
                        xrGDATable.BorderColor = Color.Black
                    Else
                        xrGDATable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                        xrGDATable.BorderWidth = 1
                        xrGDATable.BackColor = Color.White
                        xrGDATable.BorderColor = Color.Black
                    End If

                    'xrGDARow.Height = G_ReportOptions.sgFontSize2
                    'xrGDACell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                    'xrGDACell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                    'xrGDACell.Text = strX.Trim
                    'xrGDARow.Cells.Add(xrGDACell)
                    'xrGDATable.Rows.Add(xrGDARow)

                    '.Detail.Controls.Add(xrGDATable)

                    'intNewY += (xrGDATable.Height + 10)
            End Select
            'intNewY += GetLineSpace(intTextHeight) + 10

            If dblTotalValue > 0 Then
                ' RDC 05.20.2013 - Removed
                'lngspace = 0
                'lngspace = fctGetWidest(Nutrient(1).Name & " " & Nutrient(1).Unit & "/kcal", intTextHeight, lngspace, fntRegular)
                For i = 1 To 12
                    If Nutrient(i).GDA > 0 Then
                        lngspace = fctGetWidest(Nutrient(i).Name & " " & Nutrient(i).Unit, intTextHeight, lngspace, fntRegular)
                    End If
                Next

                ' RDC 05.20.2013 - Placed data to table cell
                Dim intCellWidth As Integer = (intAvailableWidth / 5)
                Dim xrGDATable As New XRTable
                xrGDATable.Width = intAvailableWidth
                xrGDATable.Location = New Point(intNewX, intNewY)

                Dim xrGDATableRow As New XRTableRow
                xrGDATableRow = fctMakeDataRow({" ", fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit)).Trim, cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent).Trim, " "},
                                                {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)},
                                                {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
                xrGDATable.Rows.Add(xrGDATableRow)

                For iNutrientPos As Integer = 0 To intCount Step 1
                    If Nutrient(iNutrientPos).GDA > 0 Then
                        If Not Nutrient(iNutrientPos).Value = -1 Then

                            Dim dblNutrientPerServing As Double = CDbl(CDbl(Nutrient(iNutrientPos).Value / Nutrient(iNutrientPos).GDA) * 100)
                            Dim dblNutrientPer100mgml As Double = CDbl(CDbl(CDbl(Nutrient(iNutrientPos).Value / dblNutrientFactor) / Nutrient(iNutrientPos).GDA) * 100)
                            Dim strNutrientPerServing As String = ""
                            Dim strNutrientPer100mgml As String = ""

                            If Not dblNutrientPerServing = 0 And dblNutrientPerServing < 0 Then
                                strNutrientPerServing = "< 1%"
                            Else
                                strNutrientPerServing = FormatNumber(dblNutrientPerServing, 0).ToString & "%"
                            End If

                            If Not dblNutrientPer100mgml = 0 And dblNutrientPer100mgml < 0 Then
                                strNutrientPer100mgml = "< 1%"
                            Else
                                strNutrientPer100mgml = FormatNumber(dblNutrientPer100mgml, 0).ToString & "%"
                            End If

                            ' RDC 05.24.2013 - CWM-6200 Fix - Replaced variable i to iNutrientPos 
                            xrGDATableRow = New XRTableRow
                            If dblNutrientFactor > 0 Then
                                xrGDATableRow = New XRTableRow
                                xrGDATableRow = fctMakeDataRow({New String(Nutrient(iNutrientPos).Name & " " & Nutrient(iNutrientPos).Unit).Trim, strNutrientPerServing.Trim, strNutrientPer100mgml.Trim, " "},
                                                               {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)},
                                                               {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
                                xrGDATable.Rows.Add(xrGDATableRow)
                            Else
                                xrGDATableRow = New XRTableRow
                                xrGDATableRow = fctMakeDataRow({New String(Nutrient(iNutrientPos).Name & " " & Nutrient(iNutrientPos).Unit).Trim, strNutrientPerServing.Trim, cLang.GetString(clsEGSLanguage.CodeType.NA), " "},
                                                               {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)},
                                                               {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
                                xrGDATable.Rows.Add(xrGDATableRow)
                            End If
                        End If
                    End If
                Next

                Detail.Controls.Add(xrGDATable)
                intNewY += (xrGDATable.Height + 20)

                ' RDC 05.20.2013 - Removed old code

                '    ' lngspace *= 1.5
                '    intNewX += lngspace

                '    intWidth = Math.Abs(intAvailableWidth - lngspace) / 2
                '    sf = New StringFormat(StringFormatFlags.NoClip)
                '    strX = fctReplacePluralWithSingularUnit(Replace(cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100), "%Y", strYieldUnit))     'per %Y at 100%
                '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

                '    intNewX += intWidth
                '    'intNewX += Math.Abs(intAvailableWidth - lngspace) / 2

                '    If dblNutrientFactor > 0 Then
                '        strX = cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent)      'per 100g or 100ml at 100%
                '        intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intWidth, sf, Me.Padding).Height
                '        '// DRR 06.23.2011
                '        If G_CLIENT = "USA" Then
                '            'do nothing
                '        Else
                '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '        End If
                '    End If
                '    intNewY += GetLineSpace(intTextHeight)

                '    'sf = New StringFormat(StringFormatFlags.DirectionVertical)

                '    intCurrY = intNewY
                '    For i = 1 To intCount
                '        intNewX = 0
                '        If Nutrient(i).GDA > 0 Then

                '            strX = Nutrient(i).Name & " " & Nutrient(i).Unit
                '            intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, lngspace, sf, Me.Padding).Height
                '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})


                '            intNewX += lngspace

                '            If Nutrient(i).Value <> -1 Then

                '                'per serving
                '                dblValue = (((Nutrient(i).Value)) / Nutrient(i).GDA) * 100
                '                If dblValue < 1 And dblValue <> 0 Then
                '                    strX = "< 1%"
                '                Else
                '                    strX = FormatNumber(dblValue, 0) & "%"
                '                End If
                '                'strX = FormatNumber(dblValue, 2) & "%"

                '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '                intNewX += intWidth

                '                If dblNutrientFactor > 0 Then
                '                    'per 100g 0r 100ml
                '                    If dblNutrientFactor > 0 Then
                '                        dblValue = (((Nutrient(i).Value / dblNutrientFactor)) / Nutrient(i).GDA) * 100

                '                        If dblValue < 1 And dblValue <> 0 Then
                '                            strX = "< 1%"
                '                        Else
                '                            strX = FormatNumber(dblValue, 0) & "%"
                '                        End If
                '                        'strX = FormatNumber(dblValue, 2) & "%"
                '                    Else
                '                        strX = strNA
                '                    End If
                '                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, intWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                '                End If
                '            End If
                '            intNewY += GetLineSpace(intTextHeight) '// DRR 07.06.2012
                '        End If

                '        'intNewY += GetLineSpace(intTextHeight)
                '    Next
            End If
        End With

    End Sub

    Sub subDisplayHACCP(ByVal strCoolingTime As String, ByVal strHeatingTime As String, ByVal strHeatingTemperature As String,
                        ByVal strHeatingMode As String, ByVal strCCPDescription As String, ByVal strStyle As String, Optional ByVal strStoringTime As String = "",
                        Optional ByVal strStoringTemp As String = "", Optional ByVal strHACCP As String = "")

        Dim lngspace As Long
        Dim intCurrY As Integer
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim strX As String

        With Me
            ' RDC 05.20.2013 - Removed replaced with code below
            'sf = New StringFormat(StringFormatFlags.DirectionVertical)
            'lngspace = 0

            'strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime)
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime)
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode)
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular) 'FTB(10554)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.StoringTemperature) 'VRP 21.08.2008
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular) 'FTB(10554)

            'strX = cLang.GetString(clsEGSLanguage.CodeType.StoringTime) 'VRP 21.08.2008
            'lngspace = fctGetWidest(strX, intTextHeight, lngspace, fntRegular) 'FTB(10554)

            ''strCSV = fctFormatTextForCSV(.TableCell(tcText, 1, 1))

            'sf = New StringFormat(StringFormatFlags.NoClip)
            'intNewY += 10

            'strX = cLang.GetString(clsEGSLanguage.CodeType.HACCP)
            'intTextHeight = ReportingTextUtils.MeasureText(strX, fntBold, intAvailableWidth, sf, Me.Padding).Height
            ' RDC 05.20.2013 - HACCP Section Header


            ' RDC 05.20.2013 - Removed due to layout will all be the same
            'Select Case strStyle
            '    Case "002"      'For Modern
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
            '    Case Else       'For Standard/Two Columns
            '        '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '        '' RDC 04.15.2013 - Added Line
            '        'intNewY += 10
            '        ''.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})

            '        ' RDC 05.15.2013 - Header in Table form
            '        Dim xrHACCPTable As New XRTable
            '        Dim xrHACCPRow As New XRTableRow
            '        Dim xrHACCPCell As New XRTableCell

            '        xrHACCPTable.Width = intAvailableWidth
            '        xrHACCPTable.Location = New Point(intNewX, intNewY)

            '        If G_ReportOptions.blnIncludeHighlightSection Then
            '            xrHACCPTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
            '            xrHACCPTable.BorderWidth = 1
            '            xrHACCPTable.BackColor = Color.LightGray
            '            xrHACCPTable.BorderColor = Color.Black
            '        Else
            '            xrHACCPTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
            '            xrHACCPTable.BorderWidth = 1
            '            xrHACCPTable.BackColor = Color.White
            '            xrHACCPTable.BorderColor = Color.Black
            '        End If

            '        xrHACCPRow.Height = G_ReportOptions.sgFontSize2
            '        xrHACCPCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            '        xrHACCPCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            '        xrHACCPCell.Text = strX.Trim
            '        xrHACCPRow.Cells.Add(xrHACCPCell)
            '        xrHACCPTable.Rows.Add(xrHACCPRow)

            '        .Detail.Controls.Add(xrHACCPTable)

            '        intNewY += (xrHACCPTable.Height + 10)
            'End Select
            ''intNewY += GetLineSpace(intTextHeight) + 10
            ' RDC 05.20.2013 - HACCP printout in table form
            ' RDC 05.20.2013 - HACCP Section Detail
            Dim xrHACCPTable As New XRTable
            Dim xrHACCPRow As XRTableRow

            xrHACCPTable.Width = intAvailableWidth
            xrHACCPTable.Location = New Point(intNewX, intNewY)
            xrHACCPTable.BackColor = Color.Aqua
            ' HACCP - Cooling Time
            If strCoolingTime.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.CoolingTime).Trim, ": " & strCoolingTime.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If
            ' HACCP - Heating Time
            If strHeatingTime.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.HeatingTime).Trim, ": " & strHeatingTime.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If
            ' HACCP - Heating Temperature
            If strHeatingTemperature.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree).Trim, ": " & strHeatingTemperature.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If
            ' HACCP - Heating Mode
            If strHeatingMode.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.HeatingMode).Trim, ": " & strHeatingMode.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If
            ' HACCP - Storing Temp
            If strStoringTemp.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.StoringTemperature).Trim, ": " & strStoringTemp.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                'xrHACCPRow.Dispose()
            End If
            ' HACCP - Storing Time 
            If strStoringTime.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.StoringTime).Trim, ": " & strStoringTime.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If
            ' HACCP - CCP Description
            If strCCPDescription.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.CCPDescription).Trim, ": " & strCCPDescription.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If

            'HACCP - HACCP
            If strHACCP.Trim.Length > 0 Then
                xrHACCPRow = New XRTableRow
                xrHACCPRow = fctMakeDataRow({cLang.GetString(clsEGSLanguage.CodeType.HACCP).Trim, ": " & strHACCP.Trim}, {CInt(200), CInt(intAvailableWidth - 200)}, {TextAlignment.TopLeft, TextAlignment.TopLeft})
                xrHACCPTable.Rows.Add(xrHACCPRow)
                ' xrHACCPRow.Dispose()
            End If


            'JTOC 14.06.2013 CWM-6443
            intNewY = intNewY + xrHACCPTable.Height
            Detail.Controls.Add(xrHACCPTable)

            ' xrHACCPTable.Dispose()

            ' RDC 05.20.2013 - Removed and placed all values inside table. See code above
            'intCurrY = intNewY

            'If strCoolingTime.Length > 0 Then
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.CoolingTime)
            '    intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingTime.Length > 0 Then
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingTime)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingTemperature.Length > 0 Then
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingDegree)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingMode.Length > 0 Then
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.HeatingMode)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strStoringTemp.Length > 0 Then 'VRP 21.08.2008
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.StoringTemperature)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strStoringTime.Length > 0 Then 'VRP 21.08.2008
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.StoringTime)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strCCPDescription.Length > 0 Then
            '    strX = cLang.GetString(clsEGSLanguage.CodeType.CCPDescription)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'intNewY = intCurrY
            'intNewX += lngspace

            'If strCoolingTime.Length > 0 Then
            '    strX = Trim(strCoolingTime)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, Math.Abs(intAvailableWidth - lngspace), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingTime.Length > 0 Then
            '    strX = Trim(strHeatingTime)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, Math.Abs(intAvailableWidth - lngspace), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingTemperature.Length > 0 Then
            '    strX = Trim(strHeatingTemperature)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, Math.Abs(intAvailableWidth - lngspace), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strHeatingMode.Length > 0 Then
            '    strX = Trim(strHeatingMode)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, Math.Abs(intAvailableWidth - lngspace), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strStoringTemp.Length > 0 Then 'VRP 21.08.2008
            '    strX = Trim(strStoringTemp)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strStoringTime.Length > 0 Then 'VRP 21.08.2008
            '    strX = Trim(strStoringTime)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, lngspace, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If

            'If strCCPDescription.Length > 0 Then
            '    strX = Trim(strCCPDescription)
            '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(": " & strX, fntRegular, intNewX, intNewY, Math.Abs(intAvailableWidth - lngspace), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    intNewY += GetLineSpace(intTextHeight)
            'End If
        End With

    End Sub

    Sub subDisplaySteps(ByVal dtIngr As DataTable, ByVal intCodeMain As Integer,
                        Optional ByVal strCnn As String = "", Optional ByVal intSizeX As Integer = 0,
                        Optional ByVal blnWithBackColor As Boolean = False, Optional ByVal strTextColor As String = "",
                        Optional ByVal intBackColorOption As Integer = 0,
                        Optional ByVal intCodeListeMain As Integer = -1, Optional ByVal intCodeListeParent As Integer = -1) 'VRP 19.05.2008
        Dim intCodeTemplate As Integer
        Dim strHeaderName As String
        Dim strProcedures() As String
        Dim strProcedure As String
        Dim intCodeMainRow As Integer
        Dim intCodeListeParentRow As Integer
        Dim intCodeListeMainRow As Integer



        intCodeListeParentRow = -1
        intCodeListeMainRow = -1

        sf = New StringFormat(StringFormatFlags.NoClip)

        If intSizeX = 0 Then intSizeX = intAvailableWidth
        With Me
            If IsNothing(dtIngr) Then Exit Sub
            For Each rowIngr As DataRow In dtIngr.Rows
                intCodeMainRow = CIntDB(rowIngr("CodeMain"))
                If intCodeMainRow = 0 Then intCodeMainRow = CIntDB(rowIngr("ItemCde"))

                If intCodeListeMain <> -1 And intCodeListeParent <> -1 Then
                    intCodeListeParentRow = fctNullToZero(rowIngr.Item("CodeListeMain"))
                    intCodeListeMainRow = fctNullToZero(rowIngr.Item("CodeListeParent"))
                End If


                If intCodeMainRow = intCodeMain And intCodeListeMainRow = intCodeListeMain And intCodeListeParentRow = intCodeListeParent Then
                    If CIntDB(rowIngr("ItemType")) = 75 Then
                        intCodeTemplate = CIntDB(rowIngr("CodeTemplate"))
                        If intCodeTemplate = 0 Then
                            strProcedure = CStrDB(rowIngr("Procedure")).Trim

                            If strProcedure <> "" Then
                                strHeaderName = CStrDB(rowIngr("ItemName")).Trim
                                intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intAvailableWidth, sf, Me.Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , blnWithBackColor, , strTextColor, , intBackColorOption)})
                                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height
                                intNewY += GetLineSpace(intTextHeight)

                                'strProcedure = CStrDB(rowIngr("Procedure")).Trim
                                'intTextHeight = ReportingTextUtils.MeasureText(strProcedure, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strProcedure, fntRegular, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                                'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height
                                'intNewY += GetLineSpace(intTextHeight)
                                strProcedure = CStrDB(rowIngr("Procedure")).Trim
                                strProcedure = Trim(Replace(strProcedure, vbCrLf & "#", vbCrLf))
                                strProcedure = Trim(Replace(strProcedure, Chr(1), vbCrLf))
                                If Mid(strProcedure, 1, 1) = "#" Then strProcedure = Mid(strProcedure, 2)

                                intTextHeight = ReportingTextUtils.MeasureText(strX, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                                SplitNote(strProcedure, intSizeX, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopLeft)
                            End If
                        Else
                            Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
                            Dim dt As DataTable = cListe.fctGetProcedureTemplateD(G_ReportOptions.intTranslation, CIntDB(rowIngr("CodeTemplate")))

                            strHeaderName = rowIngr("ItemName").trim
                            strProcedures = rowIngr("Procedure").split(CChar("¤"))

                            intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intAvailableWidth, sf, Me.Padding).Height
                            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , blnWithBackColor, , strTextColor, , intBackColorOption)})
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height
                            intNewY += GetLineSpace(intTextHeight)

                            Dim irow As Integer = 0
                            For Each row As DataRow In dt.Rows
                                If strProcedures(irow).Trim.Length > 0 Then
                                    '--- procedure template headers
                                    strX = CStrDB(row("Name")).Trim
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntItalic, intAvailableWidth, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntItalic, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height
                                    intNewY += GetLineSpace(intTextHeight)
                                    '--- 
                                    intTextHeight = ReportingTextUtils.MeasureText(strProcedures(irow), fntRegular, intAvailableWidth, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strProcedures(irow).Trim, fntRegular, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                                    'intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intAvailableWidth, sf, Me.Padding).Height
                                    intNewY += GetLineSpace(intTextHeight)
                                End If
                                irow += 1
                            Next
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
                            intNewY += intTextHeight
                        End If
                    End If
                End If
            Next
        End With
    End Sub

    Sub subDisplaySteps2(ByVal dtIngr As DataTable, ByVal intCodeMain As Integer,
                       Optional ByVal strCnn As String = "", Optional ByVal intSizeX As Integer = 0,
                       Optional ByVal blnWithBackColor As Boolean = False, Optional ByVal strTextColor As String = "",
                       Optional ByVal intBackColorOption As Integer = 0) 'VRP 19.05.2008

        Dim intCodeTemplate As Integer
        Dim strHeaderName As String
        Dim strProcedures() As String
        Dim strProcedure As String
        Dim intCodeListeMain As Integer
        sf = New StringFormat(StringFormatFlags.NoClip)

        If intSizeX = 0 Then intSizeX = intAvailableWidth
        With Me
            If IsNothing(dtIngr) Then Exit Sub

            For Each rowIngr As DataRow In dtIngr.Rows
                intCodeListeMain = CIntDB(rowIngr("CodeMain"))
                If intCodeListeMain = 0 Then intCodeListeMain = CIntDB(rowIngr("ItemCode"))

                If intCodeListeMain = intCodeMain Then
                    If CIntDB(rowIngr("ItemType")) = 75 Then
                        intCodeTemplate = CIntDB(rowIngr("CodeTemplate"))
                        If intCodeTemplate = 0 Then
                            strProcedure = CStrDB(rowIngr("Procedure")).Trim
                            If strProcedure.Trim.Length > 0 Then
                                strHeaderName = CStrDB(rowIngr("ItemName")).Trim
                                intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intSizeX, sf, Me.Padding).Height
                                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , blnWithBackColor, , strTextColor, , intBackColorOption)})
                                intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intSizeX, sf, Me.Padding).Height
                                intNewY += intTextHeight

                                strProcedure = Trim(Replace(strProcedure, vbCrLf & "#", vbCrLf))
                                strProcedure = Trim(Replace(strProcedure, Chr(1), vbCrLf))
                                If Mid(strProcedure, 1, 1) = "#" Then strProcedure = Mid(strProcedure, 2)

                                intTextHeight = ReportingTextUtils.MeasureText(strProcedure, fntRegular, intSizeX, sf, Me.Padding).Height
                                SplitNote2(strProcedure, intSizeX, intNewX, intNewY, DevExpress.XtraPrinting.TextAlignment.TopLeft)
                                'intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAvailableWidth, sf, Me.Padding).Height
                                'intNewY += intTextHeight
                            End If
                        Else
                            Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
                            Dim dt As DataTable = cListe.fctGetProcedureTemplateD(G_ReportOptions.intTranslation, CIntDB(rowIngr("CodeTemplate")))

                            strHeaderName = rowIngr("ItemName").trim
                            strProcedures = rowIngr("Procedure").split(CChar("¤"))

                            Dim irow As Integer = 0
                            For Each row As DataRow In dt.Rows
                                If strProcedures(irow).Trim.Length > 0 Then
                                    intTextHeight = ReportingTextUtils.MeasureText(strHeaderName, fntBold, intSizeX, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeaderName, fntBold, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , , , blnWithBackColor, , strTextColor, , intBackColorOption)})
                                    intTextHeight = ReportingTextUtils.MeasureText("A", fntBold, intSizeX, sf, Me.Padding).Height
                                    intNewY += GetLineSpace(intTextHeight)

                                    '--- procedure template headers
                                    strX = CStrDB(row("Name")).Trim
                                    intTextHeight = ReportingTextUtils.MeasureText(strX, fntItalic, intSizeX, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntItalic, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                                    intNewY += intTextHeight
                                    '--- 
                                    intTextHeight = ReportingTextUtils.MeasureText(strProcedures(irow).Trim, fntRegular, intSizeX, sf, Me.Padding).Height
                                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strProcedures(irow).Trim, fntRegular, intNewX, intNewY, intSizeX, intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, , True)})
                                    intNewY += intTextHeight
                                End If
                                irow += 1
                            Next
                            'intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intSizeX, sf, Me.Padding).Height
                            'intNewY += intTextHeight
                        End If
                    End If
                End If
            Next
        End With
    End Sub

    Sub subDisplayKeywords(ByVal drKeywords() As DataRow, ByVal strStyle As String)
        Dim strKeyword As String
        Dim intPrevious As Integer

        If CInt(intAvailableWidth) = 0 Then intAvailableWidth = 600
        'intNewY += 10
        strX = cLang.GetString(clsEGSLanguage.CodeType.Keywords)    'Keywords
        With Me

            If IsNothing(drKeywords) Then Exit Sub
            ' RDC 05.20.2013 - When keyword is 0
            If drKeywords.Count = 0 Then Exit Sub

            ' RDC 05.20.2013 - Remove due to layout will be the same.
            'Select Case strStyle
            '    Case "002"  'For Modern
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
            '    Case Else  'For Standard/Two Columns
            '        '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntBold, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True, DevExpress.XtraPrinting.BorderSide.Top, True, True, , G_ReportOptions.strTitleColor)})
            '        ' RDC 04.15.2013 - Added Line
            '        'intNewY += 10
            '        '.Detail.Controls.AddRange(New XRControl() {fctMakeLine(intNewX, intNewY, intAvailableWidth, 1)})

            '        ' RDC 05.15.2013 - Header in Table form
            '        Dim xrKeywordTable As New XRTable
            '        Dim xrKeywordRow As New XRTableRow
            '        Dim xrKeywordCell As New XRTableCell

            '        xrKeywordTable.Width = intAvailableWidth
            '        xrKeywordTable.Location = New Point(intNewX, intNewY)

            '        If G_ReportOptions.blnIncludeHighlightSection Then
            '            xrKeywordTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
            '            xrKeywordTable.BorderWidth = 1
            '            xrKeywordTable.BackColor = Color.LightGray
            '            xrKeywordTable.BorderColor = Color.Black
            '        Else
            '            xrKeywordTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
            '            xrKeywordTable.BorderWidth = 1
            '            xrKeywordTable.BackColor = Color.White
            '            xrKeywordTable.BorderColor = Color.Black
            '        End If

            '        xrKeywordRow.Height = G_ReportOptions.sgFontSize2
            '        xrKeywordCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
            '        xrKeywordCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
            '        xrKeywordCell.Text = strX.Trim
            '        xrKeywordRow.Cells.Add(xrKeywordCell)
            '        xrKeywordTable.Rows.Add(xrKeywordRow)

            '        .Detail.Controls.Add(xrKeywordTable)

            '        intNewY += (xrKeywordTable.Height + 10)
            'End Select
            'intNewY += intTextHeight + 10
            ' RDC 05.20.2013 - Replaced code above with codes below using XRTable control
            'With G_ReportOptions
            '    Dim xrSectionHeaderTable As New XRTable
            '    xrSectionHeaderTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.Keywords).Trim, intNewX, intNewY, intAvailableWidth, .sgFontSize2, .blnIncludeHighlightSection)
            '    Detail.Controls.Add(xrSectionHeaderTable)
            '    intNewY += (xrSectionHeaderTable.Height + 10)
            '    'xrSectionHeaderTable.Dispose()
            'End With


            intPrevious = -1
            'For rowK As Integer = 0 To drKeywords.GetUpperBound(0)

            '    strKeyword = CType(drKeywords(rowK)("Name"), String)

            '    If CType(drKeywords(rowK)("Type"), Integer) = ID_Recipe Then
            '        If intPrevious <> CType(drKeywords(rowK)("CodeKey"), Integer) Then
            '            If CType(drKeywords(rowK)("derived"), Boolean) Then
            '                fntFont = fntItalic
            '            Else
            '                fntFont = fntRegular
            '            End If
            '            .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '        End If
            '    Else
            '        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '    End If
            '    intNewY += GetLineSpace(intTextHeight)

            'Next
            ' RDC 05.20.2013 - Data will be put on a cell table
            Dim xrKeywordTable As New XRTable
            xrKeywordTable.Width = intAvailableWidth
            xrKeywordTable.Location = New Point(intNewX, intNewY)
            Dim xrKeywordRow As XRTableRow

            ' RDC 07.30.2013 : Reordering of keywords in Alphabetical order

            Dim dt As New DataTable
            dt.Columns.Add("Keyword")
            dt.Columns.Add("Type")
            dt.Columns.Add("CodeKey")
            dt.Columns.Add("Derived")

            Dim dRows(3)

            Dim strDerived As String = " (derived)"
            strDerived = cLang.GetString(clsEGSLanguage.CodeType.Derived)

            For iRowPos As Integer = 0 To drKeywords.GetUpperBound(0)
                If CType(drKeywords(iRowPos)("derived"), Boolean) Then
                    dRows(0) = CType(drKeywords(iRowPos)("Name").ToString, String) & " (" & strDerived & ")"
                Else
                    dRows(0) = CType(drKeywords(iRowPos)("Name").ToString, String)

                End If

                dRows(1) = CType(drKeywords(iRowPos)("Type"), Integer)
                dRows(2) = CType(drKeywords(iRowPos)("CodeKey"), Integer)
                dRows(3) = CType(drKeywords(iRowPos)("Derived"), Boolean)

                dt.Rows.Add(dRows)

            Next

            Dim strFilter As String = ""


            'If G_ReportOptions.blnIncludeDerivedKeyword Then ' Original codes.
            '    strFilter = "Type=" & ID_Recipe & " And CodeKey<>" & intPrevious
            'Else
            '    strFilter = "Type=" & ID_Recipe & " And CodeKey<>" & intPrevious & " And Derived='False'" 'AGL 2014.01.08 - Changed Derived=0 to Derived='False'
            'End If

            'If G_ReportOptions.blnIncludeKeyword And G_ReportOptions.blnIncludeDerivedKeyword Then ' KMQDC 5.27.2015 Changes is for not Derived Keywords to be shown
            '    ' strFilter = "Type IN (" & ID_Recipe & ",16)And CodeKey<>" & intPrevious
            '    strFilter = "Type=16 And CodeKey<>" & intPrevious
            'ElseIf G_ReportOptions.blnIncludeDerivedKeyword Then
            '    strFilter = "Type=" & ID_Recipe & " And CodeKey<>" & intPrevious
            'ElseIf G_ReportOptions.blnIncludeKeyword Then
            '    strFilter = "Type=16 And CodeKey<>" & intPrevious
            '    'Else
            '    '    strFilter = "Type=" & ID_Recipe & " And CodeKey<>" & intPrevious & " And Derived='False'" 'AGL 2014.01.08 - Changed Derived=0 to Derived='False'
            'End If

            ' RDC 11.05.2013 : Added filtering for duplicate keywords 
            '' ''Dim dtKeys As New DataTable
            '' ''dtKeys = dt.DefaultView.ToTable(True, "Keyword", "Type", "CodeKey", "Derived").Copy


            '' ''Dim checkKeyrow As Integer = 0
            '' ''If G_ReportOptions.blnIncludeKeyword And G_ReportOptions.blnIncludeDerivedKeyword Then

            '' ''    For Each keyRow As DataRow In dtKeys.Select("Derived is not NULL")

            '' ''        Dim keyFontStyle As FontStyle = FontStyle.Regular
            '' ''        xrKeywordRow = New XRTableRow
            '' ''        If G_ReportOptions.blnIncludeDerivedKeyword And CBool(keyRow("Derived")) Then
            '' ''            keyFontStyle = FontStyle.Italic
            '' ''        Else
            '' ''            keyFontStyle = FontStyle.Regular
            '' ''        End If

            '' ''        xrKeywordRow = fctMakeDataRow({keyRow("Keyword").ToString}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.None, keyFontStyle)
            '' ''        xrKeywordTable.Rows.Add(xrKeywordRow)

            '' ''        checkKeyrow = 1        'KMQDC 5.25.2015 Check for derived
            '' ''    Next
            '' ''Else
            '' ''    For Each keyRow As DataRow In dtKeys.Select("Derived = FALSE")

            '' ''        Dim keyFontStyle As FontStyle = FontStyle.Regular
            '' ''        xrKeywordRow = New XRTableRow
            '' ''        If G_ReportOptions.blnIncludeDerivedKeyword And CBool(keyRow("Derived")) Then
            '' ''            keyFontStyle = FontStyle.Italic
            '' ''        Else
            '' ''            keyFontStyle = FontStyle.Regular
            '' ''        End If

            '' ''        xrKeywordRow = fctMakeDataRow({keyRow("Keyword").ToString}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.None, keyFontStyle)
            '' ''        xrKeywordTable.Rows.Add(xrKeywordRow)

            '' ''        checkKeyrow = 1        'KMQDC 5.25.2015 Check for derived
            '' ''    Next
            '' ''End If
            If G_ReportOptions.blnIncludeKeyword And G_ReportOptions.blnIncludeDerivedKeyword Then
                strFilter = "CodeKey<>" & intPrevious
            Else
                strFilter = "CodeKey<>" & intPrevious & " And Derived='False'" 'AGL 2014.01.08 - Changed Derived=0 to Derived='False'
            End If

            ' RDC 11.05.2013 : Added filtering for duplicate keywords 
            Dim dtKeys As New DataTable
            dtKeys = dt.DefaultView.ToTable(True, "Keyword", "Type", "CodeKey", "Derived").Copy

            For Each keyRow As DataRow In dtKeys.Select(strFilter, "Keyword")
                Dim keyFontStyle As FontStyle = FontStyle.Regular
                xrKeywordRow = New XRTableRow
                If G_ReportOptions.blnIncludeDerivedKeyword And CBool(keyRow("Derived")) Then
                    keyFontStyle = FontStyle.Italic
                End If
                xrKeywordRow = fctMakeDataRow({keyRow("Keyword").ToString}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.None, keyFontStyle)
                xrKeywordTable.Rows.Add(xrKeywordRow)
                ' xrKeywordRow.Dispose()
            Next

            'If G_ReportOptions.blnIncludeDerivedKeyword Then 'VRP 11.09.2008
            '    For rowK As Integer = 0 To drKeywords.GetUpperBound(0)
            '        strKeyword = CType(drKeywords(rowK)("Name"), String)
            '        If CType(drKeywords(rowK)("Type"), Integer) = ID_Recipe Then
            '            If intPrevious <> CType(drKeywords(rowK)("CodeKey"), Integer) Then
            '                If CType(drKeywords(rowK)("derived"), Boolean) Then
            '                    fntFont = fntItalic
            '                    strKeyword += "(derived)"
            '                Else
            '                    fntFont = fntRegular
            '                End If
            '                ' RDC 05.20.2013 - Removed
            '                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                ' RDC 05.20.2013 - Placed data inside a table cell
            '                ' RDC 07.29.2013 : All keywords are all capitalized as per RB requirement
            '                xrKeywordRow = New XRTableRow
            '                xrKeywordRow = fctMakeDataRow({strKeyword.Trim.ToUpper}, {intAvailableWidth}, {TextAlignment.MiddleLeft})
            '                xrKeywordTable.Rows.Add(xrKeywordRow)
            '            End If
            '        Else
            '            If CType(drKeywords(rowK)("derived"), Boolean) Then
            '                strKeyword += "(derived)"
            '            End If
            '            ' RDC 05.20.2013 - Removed
            '            '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '            ' RDC 05.20.2013 - Placed data inside a table cell
            '            ' RDC 07.29.2013 : All keywords are all capitalized as per RB requirement
            '            xrKeywordRow = New XRTableRow
            '            xrKeywordRow = fctMakeDataRow({strKeyword.Trim.ToUpper}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, , FontStyle.Italic)
            '            xrKeywordTable.Rows.Add(xrKeywordRow)
            '        End If
            '        ' RDC 05.20.2013 - No use
            '        'intNewY += GetLineSpace(intTextHeight)
            '    Next
            'Else
            '    For rowK As Integer = 0 To drKeywords.GetUpperBound(0)
            '        If Not CType(drKeywords(rowK)("derived"), Boolean) Then
            '            strKeyword = CType(drKeywords(rowK)("Name"), String)
            '            If CType(drKeywords(rowK)("Type"), Integer) = ID_Recipe Then
            '                If intPrevious <> CType(drKeywords(rowK)("CodeKey"), Integer) Then
            '                    If CType(drKeywords(rowK)("derived"), Boolean) Then
            '                        fntFont = fntItalic
            '                        strKeyword += "(derived)"
            '                    Else
            '                        fntFont = fntRegular
            '                    End If
            '                    ' RDC 05.20.2013 - Removed
            '                    '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntRegular, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})

            '                    ' RDC 05.20.2013 - Placed data inside a table cell
            '                    ' RDC 07.29.2013 : All keywords are all capitalized as per RB requirement
            '                    xrKeywordRow = New XRTableRow
            '                    xrKeywordRow = fctMakeDataRow({strKeyword.Trim.ToUpper}, {intAvailableWidth}, {TextAlignment.MiddleLeft})
            '                    xrKeywordTable.Rows.Add(xrKeywordRow)
            '                End If
            '            Else
            '                ' RDC 05.20.2013 - Removed
            '                '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strKeyword, fntItalic, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
            '                ' RDC 05.20.2013 - Placed data inside a table cell
            '                ' RDC 07.29.2013 : All keywords are all capitalized as per RB requirement
            '                xrKeywordRow = New XRTableRow
            '                xrKeywordRow = fctMakeDataRow({strKeyword.Trim.ToUpper}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, , FontStyle.Italic)
            '                xrKeywordTable.Rows.Add(xrKeywordRow)
            '            End If
            '            ' RDC 05.20.2013 - No use
            '            'intNewY += GetLineSpace(intTextHeight)
            '        End If
            '    Next
            'End If
            'KMQDC 5.25.2015 Check for derived
            ' ''If checkKeyrow <> 1 Then
            ' ''    xrKeywordRow = fctMakeDataRow({dt.Rows(0)(0)}, {intAvailableWidth}, {TextAlignment.MiddleLeft}, DevExpress.XtraPrinting.BorderSide.None, FontStyle.Regular)
            ' ''    xrKeywordTable.Rows.Add(xrKeywordRow)
            ' ''Else

            ' ''End If

            Detail.Controls.Add(xrKeywordTable)
            intNewY += (xrKeywordTable.Height + 20)
            'dt.Dispose()
            'dtKeys.Dispose()
            'xrKeywordTable.Dispose()
        End With
    End Sub

    Sub subDisplayAllegens(ByVal drAllegens() As DataRow,
                           ByVal intNewY As Integer,
                           ByVal intTextHeight As Integer,
                           ByVal fntHeaderFont As Font,
                           ByVal fntDetailFont As Font, ByVal strStyle As String,
                           Optional ByVal blnManor As Boolean = False,
                           Optional ByVal validAllergen As Boolean = True)  'MCM 03.03.06

        Dim strAllergens As String = Nothing
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)


        intNewX = 0
        If blnManor = False Then
            sf = New StringFormat(StringFormatFlags.NoClip)
            With Me
                strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
                Select Case strStyle

                    Case "001", "002", "003"
                        Dim xrAllergensTable As New XRTable
                        Dim xrAllergensRow As New XRTableRow
                        Dim xrAllergensCell As New XRTableCell

                        xrAllergensTable.Width = intAvailableWidth
                        xrAllergensTable.Location = New Point(intNewX, intNewY)

                        If G_ReportOptions.blnIncludeHighlightSection Then
                            xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                            xrAllergensTable.BorderWidth = 1
                            xrAllergensTable.BackColor = Color.LightGray
                            xrAllergensTable.BorderColor = Color.Black
                        Else
                            xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                            xrAllergensTable.BorderWidth = 1
                            xrAllergensTable.BackColor = Color.White
                            xrAllergensTable.BorderColor = Color.Black
                        End If

                        xrAllergensRow.Height = G_ReportOptions.sgFontSize2
                        xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                        xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
                        xrAllergensCell.Text = strX.Trim
                        xrAllergensRow.Cells.Add(xrAllergensCell)
                        xrAllergensTable.Rows.Add(xrAllergensRow)

                        .Detail.Controls.Add(xrAllergensTable)

                        intNewX += (xrAllergensTable.Height + 10)

                        ' RDC 05.15.2013 - Removed.
                        'Case "002"  'Modern
                        '    intNewY += 10
                        '    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(Space(2) & strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top, , True)})
                        'Case "003"
                        '    intNewY += 10
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    Case "003Menu"
                        intNewY += 10
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                    Case "004" 'Merchandise Details
                        intNewY += 30
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
                    Case Else
                        intNewY += 10
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                End Select


                intNewY += intTextHeight + 10
            End With
        Else
            intNewY += GetLineSpace(intTextHeight)
        End If

        With Me
            If blnManor And Not validAllergen Then
                strAllergens = cLang.GetString(161852)   'the recipe may contain allergens

                intTextHeight = ReportingTextUtils.MeasureText(strAllergens, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strAllergens, fntDetailFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                intNewY += GetLineSpace(intTextHeight)

            Else
                If IsNothing(drAllegens) Then Exit Sub
                For rowK As Integer = 0 To drAllegens.GetUpperBound(0)
                    strAllergens = Nothing

                    If G_ReportOptions.blnAllergensAbbrev Then
                        strAllergens = CType(drAllegens(rowK)("Abbreviation"), String)
                    End If

                    If IsNothing(strAllergens) Then
                        strAllergens = CType(drAllegens(rowK)("Name"), String)
                        If G_ReportOptions.intTranslation > 0 AndAlso drAllegens(rowK)("FTBCode") <> -1 Then
                            strAllergens = cLang.GetString(CType(drAllegens(rowK)("FTBCode"), Integer))
                        End If
                    End If

                    intTextHeight = ReportingTextUtils.MeasureText(strAllergens, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strAllergens, fntDetailFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                    intNewY += GetLineSpace(intTextHeight)
                Next
            End If
        End With
    End Sub

    Sub subDisplayAllegensTest(ByVal drAllegens() As DataRow,
                          ByRef intNewY As Integer,
                          ByVal intTextHeight As Integer,
                          ByVal fntHeaderFont As Font,
                          ByVal fntDetailFont As Font, ByVal strStyle As String,
                          Optional ByVal blnManor As Boolean = False,
                          Optional ByVal validAllergen As Boolean = True,
                          Optional ByVal strCnn As String = "",
                          Optional ByVal CodeAllergenTranslation As Integer = 1)  'MCM 03.03.06
        'KMQDC adding for translation 6.15.2015

        Dim strAllergens As String = Nothing
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)


        intNewX = 0
        'If blnManor = False Then
        '    sf = New StringFormat(StringFormatFlags.NoClip)
        '    With Me
        '        strX = cLang.GetString(clsEGSLanguage.CodeType.Allergens)
        '        Select Case strStyle

        '            Case "001", "002", "003"
        '                Dim xrAllergensTable As New XRTable
        '                Dim xrAllergensRow As New XRTableRow
        '                Dim xrAllergensCell As New XRTableCell

        '                xrAllergensTable.Width = intAvailableWidth
        '                xrAllergensTable.Location = New Point(intNewX, intNewY)

        '                If G_ReportOptions.blnIncludeHighlightSection Then
        '                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
        '                    xrAllergensTable.BorderWidth = 1
        '                    xrAllergensTable.BackColor = Color.LightGray
        '                    xrAllergensTable.BorderColor = Color.Black
        '                Else
        '                    xrAllergensTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
        '                    xrAllergensTable.BorderWidth = 1
        '                    xrAllergensTable.BackColor = Color.White
        '                    xrAllergensTable.BorderColor = Color.Black
        '                End If

        '                xrAllergensRow.Height = G_ReportOptions.sgFontSize2
        '                xrAllergensCell.TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
        '                xrAllergensCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
        '                xrAllergensCell.Text = strX.Trim
        '                xrAllergensRow.Cells.Add(xrAllergensCell)
        '                xrAllergensTable.Rows.Add(xrAllergensRow)

        '                .Detail.Controls.Add(xrAllergensTable)

        '                intNewX += (xrAllergensTable.Height + 10)
        '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})


        '            Case "003Menu"
        '                intNewY += 10
        '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, , DevExpress.XtraPrinting.BorderSide.Top)})
        '            Case "004" 'Merchandise Details
        '                intNewY += 30

        '                .Detail.Controls.AddRange(New XRControl() {fctMakeSectionHeader(strX, intNewX, intNewY, CInt(intAvailableWidth), G_ReportOptions.sgFontSize2 + 1, G_ReportOptions.blnIncludeHighlightSection)})
        '            Case Else
        '                intNewY += 10
        '                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strX, fntHeaderFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
        '        End Select


        '        intNewY += intTextHeight + 10
        '    End With
        'Else
        '    intNewY += GetLineSpace(intTextHeight)
        'End If

        With Me
            If blnManor And Not validAllergen Then
                strAllergens = cLang.GetString(161852)   'the recipe may contain allergens

                intTextHeight = ReportingTextUtils.MeasureText(strAllergens, fntRegular, intAvailableWidth, sf, Me.Padding).Height
                .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strAllergens, fntDetailFont, intNewX, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft)})
                intNewY += GetLineSpace(intTextHeight)

            Else
                ' JMS 2015-04-22 Issue 16894 START
                Try
                    If IsNothing(drAllegens) Or drAllegens.Length <= 0 Then Exit Sub
                Catch ex As Exception
                    If IsNothing(drAllegens) Then Exit Sub
                End Try
                'If IsNothing(drAllegens) Then Exit Sub
                ' JMS 2015-04-22 Issue 16894 END
                Dim L_udtUser As structUser
                Dim nCodeListe As Integer = CType(drAllegens(0)("Codeliste"), Integer)
                Dim foodLaw As enumAllergenFoodLaw = G_ReportOptions.intfoodLaw
                Dim cListe As New clsListe(enumAppType.WebApp, strCnn)
                Dim cAllergen As clsAllergen = New clsAllergen(L_udtUser, enumAppType.WebApp, strCnn, enumEgswFetchType.DataSet)
                Dim ttlAllergens As Integer = DirectCast(cAllergen.GetList(enumAppType.WebApp, foodLaw), DataSet).Tables(0).Rows.Count
                'Dim drAllergen = cListe.GetListeAllergen(nCodeListe, G_ReportOptions.intCodeTrans)
                Dim drAllergen = cListe.GetListeAllergen(nCodeListe, CodeAllergenTranslation)  'KMQDC 6.15.2015
                Dim AllergensEu As String = ""
                Dim AllergensSw As String = ""
                Dim AllergenSwContain As String = ""
                Dim AllergenSwTrace As String = ""
                Dim allergenCount As Integer = 0
                'Dim strMayContain As String = GetString(cLang, 172534)  'May contain traces of %a


                Dim flagQtyFirst As Boolean = True
                Dim strFileName As String = Nothing
                Dim intY As Integer = 0
                Dim intDPic As Integer, intPicWidth As Integer = CInt(14), intPicHeight As Integer = CInt(14)
                Dim xrPicTable As New XRTable
                Dim xrPicRow As New XRTableRow
                Dim xrPicCell1 As New XRTableCell, xrPicCell2 As New XRTableCell
                Dim allergenName As String
                Dim allergenImg As String
                Dim arrPicture() As String

                Dim dtAllergensEu As New DataTable
                Dim dtAllergenSwContain As New DataTable
                Dim dtAllergenSwTrace As New DataTable


                dtAllergensEu.Columns.Add("Name", GetType(String))
                dtAllergensEu.Columns.Add("PicName", GetType(String))
                dtAllergenSwContain.Columns.Add("Name", GetType(String))
                dtAllergenSwContain.Columns.Add("PicName", GetType(String))
                dtAllergenSwTrace.Columns.Add("Name", GetType(String))
                dtAllergenSwTrace.Columns.Add("PicName", GetType(String))

                strAllergens = ""
                If drAllergen.HasRows Then
                    While drAllergen.Read
                        If Not CBool(drAllergen.Item("Hidden")) Then
                            If CBool(drAllergen.Item("EuLaw")) And (CBool(drAllergen.Item("Contain")) Or CBool(drAllergen.Item("Trace"))) Then
                                'If Not IsDBNull(drAllergen.Item("PictureName")) AndAlso drAllergen.Item("PictureName") <> "" Then
                                '    AllergensEu &= "<img src='images/allergens/" & drAllergen.Item("PictureName") & "'/> "
                                'End If
                                AllergensEu &= drAllergen.Item("Name") & ", "
                            End If

                            If CBool(drAllergen.Item("Contain")) Then
                                If CBool(drAllergen.Item("SwLaw")) Then
                                    'If Not IsDBNull(drAllergen.Item("PictureName")) AndAlso drAllergen.Item("PictureName") <> "" Then
                                    '    AllergenSwContain &= "<img src='images/allergens/" & drAllergen.Item("PictureName") & "'/> "
                                    'End If
                                    AllergenSwContain &= drAllergen.Item("Name") & ", "
                                End If
                            End If
                            If CBool(drAllergen.Item("Trace")) Then
                                If CBool(drAllergen.Item("SwLaw")) Then
                                    'If Not IsDBNull(drAllergen.Item("PictureName")) AndAlso drAllergen.Item("PictureName") <> "" Then
                                    '    AllergenSwTrace &= "<img src='images/allergens/" & drAllergen.Item("PictureName") & "'/> "
                                    'End If
                                    AllergenSwTrace &= drAllergen.Item("Name") & ", "
                                End If
                            End If
                        End If
                        If CBool(drAllergen.Item("Contain")) Or CBool(drAllergen.Item("Trace")) Or CBool(drAllergen.Item("NonAllergen")) Then
                            allergenCount += 1
                        End If
                    End While
                    drAllergen.Close()


                    If allergenCount = 0 Then
                        AllergensEu = cLang.GetString(172676)   'No allergen assigned yet.
                        AllergensSw = cLang.GetString(172676)   'No allergen assigned yet.
                    Else
                        If AllergensEu = "" Then
                            AllergensEu = cLang.GetString(172344)   'Allergen not Present
                            AllergensSw = cLang.GetString(172344)   'Allergen not Present
                        Else
                            AllergensEu = AllergensEu.Trim.TrimEnd(",") & ". "
                            AllergensSw = ""
                            If AllergenSwContain <> "" Then
                                AllergensSw = cLang.GetString(clsEGSLanguage.CodeType.Contains) & ": " & AllergenSwContain.Trim.TrimEnd(",") & "; "
                            End If
                            If AllergenSwTrace <> "" Then
                                AllergensSw &= cLang.GetString(172680) & ": " & AllergenSwTrace.Trim.TrimEnd(",")
                            End If
                            AllergensSw = AllergensSw.Trim.TrimEnd(";") & ". "
                        End If
                    End If

                    Select Case foodLaw
                        Case enumAllergenFoodLaw.EULaw
                            strAllergens = AllergensEu
                        Case enumAllergenFoodLaw.SwissLaw
                            strAllergens = AllergensSw
                        Case enumAllergenFoodLaw.Both
                            strAllergens = AllergensEu & " (" & cLang.GetString(173779) & ")" & vbCrLf &
                                                AllergensSw & " (" & cLang.GetString(173780) & ")"
                    End Select



                    'If allergenCount = ttlAllergens Then
                    '    strAllergens = Replace(strAllergens, "%img", "images/icons/check.png")
                    'Else
                    '    strAllergens = Replace(strAllergens, "%img", "images/icons/delete_3.png")
                    'End If


                    xrPicTable.Width = intAvailableWidth
                    xrPicTable = New XRTable
                    xrPicRow = New XRTableRow
                    Dim recipeImg As String

                    If allergenCount = ttlAllergens Then
                        ' If Not G_strLogoPath.EndsWith("check.png") Then
                        G_strLogoPath = G_strLogoPath & "check.png"
                        recipeImg = G_strLogoPath
                        'Else
                        '    recipeImg = G_strLogoPath
                        'End If
                    Else

                        'If Not G_strLogoPath.EndsWith("delete_3.png") Then
                        G_strLogoPath = G_strLogoPath & "delete_3.png"
                        recipeImg = G_strLogoPath
                        'Else
                        '    recipeImg = G_strLogoPath
                        'End If
                    End If

                    intTextHeight = ReportingTextUtils.MeasureText(strAllergens, fntRegular, intAvailableWidth, sf, Me.Padding).Height

                    xrPicTable.Location = New Point(0, intNewY)
                    xrPicTable.Width = 520


                    If foodLaw = enumAllergenFoodLaw.EULaw Or foodLaw = enumAllergenFoodLaw.SwissLaw Then

                        xrPicCell1 = New XRTableCell
                        xrPicCell2 = New XRTableCell
                        Dim xrPicBox As New XRPictureBox

                        With xrPicCell1
                            .Size = New System.Drawing.Size(intPicWidth, intPicHeight)
                            .CanGrow = False
                            .CanShrink = False
                            .Width = 20
                            If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0

                                xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 2), CInt(intPicHeight - 2))
                                xrPicBox.Location = New Point(5, 4)
                                xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                                xrPicBox.Sizing = ImageSizeMode.ZoomImage
                                xrPicBox.Parent = xrPicCell1
                                xrPicCell1.Controls.Add(xrPicBox)
                                If allergenCount = ttlAllergens Then
                                    G_strLogoPath = G_strLogoPath.Substring(0, G_strLogoPath.Length - 9)
                                Else
                                    G_strLogoPath = G_strLogoPath.Substring(0, G_strLogoPath.Length - 12)
                                End If

                            Else
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0
                            End If
                        End With


                        With xrPicCell2
                            .Font = fntRegular
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                            .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                            .Text = strAllergens
                            .Width = 500
                        End With

                        xrPicRow.Width = 520

                        xrPicRow.Cells.AddRange({xrPicCell1, xrPicCell2})



                    Else
                        '''Both

                        xrPicCell1 = New XRTableCell
                        xrPicCell2 = New XRTableCell
                        Dim xrPicBox As New XRPictureBox
                        With xrPicCell1
                            .Size = New System.Drawing.Size(intPicWidth, intPicHeight)
                            .CanGrow = False
                            .CanShrink = False
                            .Width = 20
                            If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0

                                xrPicBox.Size = New System.Drawing.Size(CInt(intPicWidth - 2), CInt(intPicHeight - 2))
                                xrPicBox.Location = New Point(5, 4)
                                xrPicBox.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrPicBox.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                                xrPicBox.Sizing = ImageSizeMode.ZoomImage
                                xrPicBox.Parent = xrPicCell1

                                xrPicCell1.Controls.Add(xrPicBox)
                            Else
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0
                            End If
                        End With


                        With xrPicCell2
                            .Font = fntRegular
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                            .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                            .Text = AllergensEu & " (" & cLang.GetString(173779) & ")"
                            .Width = 500
                        End With

                        xrPicRow.Width = 520
                        xrPicRow.Cells.AddRange({xrPicCell1, xrPicCell2})

                        xrPicTable.Rows.Add(xrPicRow)
                        .Detail.Controls.Add(xrPicTable)

                        xrPicRow = New XRTableRow
                        xrPicCell1 = New XRTableCell
                        xrPicCell2 = New XRTableCell
                        Dim xrPicBox1 As New XRPictureBox
                        With xrPicCell1
                            .Size = New System.Drawing.Size(intPicWidth, intPicHeight)
                            .CanGrow = False
                            .CanShrink = False
                            .Width = 20
                            If Not recipeImg = "" And UrlFileExists(recipeImg) Then
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0

                                xrPicBox1.Size = New System.Drawing.Size(CInt(intPicWidth - 2), CInt(intPicHeight - 2))
                                xrPicBox1.Location = New Point(5, 4)
                                xrPicBox1.Borders = DevExpress.XtraPrinting.BorderSide.None
                                xrPicBox1.Image = LoadImageFromUrl(recipeImg) 'Image.FromFile(recipeImg)
                                xrPicBox1.Sizing = ImageSizeMode.ZoomImage
                                xrPicBox1.Parent = xrPicCell1

                                xrPicCell1.Controls.Add(xrPicBox1)
                            Else
                                .Borders = DevExpress.XtraPrinting.BorderSide.None
                                .BorderWidth = 0
                            End If
                        End With


                        With xrPicCell2
                            .Font = fntRegular
                            .Borders = DevExpress.XtraPrinting.BorderSide.None
                            .BorderWidth = 0
                            .TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft
                            .Text = AllergensSw & " (" & cLang.GetString(173780) & ")"
                            .Width = 500
                        End With

                        xrPicRow.Width = 520
                        xrPicRow.Cells.AddRange({xrPicCell1, xrPicCell2})

                    End If



                    xrPicTable.Rows.Add(xrPicRow)
                    .Detail.Controls.Add(xrPicTable)

                Else
                    '' ucDLAllergen.Visible = False
                End If
                '' Else
                ''ucDLAllergen.Visible = False
                'xrPicTable.Dispose()
                'xrPicRow.Dispose()
                'xrPicCell1.Dispose()
                'dtAllergensEu.Dispose()
                'dtAllergenSwContain.Dispose()
                'dtAllergenSwTrace.Dispose()
            End If


            '' intTextHeight = ReportingTextUtils.MeasureText(strAllergens, fntRegular, intAvailableWidth, sf, Me.Padding).Height
            '' .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strAllergens, fntRegular, intNewX + 12, intNewY, CInt(intAvailableWidth), intTextHeight, DevExpress.XtraPrinting.TextAlignment.TopLeft, True)})


            intNewY += GetLineSpace(intTextHeight)


        End With
    End Sub

    Private Sub SplitNote(ByVal strNote As String, ByVal intAW As Integer, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment,
                          Optional ByVal cSeparator As Char = vbCrLf, Optional ByVal blnNumber As Boolean = False)
        Dim x As Integer = 2
        Dim intDetailheight As Integer

        With Me
            intDetailheight = .Detail.Height
            Dim intLineSpace As Integer = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
            intLineSpace = CInt(GetLineSpace(intLineSpace * 3 / 5))

            'strNote = strNote.Replace(Chr(10), "")
            Dim arr() As String = strNote.Split(cSeparator)

            Dim i As Integer = 0
            If Not blnNumber Then
                While i < arr.Length
                    If arr(i).Trim.Length > 0 Then
                        strNote = arr(i)
                        sf = New StringFormat(StringFormatFlags.NoClip)
                        'intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = fctGetHighest(strNote, intTextHeight, intAW + 10, fntRegular, sf)

                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNote, fntRegular, intCX, intCY, intAW, intTextHeight, align, True, , True, , , , , , False)})
                        intCY += GetLineSpace(intTextHeight)
                    Else
                        intCY += intLineSpace
                    End If
                    i += 1
                End While
            Else
                sf = New StringFormat(StringFormatFlags.NoClip)
                While i < arr.Length
                    If arr(i).Trim.Length > 0 Then
                        intCX = 0

                        strNote = CStr(i + 1) & ". "
                        'intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, 35, sf, Me.Padding).Height
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = fctGetHighest(strNote, intTextHeight, intAW + 10, fntRegular, sf)


                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strNote, fntRegular, Color.FromArgb(38, 38, 38), Color.Transparent, intCX, intCY, 35, intTextHeight, align, False, , True)})
                        intCX += 35

                        strNote = arr(i).Trim
                        intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, intAW - 35, sf, Me.Padding).Height
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strNote, fntRegular, Color.FromArgb(38, 38, 38), Color.Transparent, intCX, intCY, intAW - 35, intTextHeight, align, True, True, False)})
                        intCY += intTextHeight
                    End If
                    i += 1
                End While
            End If

        End With
    End Sub

    Private Sub SplitNote2(ByVal strNote As String, ByVal intAW As Integer, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment)
        Dim x As Integer = 2
        Dim intY As Integer = 0
        Dim intX As Integer = 0
        With Me
            sf = New StringFormat(StringFormatFlags.NoClip)

            strNote = strNote.Replace(Chr(10), "")
            Dim arr() As String = strNote.Split(vbCrLf)
            Dim intPrevPage As Integer = 0

            Dim i As Integer = 0
            While i < arr.Length
                If arr(i).Trim.Length > 0 Then
                    strNote = arr(i)
                    intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, intAW, sf, Me.Padding).Height
                    .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNote, fntRegular, intCX, intCY, intAW, intTextHeight, align, , , True, , , , True, , False)})
                    intCY += GetLineSpace(intTextHeight)

                    If Not i = arr.Length Then
                        If CInt(intCY \ 700) <> intPrevPage Then
                            '.Detail.PageBreak = PageBreak.AfterBand
                            intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                            intCY += GetLineSpace(intTextHeight)
                            intPrevPage = CInt(intCY / 700)
                        End If
                    End If
                End If
                i += 1
            End While
            'intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
            '.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("", fntRegular, intCX, intCY, intAW, intTextHeight, align, , , True, , , , , , False)})
            'intNewY += intTextHeight
        End With
    End Sub

    Private Sub SplitNote3(ByVal strNote As String, ByVal intAW As Integer, ByVal intCX As Integer,
                           ByRef intCY As Integer, ByVal align As TextAlignment, ByVal fntFont As Font,
                           ByVal TextColor As Color, ByVal BackColor As Color) 'VRP 04.07.2008

        Dim x As Integer = 2
        Dim intDetailheight As Integer

        With Me
            intDetailheight = .Detail.Height
            Dim intLineSpace As Integer = ReportingTextUtils.MeasureText("A", fntFont, intAW, sf, Me.Padding).Height
            intLineSpace = CInt(GetLineSpace(intLineSpace * 3 / 5))

            strNote = strNote.Replace(Chr(10), "")
            Dim arr() As String = strNote.Split(vbCrLf)

            Dim i As Integer = 0
            While i < arr.Length
                If arr(i).Trim.Length > 0 Then
                    strNote = arr(i)
                    sf = New StringFormat(StringFormatFlags.NoClip)
                    intTextHeight = ReportingTextUtils.MeasureText("A", fntFont, intAW, sf, Me.Padding).Height
                    intTextHeight = fctGetHighest(strNote, intTextHeight, intAW, fntFont, sf)

                    .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strNote, fntFont, TextColor, BackColor, intCX, intCY, intAW, intTextHeight, align, True, True)})
                    intCY += GetLineSpace(intTextHeight)
                Else
                    intCY += intLineSpace
                End If
                i += 1
            End While
        End With
    End Sub

    Private Sub PrintNote(ByVal foundPreparation() As DataRow, ByVal intAW As Integer, ByVal intCX As Integer, ByRef intCY As Integer, ByVal align As TextAlignment,
                          Optional ByVal cSeparator As Char = vbCrLf, Optional ByVal blnNumber As Boolean = False)
        Dim x As Integer = 2
        Dim intDetailheight As Integer

        With Me
            intDetailheight = .Detail.Height
            Dim intLineSpace As Integer = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
            intLineSpace = CInt(GetLineSpace(intLineSpace * 3 / 5))

            'strNote = strNote.Replace(Chr(10), "")
            Dim arr() As String  '= strNote.Split(cSeparator)

            ReDim arr(foundPreparation.Count - 1)
            For ctr As Integer = 0 To foundPreparation.GetUpperBound(0)
                arr(ctr) = foundPreparation(ctr).Item(2)
            Next

            Dim strNote As String = ""

            Dim i As Integer = 0
            If Not blnNumber Then
                While i < arr.Length
                    If arr(i).Trim.Length > 0 Then
                        strNote = arr(i)
                        sf = New StringFormat(StringFormatFlags.NoClip)
                        'intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = fctGetHighest(strNote, intTextHeight, intAW + 10, fntRegular, sf)

                        .Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel(strNote, fntRegular, intCX, intCY, intAW, intTextHeight, align, True, , True, , , , , , False)})
                        intCY += GetLineSpace(intTextHeight)
                    Else
                        intCY += intLineSpace
                    End If
                    i += 1
                End While
            Else
                sf = New StringFormat(StringFormatFlags.NoClip)
                While i < arr.Length
                    If arr(i).Trim.Length > 0 Then
                        intCX = 0

                        strNote = CStr(i + 1) & ". "
                        'intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, 35, sf, Me.Padding).Height
                        intTextHeight = ReportingTextUtils.MeasureText("A", fntRegular, intAW, sf, Me.Padding).Height
                        intTextHeight = fctGetHighest(strNote, intTextHeight, intAW + 10, fntRegular, sf)


                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strNote, fntRegular, Color.FromArgb(38, 38, 38), Color.Transparent, intCX, intCY, 35, intTextHeight, align, False, , True)})
                        intCX += 35

                        strNote = arr(i).Trim
                        intTextHeight = ReportingTextUtils.MeasureText(strNote, fntRegular, intAW - 35, sf, Me.Padding).Height
                        .Detail.Controls.AddRange(New XRControl() {fctMakeXrLabel2(strNote, fntRegular, Color.FromArgb(38, 38, 38), Color.Transparent, intCX, intCY, intAW - 35, intTextHeight, align, True, True, False)})
                        intCY += intTextHeight
                    End If
                    i += 1
                End While
            End If

        End With
    End Sub

    Sub GetChild(ByVal dtKey As DataTable, ByVal intCurrentKey As Integer)
        If dtKey.Select("[parent]=" & intCurrentKey).Length > 0 Then
            Dim arwKey As DataRow() = dtKey.Select("[parent]=" & intCurrentKey)
            For i As Integer = 0 To arwKey.GetUpperBound(0)
                intNewX = arwKey(i)("indent") * 20
                intNewY += GetLineSpace(intTextHeight)
                Me.Detail.Controls.AddRange(New XRControl() {fctMakeXRLabel("> " & arwKey(i)("name"), fntRegular2, intNewX, intNewY, intAvailableWidth, intTextHeight, DevExpress.XtraPrinting.TextAlignment.MiddleLeft)})
                GetChild(dtKey, arwKey(i)("codeKey"))
            Next
        End If
    End Sub

    Private Function fctGetGDAPanel(ByVal intPosX As Integer, ByVal intPosY As Integer, ByVal intWidth As Integer, ByVal intHeight As Integer, ByVal arrNutrientNames As ArrayList, ByVal intCodeTrans As Integer, Optional ByVal bGDAEnergyOnly As Boolean = False) As XRPanel
        Dim fntGDATitle As New Font("arial", 5.0!, FontStyle.Regular)
        Dim intCellAllowance As Integer
        If intHeight = 70 Then
            fntGDATitle = New Font("arial", 5.0!, FontStyle.Regular)
            intCellAllowance = 40
        ElseIf intHeight > 70 Then
            intCellAllowance = 60
            fntGDATitle = New Font("arial", 8.0!, FontStyle.Regular)
        End If
        Dim intTitleHeight As Integer = MeasureText("A", fntGDATitle, 1000, New StringFormat(StringFormatFlags.NoClip), Me.Padding).Height
        Dim intCellHeight As Double = intHeight - (intTitleHeight * 2)
        Dim intCellWidth As Double = intCellHeight * 0.7

        Dim GDAPanel As New XRPanel
        Dim cLang As New clsEGSLanguage(G_ReportOptions.intPageLanguage)
        Dim strHead1, strHead2 As String

        With GDAPanel
            .Size = New System.Drawing.Point(intWidth, intHeight)
            .Location = New System.Drawing.Point(intPosX, intPosY)
            '.Borders = DevExpress.XtraPrinting.BorderSide.All
            Dim strPercentage As String
            Dim strHeading As String
            If bGDAEnergyOnly Then
                If CDblDB(G_Nutrient(1).GDA) > 0 Then
                    If (CDblDB(L_Nutrient(1).Value) / CDblDB(G_Nutrient(1).GDA)) * 100 < 1 Then
                        strPercentage = "<1%"
                    Else
                        strPercentage = CStrDB(Format((CDblDB(L_Nutrient(1).Value) / CDblDB(G_Nutrient(1).GDA)) * 100, "0")) & "%"
                    End If
                Else
                    strPercentage = "NA"
                End If
                Select Case intCodeTrans
                    Case 1 : strHead1 = "par portion"
                        strHead2 = "de GDA d'un adulte"
                    Case 2 : strHead1 = "per serving"
                        strHead2 = "of an adult's GDA"
                    Case 3 : strHead1 = "pro portion"
                        strHead2 = "der GDA"

                End Select
                .Controls.AddRange(New XRControl() {fctGetGDAImagePanel(intCellWidth, intCellHeight, intCellAllowance / 2, intTitleHeight, arrNutrientNames(0), strPercentage, fntGDATitle)})
                '.Controls.AddRange(New XRControl() {fctMakeXRLabel("perServing", fntGDATitle, 0, 0, intCellWidth + intCellAllowance, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                '.Controls.AddRange(New XRControl() {fctMakeXRLabel("of an adult's GDA", fntGDATitle, 0, intTitleHeight + intCellHeight, intCellWidth + intCellAllowance, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                .Controls.AddRange(New XRControl() {fctMakeXRLabel(strHead1, fntGDATitle, 0, 0, intCellWidth + intCellAllowance, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                .Controls.AddRange(New XRControl() {fctMakeXRLabel(strHead2, fntGDATitle, 0, intTitleHeight + intCellHeight, intCellWidth + intCellAllowance, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            Else
                For ctr As Integer = 0 To 4

                    Dim strX As String = G_Nutrient(ctr + 1).Name

                    If CDblDB(G_Nutrient(ctr + 1).GDA) > 0 Then
                        If (CDblDB(L_Nutrient(ctr + 1).Value) / CDblDB(G_Nutrient(ctr + 1).GDA)) * 100 < 1 Then
                            strPercentage = "<1%"
                        Else
                            strPercentage = CStrDB(Format((CDblDB(L_Nutrient(ctr + 1).Value) / CDblDB(G_Nutrient(ctr + 1).GDA)) * 100, "0")) & "%"
                        End If
                    Else
                        strPercentage = "NA"
                    End If
                    If ctr = 0 Then
                        strPercentage = Format(CDblDB(L_Nutrient(ctr + 1).Value), CStrDB(L_Nutrient(ctr + 1).Format)) & CStrDB(G_Nutrient(ctr + 1).Unit) & vbCrLf & Format(CDblDB(L_Nutrient(ctr + 1).Value) / ENERGYFACTOR, "0.0") & "kcal" & vbCrLf & strPercentage
                    Else
                        strPercentage = Format(CDblDB(L_Nutrient(ctr + 1).Value), CStrDB(L_Nutrient(ctr + 1).Format)) & CStrDB(G_Nutrient(ctr + 1).Unit) & vbCrLf & strPercentage
                    End If

                    strHeading = arrNutrientNames(ctr) '& " " & Format(CDblDB(G_Nutrient(ctr + 1).GDA), CStrDB(G_Nutrient(ctr + 1).Format)) & CStrDB(G_Nutrient(ctr + 1).Unit)
                    If strHeading.IndexOf("Nahrun") > -1 Then
                        strHeading = "Nahrungs-" & vbCrLf & "fasern"
                    ElseIf strHeading = "Carbohydrates" Then
                        strHeading = "Carbo-" & vbCrLf & "hydrates"
                    ElseIf strHeading = "KH" Then
                        strHeading = "Kohlen-" & vbCrLf & "hydrate"
                    ElseIf strHeading = "Kohlenhydrate" Then
                        strHeading = "Kohlen-" & vbCrLf & "hydrate"
                    End If
                    .Controls.AddRange(New XRControl() {fctGetGDAImagePanel(intCellWidth, intCellHeight, ((intCellWidth + 3) * ctr), intTitleHeight, strHeading, strPercentage, fntGDATitle)})
                    If ctr = 0 Then
                        'If CDblDB(G_Nutrient(1).GDA) > 0 Then
                        '    If (CDblDB(L_Nutrient(1).Value) / CDblDB(G_Nutrient(1).GDA)) * 100 < 1 Then
                        '        strPercentage = "<1%"
                        '    Else
                        '        strPercentage = CStrDB(Format(((CDblDB(L_Nutrient(1).Value) / CDblDB(G_Nutrient(1).GDA)) / 0) * 100, "0")) & "%"
                        '    End If
                        'Else
                        '    strPercentage = "NA"
                        'End If
                    End If
                Next

                Select Case intCodeTrans
                    Case 1 : strHead1 = "1 portion contient"
                        strHead2 = "de l'apport moyen nutritionnel journalier"
                    Case 2 : strHead1 = "1 portion contains"
                        strHead2 = "of an adult's Guideline Daily Amount"
                    Case 3 : strHead1 = "1 Portion enthält"
                        strHead2 = "der empfohlenen Tagesmenge"

                End Select
                '.Controls.AddRange(New XRControl() {fctMakeXRLabel("Each portion contains", fntGDATitle, intWidth - (intCellWidth * 5), 0, intCellWidth * 5, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                '.Controls.AddRange(New XRControl() {fctMakeXRLabel("of an adult's Guideline Daily Amount", fntGDATitle, intWidth - (intCellWidth * 5), intTitleHeight + intCellHeight, intCellWidth * 5, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                .Controls.AddRange(New XRControl() {fctMakeXRLabel(strHead1, fntGDATitle, 0, 0, (intCellWidth + 3) * 5, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
                .Controls.AddRange(New XRControl() {fctMakeXRLabel(strHead2, fntGDATitle, 0, intTitleHeight + intCellHeight, intCellWidth * 5, intTitleHeight, DevExpress.XtraPrinting.TextAlignment.MiddleCenter)})
            End If

            '.Controls.AddRange(New XRControl() {fctGetGDAImagePanel(intCellWidth, intCellHeight, 0, 0, G_Nutrient(1).Name, G_Nutrient(1).Value, G_Nutrient(1).Unit)})


        End With

        Return GDAPanel
    End Function

    Private Function fctGetGDAImagePanel(ByVal intWidth As Integer, ByVal intHeight As Integer, ByVal intPosX As Integer, ByVal intPosY As Integer, ByVal strHeading As String, ByVal strValue As String, ByVal fntGDA As Font) As XRPanel

        Dim xrImagePanel As New XRPanel
        Dim xrImageTable As New XRTable
        Dim xrRowTop, xrRowMid, xrRowBot As New XRTableRow
        Dim xrCellTop, xrCellMid, xrCellBot As New XRTableCell
        Dim strImageTop As String = AppDomain.CurrentDomain.BaseDirectory & "\images\GDA-top-nofill.png"
        Dim strImageMid As String = AppDomain.CurrentDomain.BaseDirectory & "\images\GDA-mid-nofill.png"
        Dim strImageBot As String = AppDomain.CurrentDomain.BaseDirectory & "\images\GDA-bot-nofill.png"
        Dim intLabelHeightMultiplier As Integer

        If fntGDA.Size > 4.0! Then
            intLabelHeightMultiplier = 3
        Else
            intLabelHeightMultiplier = 2
        End If

        Dim fntGDAName As New Font(fntGDA.FontFamily, fntGDA.Size, FontStyle.Regular)
        With xrImagePanel
            .Height = intHeight
            .Width = intWidth + 2
            .Location = New System.Drawing.Point(intPosX, intPosY)
            With xrImageTable
                .Width = xrImagePanel.Width
                With xrRowTop
                    .Height = intHeight * 0.18
                    .Width = xrImagePanel.Width
                    With xrCellTop
                        .Height = intHeight * 0.18
                        .Controls.AddRange(New XRControl() {fctMakePictureBox(strImageTop, 0, 0, intWidth, intHeight * 0.18, False)})
                    End With
                    .Controls.AddRange(New XRControl() {xrCellTop})
                End With
                .Controls.AddRange(New XRControl() {xrRowTop})
                With xrRowMid
                    .Height = intHeight * 0.4
                    .Width = xrImagePanel.Width
                    With xrCellMid
                        .Height = intHeight * 0.4
                        Dim xrBG As XRPictureBox = fctMakePictureBox(strImageMid, 0, 0, intWidth, intHeight * 0.4, False)


                        .Controls.AddRange(New XRControl() {xrBG})
                        .Controls.AddRange(New XRControl() {fctMakeXRLabel(strHeading, fntGDAName, 0, 0, intWidth, intHeight * 0.4, DevExpress.XtraPrinting.TextAlignment.TopCenter, True, DevExpress.XtraPrinting.BorderSide.None, False, False, , , , , True)})
                        xrBG.SendToBack()
                    End With
                    .Controls.AddRange(New XRControl() {xrCellMid})
                End With
                .Controls.AddRange(New XRControl() {xrRowMid})
                With xrRowBot
                    .Height = intHeight * 0.44
                    .Width = xrImagePanel.Width
                    With xrCellBot
                        .Height = intHeight * 0.44
                        Dim xrBotBG As XRPictureBox = fctMakePictureBox(strImageBot, 0, 0, intWidth, intHeight * 0.44, False)
                        .Controls.AddRange(New XRControl() {xrBotBG})
                        .Controls.AddRange(New XRControl() {fctMakeXRLabel(strValue, fntGDAName, 0, 0, intWidth - 2, intHeight * 0.47, DevExpress.XtraPrinting.TextAlignment.TopCenter, True, DevExpress.XtraPrinting.BorderSide.None, False, False, , , , , False)})
                        xrBotBG.SendToBack()
                    End With
                    .Controls.AddRange(New XRControl() {xrCellBot})
                End With
                .Controls.AddRange(New XRControl() {xrRowBot})
            End With
            .Controls.AddRange(New XRControl() {xrImageTable})
        End With

        Return xrImagePanel
    End Function

    Private Function TrimData(strData As String) As String
        Dim blTrimmed As Boolean = True
        Dim str2Enter As String = Chr(13) & Chr(13)
        Dim str2Enter1 As String = Chr(10) & Chr(10)
        Dim str2Enter2 As String = Chr(13) & Chr(10) & Chr(13) & Chr(10)
        blTrimmed = True
        While blTrimmed = True
            blTrimmed = False
            If strData.IndexOf("  ") > 0 Then
                blTrimmed = True
            End If
            strData = strData.Replace("  ", " ")
        End While

        blTrimmed = True
        While blTrimmed = True

            blTrimmed = False
            If strData.IndexOf(str2Enter2) > 0 Then
                blTrimmed = True
            End If
            strData = strData.Replace(str2Enter2, Chr(13) & Chr(10))
        End While

        Return strData
    End Function

#End Region

#Region " Functions "

    Function fctGetHighest(ByVal strText As String, ByVal intTxtHt As Integer, ByVal intWidest As Integer, ByVal fntFont As Font, ByVal strFmt As StringFormat) As Integer
        Dim intHeight As Integer
        sf = New StringFormat(StringFormatFlags.NoClip)
        With Me
            intHeight = ReportingTextUtils.MeasureText(strText, fntFont, intWidest, sf, Me.Padding).Height
            If intTxtHt < intHeight Then 'FTB(1450)
                Return intHeight
            Else
                Return intTxtHt
            End If
        End With
    End Function

    Function fctMakeLine(ByVal intX As Integer, ByVal intY As Integer, ByVal intWidth As Integer, ByVal intLineWidth As Integer,
                         Optional ByVal intHeight As Integer = 9, Optional ByVal xrLineDirection As LineDirection = LineDirection.Horizontal,
                         Optional ByVal isVisible As Boolean = False, Optional ByVal xrLineStyle As Integer = Drawing2D.DashStyle.Solid) As XRLine
        Dim XRLine As New XRLine

        With XRLine
            .LineDirection = xrLineDirection
            .Location = New System.Drawing.Point(intX, intY)
            .Name = "xrLine1"
            .Size = New System.Drawing.Size(intWidth, intHeight)
            .LineStyle = xrLineStyle
            .LineWidth = intLineWidth
            If G_ReportOptions.flagNoLines Then 'DLS Sept142007
                XRLine.Visible = False
            End If
            If isVisible Then XRLine.Visible = isVisible 'VRP 03.06.2008
        End With
        Return XRLine
    End Function

    Function fctMakeXrLine(ByVal intX As Integer, ByVal intY As Integer,
                           ByVal intWidth As Integer, ByVal intHeight As Integer,
                           ByVal clrLine As Color, ByVal intLineWidth As Integer,
                           Optional ByVal blnVisible As Boolean = True,
                           Optional ByVal xrLineDirection As LineDirection = LineDirection.Horizontal,
                           Optional ByVal xrLineStyle As Integer = Drawing2D.DashStyle.Solid) As XRLine

        Dim xrLine As New XRLine
        With xrLine
            .Location = New System.Drawing.Point(intX, intY)
            .Size = New System.Drawing.Size(intWidth, intHeight)
            .ForeColor = clrLine
            .LineDirection = xrLineDirection
            .LineStyle = xrLineStyle
            .LineWidth = intLineWidth
            .Visible = blnVisible
        End With
        Return xrLine
    End Function

    Function fctMakePictureBox(ByVal strFileName As String, ByVal intX As Integer, ByVal intY As Integer, ByVal intPicWidth As Integer, ByVal intPicHeight As Integer, Optional ByVal bResizetoFit As Boolean = True) As XRPictureBox
        Dim XRPic As New XRPictureBox
        Dim H1 As Long
        Dim W1 As Long
        Dim Aspect As Double
        Dim dblTempH As Double
        Dim dblTempW As Double

        fctMakePictureBox = Nothing
        With XRPic
            .Image = LoadImageFromUrl(strFileName) 'Image.FromFile(strFileName)
            .Location = New System.Drawing.Point(intX, intY)
            .Name = "XrPictureBox1"
            ' RDC 04.18.2013 - Removed
            '.Sizing = ImageSizeMode.StretchImage
            ' RDC 04.18.2013 - CWM-5320 : Print Details - Rectangle image appears as square in print output Fix
            .Sizing = ImageSizeMode.ZoomImage
            .Size = New System.Drawing.Size(intPicWidth, intPicHeight)
            If bResizetoFit Then
                H1 = intPicHeight
                W1 = intPicWidth

                Aspect = .Image.Height / .Image.Width

                If .Image.Height > .Image.Width Then
                    dblTempH = CDbl(H1)
                    dblTempW = dblTempH / Aspect
                Else
                    dblTempW = CDbl(W1)
                    'ADR 04.26.11 - to prevent report distortion when height is much lesser than the width
                    'dblTempH = dblTempW * Aspect 
                    dblTempH = dblTempW
                End If

                Do While (dblTempW > CDbl(W1) Or dblTempH > CDbl(H1))
                    dblTempW = (dblTempW * 0.999)
                    dblTempH = (dblTempH * 0.999)
                Loop

                G_dblMaxWidthPicture = CLng(dblTempW)
                G_dblMaxHeightPicture = CLng(dblTempH)
                ' RDC 04.18.2013 - Removed
                '.Sizing = ImageSizeMode.StretchImage
                ' RDC 04.18.2013 - CWM-5320 : Print Details - Rectangle image appears as square in print output Fix
                .Sizing = ImageSizeMode.ZoomImage
                .Size = New System.Drawing.Size(G_dblMaxWidthPicture, G_dblMaxHeightPicture)
                .CanGrow = True

            Else
                .Sizing = ImageSizeMode.StretchImage

                .Size = New System.Drawing.Size(intPicWidth, intPicHeight)
            End If
            'mcm 01.24.05---------------------------------------

            '-------------------------------------

        End With
        Return XRPic
    End Function

    Function fctMakeXrPanel(ByVal intX As Integer, ByVal intY As Integer, ByVal intWidth As Integer, ByVal strName As String,
                            Optional ByVal intHeight As Integer = -1, Optional ByVal blnWithBackColor As Boolean = False) 'VRP 05.06.2008
        Dim xrPanel As New XRPanel
        With xrPanel
            .KeepTogether = True
            .Location = New System.Drawing.Point(intX, intY)
            .Width = intWidth
            .Name = strName
            '.Size = New Size(intWidth ,)
            '.CanShrink = True
            .CanGrow = True
            If Not intHeight = -1 Then .Height = intHeight

            If blnWithBackColor = True Then
                .BackColor = Color.WhiteSmoke  '"224, 224, 224"
            End If
        End With
        Return xrPanel
    End Function

    'Function fctMakeXrTable(ByVal intX As Integer, ByVal intY As Integer, ByVal intWidth As Integer, ByVal strName As String, _
    '                       Optional ByVal intHeight As Integer = -1, Optional ByVal blnWithBackColor As Boolean = False) 'VRP 05.06.2008
    '    Dim xrTable As New XRTable
    '    With xrTable
    '        .KeepTogether = True
    '        .Location = New System.Drawing.Point(intX, intY)
    '        .Width = intWidth
    '        .Name = strName


    '        If Not intHeight = -1 Then .Height = intHeight
    '        If blnWithBackColor = True Then
    '            .BackColor = Color.LightGray
    '        End If
    '    End With
    '    Return xrTable
    'End Function

    Public Function fctGetMaxHeight(ByVal strText As String, ByVal intWeight As Integer, ByVal fontsize As Single, ByVal fontname As String, ByVal font As Font, ByVal bUsedBold As Boolean) As Single
        Dim lb As New Label
        Dim StrToMeasure As String
        Dim FontUsed As Font = font

        Dim g As Graphics
        Dim StrSize As New SizeF
        Dim b As Bitmap
        b = New Bitmap(1, 1, PixelFormat.Format32bppArgb)
        g = Graphics.FromImage(b)
        StrToMeasure = strText

        If bUsedBold Then
            FontUsed = New Font(fontname, fontsize, FontStyle.Bold)
        Else
            FontUsed = New Font(fontname, fontsize, FontStyle.Regular)
        End If
        StrSize = g.MeasureString(StrToMeasure, FontUsed, intWeight)

        Return StrSize.Height
        g.Dispose()
        b.Dispose()
    End Function

    'Get Widest column space occupied
    Function fctGetWidest(ByVal strText As String, ByVal intTxtHt As Integer, ByVal intWidest As Integer, ByVal fntFont As Font) As Integer
        Dim intWidth As Integer
        With Me

            sf = New StringFormat(StringFormatFlags.DirectionVertical)

            intWidth = ReportingTextUtils.MeasureText(strText, fntFont, intTxtHt, sf, Me.Padding).Height - 5
            If intWidest < intWidth Then 'FTB(1450)
                Return intWidth
            Else
                Return intWidest
            End If
        End With
    End Function

    Function GetLineSpace(ByVal intTextHeight As Integer) As Double
        Select Case G_ReportOptions.dblLineSpace
            Case 1
                Return intTextHeight
            Case Is < 1
                Return intTextHeight * G_ReportOptions.dblLineSpace
            Case Is > 1
                Return intTextHeight + ReportingTextUtils.MeasureText("A", fntRegular, 1, sf, Me.Padding).Height * (G_ReportOptions.dblLineSpace - 1)
        End Select
    End Function

    ' this was done for tibits "---"
    Function CheckLineOnlyString(ByVal str As String) As Boolean
        Dim arr() As Char = str.ToCharArray
        For i As Integer = 0 To arr.Length - 1
            If CStr(arr(i)).Trim.Length > 0 And arr(i) <> "-" Then
                Return False
            End If
        Next
        Return True
    End Function

    Private Function fctNullToZero(ByVal dblX As Object) As Double
        If IsDBNull(dblX) Then
            Return 0
        Else
            Return CDbl(dblX)
        End If
    End Function

    Private Function fctNullToString(ByVal strX As Object) As String
        If IsDBNull(strX) Then
            Return ""
        Else
            Return CStr(strX)
        End If
    End Function

    Private Function fctPluralPortionText(ByVal strText As String) As String
        If strText.ToLower = "person" Then
            If G_ReportOptions.intPageLanguage = 1 Then
                strText = "Persons"
            Else
                strText = cLang.GetString(clsEGSLanguage.CodeType.Servings)
            End If
        ElseIf strText.ToLower = "serving" Then
            If G_ReportOptions.intPageLanguage = 1 Then
                strText = "Servings"
            Else
                strText = cLang.GetString(clsEGSLanguage.CodeType.Servings)
            End If
        End If

        Return strText
    End Function

    Private Function CodeSiteCO(ByVal row As DataRow) As Integer 'VRP 08.01.2009 FOR NUTRIENT ONLY : RETURN CODESITE = 0 OR CODESITE
        If G_IsCalcmenuOnline = True Then
            Return CType(row("CodeSite"), Integer)
        Else
            Return 0
        End If
    End Function

    ' RDC 05.16.2013 - Function for creating Section header using devexpress xrTable Control
    ''' <summary>
    '''  Create a section header using XRTable control
    ''' </summary>
    ''' <param name="strSectionText"> String: Text to be displayed as the Section header </param>
    ''' <param name="intXPosition"> Integer: Position of the Section header in the X ordinate</param>
    ''' <param name="intYPostion">Integer: Position of the Section header in the Y ordinate</param>
    ''' <param name="intTableWidth">Integer: Section width</param>
    ''' <param name="intTableRowHeight">Integer: Section Height </param>
    ''' <param name="blnHighlightSection">Boolean: Highlight the section header</param>
    ''' <param name="SectionTextAllign">TextAllignment: Section text allignment</param>
    ''' <returns>XRTable Control</returns>
    ''' <remarks>Created by RDC 05.16.2013</remarks>
    Private Function fctMakeSectionHeader(strSectionText As String, intXPosition As Integer, intYPostion As Integer, intTableWidth As Integer, _
                                          intTableRowHeight As Integer, blnHighlightSection As Boolean, _
                                          Optional SectionTextAllign As TextAlignment = DevExpress.XtraPrinting.TextAlignment.MiddleLeft) As XRTable
        Dim xTable As New XRTable
        Dim xTableRow As New XRTableRow
        Dim xTableCell As New XRTableCell

        xTable.Width = intTableWidth
        xTable.Location = New Point(intXPosition, intYPostion)
        xTableRow.Height = intTableRowHeight
        xTableRow.KeepTogether = False

        Select Case blnHighlightSection
            Case True
                xTable.Borders = DevExpress.XtraPrinting.BorderSide.Top
                xTable.BorderWidth = 1
                xTable.BorderColor = Color.Black
                xTable.BackColor = Color.LightGray
            Case False
                xTable.Borders = DevExpress.XtraPrinting.BorderSide.Bottom
                xTable.BorderWidth = 1
                xTable.BorderColor = Color.Black
                xTable.BackColor = Color.White
        End Select

        xTableCell.TextAlignment = SectionTextAllign
        xTableCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, FontStyle.Bold)
        xTableCell.Text = strSectionText.Trim
        xTableRow.Cells.Add(xTableCell)
        xTable.Rows.Add(xTableRow)

        Return xTable
    End Function
    ''' <summary>
    ''' Create data row using XRTableRow/XRTableCell
    ''' </summary>
    ''' <param name="arrCellText">String(): Set of values to be inserted in a the table cell</param>
    ''' <param name="arrCellWidth">Integer(): Set of values to be set on cell's width</param>
    ''' <param name="arrCellTextAllignment">TextAllignment(): Text ordering within the cell</param>
    ''' <param name="intCellBorder">BorderSide: Border style of the cell. Default is None.</param>
    ''' <returns>XRTableRow</returns>
    ''' <remarks>Created by RDC 05.16.2013</remarks>
    Private Function fctMakeDataRow(arrCellText() As String, arrCellWidth() As Integer, arrCellTextAllignment() As TextAlignment, _
                                    Optional intCellBorder As BorderSide = DevExpress.XtraPrinting.BorderSide.None, Optional fntFontType As FontStyle = FontStyle.Regular, _
                                    Optional intRowHeight As Integer = 0) As XRTableRow
        Dim xTableRow As New XRTableRow
        Dim xTableCell As New XRTableCell

        If intRowHeight > 0 Then xTableRow.Height = intRowHeight Else xTableRow.Height = G_ReportOptions.sgFontSize2
        xTableRow.Width = intAvailableWidth

        If arrCellText.Count = arrCellWidth.Count And arrCellText.Count = arrCellTextAllignment.Count And arrCellText.Count = arrCellWidth.Count Then
            For intCellPos As Integer = 0 To arrCellText.Count - 1 Step 1

                'Dim strhtml As String
                'With G_ReportOptions
                '    Dim str As String = intCellPos
                '    str = str.Replace("<b>", "\b ")
                '    str = str.Replace("</b>", "\b0")
                '    str = str.Replace("<p>", "")
                '    str = str.Replace("</p>", "")
                '    str = str.Replace("<br>", "")
                '    str = str.Replace("<i>", "\i ")
                '    str = str.Replace("</i>", "\i0")
                '    str = str.Replace("{", "")
                '    str = str.Replace("}", "")
                '    str = str.Replace("<div>", "\line \div ")
                '    str = str.Replace("</div>", "\line \div0 ")
                '    str = str.Replace("&nbsp;", " ")
                '    intCellPos = ParseHtmlToRTF(str)
                'End With

                xTableCell = New XRTableCell
                xTableCell.Font = New Font(G_ReportOptions.strFontName2, G_ReportOptions.sgFontSize2, fntFontType)
                xTableCell.TextAlignment = arrCellTextAllignment(intCellPos)
                xTableCell.Width = CInt(arrCellWidth(intCellPos))
                If intRowHeight > 0 Then xTableCell.Height = intRowHeight
                xTableCell.Borders = CType(intCellBorder, DevExpress.XtraPrinting.BorderSide)
                xTableCell.BorderWidth = 1
                xTableCell.Text = arrCellText(intCellPos).ToString.Trim
                xTableRow.Cells.Add(xTableCell)
            Next
        Else
            xTableCell.TextAlignment = arrCellTextAllignment(0)
            xTableCell.Width = arrCellWidth(0)
            xTableCell.Borders = intCellBorder
            xTableRow.Cells.Add(xTableCell)
        End If

        Return xTableRow
    End Function


    Public Enum NutrientDisplayOption As Integer
        Calculated = 0
        Imposed = 1
        Both = 2
    End Enum

    ' RDC 08.06.2013 : New function for displaying computed and imposed nutrients
    ''' <summary>
    ''' 
    ''' </summary>
    ''' <param name="intCode">Integer : Item code</param>
    ''' <param name="intPlotX">Integer : Where to plot the control in the X axis</param>
    ''' <param name="intPlotY">Integer : Where to plot the control in the Y axis</param>
    ''' <param name="intNutrientSet">Optional Integer : Selected nutrient set (default 0)</param>
    ''' <param name="intCodeTrans">Optional Integer : Selected translation code (default 0)</param>
    ''' <param name="intDisplayOption">Optional NutrientDisplayOption : Option where user can display Calculated or Imposed nutrient or both.</param>
    ''' <remarks>Created for Nutrient Set requirement</remarks>
    Sub subDisplayNutrientComputation(intCode As Integer, strYieldUnit As String, Optional intNutrientSet As Integer = 0, Optional intCodeTrans As Integer = 1, Optional intDisplayOption As NutrientDisplayOption = NutrientDisplayOption.Calculated, Optional intCodeSetPrice As Integer = 1, Optional intVersion As Integer = 1, Optional ByVal userLocale As String = "en-US")
        Dim xrNutrientTable As New XRTable
        Dim xrNutrientRow As XRTableRow
        Dim xrNutrientCell As XRTableCell

        Dim cn As New SqlConnection(G_strConnection)
        Dim dtNutInfo As New DataTable
        Dim dtNutValue As New DataTable
        Dim dtNutDetail As New DataTable
        Dim dtNutrients As New DataTable
        Dim dsNutrients As New DataSet

        ' Nutrient Information
        Dim strImpYieldUnit As String
        Dim strImpYieldUnit2 As String
        Dim strPortionSize As String
        Dim intImpType As Integer = 0
        Dim dblServingQty As Double = 0.0
        Dim dblServingQty2 As Double = 0.0
        Dim dblActualRecipeWt As Double = 0.0
        Dim strYieldQty As String = ""

        Dim userCulture As CultureInfo = New CultureInfo(userLocale)


        Try
            cn.Open()
            Dim daNutrient As New SqlDataAdapter("Exec sp_EgswDisplayCalculatedImposedNutrient @intItemCode=" & intCode & ", @intCodeTrans=" & intCodeTrans & ", @intNutrientSet=" & intNutrientSet & ",  @intCodeSetPrice=" & intCodeSetPrice & ", @intVersion= " & intVersion, cn)
            'daNutrient.FillSchema(dsNutrients, SchemaType.Source) RDC 09.06.2013 : Removed due to constraint error
            daNutrient.Fill(dsNutrients)

            dtNutInfo = dsNutrients.Tables(0)
            dtNutValue = dsNutrients.Tables(1)
            dtNutDetail = dsNutrients.Tables(2)
            dtNutrients = dsNutrients.Tables(3)
            cn.Close()


            For Each drInfo As DataRow In dtNutInfo.Rows
                intImpType = CIntDB(drInfo("ImposedType"))
                strImpYieldUnit = CStrDB(drInfo("YieldUnitDesc"))
                strImpYieldUnit2 = CStrDB(drInfo("YieldUnit2Desc"))
                strPortionSize = CStrDB(drInfo("PortionSize"))
                dblServingQty = CDblDB(drInfo("Yield"))
                dblServingQty2 = CDblDB(drInfo("Yield2"))
                dblActualRecipeWt = CDblDB(drInfo("ActualWtInGms"))
            Next

            Dim cNutrient As New clsNutrient(enumAppType.WebApp, G_strConnection)
            dblActualRecipeWt = cNutrient.GetRecipeNutrientFactor(intCode, intCodeSetPrice)
            If dblActualRecipeWt = 0 Then dblActualRecipeWt = 1

            ' RDC 09.12.2013 : Nutrient display fix
            Dim blnDisplayNutrient As Boolean
            For Each drNutValue As DataRow In dtNutValue.Rows
                'blnDisplayNutrient = CBoolDB(drNutValue("DisplayNutrition"))
                blnDisplayNutrient = True 'FOR CMC ALWAYS TRUE
            Next

            If Not blnDisplayNutrient Then Exit Sub

            Dim strImposedUnit As String = ""
            Select Case intImpType
                Case 1
                    strImposedUnit = strImpYieldUnit
                    If dblServingQty = 0 Then strYieldQty = "" Else strYieldQty = dblServingQty.ToString
                Case 2
                    strImposedUnit = strImpYieldUnit2
                    If dblServingQty2 = 0 Then strYieldQty = "" Else strYieldQty = dblServingQty2.ToString
                Case 4
                    strImposedUnit = strPortionSize
                Case Else
                    strImposedUnit = strImpYieldUnit
                    If dblServingQty = 0 Then strYieldQty = "" Else strYieldQty = dblServingQty.ToString
            End Select



            ' Plot Everything here
            Dim dblComputedValue() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim dblImposedValue() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                               0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim dblImposedValuePct() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                                  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim blnNutrientVisible() As Boolean = {False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False,
                                                   False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False}

            Dim dblComputedNutValPerServing As Double = 0.0
            Dim dblComputedNutValPer100gml As Double = 0.0

            For Each drNutVal As DataRow In dtNutValue.Rows
                For intNutPos As Integer = 0 To 41 Step 1
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1))) Then dblComputedValue(intNutPos) = drNutVal("N" & CStr(intNutPos + 1)) Else dblComputedValue(intNutPos) = 0.0
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1) & "impose")) Then dblImposedValue(intNutPos) = drNutVal("N" & CStr(intNutPos + 1) & "impose") Else dblImposedValue(intNutPos) = 0.0
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1) & "ImposePercent")) Then dblImposedValuePct(intNutPos) = drNutVal("N" & CStr(intNutPos + 1) & "ImposePercent") Else dblImposedValuePct(intNutPos) = 0.0
                    blnNutrientVisible(intNutPos) = CBoolDB(drNutVal("N" & CStr(intNutPos + 1) & "Display"))
                Next
            Next


            xrNutrientTable = New XRTable
            xrNutrientTable.Width = intAvailableWidth
            xrNutrientTable.Location = New Point(intNewX, intNewY)


            Select Case intDisplayOption
                Case NutrientDisplayOption.Calculated
                    xrNutrientRow = New XRTableRow
                    xrNutrientRow = fctMakeDataRow({Chr(32), cLang.GetString(clsEGSLanguage.CodeType.CalculatedNutrients) & " " & cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100).Replace("%Y", strYieldUnit), cLang.GetString(clsEGSLanguage.CodeType.CalculatedNutrients) & " " & cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent), Chr(32)}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2 + 5)
                    xrNutrientTable.Rows.Add(xrNutrientRow)
                    ' xrNutrientRow.Dispose()
                Case NutrientDisplayOption.Imposed

                    xrNutrientRow = New XRTableRow
                    xrNutrientRow = fctMakeDataRow({Chr(32), cLang.GetString(clsEGSLanguage.CodeType.ImposedNutrient) & " " & strYieldQty & " " & strImposedUnit, Chr(32)}, {CInt(150), CInt(150), CInt(intAvailableWidth - 300)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2 + 5)
                    xrNutrientTable.Rows.Add(xrNutrientRow)
                    ' xrNutrientRow.Dispose()
                Case NutrientDisplayOption.Both
                    xrNutrientRow = New XRTableRow
                    xrNutrientRow = fctMakeDataRow({Chr(32), cLang.GetString(clsEGSLanguage.CodeType.CalculatedNutrients) & " " & cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100).Replace("%Y", strYieldUnit), cLang.GetString(clsEGSLanguage.CodeType.CalculatedNutrients) & " " & cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent), cLang.GetString(clsEGSLanguage.CodeType.ImposedNutrient) & " " & strYieldQty & " " & strImposedUnit, Chr(32)}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2 + 5)
                    xrNutrientTable.Rows.Add(xrNutrientRow)
                    ' xrNutrientRow.Dispose()
            End Select
            Detail.Controls.Add(xrNutrientTable)
            intNewY += (xrNutrientTable.Height + 10)

            xrNutrientTable = New XRTable
            xrNutrientTable.Width = intAvailableWidth
            xrNutrientTable.Location = New Point(intNewX, intNewY)

            For Each drDetail As DataRow In dtNutrients.Rows
                xrNutrientRow = New XRTableRow
                xrNutrientRow.Height = CInt(G_ReportOptions.sgFontSize2)

                Dim intSelPos As Integer = CInt(drDetail("NutSequence"))
                Dim strValFormat As String = CStr(drDetail("Format"))

                Dim dblComputedPerServingAt100 As Double = CDblDB(dblComputedValue(intSelPos - 1))
                Dim dblComputedPer100gmlAt100 As Double = 0.0

                Dim dblPerServing As Double = 0.0
                Dim dblPer100gml As Double = 0.0

                Select Case intDisplayOption
                    Case NutrientDisplayOption.Calculated
                        If CBoolDB(blnNutrientVisible(intSelPos - 1)) Then
                            ' RDC 02.07.2014 : Fix for CWA-11496 : Recipe - Print Details - Zero values Calculated nutrients still displays in print output when recipe's Imposed nutrient have values and Calculated don't have.
                            Dim strPerServingValue As String = "", strPer100mgmlValue As String = ""

                            If intSelPos = 1 Then
                                Dim dblKjPerServing As Double = 0, dblKjPer100gml As Double = 0
                                Dim dblKcalPerServing As Double = 0, dblKcalPer100gml As Double = 0

                                ' RDC 09.09.2013 : CWM-8371 Fix
                                If dblComputedValue(intSelPos - 1) > 0 Then
                                    ' Energy Per serving kJ
                                    dblKjPerServing = dblComputedValue(intSelPos - 1) / dblServingQty
                                    dblKcalPerServing = dblKjPerServing / 4.184

                                    ' Energy Per 100 g/ml kcal
                                    dblKjPer100gml = dblKjPerServing / 10 '(100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty)
                                    dblKcalPer100gml = dblKcalPerServing / 10 'dblKjPer100gml / 4.184
                                End If

                                'JTOC 02.10.2014 Moved kcal before kj
                                '-----------------------------------------------------
                                If G_ReportOptions.intEnergyDisplay = 1 Then
                                    If dblKjPerServing > 0 And dblKjPer100gml > 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kJ"
                                        'strPer100mgmlValue = Format(dblKjPer100gml, strValFormat) & " kJ"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kJ"
                                        strPer100mgmlValue = dblKjPer100gml.ToString(strValFormat, userCulture) & " kJ"
                                    ElseIf dblKjPerServing > 0 And dblKjPer100gml = 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kJ"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kJ"
                                    ElseIf dblKjPerServing = 0 And dblKjPer100gml > 0 Then
                                        'strPer100mgmlValue = Format(dblKjPer100gml, strValFormat) & " kJ"
                                        strPer100mgmlValue = dblKjPer100gml.ToString(strValFormat, userCulture) & " kJ"
                                    Else
                                        strPerServingValue = "0 kJ"
                                        strPer100mgmlValue = "0 kJ"
                                    End If

                                    xrNutrientRow = New XRTableRow
                                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strPerServingValue, strPer100mgmlValue, " "}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    '---------------------------------------------------------
                                    If dblKcalPerServing > 0 And dblKcalPer100gml > 0 Then
                                        'strPerServingValue = Format(dblKcalPerServing, strValFormat) & " kcal"
                                        'strPer100mgmlValue = Format(dblKcalPer100gml, strValFormat) & " kcal"
                                        strPerServingValue = dblKcalPerServing.ToString(strValFormat, userCulture) & " kcal"
                                        strPer100mgmlValue = dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal"
                                    ElseIf dblKcalPerServing > 0 And dblKcalPer100gml = 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kcal"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kcal"
                                    ElseIf dblKcalPerServing = 0 And dblKcalPer100gml > 0 Then
                                        'strPer100mgmlValue = Format(dblKcalPer100gml, strValFormat) & " kcal"
                                        strPer100mgmlValue = dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal"
                                    Else
                                        strPerServingValue = "0 kcal"
                                        strPer100mgmlValue = "0 kcal"
                                    End If


                                    xrNutrientRow = fctMakeDataRow({" ", strPerServingValue, strPer100mgmlValue, " "}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                Else

                                    If dblKcalPerServing > 0 And dblKcalPer100gml > 0 Then
                                        'strPerServingValue = Format(dblKcalPerServing, strValFormat) & " kcal"
                                        'strPer100mgmlValue = Format(dblKcalPer100gml, strValFormat) & " kcal"
                                        strPerServingValue = dblKcalPerServing.ToString(strValFormat, userCulture) & " kcal"
                                        strPer100mgmlValue = dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal"
                                    ElseIf dblKcalPerServing > 0 And dblKcalPer100gml = 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kcal"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kcal"
                                    ElseIf dblKcalPerServing = 0 And dblKcalPer100gml > 0 Then
                                        'strPer100mgmlValue = Format(dblKcalPer100gml, strValFormat) & " kcal"
                                        strPer100mgmlValue = dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal"
                                    Else
                                        strPerServingValue = "0 kcal"
                                        strPer100mgmlValue = "0 kcal"
                                    End If

                                    xrNutrientRow = New XRTableRow
                                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strPerServingValue, strPer100mgmlValue, " "}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    '---------------------------------------------------------

                                    If dblKjPerServing > 0 And dblKjPer100gml > 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kJ"
                                        'strPer100mgmlValue = Format(dblKjPer100gml, strValFormat) & " kJ"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kJ"
                                        strPer100mgmlValue = dblKjPer100gml.ToString(strValFormat, userCulture) & " kJ"
                                    ElseIf dblKjPerServing > 0 And dblKjPer100gml = 0 Then
                                        'strPerServingValue = Format(dblKjPerServing, strValFormat) & " kJ"
                                        strPerServingValue = dblKjPerServing.ToString(strValFormat, userCulture) & " kJ"
                                    ElseIf dblKjPerServing = 0 And dblKjPer100gml > 0 Then
                                        'strPer100mgmlValue = Format(dblKjPer100gml, strValFormat) & " kJ"
                                        strPer100mgmlValue = dblKjPer100gml.ToString(strValFormat, userCulture) & " kJ"
                                    Else
                                        strPerServingValue = "0 kJ"
                                        strPer100mgmlValue = "0 kJ"
                                    End If

                                    xrNutrientRow = fctMakeDataRow({" ", strPerServingValue, strPer100mgmlValue, " "}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                End If



                            Else
                                Dim dblNutPerServing As Double = 0, dblNutPer100gml As Double = 0
                                ' RDC 09.09.2013 : CWM-8371 Fix
                                If dblComputedValue(intSelPos - 1) > 0 Then
                                    dblNutPerServing = dblComputedValue(intSelPos - 1) / dblServingQty
                                    dblNutPer100gml = dblNutPerServing / 10 '(100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty)
                                End If

                                'If dblNutPerServing = 0 And dblNutPer100gml > 0 Then
                                '    strPer100mgmlValue = Format(dblPer100gml, strValFormat) & " " & drDetail("Units")
                                'ElseIf dblNutPerServing > 0 And dblNutPer100gml = 0 Then
                                '    strPerServingValue = Format(dblPerServing, strValFormat) & " " & drDetail("Units")
                                'ElseIf dblNutPerServing > 0 And dblPer100gml > 0 Then
                                'strPerServingValue = Format(dblNutPerServing, strValFormat) & " " & drDetail("Units")
                                'strPer100mgmlValue = Format(dblNutPer100gml, strValFormat) & " " & drDetail("Units")
                                strPerServingValue = dblNutPerServing.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                                strPer100mgmlValue = dblNutPer100gml.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                                ''    Else
                                ''    strPerServingValue = ""
                                ''    strPer100mgmlValue = ""
                                ''End If

                                xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strPerServingValue, strPer100mgmlValue, " "}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter}, , , G_ReportOptions.sgFontSize2)
                            End If
                            xrNutrientTable.Rows.Add(xrNutrientRow)

                        End If
                    Case NutrientDisplayOption.Imposed
                        If CBoolDB(blnNutrientVisible(intSelPos - 1)) Then

                            Dim dblImposedNutPct As Double = dblImposedValuePct(intSelPos - 1)
                            Dim dblImposedNutVal As Double = dblImposedValue(intSelPos - 1)
                            Dim strValueToPrint As String = ""
                            Dim strValueToPrintKcal As String = ""
                            'strValueToPrintKcal = Format(ConvertKjtoKcal(dblImposedNutVal), strValFormat) + " kcal"
                            strValueToPrintKcal = ConvertKjtoKcal(dblImposedNutVal).ToString(strValFormat, userCulture) & " kcal"

                            'If Not dblImposedNutVal < 0 And dblImposedNutPct < 0 Then
                            '    strValueToPrint = Format(dblImposedNutVal, strValFormat) & " " & drDetail("Units")
                            'ElseIf dblImposedNutVal < 0 And Not dblImposedNutPct < 0 Then
                            '    strValueToPrint = dblImposedNutPct.ToString & "%"
                            'ElseIf Not dblImposedNutVal < 0 And Not dblImposedNutPct < 0 Then
                            '    strValueToPrint = dblImposedNutPct.ToString & "%"
                            'Else
                            '    strValueToPrint = ""
                            'End If

                            If dblImposedNutVal > 0 Then
                                'strValueToPrint = Format(dblImposedNutVal, strValFormat) & " " & drDetail("Units")
                                strValueToPrint = dblImposedNutVal.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                            Else
                                strValueToPrint = ""
                            End If

                            'AGL 2015.02.11
                            If G_ReportOptions.intEnergyDisplay = 1 Then
                                xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strValueToPrint, " "}, {CInt(150), CInt(150), CInt(intAvailableWidth - 300)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                xrNutrientTable.Rows.Add(xrNutrientRow)
                                If intSelPos = 1 And strValueToPrint <> "" Then
                                    xrNutrientRow = fctMakeDataRow({"", strValueToPrintKcal, " "}, {CInt(150), CInt(150), CInt(intAvailableWidth - 300)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                End If
                            Else
                                If intSelPos = 1 And strValueToPrint <> "" Then
                                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strValueToPrintKcal, " "}, {CInt(150), CInt(150), CInt(intAvailableWidth - 300)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                End If

                                xrNutrientRow = fctMakeDataRow({"", strValueToPrint, " "}, {CInt(150), CInt(150), CInt(intAvailableWidth - 300)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                xrNutrientTable.Rows.Add(xrNutrientRow)
                            End If

                        End If
                    Case NutrientDisplayOption.Both

                        If blnNutrientVisible(intSelPos - 1) Then

                            Dim dblImposedNutPct As Double = dblImposedValuePct(intSelPos - 1)
                            Dim dblImposedNutVal As Double = dblImposedValue(intSelPos - 1)
                            Dim strValueToPrint As String = ""
                            Dim strValueToPrintKcal As String = ""
                            'strValueToPrintKcal = Format(ConvertKjtoKcal(dblImposedNutVal), strValFormat) + " kcal"
                            strValueToPrintKcal = ConvertKjtoKcal(dblImposedNutVal).ToString(strValFormat, userCulture) & " kcal"

                            ' RDC 02.07.2014 : Fix for CWA-11496 : Recipe - Print Details - Zero values Calculated nutrients still displays in print output when recipe's Imposed nutrient have values and Calculated don't have.
                            Dim strPerServingValue As String = "", strPer100mgmlValue As String = ""

                            'If Not dblImposedNutVal < 0 And dblImposedNutPct < 0 Then
                            '    strValueToPrint = Format(dblImposedNutVal, strValFormat) & " " & drDetail("Units")
                            'ElseIf dblImposedNutVal < 0 And Not dblImposedNutPct < 0 Then
                            '    strValueToPrint = dblImposedNutPct.ToString & "%"
                            'ElseIf Not dblImposedNutVal < 0 And Not dblImposedNutPct < 0 Then
                            '    strValueToPrint = dblImposedNutPct.ToString & "%"
                            'Else
                            '    strValueToPrint = ""
                            'End If

                            If dblImposedNutVal > 0 Then
                                'strValueToPrint = Format(dblImposedNutVal, strValFormat) & " " & drDetail("Units")
                                strValueToPrint = dblImposedNutVal.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                            Else
                                strValueToPrint = ""
                            End If


                            If intSelPos = 1 Then
                                Dim dblKjPerServing As Double = 0, dblKjPer100gml As Double = 0
                                Dim dblKcalPerServing As Double = 0, dblKcalPer100gml As Double = 0

                                ' RDC 09.09.2013 : CWM-8371 Fix
                                If dblComputedValue(intSelPos - 1) > 0 Then
                                    ' Energy Per serving kJ
                                    dblKjPerServing = dblComputedValue(intSelPos - 1) / dblServingQty
                                    dblKcalPerServing = dblKjPerServing / 4.184

                                    ' Energy Per 100 g/ml kcal

                                    'dblKjPer100gml = (100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty) 'NBG 09.05.2016 'dblKjPerServing / 10 'LLG 05.14.2016 (100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty)
                                    dblKjPer100gml = dblComputedValue(intSelPos - 1) / dblServingQty / dblActualRecipeWt
                                    dblKcalPer100gml = dblKjPer100gml / 4.184 ' NBG 09.05.2016 dblKcalPerServing / 10 'dblKjPer100gml / 4.184
                                End If

                                'AGL 2015.01.22
                                If G_ReportOptions.intEnergyDisplay = 1 Then
                                    'xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, Format(dblKjPerServing, strValFormat) & " kj", Format(dblKjPer100gml, strValFormat) & " kj", strValueToPrint, " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, dblKjPerServing.ToString(strValFormat, userCulture) & " kj", dblKjPer100gml.ToString(strValFormat, userCulture) & " kj", strValueToPrint, " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    '------------------------------------------------------
                                    'If strValueToPrint <> "" Then
                                    xrNutrientRow = New XRTableRow
                                    'xrNutrientRow = fctMakeDataRow({" ", Format(dblKcalPerServing, strValFormat) & " kcal", Format(dblKcalPer100gml, strValFormat) & " kcal", IIf(strValueToPrint.ToString <> "", strValueToPrintKcal.ToString, ""), " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientRow = fctMakeDataRow({" ", dblKcalPerServing.ToString(strValFormat, userCulture) & " kcal", dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal", IIf(strValueToPrint.ToString <> "", strValueToPrintKcal.ToString, ""), " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    'End If
                                    ' xrNutrientRow.Dispose()
                                Else
                                    'JTOC 02.10.2014 Moved kcal before kj
                                    '-----------------------------------------------------
                                    'If strValueToPrint <> "" Then
                                    'xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, Format(dblKcalPerServing, strValFormat) & " kcal", Format(dblKcalPer100gml, strValFormat) & " kcal", IIf(strValueToPrint.ToString <> "", strValueToPrintKcal.ToString, ""), " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, dblKcalPerServing.ToString(strValFormat, userCulture) & " kcal", dblKcalPer100gml.ToString(strValFormat, userCulture) & " kcal", IIf(strValueToPrint.ToString <> "", strValueToPrintKcal.ToString, ""), " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    'End If
                                    '------------------------------------------------------
                                    xrNutrientRow = New XRTableRow
                                    'xrNutrientRow = fctMakeDataRow({" ", Format(dblKjPerServing, strValFormat) & " kJ", Format(dblKjPer100gml, strValFormat) & " kJ", strValueToPrint, " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientRow = fctMakeDataRow({" ", dblKjPerServing.ToString(strValFormat, userCulture) & " kJ", dblKjPer100gml.ToString(strValFormat, userCulture) & " kJ", strValueToPrint, " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                                    xrNutrientTable.Rows.Add(xrNutrientRow)
                                    ' xrNutrientRow.Dispose()
                                End If
                            Else
                                Dim dblNutPerServing As Double = 0, dblNutPer100gml As Double = 0
                                ' RDC 09.09.2013 : CWM-8371 Fix
                                If dblComputedValue(intSelPos - 1) > 0 Then
                                    dblNutPerServing = dblComputedValue(intSelPos - 1) / dblServingQty
                                    'dblNutPer100gml = (100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty) 'NBG 20160906 '(100 / (dblActualRecipeWt / dblServingQty)) * (dblComputedValue(intSelPos - 1) / dblServingQty)
                                    dblNutPer100gml = dblComputedValue(intSelPos - 1) / dblServingQty / dblActualRecipeWt
                                End If

                                ''If dblNutPerServing = 0 And dblNutPer100gml > 0 Then
                                ''    strPer100mgmlValue = Format(dblPer100gml, strValFormat) & " " & drDetail("Units")
                                ''ElseIf dblNutPerServing > 0 And dblNutPer100gml = 0 Then
                                ''    strPerServingValue = Format(dblPerServing, strValFormat) & " " & drDetail("Units")
                                ''ElseIf dblNutPerServing > 0 And dblPer100gml > 0 Then
                                'strPerServingValue = Format(dblNutPerServing, strValFormat) & " " & drDetail("Units")
                                'strPer100mgmlValue = Format(dblNutPer100gml, strValFormat) & " " & drDetail("Units")
                                strPerServingValue = dblNutPerServing.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                                strPer100mgmlValue = dblNutPer100gml.ToString(strValFormat, userCulture) & " " & drDetail("Units").ToString()
                                '    Else
                                '    strPerServingValue = ""
                                '    strPer100mgmlValue = ""
                                'End If

                                xrNutrientRow = fctMakeDataRow({drDetail("NutrientName").ToString, strPerServingValue, strPer100mgmlValue, strValueToPrint, " "}, {CInt(150), CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 600)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleRight}, , , G_ReportOptions.sgFontSize2)
                            End If
                            xrNutrientTable.Rows.Add(xrNutrientRow)
                        End If
                    Case Else

                End Select

            Next

            Detail.Controls.Add(xrNutrientTable)
            intNewY += (xrNutrientTable.Height + 20)

        Catch ex As Exception
            '  MsgBox(ex.Message)

        End Try

        'xrNutrientTable.Dispose()
        'dtNutInfo.Dispose()
        'dtNutValue.Dispose()
        'dtNutDetail.Dispose()
        'dtNutrients.Dispose()
        'dsNutrients.Dispose()


    End Sub

    Sub subDisplayGDAComputation(intCode As Integer, Optional intNutrientSet As Integer = 0, Optional intCodeTrans As Integer = 1, Optional intCodeSetPrice As Integer = 1, Optional ByVal userLocale As String = "en-US")
        Try
            Dim xrNutrientTable As New XRTable
            Dim xrNutrientRow As XRTableRow
            Dim xrNutrientCell As XRTableCell
            Dim cn As New SqlConnection(G_strConnection)
            cn.Open()
            Dim ds As New DataSet
            Dim da As New SqlDataAdapter("Exec sp_EgswDisplayCalculatedImposedNutrient @intItemCode=" & intCode & ", @intCodeTrans=" & intCodeTrans & ", @intNutrientSet=" & intNutrientSet & ",  @intCodeSetPrice=" & intCodeSetPrice, cn)
            da.Fill(ds)

            Dim dtItemInfo As DataTable = ds.Tables(0)
            Dim dtNutrientVal As DataTable = ds.Tables(1)
            Dim dtNutrientDetail As DataTable = ds.Tables(3)

            Dim dblActualRecipeWt As Double = 0
            Dim dblServingQty As Double = 0
            Dim strYieldUnit As String = ""
            Dim userCulture As CultureInfo = New CultureInfo(userLocale)

            For Each drItemInfo As DataRow In dtItemInfo.Rows
                dblActualRecipeWt = CDblDB(drItemInfo("ActualWtInGms"))
                dblServingQty = CDblDB(drItemInfo("Yield"))
                strYieldUnit = CStrDB(drItemInfo("YieldUnitDesc"))
            Next


            ' Plot Everything here
            Dim dblComputedValue() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim dblImposedValue() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                               0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim dblImposedValuePct() As Double = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
                                                  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0}
            Dim blnNutrientVisible() As Boolean = {False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False,
                                                   False, False, False, False, False, False, False, False, False, False, False, False, False, False}

            Dim intCalculatedCount As Integer = 0, intImposedCount As Integer = 0

            For Each drNutVal As DataRow In dtNutrientVal.Rows
                For intNutPos As Integer = 0 To 33 Step 1
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1))) Then dblComputedValue(intNutPos) = drNutVal("N" & CStr(intNutPos + 1)) Else dblComputedValue(intNutPos) = 0.0
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1) & "impose")) Then dblImposedValue(intNutPos) = drNutVal("N" & CStr(intNutPos + 1) & "impose") Else dblImposedValue(intNutPos) = 0.0
                    If Not IsDBNull(drNutVal("N" & CStr(intNutPos + 1) & "ImposePercent")) Then dblImposedValuePct(intNutPos) = drNutVal("N" & CStr(intNutPos + 1) & "ImposePercent") Else dblImposedValuePct(intNutPos) = 0.0
                    blnNutrientVisible(intNutPos) = CBoolDB(drNutVal("N" & CStr(intNutPos + 1) & "Display"))

                    ' Added condition for determining if all imposed or with defined calculated nutrient
                    If CDblDB(drNutVal("N" & CStr(intNutPos + 1))) > 0 Then intCalculatedCount += 1
                    If CDblDB(drNutVal("N" & CStr(intNutPos + 1) & "impose")) > 0 Or CDblDB(drNutVal("N" & CStr(intNutPos + 1) & "imposepercent")) > 0 Then intImposedCount += 1
                Next
            Next

            ' Do not generate GDA if values are imposed.
            If intCalculatedCount = 0 Then Exit Sub

            'Dim xrGDAHeader As XRTable = fctMakeSectionHeader(cLang.GetString(clsEGSLanguage.CodeType.GDA), intNewX, intNewY, intAvailableWidth, G_ReportOptions.sgFontSize2, G_ReportOptions.blnIncludeHighlightSection)
            'Detail.Controls.Add(xrGDAHeader)
            'intNewY += (xrGDAHeader.Height) + 5

            ' Report Section
            xrNutrientTable = New XRTable
            xrNutrientTable.Location = New Point(intNewX, intNewY)
            xrNutrientTable.Width = intAvailableWidth
            xrNutrientRow = New XRTableRow
            xrNutrientRow.Height = CInt(G_ReportOptions.sgFontSize2)
            'xrNutrientRow = fctMakeDataRow({Chr(32), cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100).Replace("%Y", strYieldUnit), cLang.GetString(clsEGSLanguage.CodeType.Per100gOR100mlat100Percent), Chr(32)}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
            xrNutrientRow = fctMakeDataRow({Chr(32), cLang.GetString(clsEGSLanguage.CodeType.PerYPercentAt100).Replace("%Y", strYieldUnit), "", Chr(32)}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
            xrNutrientTable.Rows.Add(xrNutrientRow)


            For Each drDetail As DataRow In dtNutrientDetail.Rows
                If blnNutrientVisible.Count <= drDetail("DisplayPosition") OrElse Not blnNutrientVisible(drDetail("DisplayPosition") - 1) Then Continue For 'JTOC 02.17.2014 Display only checked data on on nutrient details tab on recipe edit
                xrNutrientRow = New XRTableRow
                xrNutrientRow.Height = CInt(G_ReportOptions.sgFontSize2)

                Dim intSelPos As Integer = CInt(drDetail("NutSequence"))

                Dim dblGDAPer100Percent As Double = 0, dblGDAPer100gml As Double = 0

                ' RDC 09.09.2013 : CWM-8371 Fix
                If CDblDB(drDetail("GDA")) > 0 Then
                    Dim dblGDAValue As Double = CDblDB(drDetail("GDA"))
                    dblGDAPer100Percent = ((dblComputedValue(intSelPos - 1) / dblServingQty) / (dblGDAValue)) * 100
                    dblGDAPer100gml = ((100 / dblActualRecipeWt) * (dblComputedValue(intSelPos - 1) / dblServingQty) / (dblGDAValue)) * 100

                    Dim strGDAPer100Percent As String = "", strGDAPer100gml As String = ""

                    If Not dblGDAPer100Percent = 0 And dblGDAPer100Percent < 1 Then
                        strGDAPer100Percent = "< 1%"
                    ElseIf dblGDAPer100Percent = 0 Then
                        strGDAPer100Percent = "0%"
                    Else
                        'strGDAPer100Percent = FormatNumber(dblGDAPer100Percent, 0).ToString & "%"
                        strGDAPer100Percent = dblGDAPer100Percent.ToString("N0", userCulture) & "%"
                    End If

                    If Not dblGDAPer100gml = 0 And dblGDAPer100gml < 1 Then
                        strGDAPer100gml = "< 1%"
                    ElseIf dblGDAPer100gml = 0 Then
                        strGDAPer100gml = "0%"
                    Else
                        'strGDAPer100gml = FormatNumber(dblGDAPer100gml, 0).ToString & "%"
                        strGDAPer100gml = dblGDAPer100gml.ToString("N0", userCulture) & "%"
                    End If

                    strGDAPer100gml = ""

                    xrNutrientRow = fctMakeDataRow({drDetail("NutrientName"), strGDAPer100Percent, strGDAPer100gml, Chr(32)}, {CInt(150), CInt(150), CInt(150), CInt(intAvailableWidth - 450)}, {TextAlignment.MiddleLeft, TextAlignment.MiddleRight, TextAlignment.MiddleRight, TextAlignment.MiddleCenter})
                    xrNutrientTable.Rows.Add(xrNutrientRow)
                End If
            Next

            cn.Close()
            cn.Dispose()

            Detail.Controls.Add(xrNutrientTable)
            intNewY += (xrNutrientTable.Height) + 20
        Catch ex As Exception
            Log.Error("Error on subDisplayGDAComputation", ex)
        End Try
    End Sub

    Private Function getUnavalidatedQuantity(strWt As String, strUnit As String, Optional intCodeSite As Integer = 0, Optional intCodeTrans As Integer = 1) As DataTable
        Dim dt As New DataTable
        Try
            Dim cn As New SqlConnection(G_strConnection)
            cn.Open()

            Dim da As New SqlDataAdapter("Exec sp_EgswGetMetricImperialFromStringQtyAndUnit '" & strWt & "', '" & strUnit & "', " & intCodeTrans & ", " & intCodeSite, cn)
            da.Fill(dt)

            cn.Close()
            cn.Dispose()
            cn = Nothing
        Catch ex As Exception

        End Try

        Return dt
    End Function

#End Region

End Class